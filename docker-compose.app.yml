# Application Services - Backend & Frontend only
# Deploy these when code changes

services:
  shopbackend:
    image: rausach-backend:latest
    container_name: shopbackend
    restart: unless-stopped
    env_file:
      - .env.rausach
    environment:
      NODE_ENV: production
      PORT: 4000
      DATABASE_URL: postgresql://postgres:postgres@shoppostgres:5432/rausachcore
      REDIS_HOST: redis
      REDIS_PORT: 6379
      REDIS_KEY_PREFIX: "rausach:"
      MINIO_ENDPOINT: minio
      MINIO_PORT: 9000
      MINIO_USE_SSL: "false"
      MINIO_ACCESS_KEY: minio-admin
      MINIO_SECRET_KEY: minio-secret-2025
      MINIO_BUCKET_NAME: shopuploads
      GOOGLE_GEMINI_API_KEY: ${GOOGLE_GEMINI_API_KEY:-}
    ports:
      - "12001:4000"
    networks:
      - hybrid-network
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  shopfrontend:
    image: rausach-frontend:latest
    container_name: shopfrontend
    restart: unless-stopped
    environment:
      NODE_ENV: production
      PORT: 3000
      NEXT_OTEL_ENABLED: "false"
      NEXT_TELEMETRY_DISABLED: "1"
    ports:
      - "12000:3000"
    depends_on:
      - shopbackend
    networks:
      - hybrid-network
    deploy:
      resources:
        limits:
          memory: 256M
        reservations:
          memory: 128M

networks:
  hybrid-network:
    external: true
    name: rausach-network
