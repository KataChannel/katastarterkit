version: '3.8'

# ================================================================
# INNERV2 DOMAIN - PRODUCTION DEPLOYMENT
# ================================================================
# Frontend: http://116.118.48.208:13000
# Backend: http://116.118.48.208:13001
# Database: 116.118.48.208:13003
# ================================================================

services:
  # Backend with Bun
  innerv2-backend:
    build:
      context: .
      dockerfile: ./backend/Dockerfile
    container_name: innerv2-backend
    restart: unless-stopped
    env_file:
      - .env.prod.innerv2
    environment:
      NODE_ENV: production
      PORT: 4000
      DATABASE_URL: postgresql://postgres:postgres@116.118.48.208:13003/innerv2core
      REDIS_HOST: 116.118.48.208
      REDIS_PORT: 12004
      MINIO_ENDPOINT: 116.118.48.208
      MINIO_PORT: 12007
      MINIO_USE_SSL: false
      MINIO_BUCKET_NAME: innerv2-uploads
    ports:
      - "13001:4000"
    networks:
      - innerv2-network

  # Frontend with Next.js
  innerv2-frontend:
    build:
      context: .
      dockerfile: ./frontend/Dockerfile
    container_name: innerv2-frontend
    restart: unless-stopped
    env_file:
      - .env.prod.innerv2
    environment:
      NODE_ENV: production
      NEXT_PUBLIC_GRAPHQL_ENDPOINT: http://116.118.48.208:13001/graphql
      NEXT_PUBLIC_APP_URL: http://116.118.48.208:13000
      NEXTAUTH_URL: http://116.118.48.208:13000
      NEXT_OTEL_ENABLED: "false"
      NEXT_TELEMETRY_DISABLED: "1"
    ports:
      - "13000:3000"
    depends_on:
      - innerv2-backend
    networks:
      - innerv2-network

networks:
  innerv2-network:
    driver: bridge
    name: innerv2-network
