version: '3.8'

# ================================================================
# TAZAGROUP DOMAIN - PRODUCTION DEPLOYMENT
# ================================================================
# Frontend: http://116.118.49.243:13000
# Backend: http://116.118.49.243:13001
# Database: 116.118.49.243:13003
# ================================================================

services:
  # Backend with Bun
  tazagroup-backend:
    build:
      context: .
      dockerfile: ./backend/Dockerfile
    container_name: tazagroup-backend
    restart: unless-stopped
    env_file:
      - .env.prod.tazagroup
    environment:
      NODE_ENV: production
      PORT: 4000
      DATABASE_URL: postgresql://postgres:postgres@116.118.49.243:13003/tazagroupcore
      REDIS_HOST: 116.118.49.243
      REDIS_PORT: 12004
      MINIO_ENDPOINT: 116.118.49.243
      MINIO_PORT: 12007
      MINIO_USE_SSL: false
      MINIO_BUCKET_NAME: tazagroup-uploads
    ports:
      - "13001:4000"
    networks:
      - tazagroup-network

  # Frontend with Next.js
  tazagroup-frontend:
    build:
      context: .
      dockerfile: ./frontend/Dockerfile
    container_name: tazagroup-frontend
    restart: unless-stopped
    env_file:
      - .env.prod.tazagroup
    environment:
      NODE_ENV: production
      NEXT_PUBLIC_GRAPHQL_ENDPOINT: http://116.118.49.243:13001/graphql
      NEXT_PUBLIC_APP_URL: http://116.118.49.243:13000
      NEXTAUTH_URL: http://116.118.49.243:13000
      NEXT_OTEL_ENABLED: "false"
      NEXT_TELEMETRY_DISABLED: "1"
    ports:
      - "13000:3000"
    depends_on:
      - tazagroup-backend
    networks:
      - tazagroup-network

networks:
  tazagroup-network:
    driver: bridge
    name: tazagroup-network
