(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,591731,e=>{"use strict";var t=e.i(44990),a=e.i(403055),n=e.i(835819),s=e.i(415733),l=e.i(885205),r=e.i(198513),o=e.i(137651),i=e.i(696134),c=e.i(165429);let d=({isOpen:e,currentConfig:n,onSave:s,onClose:r})=>{let[d,m]=a.default.useState(n?.mst||""),[u,h]=a.default.useState(n?.companyName||"");return a.default.useEffect(()=>{n&&(m(n.mst),h(n.companyName))},[n]),(0,t.jsx)(o.Dialog,{open:e,onOpenChange:r,children:(0,t.jsxs)(o.DialogContent,{className:"sm:max-w-[500px]",children:[(0,t.jsxs)(o.DialogHeader,{children:[(0,t.jsx)(o.DialogTitle,{children:"Cáº¥u HÃ¬nh MÃ£ Sá»‘ Thuáº¿"}),(0,t.jsx)(o.DialogDescription,{children:"Nháº­p mÃ£ sá»‘ thuáº¿ Ä‘á»ƒ phÃ¢n loáº¡i hÃ³a Ä‘Æ¡n bÃ¡n/mua tá»± Ä‘á»™ng"})]}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d.trim()&&s({mst:d.trim(),companyName:u.trim()})},children:[(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)(c.Label,{htmlFor:"mst",children:["MÃ£ Sá»‘ Thuáº¿ (MST) ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,t.jsx)(i.Input,{id:"mst",value:d,onChange:e=>m(e.target.value),placeholder:"Nháº­p mÃ£ sá»‘ thuáº¿ cá»§a báº¡n",required:!0}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"MST dÃ¹ng Ä‘á»ƒ phÃ¢n loáº¡i hÃ³a Ä‘Æ¡n bÃ¡n/mua"})]}),(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsx)(c.Label,{htmlFor:"companyName",children:"TÃªn CÃ´ng Ty"}),(0,t.jsx)(i.Input,{id:"companyName",value:u,onChange:e=>h(e.target.value),placeholder:"Nháº­p tÃªn cÃ´ng ty"})]})]}),(0,t.jsxs)(o.DialogFooter,{children:[(0,t.jsx)(l.Button,{type:"button",variant:"outline",onClick:r,children:"Há»§y"}),(0,t.jsx)(l.Button,{type:"submit",children:"LÆ°u Cáº¥u HÃ¬nh"})]})]})]})})},m="xuatnhapton_user_config",u=e=>null==e?"0 â‚«":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),h=e=>null==e?"0":new Intl.NumberFormat("vi-VN").format(e),x=e=>{if(!e)return"";try{let t=new Date(e);return new Intl.DateTimeFormat("vi-VN").format(t)}catch(t){return e}},g=e=>{let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${a}-${n}`},p=!1,j=(e,t,a,n,s,l,r,o)=>{console.log("ðŸ”§ calculateInventory START:",{invoices:e.length,details:t.length,products:a.length});let i=new Map,c=e.filter(e=>{if(!e.tdlap)return!1;let t=new Date(e.tdlap),a=new Date(l),n=new Date(r);return n.setHours(23,59,59,999),t>=a&&t<=n});console.log("ðŸ“… Filtered by date:",c.length,"invoices");let d=0,m=0,u=0,h=0;c.forEach(e=>{let l=((e,t)=>{if(!t||!e)return null;let a=t.trim().toLowerCase(),n=e.nbmst?.trim().toLowerCase(),s=e.nmmst?.trim().toLowerCase();return(p||(console.log("ðŸ” classifyInvoice DEBUG:",{userMST:a,nbmst:n,nmmst:s,matchesSeller:n===a,matchesBuyer:s===a,invoice:e}),p=!0),n===a)?"sale":s===a?"purchase":null})(e,n);if(!l)return void m++;d++,"sale"===l&&u++,"purchase"===l&&h++;let r=t.filter(t=>t.idhdonServer===e.idServer);d<=2&&console.log(`ðŸ“„ Processing invoice #${d}:`,{type:l,id:e.id,idServer:e.idServer,nbmst:e.nbmst,nmmst:e.nmmst,detailsCount:r.length}),r.forEach(t=>{if(!t.ten)return;let{key:n,code:r,unit:o}=((e,t,a)=>{if(!t||0===t.length)return console.warn("âš ï¸ No products available for mapping, using original name"),{key:e,code:null,unit:null};let n=t.find(t=>t.ten?.toLowerCase()===e.toLowerCase());if(n)return{key:"ma"===a?n.ma||e:n.ten2||e,code:n.ma,unit:n.dvt};let s=t.find(t=>t.ten?.toLowerCase().includes(e.toLowerCase())||e.toLowerCase().includes(t.ten?.toLowerCase()||""));return s?{key:"ma"===a?s.ma||e:s.ten2||e,code:s.ma,unit:s.dvt}:{key:e,code:null,unit:null}})(t.ten,a,s),c=e.tdlap?new Date(e.tdlap).toISOString().split("T")[0]:"",d=`${n}_${c}`,m=i.get(d);m||(m={productName:n,originalName:t.ten,productCode:r,unit:o||t.dvtinh,date:c,openingQuantity:0,openingAmount:0,importQuantity:0,importAmount:0,exportQuantity:0,exportAmount:0,exportCostPrice:0,exportSalePrice:0,exportSaleAmount:0,closingQuantity:0,closingAmount:0},i.set(d,m));let u=Number(t.sluong)||0,h=Number(t.thtien)||0,x=Number(t.dgia)||0;"purchase"===l?(m.importQuantity+=u,m.importAmount+=h):"sale"===l&&(m.exportQuantity+=u,m.exportSalePrice=x,m.exportSaleAmount+=x*u)})}),console.log("âœ… Processed invoices:",d,"| Sales:",u,"| Purchases:",h,"| Skipped (no type):",m),console.log("ðŸ“¦ Inventory map size:",i.size);let x=Array.from(i.values());console.log("ðŸ“Š Inventory rows before grouping:",x.length);let g=new Map;x.forEach(e=>{let t=e.productName;g.has(t)||g.set(t,[]),g.get(t).push(e)}),console.log("ðŸ·ï¸ Product groups:",g.size);let j=[];return g.forEach(e=>{e.sort((e,t)=>e.date.localeCompare(t.date));let t=e[0].productName,a=o?.get(t),n=a?.quantity||0,s=a?.amount||0;a&&console.log(`ðŸ”µ Using opening balance for "${t}":`,{quantity:n,amount:s}),e.forEach(e=>{e.openingQuantity=n,e.openingAmount=s;let t=e.openingQuantity+e.importQuantity,a=e.openingAmount+e.importAmount,l=t>0?a/t:0;e.exportCostPrice=l,e.exportAmount=l*e.exportQuantity,e.closingQuantity=e.openingQuantity+e.importQuantity-e.exportQuantity,e.closingAmount=e.openingAmount+e.importAmount-e.exportAmount,n=e.closingQuantity,s=e.closingAmount,j.push(e)})}),console.log("ðŸŽ¯ FINAL ROWS:",j.length),j.length>0&&console.log("Sample row:",j[0]),j};var b=e.i(726759);let N=e=>({totalProducts:new Set(e.map(e=>e.productName)).size,totalRecords:e.length,totalOpeningQuantity:e.reduce((e,t)=>e+t.openingQuantity,0),totalOpeningAmount:e.reduce((e,t)=>e+t.openingAmount,0),totalImportQuantity:e.reduce((e,t)=>e+t.importQuantity,0),totalImportAmount:e.reduce((e,t)=>e+t.importAmount,0),totalExportQuantity:e.reduce((e,t)=>e+t.exportQuantity,0),totalExportAmount:e.reduce((e,t)=>e+t.exportAmount,0),totalExportSaleAmount:e.reduce((e,t)=>e+t.exportSaleAmount,0),totalClosingQuantity:e.reduce((e,t)=>e+t.closingQuantity,0),totalClosingAmount:e.reduce((e,t)=>e+t.closingAmount,0)});var f=e.i(775680),y=e.i(126455),T=e.i(475780),T=T,C=e.i(709786),C=C,S=e.i(742049),w=e.i(140007),v=e.i(759727),D=e.i(774309);let L=({summary:e,loading:a})=>a?(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 mb-6",children:[1,2,3,4,5,6].map(e=>(0,t.jsxs)(f.Card,{children:[(0,t.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(D.Skeleton,{className:"h-4 w-[100px]"}),(0,t.jsx)(D.Skeleton,{className:"h-4 w-4"})]}),(0,t.jsxs)(f.CardContent,{children:[(0,t.jsx)(D.Skeleton,{className:"h-8 w-[120px] mb-1"}),(0,t.jsx)(D.Skeleton,{className:"h-3 w-[80px]"})]})]},e))}):(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 mb-6",children:[(0,t.jsxs)(f.Card,{className:"border-l-4 border-l-slate-500",children:[(0,t.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(f.CardTitle,{className:"text-sm font-medium",children:"Tá»•ng Báº£n Ghi"}),(0,t.jsx)(w.ListOrdered,{className:"h-4 w-4 text-slate-500"})]}),(0,t.jsxs)(f.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:h(e.totalRecords)}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[h(e.totalProducts)," sáº£n pháº©m"]})]})]}),(0,t.jsxs)(f.Card,{className:"border-l-4 border-l-indigo-500",children:[(0,t.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(f.CardTitle,{className:"text-sm font-medium",children:"Tá»“n Äáº§u Ká»³"}),(0,t.jsx)(v.TrendingUp,{className:"h-4 w-4 text-indigo-500"})]}),(0,t.jsxs)(f.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:h(e.totalOpeningQuantity)}),(0,t.jsx)("p",{className:"text-xs text-indigo-600",children:u(e.totalOpeningAmount)})]})]}),(0,t.jsxs)(f.Card,{className:"border-l-4 border-l-green-500",children:[(0,t.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(f.CardTitle,{className:"text-sm font-medium",children:"Tá»•ng Nháº­p"}),(0,t.jsx)(T.default,{className:"h-4 w-4 text-green-500"})]}),(0,t.jsxs)(f.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:h(e.totalImportQuantity)}),(0,t.jsx)("p",{className:"text-xs text-green-600",children:u(e.totalImportAmount)})]})]}),(0,t.jsxs)(f.Card,{className:"border-l-4 border-l-orange-500",children:[(0,t.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(f.CardTitle,{className:"text-sm font-medium",children:"Tá»•ng Xuáº¥t"}),(0,t.jsx)(C.default,{className:"h-4 w-4 text-orange-500"})]}),(0,t.jsxs)(f.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:h(e.totalExportQuantity)}),(0,t.jsxs)("p",{className:"text-xs text-orange-600",title:"GiÃ¡ vá»‘n",children:["Vá»‘n: ",u(e.totalExportAmount)]}),(0,t.jsxs)("p",{className:"text-xs text-orange-800 font-medium",title:"Doanh thu bÃ¡n",children:["BÃ¡n: ",u(e.totalExportSaleAmount)]})]})]}),(0,t.jsxs)(f.Card,{className:"border-l-4 border-l-purple-500",children:[(0,t.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(f.CardTitle,{className:"text-sm font-medium",children:"Tá»“n Cuá»‘i Ká»³"}),(0,t.jsx)(S.Archive,{className:"h-4 w-4 text-purple-500"})]}),(0,t.jsxs)(f.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:h(e.totalClosingQuantity)}),(0,t.jsx)("p",{className:"text-xs text-purple-600",children:u(e.totalClosingAmount)})]})]}),(0,t.jsxs)(f.Card,{className:"border-l-4 border-l-blue-500",children:[(0,t.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(f.CardTitle,{className:"text-sm font-medium",children:"Sáº£n Pháº©m"}),(0,t.jsx)(y.Package,{className:"h-4 w-4 text-blue-500"})]}),(0,t.jsxs)(f.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:h(e.totalProducts)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Unique SKU"})]})]})]});var A=e.i(183194),k=e.i(850384),P=e.i(706547),Q=e.i(791174),I=e.i(248025),H=e.i(996701),E=e.i(169989);let M=({searchTerm:e,onSearchChange:n,dateRange:s,onDateRangeChange:r,onSearch:o,groupBy:d,onGroupByChange:m,sortField:u,sortDirection:h,onSortChange:x,onExport:g,onRefresh:p,onConfig:j,loading:b,totalRecords:N=0,displayedRecords:y=0,isSearching:T=!1})=>{let[C,S]=(0,a.useState)(s);(0,a.useEffect)(()=>{S(s)},[s]);let w=C.startDate!==s.startDate||C.endDate!==s.endDate||C.periodStartDate!==s.periodStartDate;return(0,t.jsx)(f.Card,{className:"mb-6",children:(0,t.jsxs)(f.CardContent,{className:"pt-6 space-y-4",children:[C.periodStartDate&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm bg-green-50 dark:bg-green-950 border border-green-200 dark:border-green-800 px-4 py-2 rounded-md",children:[(0,t.jsxs)("span",{className:"text-green-700 dark:text-green-300",children:["ðŸ”µ ",(0,t.jsx)("strong",{children:"NgÃ y chá»‘t Ä‘áº§u ká»³:"})," ",new Date(C.periodStartDate).toLocaleDateString("vi-VN")]}),(0,t.jsx)("span",{className:"text-xs text-green-600 dark:text-green-400",children:"(Tá»“n Ä‘áº§u tÃ­nh tá»« 5 nÄƒm trÆ°á»›c)"})]}),N>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-blue-50 dark:bg-blue-950 px-4 py-2 rounded-md",children:[(0,t.jsxs)("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:["Tá»•ng sá»‘: ",N.toLocaleString()," báº£n ghi"]}),N!==y&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"â€¢"}),(0,t.jsxs)("span",{className:"text-amber-700 dark:text-amber-300",children:["Hiá»ƒn thá»‹: ",y.toLocaleString()," báº£n ghi"]}),(0,t.jsx)("span",{className:"text-xs",children:"(Xuáº¥t Excel Ä‘á»ƒ xem Ä‘áº§y Ä‘á»§)"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[T?(0,t.jsx)(E.Loader2,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-primary animate-spin"}):(0,t.jsx)(k.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(i.Input,{value:e,onChange:e=>n(e.target.value),placeholder:"TÃ¬m kiáº¿m theo tÃªn, mÃ£ sáº£n pháº©m, Ä‘Æ¡n vá»‹...",className:"pl-9 transition-all duration-200 focus:ring-2 focus:ring-primary"}),e&&(0,t.jsx)("button",{onClick:()=>n(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",title:"XÃ³a tÃ¬m kiáº¿m",children:"âœ•"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(l.Button,{variant:"outline",size:"default",onClick:j,children:[(0,t.jsx)(P.Settings,{className:"h-4 w-4 mr-2"}),"Cáº¥u HÃ¬nh"]}),(0,t.jsxs)(l.Button,{variant:"outline",size:"default",onClick:p,disabled:b,children:[(0,t.jsx)(Q.RefreshCw,{className:`h-4 w-4 mr-2 ${b?"animate-spin":""}`}),"LÃ m Má»›i"]}),(0,t.jsxs)(l.Button,{variant:"default",size:"default",onClick:g,children:[(0,t.jsx)(I.FileSpreadsheet,{className:"h-4 w-4 mr-2"}),"Xuáº¥t Excel"]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)(c.Label,{htmlFor:"periodStartDate",className:"flex items-center gap-1",children:["NgÃ y Chá»‘t Äáº§u Ká»³",(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"(optional)"})]}),(0,t.jsx)(i.Input,{id:"periodStartDate",type:"date",value:C.periodStartDate||"",onChange:e=>S({...C,periodStartDate:e.target.value||void 0}),placeholder:"Chá»n ngÃ y chá»‘t",title:"Chá»n ngÃ y chá»‘t Ä‘áº§u ká»³ Ä‘á»ƒ tÃ­nh tá»“n Ä‘áº§u tá»« 5 nÄƒm trÆ°á»›c"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"TÃ­nh tá»“n Ä‘áº§u tá»« giao dá»‹ch 5 nÄƒm trÆ°á»›c"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"startDate",children:"Tá»« NgÃ y"}),(0,t.jsx)(i.Input,{id:"startDate",type:"date",value:C.startDate,onChange:e=>S({...C,startDate:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"endDate",children:"Äáº¿n NgÃ y"}),(0,t.jsx)(i.Input,{id:"endDate",type:"date",value:C.endDate,onChange:e=>S({...C,endDate:e.target.value})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{className:"opacity-0",children:"Action"}),(0,t.jsxs)(l.Button,{variant:w?"default":"outline",size:"default",onClick:()=>{r(C),o()},disabled:b,className:"w-full",children:[(0,t.jsx)(k.Search,{className:"h-4 w-4 mr-2"}),w?"TÃ¬m kiáº¿m":"ÄÃ£ cáº­p nháº­t"]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{htmlFor:"groupBy",children:"NhÃ³m Theo"}),(0,t.jsxs)(A.Select,{value:d,onValueChange:e=>m(e),children:[(0,t.jsx)(A.SelectTrigger,{id:"groupBy",children:(0,t.jsx)(A.SelectValue,{})}),(0,t.jsxs)(A.SelectContent,{children:[(0,t.jsx)(A.SelectItem,{value:"ma",children:"MÃ£ Sáº£n Pháº©m"}),(0,t.jsx)(A.SelectItem,{value:"ten2",children:"TÃªn Chuáº©n HÃ³a"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.Label,{children:"Sáº¯p Xáº¿p"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(A.Select,{value:u,onValueChange:e=>x(e,h),children:[(0,t.jsx)(A.SelectTrigger,{className:"flex-1",children:(0,t.jsx)(A.SelectValue,{})}),(0,t.jsxs)(A.SelectContent,{children:[(0,t.jsx)(A.SelectItem,{value:"date",children:"NgÃ y"}),(0,t.jsx)(A.SelectItem,{value:"productName",children:"TÃªn SP"}),(0,t.jsx)(A.SelectItem,{value:"closingQuantity",children:"SL Tá»“n"}),(0,t.jsx)(A.SelectItem,{value:"closingAmount",children:"TT Tá»“n"})]})]}),(0,t.jsx)(l.Button,{variant:"outline",size:"icon",onClick:()=>x(u,"asc"===h?"desc":"asc"),title:"asc"===h?"TÄƒng dáº§n":"Giáº£m dáº§n",children:(0,t.jsx)(H.ArrowUpDown,{className:"h-4 w-4"})})]})]})]})]})})};var B=e.i(741850);let $=({rows:e,currentPage:a,itemsPerPage:n,loading:s,totalRecords:l=0,isLimited:r=!1,searchTerm:o="",isSearching:i=!1})=>{let c=(a-1)*n,d=Math.min(c+n,e.length),m=e.slice(c,d);console.log("rows",e),console.log("ðŸ“‹ InventoryTable render:",{totalRows:e.length,displayRows:m.length,currentPage:a,itemsPerPage:n,startIndex:c,endIndex:d,loading:s,searchTerm:o,isSearching:i});let g=(e,a)=>{if(!e||!a)return e||"-";let n=e.toLowerCase(),s=a.toLowerCase(),l=n.indexOf(s);if(-1===l)return e;let r=e.slice(0,l),o=e.slice(l,l+a.length),i=e.slice(l+a.length);return(0,t.jsxs)(t.Fragment,{children:[r,(0,t.jsx)("mark",{className:"bg-yellow-200 dark:bg-yellow-800 font-semibold",children:o}),i]})};return s?(0,t.jsx)(f.Card,{children:(0,t.jsx)(f.CardContent,{className:"p-8",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center text-center",children:[(0,t.jsx)(E.Loader2,{className:"h-8 w-8 animate-spin text-primary mb-2"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Äang táº£i dá»¯ liá»‡u..."})]})})}):0===e.length?(0,t.jsx)(f.Card,{children:(0,t.jsx)(f.CardContent,{className:"p-8",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center text-center",children:[(0,t.jsx)(y.Package,{className:"h-12 w-12 text-muted-foreground mb-2"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ hiá»ƒn thá»‹"})]})})}):(0,t.jsxs)(f.Card,{children:[r&&l>e.length&&(0,t.jsx)("div",{className:"bg-amber-50 dark:bg-amber-950 border-b border-amber-200 dark:border-amber-800 px-4 py-3",children:(0,t.jsxs)("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:["âš ï¸ Hiá»ƒn thá»‹ ",e.length.toLocaleString()," / ",l.toLocaleString()," báº£n ghi Ä‘á»ƒ tá»‘i Æ°u hiá»‡u suáº¥t.",(0,t.jsx)("span",{className:"font-medium",children:' Sá»­ dá»¥ng "Xuáº¥t Excel" Ä‘á»ƒ xem toÃ n bá»™ dá»¯ liá»‡u.'})]})}),o&&(0,t.jsx)("div",{className:"bg-blue-50 dark:bg-blue-950 border-b border-blue-200 dark:border-blue-800 px-4 py-3",children:(0,t.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["ðŸ” TÃ¬m kiáº¿m: ",(0,t.jsxs)("span",{className:"font-semibold",children:['"',o,'"']})," -",i?(0,t.jsx)("span",{className:"ml-2 italic",children:"Äang tÃ¬m kiáº¿m..."}):(0,t.jsxs)("span",{className:"ml-2",children:["TÃ¬m tháº¥y ",e.length.toLocaleString()," káº¿t quáº£"]})]})}),(0,t.jsx)(f.CardContent,{className:"p-0",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)(B.Table,{children:[(0,t.jsxs)(B.TableHeader,{children:[(0,t.jsxs)(B.TableRow,{children:[(0,t.jsx)(B.TableHead,{className:"w-[60px]",children:"STT"}),(0,t.jsx)(B.TableHead,{className:"w-[120px]",children:"NgÃ y"}),(0,t.jsx)(B.TableHead,{className:"min-w-[250px]",children:"TÃªn Sáº£n Pháº©m"}),(0,t.jsx)(B.TableHead,{className:"min-w-[250px]",children:"TÃªn Gá»‘c (HÃ³a ÄÆ¡n)"}),(0,t.jsx)(B.TableHead,{className:"w-[120px]",children:"MÃ£ SP"}),(0,t.jsx)(B.TableHead,{className:"w-[80px]",children:"ÄVT"}),(0,t.jsx)(B.TableHead,{colSpan:2,className:"text-center bg-blue-50",children:"Tá»“n Äáº§u"}),(0,t.jsx)(B.TableHead,{colSpan:2,className:"text-center bg-green-50",children:"Nháº­p"}),(0,t.jsx)(B.TableHead,{colSpan:5,className:"text-center bg-orange-50",children:"Xuáº¥t"}),(0,t.jsx)(B.TableHead,{colSpan:2,className:"text-center bg-purple-50",children:"Tá»“n Cuá»‘i"})]}),(0,t.jsxs)(B.TableRow,{children:[(0,t.jsx)(B.TableHead,{colSpan:6}),(0,t.jsx)(B.TableHead,{className:"text-right bg-blue-50",children:"SL"}),(0,t.jsx)(B.TableHead,{className:"text-right bg-blue-50",children:"ThÃ nh Tiá»n"}),(0,t.jsx)(B.TableHead,{className:"text-right bg-green-50",children:"SL"}),(0,t.jsx)(B.TableHead,{className:"text-right bg-green-50",children:"ThÃ nh Tiá»n"}),(0,t.jsx)(B.TableHead,{className:"text-right bg-orange-50",children:"SL"}),(0,t.jsx)(B.TableHead,{className:"text-right bg-orange-50",children:"GiÃ¡ Vá»‘n"}),(0,t.jsx)(B.TableHead,{className:"text-right bg-orange-50",children:"TT Vá»‘n"}),(0,t.jsx)(B.TableHead,{className:"text-right bg-orange-50",children:"GiÃ¡ BÃ¡n"}),(0,t.jsx)(B.TableHead,{className:"text-right bg-orange-50",children:"TT BÃ¡n"}),(0,t.jsx)(B.TableHead,{className:"text-right bg-purple-50",children:"SL"}),(0,t.jsx)(B.TableHead,{className:"text-right bg-purple-50",children:"ThÃ nh Tiá»n"})]})]}),(0,t.jsx)(B.TableBody,{children:m.map((e,a)=>(0,t.jsxs)(B.TableRow,{className:"animate-in fade-in duration-200",style:{animationDelay:`${20*a}ms`},children:[(0,t.jsx)(B.TableCell,{className:"font-medium",children:c+a+1}),(0,t.jsx)(B.TableCell,{className:"whitespace-nowrap",children:x(e.date)}),(0,t.jsx)(B.TableCell,{className:"font-medium",children:g(e.productName,o)}),(0,t.jsx)(B.TableCell,{className:"text-muted-foreground text-sm",children:g(e.originalName,o)}),(0,t.jsx)(B.TableCell,{className:"text-muted-foreground",children:g(e.productCode,o)}),(0,t.jsx)(B.TableCell,{className:"text-muted-foreground",children:g(e.unit,o)}),(0,t.jsx)(B.TableCell,{className:"text-right bg-blue-50",children:h(e.openingQuantity)}),(0,t.jsx)(B.TableCell,{className:"text-right text-blue-600 bg-blue-50",children:u(e.openingAmount)}),(0,t.jsx)(B.TableCell,{className:"text-right bg-green-50",children:h(e.importQuantity)}),(0,t.jsx)(B.TableCell,{className:"text-right text-green-600 bg-green-50",children:u(e.importAmount)}),(0,t.jsx)(B.TableCell,{className:"text-right bg-orange-50",children:h(e.exportQuantity)}),(0,t.jsx)(B.TableCell,{className:"text-right text-orange-600 bg-orange-50",title:"GiÃ¡ vá»‘n bÃ¬nh quÃ¢n gia quyá»n",children:u(e.exportCostPrice)}),(0,t.jsx)(B.TableCell,{className:"text-right text-orange-600 bg-orange-50",title:"ThÃ nh tiá»n vá»‘n",children:u(e.exportAmount)}),(0,t.jsx)(B.TableCell,{className:"text-right text-orange-700 bg-orange-50",title:"GiÃ¡ bÃ¡n (tá»« Ä‘Æ¡n hÃ ng)",children:u(e.exportSalePrice)}),(0,t.jsx)(B.TableCell,{className:"text-right text-orange-800 font-medium bg-orange-50",title:"ThÃ nh tiá»n bÃ¡n",children:u(e.exportSaleAmount)}),(0,t.jsx)(B.TableCell,{className:"text-right font-semibold bg-purple-50",children:h(e.closingQuantity)}),(0,t.jsx)(B.TableCell,{className:"text-right font-semibold text-purple-600 bg-purple-50",children:u(e.closingAmount)})]},`${e.productName}-${e.date}-${a}`))})]})})})]})};var O=e.i(630596),F=e.i(567961);let R=({currentPage:e,totalPages:a,totalItems:n,itemsPerPage:s,onPageChange:r,canGoPrev:o,canGoNext:i,totalRecords:c=0,isLimited:d=!1})=>{let m=Math.min(e*s,n);return 0===n?null:(0,t.jsxs)("div",{className:"flex items-center justify-between px-2 py-4",children:[(0,t.jsxs)("div",{className:"flex-1 text-sm text-muted-foreground",children:["Hiá»ƒn thá»‹ ",(0,t.jsx)("span",{className:"font-medium",children:(e-1)*s+1})," Ä‘áº¿n"," ",(0,t.jsx)("span",{className:"font-medium",children:m})," trong tá»•ng sá»‘"," ",(0,t.jsx)("span",{className:"font-medium",children:n})," káº¿t quáº£",d&&c>n&&(0,t.jsxs)("span",{className:"ml-2 text-amber-600 dark:text-amber-400",children:["(",c.toLocaleString()," tá»•ng - giá»›i háº¡n hiá»ƒn thá»‹)"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>r(e-1),disabled:!o,children:[(0,t.jsx)(O.ChevronLeft,{className:"h-4 w-4 mr-1"}),"TrÆ°á»›c"]}),(0,t.jsx)("div",{className:"hidden md:flex items-center gap-1",children:(()=>{let t=[];if(a<=5)for(let e=1;e<=a;e++)t.push(e);else{t.push(1),e>3&&t.push("...");let n=Math.max(2,e-1),s=Math.min(a-1,e+1);for(let e=n;e<=s;e++)t.push(e);e<a-2&&t.push("..."),t.push(a)}return t})().map((a,n)=>"..."===a?(0,t.jsx)("span",{className:"px-2",children:"..."},`ellipsis-${n}`):(0,t.jsx)(l.Button,{variant:e===a?"default":"outline",size:"sm",onClick:()=>r(a),className:"w-9",children:a},a))}),(0,t.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>r(e+1),disabled:!i,children:["Sau",(0,t.jsx)(F.ChevronRight,{className:"h-4 w-4 ml-1"})]})]})]})};var G=e.i(125284);function V(){let e,o,[i,c]=(0,a.useState)(null),[u,h]=(0,a.useState)(!1),[p,f]=(0,a.useState)((e=new Date,(o=new Date).setDate(o.getDate()-30),{startDate:g(o),endDate:g(e)})),[y,T]=(0,a.useState)(""),C=function(e,t=300){let[n,s]=(0,a.useState)(e);return(0,a.useEffect)(()=>{let a=setTimeout(()=>{s(e)},t);return()=>{clearTimeout(a)}},[e,t]),n}(y,300),[S,w]=(0,a.useState)(!1),[v,D]=(0,a.useState)("ma"),[A,k]=(0,a.useState)("date"),[P,Q]=(0,a.useState)("desc"),[I]=(0,a.useState)(50),{invoices:H,details:E,products:B,loading:O,error:F,isReady:V,refetch:_}=(()=>{let[e,t]=(0,a.useState)(!1),[n,s]=(0,a.useState)(!1),[l,r]=(0,a.useState)(!1),{data:o,loading:i,error:c,refetch:d}=(0,G.useDynamicQuery)("GET_ALL","ext_listhoadon",{fetchPolicy:"network-only"});console.log("invoicesData",o);let{data:m,loading:u,error:h,refetch:x}=(0,G.useDynamicQuery)("GET_ALL","ext_detailhoadon",{fetchPolicy:"network-only"}),{data:g,loading:p,error:j,refetch:b}=(0,G.useDynamicQuery)("GET_ALL","ext_sanphamhoadon",{fetchPolicy:"network-only"}),N=o?.getext_listhoadons||[],f=m?.getext_detailhoadons||[],y=g?.getext_sanphamhoadons||[];(0,a.useEffect)(()=>{N.length>0&&!n&&(console.log("ðŸ“‹ Sample invoice:",N[0]),console.log("ðŸ“‹ Invoice fields:",Object.keys(N[0])),s(!0)),f.length>0&&!l&&(console.log("ðŸ“„ Sample detail:",f[0]),console.log("ðŸ“„ Detail fields:",Object.keys(f[0])),r(!0))},[N,f,n,l]),(0,a.useEffect)(()=>{i||u||p||t(!0)},[i,u,p]);let T=async()=>{await Promise.all([d(),x(),b()])};return{invoices:N,details:f,products:y,loading:{invoices:i,details:u,products:p,any:i||u||p},error:{invoices:c?.message||null,details:h?.message||null,products:j?.message||null,any:c||h||j},isReady:e,refetch:T}})();(0,a.useEffect)(()=>{let e=(()=>{try{let e=localStorage.getItem(m);if(!e)return null;return JSON.parse(e)}catch(e){return console.error("Error reading user config:",e),null}})();e?c(e):h(!0)},[]);let z=(({rows:e,searchTerm:t,sortField:n,sortDirection:s})=>(0,a.useMemo)(()=>{let a=performance.now(),l=[...e];if(t){let n=t.toLowerCase().trim();l=l.filter(e=>e.productName?.toLowerCase().includes(n)||e.productCode?.toLowerCase().includes(n)||e.unit?.toLowerCase().includes(n));let s=performance.now();console.log(`ðŸ” Search completed in ${(s-a).toFixed(2)}ms - Found ${l.length}/${e.length} records`)}return l.sort((e,t)=>{let a,l;switch(n){case"date":a=new Date(e.date).getTime(),l=new Date(t.date).getTime();break;case"productName":a=(e.productName||"").toLowerCase(),l=(t.productName||"").toLowerCase();break;case"closingQuantity":a=e.closingQuantity||0,l=t.closingQuantity||0;break;case"closingAmount":a=e.closingAmount||0,l=t.closingAmount||0;break;default:a=0,l=0}let r=a<l?-1:+(a>l);return"asc"===s?r:-r}),l},[e,t,n,s]))({rows:(0,a.useMemo)(()=>{let e;if(!i||!V)return console.log("âš ï¸ Inventory calculation skipped:",{hasUserConfig:!!i,isReady:V,userConfig:i}),[];console.log("ðŸ“Š Calculating inventory with:",{invoicesCount:H.length,detailsCount:E.length,productsCount:B.length,userMST:i.mst,groupBy:v,dateRange:p,periodStartDate:p.periodStartDate,sampleInvoice:H[0],sampleDetail:E[0],sampleProduct:B[0]});let t=i.mst.trim().toLowerCase(),a=H.filter(e=>e.nbmst?.trim().toLowerCase()===t),n=H.filter(e=>e.nmmst?.trim().toLowerCase()===t);if(console.log("ðŸ” MST Matching Debug:",{userMST:i.mst,userMSTLower:t,matchingSalesCount:a.length,matchingPurchasesCount:n.length,sampleSaleInvoice:a[0],samplePurchaseInvoice:n[0],firstInvoiceNbmst:H[0]?.nbmst,firstInvoiceNmmst:H[0]?.nmmst}),p.periodStartDate){var s,l;let t,a,n,r,o;console.log("ðŸ”µ Calculating opening balance from period start:",p.periodStartDate),s=i.mst,console.log("ðŸ”µ calculateOpeningBalance START:",{periodStartDate:l=p.periodStartDate}),(a=new Date(t=new Date(l))).setFullYear(t.getFullYear()-5),console.log("ðŸ“… Date range for opening balance:",{from:a.toISOString().split("T")[0],to:l}),(n=new Date(t)).setDate(n.getDate()-1),r=j(H,E,B,s,v,a.toISOString().split("T")[0],n.toISOString().split("T")[0]),o=new Map,r.forEach(e=>{let t=o.get(e.productName);t?(t.quantity+=e.closingQuantity,t.amount+=e.closingAmount):o.set(e.productName,{productName:e.productName,quantity:e.closingQuantity,amount:e.closingAmount})}),console.log("âœ… Opening balance calculated for",o.size,"products"),o.size>0&&console.log("Sample opening balances:",Array.from(o.values()).slice(0,3)),console.log("âœ… Opening balance calculated for",(e=o).size,"products")}let r=j(H,E,B,i.mst,v,p.startDate,p.endDate,e);return console.log("âœ… Inventory rows calculated:",r.length),r.length>0?console.log("Sample result rows (first 3):",r.slice(0,3)):console.warn("âš ï¸ No inventory rows generated! Check MST matching logic."),r},[H,E,B,i,v,p,V]),searchTerm:C,sortField:A,sortDirection:P});(0,a.useEffect)(()=>{y!==C?w(!0):w(!1)},[y,C]),console.log("ðŸ” Filtered rows:",z.length,{searchTerm:C,sortField:A,sortDirection:P});let X=z.length,q=z.slice(0,100),U=X>100,K=(0,a.useMemo)(()=>N(q),[q]),{currentPage:Y,totalPages:J,startIndex:W,endIndex:Z,goToPage:ee,nextPage:et,prevPage:ea,canGoNext:en,canGoPrev:es}=(({totalItems:e,itemsPerPage:t})=>{let[n,s]=(0,a.useState)(1),l=Math.ceil(e/t),r=(n-1)*t,o=Math.min(r+t,e);return(0,a.useEffect)(()=>{n>l&&l>0&&s(1)},[n,l]),{currentPage:n,totalPages:l,startIndex:r,endIndex:o,goToPage:e=>{e>=1&&e<=l&&s(e)},nextPage:()=>{n<l&&s(e=>e+1)},prevPage:()=>{n>1&&s(e=>e-1)},canGoNext:n<l,canGoPrev:n>1}})({totalItems:q.length,itemsPerPage:I}),el=async()=>{try{await _(),n.toast.success("ÄÃ£ lÃ m má»›i dá»¯ liá»‡u")}catch(e){console.error("Refresh error:",e),n.toast.error("Lá»—i khi lÃ m má»›i dá»¯ liá»‡u")}};(0,a.useEffect)(()=>{F.any&&(F.invoices&&n.toast.error(`Lá»—i táº£i h\xf3a Ä‘Æ¡n: ${F.invoices}`),F.details&&n.toast.error(`Lá»—i táº£i chi tiáº¿t: ${F.details}`),F.products&&n.toast.error(`Lá»—i táº£i sáº£n pháº©m: ${F.products}`))},[F]);let er=!i&&!u;return(0,t.jsxs)("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"BÃ¡o CÃ¡o Xuáº¥t Nháº­p Tá»“n"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"Quáº£n lÃ½ vÃ  theo dÃµi xuáº¥t nháº­p tá»“n kho theo hÃ³a Ä‘Æ¡n"}),i&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["MST: ",(0,t.jsx)("span",{className:"font-medium",children:i.mst}),i.companyName&&` - ${i.companyName}`]})]}),er&&(0,t.jsxs)(s.Alert,{className:"border-yellow-500 bg-yellow-50",children:[(0,t.jsx)(r.AlertCircle,{className:"h-4 w-4 text-yellow-600"}),(0,t.jsxs)(s.AlertDescription,{className:"text-yellow-700",children:[(0,t.jsx)("span",{className:"font-medium",children:"Cáº§n cáº¥u hÃ¬nh MST:"})," Vui lÃ²ng cáº¥u hÃ¬nh mÃ£ sá»‘ thuáº¿ (MST) Ä‘á»ƒ phÃ¢n loáº¡i hÃ³a Ä‘Æ¡n bÃ¡n/mua."," ",(0,t.jsx)(l.Button,{variant:"link",className:"h-auto p-0 text-yellow-800 underline",onClick:()=>h(!0),children:"Cáº¥u hÃ¬nh ngay"})]})]}),(0,t.jsx)(d,{isOpen:u,currentConfig:i,onSave:e=>{try{localStorage.setItem(m,JSON.stringify(e))}catch(e){console.error("Error saving user config:",e)}c(e),h(!1),n.toast.success("ÄÃ£ lÆ°u cáº¥u hÃ¬nh MST")},onClose:()=>h(!1)}),(0,t.jsx)(L,{summary:K,loading:O.any}),(0,t.jsx)(M,{searchTerm:y,onSearchChange:T,dateRange:p,onDateRangeChange:f,onSearch:()=>{n.toast.info(`T\xecm tháº¥y ${X} báº£n ghi${U?`, hiá»ƒn thá»‹ 100 Ä‘áº§u ti\xean`:""}`)},groupBy:v,onGroupByChange:D,sortField:A,sortDirection:P,onSortChange:(e,t)=>{k(e),Q(t)},onExport:()=>{if(!i){n.toast.error("Vui lÃ²ng cáº¥u hÃ¬nh MST trÆ°á»›c"),h(!0);return}if(0===z.length)return void n.toast.error("KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ xuáº¥t");try{var e;let t,a,s,l,r,o=N(z);e=i.companyName||"CÃ´ng ty",t=b.utils.book_new(),(a=[]).push(["BÃO CÃO XUáº¤T NHáº¬P Tá»’N"]),a.push([e]),a.push([`Tá»« ng\xe0y: ${x(p.startDate)} - Äáº¿n ng\xe0y: ${x(p.endDate)}`]),a.push([]),a.push(["NgÃ y","TÃªn Sáº£n Pháº©m","MÃ£ SP","ÄVT","SL Tá»“n Äáº§u","TT Tá»“n Äáº§u","SL Nháº­p","TT Nháº­p","SL Xuáº¥t","GiÃ¡ Vá»‘n","TT Vá»‘n","GiÃ¡ BÃ¡n","TT BÃ¡n","SL Tá»“n Cuá»‘i","TT Tá»“n Cuá»‘i"]),z.forEach(e=>{a.push([x(e.date),e.productName,e.productCode||"",e.unit||"",e.openingQuantity,e.openingAmount,e.importQuantity,e.importAmount,e.exportQuantity,e.exportCostPrice,e.exportAmount,e.exportSalePrice,e.exportSaleAmount,e.closingQuantity,e.closingAmount])}),a.push([]),a.push(["Tá»”NG Há»¢P"]),a.push(["Tá»•ng sá»‘ sáº£n pháº©m:",o.totalProducts]),a.push(["Tá»•ng SL nháº­p:",o.totalImportQuantity]),a.push(["Tá»•ng TT nháº­p:",o.totalImportAmount]),a.push(["Tá»•ng SL xuáº¥t:",o.totalExportQuantity]),a.push(["Tá»•ng TT vá»‘n:",o.totalExportAmount]),a.push(["Tá»•ng TT bÃ¡n:",o.totalExportSaleAmount]),a.push(["Tá»•ng SL tá»“n cuá»‘i:",o.totalClosingQuantity]),a.push(["Tá»•ng TT tá»“n cuá»‘i:",o.totalClosingAmount]),(s=b.utils.aoa_to_sheet(a))["!cols"]=[{wch:12},{wch:40},{wch:15},{wch:10},{wch:12},{wch:15},{wch:12},{wch:15},{wch:12},{wch:15},{wch:15},{wch:15},{wch:15},{wch:12},{wch:15}],s["!merges"]=[{s:{r:0,c:0},e:{r:0,c:14}},{s:{r:1,c:0},e:{r:1,c:14}},{s:{r:2,c:0},e:{r:2,c:14}}],b.utils.book_append_sheet(t,s,"Xuáº¥t Nháº­p Tá»“n"),l=new Date().toISOString().split("T")[0],r=`XuatNhapTon_${l}.xlsx`,b.writeFile(t,r),n.toast.success(`Ä\xe3 xuáº¥t ${z.length.toLocaleString()} báº£n ghi ra Excel`)}catch(e){console.error("Export error:",e),n.toast.error("Lá»—i khi xuáº¥t file Excel")}},onRefresh:el,onConfig:()=>h(!0),loading:O.any,totalRecords:X,displayedRecords:q.length,isSearching:S}),(0,t.jsx)($,{rows:q,currentPage:Y,itemsPerPage:I,loading:O.any,totalRecords:X,isLimited:U,searchTerm:C,isSearching:S}),(0,t.jsx)(R,{currentPage:Y,totalPages:J,totalItems:q.length,itemsPerPage:I,onPageChange:ee,canGoPrev:es,canGoNext:en,totalRecords:X,isLimited:U})]})}e.s(["default",()=>V],591731)}]);