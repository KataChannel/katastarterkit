module.exports=[723989,a=>{"use strict";var b=a.i(699665);a.s(["MoreVertical",()=>b.default])},638735,a=>{"use strict";var b=a.i(273841);a.s(["MessageSquare",()=>b.default])},140300,a=>{"use strict";var b=a.i(814588);a.s(["Mail",()=>b.default])},434741,a=>{"use strict";var b=a.i(557079);a.s(["Phone",()=>b.default])},508477,a=>{"use strict";var b=a.i(36755);a.s(["Facebook",()=>b.default])},625783,a=>{"use strict";var b=a.i(321248),c=a.i(651332),d=a.i(421396),e=a.i(196467),f=a.i(168918),g=a.i(8912),h=a.i(40947),i=a.i(649515),j=a.i(638735),k=a.i(629432),l=a.i(723989),m=a.i(502794),n=a.i(921599),o=a.i(434741),p=a.i(140300),q=a.i(500891),r=a.i(508477),s=a.i(646254);function t(){let{user:a}=(0,h.useAuth)(),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)("all"),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)({total:0,active:0,waiting:0,avgResponseTime:0}),{data:H,refetch:I}=(0,f.useQuery)(i.GET_SUPPORT_CONVERSATIONS,{variables:{where:"all"!==B?{status:B.toUpperCase()}:void 0,take:50}}),{data:J}=(0,f.useQuery)(i.GET_SUPPORT_CONVERSATION,{variables:{id:t?.id},skip:!t}),[K]=(0,g.useMutation)(i.SEND_SUPPORT_MESSAGE),[L]=(0,g.useMutation)(i.ASSIGN_CONVERSATION_TO_AGENT),[M]=(0,g.useMutation)(i.UPDATE_CONVERSATION_STATUS),N=H?.supportConversations||[];(0,c.useEffect)(()=>{let a=N.length;G({total:a,active:N.filter(a=>"ACTIVE"===a.status).length,waiting:N.filter(a=>"WAITING"===a.status).length,avgResponseTime:45})},[N]),(0,c.useEffect)(()=>{J?.supportConversation?.messages&&w(J.supportConversation.messages)},[J]),(0,c.useEffect)(()=>{let a=(0,e.io)("http://localhost:3001/support-chat");return a.on("connect",()=>{console.log("Admin connected to support chat")}),a.on("new_conversation",()=>{I()}),a.on("new_message",a=>{t&&a.conversationId===t.id&&w(b=>[...b,a]),I()}),A(a),()=>{a.disconnect()}},[t,I]),(0,c.useEffect)(()=>{I()},[B,I]);let O=async()=>{if(x.trim()&&t&&a){y("");try{await K({variables:{input:{conversationId:t.id,content:x,senderType:"AGENT",senderId:a.id,senderName:a.username||"Agent"}}}),z&&z.emit("send_message",{conversationId:t.id,content:x,senderType:"AGENT",senderId:a.id,senderName:a.username||"Agent"})}catch(a){console.error("Error sending message:",a),y(x)}}},P=async()=>{if(t&&a)try{await L({variables:{conversationId:t.id,agentId:a.id}}),I()}catch(a){console.error("Error assigning conversation:",a)}};return(0,b.jsxs)("div",{className:"h-screen bg-gray-50 flex flex-col",children:[(0,b.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Hỗ trợ khách hàng"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Quản lý tất cả hội thoại"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:F.total}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"Tổng số"})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:F.active}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"Đang xử lý"})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:F.waiting}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"Chờ xử lý"})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[F.avgResponseTime,"s"]}),(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"Thời gian phản hồi"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-4 mt-4",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(k.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,b.jsx)("input",{type:"text",value:D,onChange:a=>E(a.target.value),placeholder:"Tìm kiếm khách hàng...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("button",{onClick:()=>C("all"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${"all"===B?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Tất cả"}),(0,b.jsx)("button",{onClick:()=>C("waiting"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${"waiting"===B?"bg-yellow-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Chờ xử lý"}),(0,b.jsx)("button",{onClick:()=>C("active"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${"active"===B?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Đang xử lý"})]})]})]}),(0,b.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,b.jsx)("div",{className:"w-96 bg-white border-r border-gray-200 overflow-y-auto",children:N.map(c=>(0,b.jsx)(d.motion.div,{whileHover:{backgroundColor:"#f9fafb"},onClick:()=>{u(c),z&&a&&z.emit("join_conversation",{conversationId:c.id,userId:a.id})},className:`p-4 border-b border-gray-200 cursor-pointer transition-colors ${t?.id===c.id?"bg-blue-50":""}`,children:(0,b.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold flex-shrink-0",children:c.customerName?.[0]?.toUpperCase()||"K"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 truncate",children:c.customerName||"Khách hàng"}),(0,b.jsxs)("div",{className:"flex items-center space-x-1",children:[(a=>{switch(a){case"FACEBOOK":return(0,b.jsx)(r.Facebook,{className:"w-4 h-4"});case"ZALO":return(0,b.jsx)(s.MessageCircle,{className:"w-4 h-4"});default:return(0,b.jsx)(j.MessageSquare,{className:"w-4 h-4"})}})(c.platform),(0,b.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${(a=>{switch(a){case"URGENT":return"text-red-600 bg-red-100";case"HIGH":return"text-orange-600 bg-orange-100";case"MEDIUM":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}})(c.priority)}`,children:c.priority})]})]}),(0,b.jsx)("p",{className:"text-sm text-gray-600 truncate",children:c.lastMessagePreview||"Chưa có tin nhắn"}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,b.jsx)("span",{className:"text-xs text-gray-400",children:c.lastMessageAt?new Date(c.lastMessageAt).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}):""}),c.assignedAgent&&(0,b.jsx)("span",{className:"text-xs text-blue-600",children:c.assignedAgent.username})]})]})]})},c.id))}),t?(0,b.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,b.jsx)("div",{className:"bg-white border-b border-gray-200 p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold",children:t.customerName?.[0]?.toUpperCase()||"K"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:t.customerName||"Khách hàng"}),(0,b.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[t.customerEmail&&(0,b.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,b.jsx)(p.Mail,{className:"w-3 h-3"}),(0,b.jsx)("span",{children:t.customerEmail})]}),t.customerPhone&&(0,b.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,b.jsx)(o.Phone,{className:"w-3 h-3"}),(0,b.jsx)("span",{children:t.customerPhone})]})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("button",{onClick:P,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Nhận hội thoại"}),(0,b.jsx)("button",{className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,b.jsx)(l.MoreVertical,{className:"w-5 h-5 text-gray-600"})})]})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:v.map(a=>(0,b.jsx)("div",{className:`flex ${"AGENT"===a.senderType?"justify-end":"justify-start"}`,children:(0,b.jsxs)("div",{className:`max-w-[70%] rounded-2xl px-4 py-2.5 ${"AGENT"===a.senderType?"bg-blue-600 text-white rounded-br-sm":"bg-white text-gray-900 rounded-bl-sm shadow-sm"}`,children:["AGENT"!==a.senderType&&a.isAIGenerated&&(0,b.jsxs)("div",{className:"flex items-center space-x-1 mb-1",children:[(0,b.jsx)(q.Bot,{className:"w-3 h-3 text-blue-500"}),(0,b.jsx)("span",{className:"text-xs font-medium text-gray-600",children:"AI"})]}),(0,b.jsx)("p",{className:"text-sm leading-relaxed",children:a.content}),(0,b.jsx)("span",{className:`text-xs block mt-1 ${"AGENT"===a.senderType?"text-blue-100":"text-gray-400"}`,children:new Date(a.sentAt).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})})]})},a.id))}),(0,b.jsx)("div",{className:"bg-white border-t border-gray-200 p-4",children:(0,b.jsxs)("div",{className:"flex items-end space-x-2",children:[(0,b.jsx)("button",{className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,b.jsx)(n.Paperclip,{className:"w-5 h-5 text-gray-500"})}),(0,b.jsx)("textarea",{value:x,onChange:a=>y(a.target.value),onKeyPress:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),O())},placeholder:"Nhập tin nhắn...",rows:1,className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none resize-none"}),(0,b.jsx)("button",{onClick:O,disabled:!x.trim(),className:"p-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,b.jsx)(m.Send,{className:"w-5 h-5"})})]})})]}):(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(j.MessageSquare,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Chọn một hội thoại để bắt đầu"})]})})]})]})}a.s(["default",()=>t])}];

//# sourceMappingURL=_af945b37._.js.map