module.exports=[785554,a=>{"use strict";var b=a.i(321248),c=a.i(651332),d=a.i(53627),e=a.i(281336);a.i(439889);var f=a.i(975780),g=a.i(293470);a.i(79028);var h=a.i(300827),i=a.i(422171),j=a.i(202979),k=a.i(669055),l=a.i(862122),m=a.i(538042),n=a.i(687649),o=a.i(558767),p=a.i(723593);function q({categories:a,selectedId:c,onSelect:d,onEdit:e,onDelete:f,onAddChild:g,showActions:h=!1,showProductCount:j=!0,className:k}){return(0,b.jsx)("div",{className:(0,i.cn)("space-y-1",k),children:a.map(a=>(0,b.jsx)(r,{category:a,level:0,selectedId:c,onSelect:d,onEdit:e,onDelete:f,onAddChild:g,showActions:h,showProductCount:j},a.id))})}function r({category:a,level:d,selectedId:e,onSelect:f,onEdit:q,onDelete:s,onAddChild:t,showActions:u,showProductCount:v}){let[w,x]=c.default.useState(d<2),y=a.children&&a.children.length>0,z=e===a.id;return(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:(0,i.cn)("group flex items-center gap-2 px-2 py-2 rounded-md hover:bg-accent transition-colors cursor-pointer",z&&"bg-accent",!a.isActive&&"opacity-60"),style:{paddingLeft:`${24*d+8}px`},onClick:()=>{f?.(a)},children:[(0,b.jsx)("button",{type:"button",onClick:a=>{a.stopPropagation(),x(!w)},className:(0,i.cn)("flex-shrink-0 w-5 h-5 flex items-center justify-center hover:bg-accent-foreground/10 rounded transition-colors",!y&&"invisible"),children:y&&(w?(0,b.jsx)(k.ChevronDown,{className:"h-4 w-4"}):(0,b.jsx)(h.ChevronRight,{className:"h-4 w-4"}))}),(0,b.jsx)("div",{className:"flex-shrink-0",children:w&&y?(0,b.jsx)(m.FolderOpen,{className:"h-5 w-5 text-primary"}):(0,b.jsx)(l.Folder,{className:"h-5 w-5 text-muted-foreground"})}),a.image&&(0,b.jsx)("img",{src:a.image,alt:a.name,className:"w-6 h-6 rounded object-cover flex-shrink-0"}),(0,b.jsx)("span",{className:(0,i.cn)("flex-1 font-medium text-sm",z&&"font-semibold"),children:a.name}),v&&void 0!==a.productCount&&(0,b.jsx)(g.Badge,{variant:"secondary",className:"text-xs",children:a.productCount}),!a.isActive&&(0,b.jsx)(g.Badge,{variant:"outline",className:"text-xs",children:"áº¨n"}),u&&(0,b.jsxs)("div",{className:"flex-shrink-0 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,b.jsx)(j.Button,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7",onClick:b=>{b.stopPropagation(),t?.(a)},title:"ThÃªm danh má»¥c con",children:(0,b.jsx)(p.Plus,{className:"h-4 w-4"})}),(0,b.jsx)(j.Button,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7",onClick:b=>{b.stopPropagation(),q?.(a)},title:"Chá»‰nh sá»­a",children:(0,b.jsx)(n.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(j.Button,{type:"button",size:"icon",variant:"ghost",className:"h-7 w-7 text-red-500 hover:text-red-600",onClick:b=>{b.stopPropagation(),s?.(a)},title:"XÃ³a",children:(0,b.jsx)(o.Trash2,{className:"h-4 w-4"})})]})]}),y&&w&&(0,b.jsx)("div",{children:a.children.map(a=>(0,b.jsx)(r,{category:a,level:d+1,selectedId:e,onSelect:f,onEdit:q,onDelete:s,onAddChild:t,showActions:u,showProductCount:v},a.id))})]})}var s=a.i(948428),t=a.i(908286),u=a.i(308135),v=a.i(478184),w=a.i(466577),x=a.i(441405),y=a.i(144932),z=a.i(650661),A=a.i(733554);let B=u.object({name:u.string().min(2,"TÃªn danh má»¥c pháº£i cÃ³ Ã­t nháº¥t 2 kÃ½ tá»±"),description:u.string().optional(),imageUrl:u.string().url("URL áº£nh khÃ´ng há»£p lá»‡").optional().or(u.literal("")),parentId:u.string().optional(),displayOrder:u.number().min(0).optional(),isActive:u.boolean().optional()});function C({category:a,onSubmit:d,onCancel:g,loading:h=!1,excludeId:i}){let{categoryTree:k,loading:l}=(0,e.useCategoryTree)(),{register:m,handleSubmit:n,formState:{errors:o},setValue:p,watch:q}=(0,s.useForm)({resolver:(0,t.zodResolver)(B),defaultValues:a?{name:a.name,description:a.description||"",imageUrl:a.image||"",parentId:a.parent?.id||"",displayOrder:a.displayOrder||0,isActive:a.isActive}:{displayOrder:0,isActive:!0}}),r=q(),u=(a,b=0,c)=>{let d=[];return a.forEach(a=>{a.id!==c&&(d.push({...a,level:b}),a.children&&a.children.length>0&&d.push(...u(a.children,b+1,c)))}),d},C=c.default.useMemo(()=>u(k,0,i||a?.id),[k,i,a?.id]),D=async a=>{let b={...a,parentId:a.parentId||void 0,image:a.imageUrl||void 0,description:a.description||void 0};delete b.imageUrl,await d(b)};return(0,b.jsxs)("form",{onSubmit:n(D),className:"space-y-6",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"ThÃ´ng tin danh má»¥c"})}),(0,b.jsxs)(f.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"name",children:"TÃªn danh má»¥c *"}),(0,b.jsx)(v.Input,{id:"name",...m("name"),placeholder:"Nháº­p tÃªn danh má»¥c"}),o.name&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:o.name.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"description",children:"MÃ´ táº£"}),(0,b.jsx)(w.Textarea,{id:"description",...m("description"),placeholder:"MÃ´ táº£ vá» danh má»¥c",rows:4}),o.description&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:o.description.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"imageUrl",children:"URL áº£nh"}),(0,b.jsx)(v.Input,{id:"imageUrl",...m("imageUrl"),placeholder:"https://example.com/image.jpg"}),o.imageUrl&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:o.imageUrl.message}),r.imageUrl&&(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)("img",{src:r.imageUrl,alt:"Preview",className:"w-32 h-32 object-cover rounded border",onError:a=>{a.currentTarget.style.display="none"}})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"parentId",children:"Danh má»¥c cha"}),(0,b.jsxs)(y.Select,{value:r.parentId||"none",onValueChange:a=>p("parentId","none"===a?"":a),children:[(0,b.jsx)(y.SelectTrigger,{children:(0,b.jsx)(y.SelectValue,{placeholder:"Chá»n danh má»¥c cha (tÃ¹y chá»n)"})}),(0,b.jsxs)(y.SelectContent,{children:[(0,b.jsx)(y.SelectItem,{value:"none",children:"KhÃ´ng cÃ³ (danh má»¥c gá»‘c)"}),l?(0,b.jsx)("div",{className:"p-2 text-center text-sm",children:"Äang táº£i..."}):C.map(a=>(0,b.jsxs)(y.SelectItem,{value:a.id,children:["â€”".repeat(a.level)," ",a.name]},a.id))]})]}),o.parentId&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:o.parentId.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(x.Label,{htmlFor:"displayOrder",children:"Thá»© tá»± hiá»ƒn thá»‹"}),(0,b.jsx)(v.Input,{id:"displayOrder",type:"number",...m("displayOrder",{valueAsNumber:!0}),placeholder:"0"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Sá»‘ thá»© tá»± hiá»ƒn thá»‹ (sá»‘ nhá» hÆ¡n sáº½ hiá»ƒn thá»‹ trÆ°á»›c)"}),o.displayOrder&&(0,b.jsx)("p",{className:"text-sm text-red-500",children:o.displayOrder.message})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(x.Label,{htmlFor:"isActive",children:"Tráº¡ng thÃ¡i hoáº¡t Ä‘á»™ng"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Danh má»¥c sáº½ hiá»ƒn thá»‹ trÃªn website khi Ä‘Æ°á»£c kÃ­ch hoáº¡t"})]}),(0,b.jsx)(z.Switch,{id:"isActive",checked:r.isActive,onCheckedChange:a=>p("isActive",a)})]})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"Xem trÆ°á»›c"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"border rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[r.imageUrl?(0,b.jsx)("img",{src:r.imageUrl,alt:"Preview",className:"w-12 h-12 rounded object-cover",onError:a=>{a.currentTarget.style.display="none"}}):(0,b.jsx)("div",{className:"w-12 h-12 rounded bg-primary/10 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-lg",children:"ðŸ“"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"font-medium",children:r.name||"TÃªn danh má»¥c"}),r.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-1",children:r.description})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:`text-xs ${r.isActive?"text-green-600":"text-gray-400"}`,children:r.isActive?"âœ“ Hoáº¡t Ä‘á»™ng":"âœ— KhÃ´ng hoáº¡t Ä‘á»™ng"}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Thá»© tá»±: ",r.displayOrder||0]})]})]})})})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-3",children:[g&&(0,b.jsx)(j.Button,{type:"button",variant:"outline",onClick:g,disabled:h,children:"Há»§y"}),(0,b.jsxs)(j.Button,{type:"submit",disabled:h,children:[h&&(0,b.jsx)(A.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),a?"Cáº­p nháº­t":"Táº¡o má»›i"]})]})]})}var D=a.i(429143),E=a.i(755820),F=a.i(793816),F=F,G=a.i(515678),H=a.i(147745),I=a.i(189101);function J(){(0,d.useRouter)();let[a,g]=c.default.useState(null),[h,i]=c.default.useState(null),[k,l]=c.default.useState(null),[m,n]=c.default.useState(!1),{categoryTree:o,loading:r,error:s,refetch:t}=(0,e.useCategoryTree)(),{createCategory:u,loading:v}=(0,e.useCreateCategory)(),{updateCategory:w,loading:x}=(0,e.useUpdateCategory)(),{deleteCategory:y,loading:z}=(0,e.useDeleteCategory)(),B=()=>{i(null),l(null),g("create")},J=async a=>{try{await y(a.id),I.toast.success(`Ä\xe3 x\xf3a danh má»¥c "${a.name}"`),t()}catch(a){I.toast.error(a.message||"Lá»—i khi xÃ³a danh má»¥c"),console.error(a)}},K=async b=>{try{if("create"===a||"create-child"===a){let c={...b,parentId:"create-child"===a?k?.id:b.parentId};await u(c),I.toast.success("Táº¡o danh má»¥c thÃ nh cÃ´ng!")}else"edit"===a&&h&&(await w(h.id,b),I.toast.success("Cáº­p nháº­t danh má»¥c thÃ nh cÃ´ng!"));g(null),i(null),l(null),t()}catch(a){I.toast.error(a.message||"Lá»—i khi lÆ°u danh má»¥c"),console.error(a)}},L=()=>{g(null),i(null),l(null)},M=async()=>{try{let a=localStorage.getItem("accessToken"),b="https://api.rausachtrangia.com/graphql".replace("/graphql","")||"http://localhost:12001",c=await fetch(`${b}/api/category-import-export/export`,{headers:{Authorization:`Bearer ${a}`}});if(!c.ok)throw Error("Export failed");let d=await c.blob(),e=window.URL.createObjectURL(d),f=document.createElement("a");f.href=e,f.download=`DanhMuc_${Date.now()}.xlsx`,document.body.appendChild(f),f.click(),window.URL.revokeObjectURL(e),document.body.removeChild(f),I.toast.success("ÄÃ£ export danh má»¥c thÃ nh cÃ´ng")}catch(a){I.toast.error("KhÃ´ng thá»ƒ export danh má»¥c")}},N=c.default.useMemo(()=>{let a=b=>b.reduce((b,c)=>b+1+(c.children?a(c.children):0),0);return a(o)},[o]),O=c.default.useMemo(()=>{let a=b=>b.reduce((b,c)=>b+ +!!c.isActive+(c.children?a(c.children):0),0);return a(o)},[o]);return(0,b.jsxs)("div",{className:"container mx-auto py-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Quáº£n lÃ½ danh má»¥c"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"Quáº£n lÃ½ cÃ¢y danh má»¥c sáº£n pháº©m"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(j.Button,{variant:"outline",onClick:()=>n(!0),children:[(0,b.jsx)(H.Upload,{className:"h-4 w-4 mr-2"}),"Import Excel"]}),(0,b.jsxs)(j.Button,{variant:"outline",onClick:M,children:[(0,b.jsx)(G.Download,{className:"h-4 w-4 mr-2"}),"Export Excel"]}),(0,b.jsxs)(j.Button,{onClick:B,children:[(0,b.jsx)(p.Plus,{className:"h-4 w-4 mr-2"}),"Táº¡o danh má»¥c má»›i"]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{className:"pb-2",children:(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Tá»•ng danh má»¥c"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:N})})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{className:"pb-2",children:(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Äang hoáº¡t Ä‘á»™ng"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:O})})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{className:"pb-2",children:(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"KhÃ´ng hoáº¡t Ä‘á»™ng"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold text-gray-600",children:N-O})})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsxs)(f.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(F.default,{className:"h-5 w-5"}),"CÃ¢y danh má»¥c"]})}),(0,b.jsx)(f.CardContent,{children:r?(0,b.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,b.jsx)(A.Loader2,{className:"h-8 w-8 animate-spin text-primary"})}):s?(0,b.jsxs)("div",{className:"text-center py-12 text-red-500",children:["Lá»—i: ",s.message]}):0===o.length?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("p",{className:"text-muted-foreground mb-4",children:"ChÆ°a cÃ³ danh má»¥c nÃ o"}),(0,b.jsxs)(j.Button,{onClick:B,children:[(0,b.jsx)(p.Plus,{className:"h-4 w-4 mr-2"}),"Táº¡o danh má»¥c Ä‘áº§u tiÃªn"]})]}):(0,b.jsx)(q,{categories:o,selectedId:h?.id,onSelect:i,onEdit:a=>{i(a),g("edit")},onDelete:J,onAddChild:a=>{l(a),i(null),g("create-child")},showActions:!0,showProductCount:!0})})]}),(0,b.jsx)(E.Dialog,{open:null!==a,onOpenChange:()=>L(),children:(0,b.jsxs)(E.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(E.DialogHeader,{children:(0,b.jsxs)(E.DialogTitle,{children:["create"===a&&"Táº¡o danh má»¥c má»›i","create-child"===a&&`Táº¡o danh má»¥c con cho "${k?.name}"`,"edit"===a&&`Chá»‰nh sá»­a "${h?.name}"`]})}),(0,b.jsx)(C,{category:h||void 0,onSubmit:K,onCancel:L,loading:v||x,excludeId:h?.id})]})}),(0,b.jsx)(D.ImportExportDialog,{open:m,onOpenChange:n,title:"Import Danh Má»¥c tá»« Excel",description:"Táº£i file máº«u, Ä‘iá»n thÃ´ng tin, vÃ  upload Ä‘á»ƒ import hÃ ng loáº¡t danh má»¥c",templateUrl:"/api/category-import-export/template",importUrl:"/api/category-import-export/import",onImportSuccess:()=>{t(),I.toast.success("Import danh má»¥c thÃ nh cÃ´ng")}})]})}a.s(["default",()=>J],785554)}];

//# sourceMappingURL=frontend_src_app_admin_categories_page_tsx_105ce23d._.js.map