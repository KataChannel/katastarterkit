module.exports=[983657,a=>{"use strict";var b=a.i(321248),c=a.i(651332),d=a.i(53627),e=a.i(40947),f=a.i(951369),g=a.i(358054),h=a.i(778775);function i({activeTab:a,onTabChange:c}){return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Báº£ng Äiá»u Khiá»ƒn Quáº£n Trá»‹"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2",children:"Quáº£n lÃ½ ngÆ°á»i dÃ¹ng, vai trÃ² vÃ  quyá»n háº¡n trÃªn toÃ n há»‡ thá»‘ng"})]})}),(0,b.jsx)(f.Tabs,{value:a,onValueChange:a=>c(a),children:(0,b.jsxs)(f.TabsList,{className:"grid w-full max-w-md grid-cols-2",children:[(0,b.jsxs)(f.TabsTrigger,{value:"users",className:"gap-2",children:[(0,b.jsx)(g.Users,{className:"w-4 h-4"}),"User Management"]}),(0,b.jsxs)(f.TabsTrigger,{value:"rbac",className:"gap-2",children:[(0,b.jsx)(h.Shield,{className:"w-4 h-4"}),"RBAC & Permissions"]})]})})]})}var j=a.i(168918),k=a.i(8912),l=a.i(563718),m=a.i(772213),n=a.i(394940);m.gql`
  query SearchUsers($input: UserSearchInput!) {
    searchUsers(input: $input) {
      users {
        ...UserFragment
      }
      total
      page
      size
      totalPages
    }
  }
  ${n.USER_FRAGMENT}
`;let o=m.gql`
  query GetUserStats {
    getUserStats {
      totalUsers
      activeUsers
      verifiedUsers
      newUsersThisMonth
      adminUsers
      regularUsers
      guestUsers
    }
  }
`;m.gql`
  query GetUserById($id: String!) {
    getUserById(id: $id) {
      ...UserFragment
    }
  }
  ${n.USER_FRAGMENT}
`;let p=m.gql`
  query GetAllUsers {
    getUsers {
      ...UserFragment
    }
  }
  ${n.USER_FRAGMENT}
`,q=m.gql`
  mutation AdminUpdateUser($id: String!, $input: AdminUpdateUserInput!) {
    adminUpdateUser(id: $id, input: $input) {
      ...UserFragment
    }
  }
  ${n.USER_FRAGMENT}
`,r=m.gql`
  mutation BulkUserAction($input: BulkUserActionInput!) {
    bulkUserAction(input: $input) {
      success
      affectedCount
      errors
      message
    }
  }
`,s=m.gql`
  mutation AdminCreateUser($input: AdminCreateUserInput!) {
    adminCreateUser(input: $input) {
      ...UserFragment
    }
  }
  ${n.USER_FRAGMENT}
`;m.gql`
  mutation DeleteUser($id: String!) {
    deleteUser(id: $id)
  }
`,m.gql`
  mutation UpdateUser($id: String!, $input: UpdateUserInput!) {
    updateUser(id: $id, input: $input) {
      ...UserFragment
    }
  }
  ${n.USER_FRAGMENT}
`;var t=a.i(464674);function u(a={},b){var d,e,f,g;let h=(0,c.useMemo)(()=>{let b={};return a.search&&a.search.trim()&&(b.OR=[{email:{contains:a.search,mode:"insensitive"}},{username:{contains:a.search,mode:"insensitive"}},{firstName:{contains:a.search,mode:"insensitive"}},{lastName:{contains:a.search,mode:"insensitive"}}]),a.roleType&&(b.roleType={equals:a.roleType}),void 0!==a.isActive&&(b.isActive={equals:a.isActive}),void 0!==a.isVerified&&(b.isVerified={equals:a.isVerified}),a.createdAfter&&(b.createdAt={...b.createdAt||{},gte:a.createdAfter}),a.createdBefore&&(b.createdAt={...b.createdAt||{},lte:a.createdBefore}),b},[a.search,a.roleType,a.isActive,a.isVerified,a.createdAfter,a.createdBefore]),i=(0,c.useMemo)(()=>({[a.sortBy||"createdAt"]:a.sortOrder||"desc"}),[a.sortBy,a.sortOrder]),k=a.page||0,l=a.size||20,{data:m,loading:n,error:o,refetch:p}=(d={model:"user",where:h,orderBy:i,pagination:{page:k,limit:l,sortBy:a.sortBy||"createdAt",sortOrder:a.sortOrder||"desc"},select:{id:!0,email:!0,username:!0,firstName:!0,lastName:!0,phone:!0,avatar:!0,roleType:!0,isActive:!0,isVerified:!0,isTwoFactorEnabled:!0,failedLoginAttempts:!0,lockedUntil:!0,lastLoginAt:!0,createdAt:!0,updatedAt:!0}},e={fetchPolicy:"cache-and-network",skip:b?.skip},(0,j.useQuery)(t.DYNAMIC_FIND_MANY,{variables:{input:d},...e})),{data:q,loading:r,error:s}=(f={model:"user",where:h},g={fetchPolicy:"cache-and-network",skip:b?.skip},(0,j.useQuery)(t.DYNAMIC_COUNT,{variables:{input:f},...g})),v=m?.dynamicFindMany?.data||[],w=q?.dynamicCount?.data||0,x=Math.ceil(w/l);return{data:{searchUsers:{users:v,total:w,page:k,size:l,totalPages:x}},users:v,total:w,page:k,size:l,totalPages:x,loading:n||r,error:o||s,refetch:async a=>{a&&console.warn("useSearchUsers: refetch with new input not fully supported. Re-render component with new input instead."),await Promise.all([p()])}}}var v=a.i(234211),w=a.i(202979),x=a.i(478184),y=a.i(441405),z=a.i(144932),A=a.i(975780),B=a.i(650661),C=a.i(359379),D=a.i(363615),E=a.i(607226),F=a.i(733554),G=a.i(327987);let H={username:"",email:"",firstName:"",lastName:"",phone:"",password:"",roleType:"USER",isActive:!0,isVerified:!1};function I({isOpen:a,onClose:d,onSuccess:e}){let f,[g,{loading:h}]=(f=(0,l.useApolloClient)(),(0,k.useMutation)(s,{onCompleted:()=>{f.refetchQueries({include:[p,o]})},errorPolicy:"all"})),[i,j]=(0,c.useState)(H),[m,n]=(0,c.useState)({}),[q,r]=(0,c.useState)(null);(0,c.useEffect)(()=>{a&&(j(H),n({}),r(null))},[a]);let t=(0,c.useCallback)(()=>{let a={};return i.username.trim()?i.username.length<3?a.username="Username must be at least 3 characters":/^[a-zA-Z0-9_-]+$/.test(i.username)||(a.username="Username can only contain letters, numbers, underscores, and hyphens"):a.username="Username is required",i.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.email)&&(a.email="Please enter a valid email address"),i.password?i.password.length<8?a.password="Password must be at least 8 characters":/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(i.password)||(a.password="Password must contain uppercase, lowercase, and number"):a.password="Password is required",i.phone&&!/^[\d\s+()-]+$/.test(i.phone)&&(a.phone="Please enter a valid phone number"),n(a),0===Object.keys(a).length},[i]),u=(0,c.useCallback)(async a=>{if(a.preventDefault(),r(null),t())try{let a=await g({variables:{input:{username:i.username.trim(),email:i.email.trim()||void 0,password:i.password,firstName:i.firstName.trim()||void 0,lastName:i.lastName.trim()||void 0,phone:i.phone.trim()||void 0,roleType:i.roleType,isActive:i.isActive,isVerified:i.isVerified}}});a.data?.adminCreateUser&&((0,v.toast)({title:"User created successfully",description:`User "${a.data.adminCreateUser.username}" has been created.`,type:"success"}),e(),d())}catch(b){let a=b.graphQLErrors?.[0]?.message||b.message||"Failed to create user";r(a),(0,v.toast)({title:"Failed to create user",description:a,type:"error",variant:"destructive"})}},[i,t,g,e,d]),I=(0,c.useCallback)((a,b)=>{j(c=>({...c,[a]:b})),m[a]&&n(b=>({...b,[a]:void 0}))},[m]),J=(0,c.useCallback)(()=>{h||d()},[h,d]);return a?(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)(A.Card,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(A.CardHeader,{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(E.UserPlus,{className:"h-5 w-5"}),(0,b.jsx)(A.CardTitle,{children:"Create New User"})]}),(0,b.jsx)(w.Button,{variant:"ghost",size:"icon",onClick:J,disabled:h,className:"h-8 w-8",children:(0,b.jsx)(D.X,{className:"h-4 w-4"})})]}),(0,b.jsx)(A.CardDescription,{children:"Fill in the details below to create a new user account"})]}),(0,b.jsx)(A.CardContent,{children:(0,b.jsxs)("form",{onSubmit:u,className:"space-y-6",children:[q&&(0,b.jsxs)(C.Alert,{className:"border-red-500 bg-red-50",children:[(0,b.jsx)(G.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(C.AlertDescription,{children:q})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Account Information"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"username",className:"required",children:"Username"}),(0,b.jsx)(x.Input,{id:"username",type:"text",value:i.username,onChange:a=>I("username",a.target.value),placeholder:"Enter username",disabled:h,className:m.username?"border-red-500":"",autoFocus:!0}),m.username&&(0,b.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,b.jsx)(G.AlertCircle,{className:"h-3 w-3"}),m.username]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"email",children:"Email"}),(0,b.jsx)(x.Input,{id:"email",type:"email",value:i.email,onChange:a=>I("email",a.target.value),placeholder:"user@example.com",disabled:h,className:m.email?"border-red-500":""}),m.email&&(0,b.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,b.jsx)(G.AlertCircle,{className:"h-3 w-3"}),m.email]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"password",className:"required",children:"Password"}),(0,b.jsx)(x.Input,{id:"password",type:"password",value:i.password,onChange:a=>I("password",a.target.value),placeholder:"Enter secure password",disabled:h,className:m.password?"border-red-500":""}),m.password&&(0,b.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,b.jsx)(G.AlertCircle,{className:"h-3 w-3"}),m.password]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Must be at least 8 characters with uppercase, lowercase, and number"})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Personal Information"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"firstName",children:"First Name"}),(0,b.jsx)(x.Input,{id:"firstName",type:"text",value:i.firstName,onChange:a=>I("firstName",a.target.value),placeholder:"Enter first name",disabled:h})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"lastName",children:"Last Name"}),(0,b.jsx)(x.Input,{id:"lastName",type:"text",value:i.lastName,onChange:a=>I("lastName",a.target.value),placeholder:"Enter last name",disabled:h})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"phone",children:"Phone Number"}),(0,b.jsx)(x.Input,{id:"phone",type:"tel",value:i.phone,onChange:a=>I("phone",a.target.value),placeholder:"+1 (555) 123-4567",disabled:h,className:m.phone?"border-red-500":""}),m.phone&&(0,b.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,b.jsx)(G.AlertCircle,{className:"h-3 w-3"}),m.phone]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Role & Permissions"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"roleType",children:"Role Type"}),(0,b.jsxs)(z.Select,{value:i.roleType,onValueChange:a=>I("roleType",a),disabled:h,children:[(0,b.jsx)(z.SelectTrigger,{id:"roleType",children:(0,b.jsx)(z.SelectValue,{placeholder:"Select role"})}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"ADMIN",children:"Admin"}),(0,b.jsx)(z.SelectItem,{value:"USER",children:"User"}),(0,b.jsx)(z.SelectItem,{value:"GUEST",children:"Guest"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(y.Label,{htmlFor:"isActive",className:"cursor-pointer",children:"Active Status"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"User can log in and access the system"})]}),(0,b.jsx)(B.Switch,{id:"isActive",checked:i.isActive,onCheckedChange:a=>I("isActive",a),disabled:h})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(y.Label,{htmlFor:"isVerified",className:"cursor-pointer",children:"Verified Status"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"User's email/account has been verified"})]}),(0,b.jsx)(B.Switch,{id:"isVerified",checked:i.isVerified,onCheckedChange:a=>I("isVerified",a),disabled:h})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,b.jsx)(w.Button,{type:"button",variant:"outline",onClick:J,disabled:h,className:"flex-1",children:"Cancel"}),(0,b.jsx)(w.Button,{type:"submit",disabled:h,className:"flex-1",children:h?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(F.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(E.UserPlus,{className:"mr-2 h-4 w-4"}),"Create User"]})})]})]})})]})}):null}var J=a.i(755820),K=a.i(973174),L=a.i(687649),M=a.i(268715),N=a.i(652878),O=a.i(208172),P=a.i(519732);let Q=m.gql`
  mutation AdminResetPassword($input: AdminResetPasswordInput!) {
    adminResetPassword(input: $input) {
      success
      message
      newPassword
      user {
        id
        username
        email
        firstName
        lastName
      }
    }
  }
`;function R({user:a,isOpen:d,onClose:e,onSuccess:f}){let g,[h,{loading:i}]=(g=(0,l.useApolloClient)(),(0,k.useMutation)(q,{onCompleted:()=>{g.refetchQueries({include:[p,o]})},errorPolicy:"all"})),[j,{loading:m}]=(0,k.useMutation)(Q),[n,r]=(0,c.useState)({username:"",email:"",firstName:"",lastName:"",phone:"",roleType:"USER",isActive:!0,isVerified:!1,isTwoFactorEnabled:!1}),[s,t]=(0,c.useState)({}),[u,E]=(0,c.useState)(null),[H,I]=(0,c.useState)(!1),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)(!1);(0,c.useEffect)(()=>{a&&d&&(r({username:a.username||"",email:a.email||"",firstName:a.firstName||"",lastName:a.lastName||"",phone:a.phone||"",roleType:a.roleType||"USER",isActive:a.isActive??!0,isVerified:a.isVerified??!1,isTwoFactorEnabled:a.isTwoFactorEnabled??!1}),t({}),E(null),I(!1))},[a,d]);let X=(0,c.useCallback)(()=>{let a={};return n.username.trim()?n.username.length<3?a.username="Username must be at least 3 characters":/^[a-zA-Z0-9_-]+$/.test(n.username)||(a.username="Username can only contain letters, numbers, underscores, and hyphens"):a.username="Username is required",n.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.email)&&(a.email="Please enter a valid email address"),n.phone&&!/^[\d\s+()-]+$/.test(n.phone)&&(a.phone="Please enter a valid phone number"),t(a),0===Object.keys(a).length},[n]),Y=(0,c.useCallback)(async b=>{if((b.preventDefault(),a)&&(E(null),X()))try{let b=await h({variables:{id:a.id,input:{username:n.username.trim(),email:n.email.trim()||void 0,firstName:n.firstName.trim()||void 0,lastName:n.lastName.trim()||void 0,phone:n.phone.trim()||void 0,roleType:n.roleType,isActive:n.isActive,isVerified:n.isVerified,isTwoFactorEnabled:n.isTwoFactorEnabled}}});b.data?.adminUpdateUser&&((0,v.toast)({title:"User updated successfully",description:`Changes to "${b.data.adminUpdateUser.username}" have been saved.`,type:"success"}),f(),e())}catch(b){let a=b.graphQLErrors?.[0]?.message||b.message||"Failed to update user";E(a),(0,v.toast)({title:"Failed to update user",description:a,type:"error"})}},[a,n,X,h,f,e]),Z=(0,c.useCallback)((a,b)=>{r(c=>({...c,[a]:b})),I(!0),s[a]&&t(b=>({...b,[a]:void 0}))},[s]),$=(0,c.useCallback)(()=>{!i&&!m&&(!H||confirm("You have unsaved changes. Are you sure you want to close?"))&&e()},[i,m,H,e]),_=(0,c.useCallback)(async()=>{if(a&&confirm(`Báº¡n c\xf3 cháº¯c muá»‘n reset máº­t kháº©u cho user "${a.username}"?

Máº­t kháº©u má»›i sáº½ Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng.`))try{let{data:b}=await j({variables:{input:{userId:a.id}}});b?.adminResetPassword?.success&&(U(b.adminResetPassword.newPassword),S(!0),(0,v.toast)({title:"Reset máº­t kháº©u thÃ nh cÃ´ng",description:`Máº­t kháº©u má»›i Ä‘\xe3 Ä‘Æ°á»£c táº¡o cho "${a.username}"`,type:"success"}))}catch(b){let a=b.graphQLErrors?.[0]?.message||b.message||"KhÃ´ng thá»ƒ reset máº­t kháº©u";(0,v.toast)({title:"Reset máº­t kháº©u tháº¥t báº¡i",description:a,type:"error"})}},[a,j]),aa=(0,c.useCallback)(async()=>{try{await navigator.clipboard.writeText(T),W(!0),(0,v.toast)({title:"ÄÃ£ copy",description:"Máº­t kháº©u Ä‘Ã£ Ä‘Æ°á»£c copy vÃ o clipboard",type:"success"}),setTimeout(()=>W(!1),2e3)}catch(a){(0,v.toast)({title:"Lá»—i",description:"KhÃ´ng thá»ƒ copy máº­t kháº©u",type:"error"})}},[T]),ab=(0,c.useCallback)(()=>{S(!1),U(""),W(!1)},[]);return d&&a?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)(A.Card,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(A.CardHeader,{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(L.Edit,{className:"h-5 w-5"}),(0,b.jsx)(A.CardTitle,{children:"Edit User"})]}),(0,b.jsx)(w.Button,{variant:"ghost",size:"icon",onClick:$,disabled:i||m,className:"h-8 w-8",children:(0,b.jsx)(D.X,{className:"h-4 w-4"})})]}),(0,b.jsxs)(A.CardDescription,{children:["Update information for ",a.username]})]}),(0,b.jsx)(A.CardContent,{children:(0,b.jsxs)("form",{onSubmit:Y,className:"space-y-6",children:[u&&(0,b.jsxs)(C.Alert,{className:"border-red-500 bg-red-50",children:[(0,b.jsx)(G.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(C.AlertDescription,{children:u})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Account Information"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"username",className:"required",children:"Username"}),(0,b.jsx)(x.Input,{id:"username",type:"text",value:n.username,onChange:a=>Z("username",a.target.value),placeholder:"Enter username",disabled:i,className:s.username?"border-red-500":"",autoFocus:!0}),s.username&&(0,b.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,b.jsx)(G.AlertCircle,{className:"h-3 w-3"}),s.username]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"email",children:"Email"}),(0,b.jsx)(x.Input,{id:"email",type:"email",value:n.email,onChange:a=>Z("email",a.target.value),placeholder:"user@example.com",disabled:i,className:s.email?"border-red-500":""}),s.email&&(0,b.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,b.jsx)(G.AlertCircle,{className:"h-3 w-3"}),s.email]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Personal Information"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"firstName",children:"First Name"}),(0,b.jsx)(x.Input,{id:"firstName",type:"text",value:n.firstName,onChange:a=>Z("firstName",a.target.value),placeholder:"Enter first name",disabled:i})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"lastName",children:"Last Name"}),(0,b.jsx)(x.Input,{id:"lastName",type:"text",value:n.lastName,onChange:a=>Z("lastName",a.target.value),placeholder:"Enter last name",disabled:i})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"phone",children:"Phone Number"}),(0,b.jsx)(x.Input,{id:"phone",type:"tel",value:n.phone,onChange:a=>Z("phone",a.target.value),placeholder:"+1 (555) 123-4567",disabled:i,className:s.phone?"border-red-500":""}),s.phone&&(0,b.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,b.jsx)(G.AlertCircle,{className:"h-3 w-3"}),s.phone]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Role & Permissions"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{htmlFor:"roleType",children:"Role Type"}),(0,b.jsxs)(z.Select,{value:n.roleType,onValueChange:a=>Z("roleType",a),disabled:i,children:[(0,b.jsx)(z.SelectTrigger,{id:"roleType",children:(0,b.jsx)(z.SelectValue,{placeholder:"Select role"})}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"ADMIN",children:"Admin"}),(0,b.jsx)(z.SelectItem,{value:"USER",children:"User"}),(0,b.jsx)(z.SelectItem,{value:"GUEST",children:"Guest"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(y.Label,{htmlFor:"isActive",className:"cursor-pointer",children:"Active Status"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"User can log in and access the system"})]}),(0,b.jsx)(B.Switch,{id:"isActive",checked:n.isActive,onCheckedChange:a=>Z("isActive",a),disabled:i})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(y.Label,{htmlFor:"isVerified",className:"cursor-pointer",children:"Verified Status"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"User's email/account has been verified"})]}),(0,b.jsx)(B.Switch,{id:"isVerified",checked:n.isVerified,onCheckedChange:a=>Z("isVerified",a),disabled:i})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,b.jsxs)("div",{className:"space-y-0.5",children:[(0,b.jsx)(y.Label,{htmlFor:"isTwoFactorEnabled",className:"cursor-pointer",children:"Two-Factor Authentication"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Require 2FA for enhanced security"})]}),(0,b.jsx)(B.Switch,{id:"isTwoFactorEnabled",checked:n.isTwoFactorEnabled,onCheckedChange:a=>Z("isTwoFactorEnabled",a),disabled:i})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Security Actions"}),(0,b.jsxs)(C.Alert,{className:"border-amber-200 bg-amber-50",children:[(0,b.jsx)(M.Key,{className:"h-4 w-4 text-amber-600"}),(0,b.jsx)(C.AlertDescription,{className:"text-sm",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-amber-800 font-medium",children:"Reset máº­t kháº©u cho nhÃ¢n viÃªn"}),(0,b.jsx)("p",{className:"text-xs text-amber-700",children:"Há»‡ thá»‘ng sáº½ táº¡o máº­t kháº©u ngáº«u nhiÃªn máº¡nh. Báº¡n cÃ³ thá»ƒ copy vÃ  gá»­i cho nhÃ¢n viÃªn."}),(0,b.jsx)(w.Button,{type:"button",variant:"outline",size:"sm",onClick:_,disabled:i||m,className:"w-full sm:w-auto mt-2 border-amber-300 text-amber-700 hover:bg-amber-100 hover:text-amber-800",children:m?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(F.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Äang reset..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(P.RefreshCw,{className:"mr-2 h-4 w-4"}),"Reset Password"]})})]})})]})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[(0,b.jsx)(w.Button,{type:"button",variant:"outline",onClick:$,disabled:i||m,className:"flex-1",children:"Cancel"}),(0,b.jsx)(w.Button,{type:"submit",disabled:i||m||!H,className:"flex-1",children:i?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(F.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(K.Save,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})]})]})})]})}),(0,b.jsx)(J.Dialog,{open:R,onOpenChange:S,children:(0,b.jsxs)(J.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(J.DialogHeader,{children:[(0,b.jsxs)(J.DialogTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(M.Key,{className:"h-5 w-5 text-green-600"}),"Máº­t kháº©u má»›i Ä‘Ã£ Ä‘Æ°á»£c táº¡o"]}),(0,b.jsx)(J.DialogDescription,{children:"Copy máº­t kháº©u nÃ y vÃ  gá»­i cho nhÃ¢n viÃªn. Máº­t kháº©u sáº½ khÃ´ng hiá»ƒn thá»‹ láº¡i."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(y.Label,{className:"text-sm font-medium",children:"Máº­t kháº©u má»›i"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(x.Input,{type:"text",value:T,readOnly:!0,className:"pr-12 font-mono text-base sm:text-lg font-semibold bg-gray-50 border-2 border-green-300"}),(0,b.jsx)(w.Button,{type:"button",size:"icon",variant:"ghost",onClick:aa,className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8 hover:bg-green-100",title:"Copy password",children:V?(0,b.jsx)(O.CheckCheck,{className:"h-4 w-4 text-green-600"}):(0,b.jsx)(N.Copy,{className:"h-4 w-4"})})]})]}),(0,b.jsxs)(C.Alert,{className:"border-blue-200 bg-blue-50",children:[(0,b.jsx)(G.AlertCircle,{className:"h-4 w-4 text-blue-600"}),(0,b.jsxs)(C.AlertDescription,{className:"text-sm space-y-1",children:[(0,b.jsx)("p",{className:"font-medium text-blue-900",children:"ThÃ´ng tin ngÆ°á»i dÃ¹ng:"}),(0,b.jsxs)("div",{className:"text-xs text-blue-800 space-y-0.5",children:[(0,b.jsxs)("p",{children:["â€¢ Username: ",(0,b.jsx)("span",{className:"font-mono font-semibold",children:a.username})]}),a.email&&(0,b.jsxs)("p",{children:["â€¢ Email: ",(0,b.jsx)("span",{className:"font-mono",children:a.email})]}),a.firstName&&a.lastName&&(0,b.jsxs)("p",{children:["â€¢ Há» tÃªn: ",a.firstName," ",a.lastName]})]})]})]}),(0,b.jsxs)(C.Alert,{className:"border-amber-200 bg-amber-50",children:[(0,b.jsx)(G.AlertCircle,{className:"h-4 w-4 text-amber-600"}),(0,b.jsxs)(C.AlertDescription,{className:"text-xs text-amber-800",children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"âš ï¸ LÆ°u Ã½ quan trá»ng:"}),(0,b.jsxs)("ul",{className:"list-disc list-inside space-y-0.5 ml-1",children:[(0,b.jsx)("li",{children:"Máº­t kháº©u nÃ y chá»‰ hiá»ƒn thá»‹ 1 láº§n duy nháº¥t"}),(0,b.jsx)("li",{children:"HÃ£y copy vÃ  gá»­i cho nhÃ¢n viÃªn ngay"}),(0,b.jsx)("li",{children:"NhÃ¢n viÃªn nÃªn Ä‘á»•i máº­t kháº©u sau láº§n Ä‘Äƒng nháº­p Ä‘áº§u"})]})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-3",children:[(0,b.jsx)(w.Button,{type:"button",variant:"outline",onClick:aa,className:"flex-1",children:V?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(O.CheckCheck,{className:"mr-2 h-4 w-4 text-green-600"}),"ÄÃ£ copy!"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(N.Copy,{className:"mr-2 h-4 w-4"}),"Copy Password"]})}),(0,b.jsx)(w.Button,{type:"button",onClick:ab,className:"flex-1",children:"ÄÃ³ng"})]})]})})]}):null}var S=a.i(897608);function T({title:a="Error",message:c,onRetry:d,retryLabel:e="Retry"}){return(0,b.jsx)("div",{className:"container mx-auto py-8",children:(0,b.jsx)(A.Card,{children:(0,b.jsx)(A.CardContent,{className:"flex items-center justify-center py-12",children:(0,b.jsxs)("div",{className:"text-center max-w-md",children:[(0,b.jsx)(S.AlertTriangle,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:a}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:c}),d&&(0,b.jsxs)(w.Button,{onClick:d,variant:"outline",children:[(0,b.jsx)(P.RefreshCw,{className:"w-4 h-4 mr-2"}),e]})]})})})})}a.i(294995);var U=a.i(788758),V=a.i(293470),W=a.i(251326),X=a.i(751075),Y=a.i(723989),Z=a.i(558767),$=a.i(162036),_=a.i(23064),_=_,aa=a.i(411185),ab=a.i(140300),ac=a.i(434741),ad=a.i(128348),ae=a.i(508335),af=a.i(390874),ag=a.i(509423),ah=a.i(510071),ai=a.i(300827),aj=a.i(450345),ak=a.i(836690);function al({currentPage:a,totalPages:c,pageSize:d,totalItems:e,onPageChange:f,onPageSizeChange:g,pageSizeOptions:h=[10,20,50,100]}){let i=Math.min((a+1)*d,e);return(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 border-t pt-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(0,b.jsx)("span",{className:"font-medium",children:a*d+1})," to"," ",(0,b.jsx)("span",{className:"font-medium",children:i})," of"," ",(0,b.jsx)("span",{className:"font-medium",children:e})," results"]}),g&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Show"}),(0,b.jsxs)(z.Select,{value:String(d),onValueChange:a=>g(Number(a)),children:[(0,b.jsx)(z.SelectTrigger,{className:"w-[70px]",children:(0,b.jsx)(z.SelectValue,{})}),(0,b.jsx)(z.SelectContent,{children:h.map(a=>(0,b.jsx)(z.SelectItem,{value:String(a),children:a},a))})]})]})]}),c>1&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Button,{variant:"outline",size:"icon",onClick:()=>f(0),disabled:0===a,title:"First page",children:(0,b.jsx)(aj.ChevronsLeft,{className:"h-4 w-4"})}),(0,b.jsx)(w.Button,{variant:"outline",size:"icon",onClick:()=>f(a-1),disabled:0===a,title:"Previous page",children:(0,b.jsx)(ah.ChevronLeft,{className:"h-4 w-4"})}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:(()=>{let b=[];if(c<=5)for(let a=0;a<c;a++)b.push(a);else{b.push(0);let d=Math.max(1,a-1),e=Math.min(c-2,a+1);a<=2?e=3:a>=c-3&&(d=c-4),d>1&&b.push("...");for(let a=d;a<=e;a++)b.push(a);e<c-2&&b.push("..."),b.push(c-1)}return b})().map((c,d)=>"..."===c?(0,b.jsx)("span",{className:"px-2 text-muted-foreground",children:"..."},`ellipsis-${d}`):(0,b.jsx)(w.Button,{variant:c===a?"default":"outline",size:"icon",onClick:()=>f(c),className:"w-9 h-9",children:c+1},c))}),(0,b.jsx)(w.Button,{variant:"outline",size:"icon",onClick:()=>f(a+1),disabled:a>=c-1,title:"Next page",children:(0,b.jsx)(ai.ChevronRight,{className:"h-4 w-4"})}),(0,b.jsx)(w.Button,{variant:"outline",size:"icon",onClick:()=>f(c-1),disabled:a>=c-1,title:"Last page",children:(0,b.jsx)(ak.ChevronsRight,{className:"h-4 w-4"})})]})]})}var am=a.i(772451),an=a.i(920283);function ao({rows:a=5}){return(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)(an.Table,{children:[(0,b.jsx)(an.TableHeader,{children:(0,b.jsxs)(an.TableRow,{children:[(0,b.jsx)(an.TableHead,{className:"w-[50px]",children:(0,b.jsx)(am.Skeleton,{className:"h-4 w-4"})}),(0,b.jsx)(an.TableHead,{children:(0,b.jsx)(am.Skeleton,{className:"h-4 w-20"})}),(0,b.jsx)(an.TableHead,{children:(0,b.jsx)(am.Skeleton,{className:"h-4 w-16"})}),(0,b.jsx)(an.TableHead,{children:(0,b.jsx)(am.Skeleton,{className:"h-4 w-24"})}),(0,b.jsx)(an.TableHead,{children:(0,b.jsx)(am.Skeleton,{className:"h-4 w-16"})}),(0,b.jsx)(an.TableHead,{children:(0,b.jsx)(am.Skeleton,{className:"h-4 w-20"})}),(0,b.jsx)(an.TableHead,{className:"w-[100px]",children:(0,b.jsx)(am.Skeleton,{className:"h-4 w-16"})})]})}),(0,b.jsx)(an.TableBody,{children:Array.from({length:a}).map((a,c)=>(0,b.jsxs)(an.TableRow,{children:[(0,b.jsx)(an.TableCell,{children:(0,b.jsx)(am.Skeleton,{className:"h-4 w-4"})}),(0,b.jsx)(an.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(am.Skeleton,{className:"h-10 w-10 rounded-full"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(am.Skeleton,{className:"h-4 w-32"}),(0,b.jsx)(am.Skeleton,{className:"h-3 w-24"})]})]})}),(0,b.jsx)(an.TableCell,{children:(0,b.jsx)(am.Skeleton,{className:"h-4 w-16"})}),(0,b.jsx)(an.TableCell,{children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(am.Skeleton,{className:"h-4 w-40"}),(0,b.jsx)(am.Skeleton,{className:"h-3 w-32"})]})}),(0,b.jsx)(an.TableCell,{children:(0,b.jsx)(am.Skeleton,{className:"h-5 w-14 rounded-full"})}),(0,b.jsx)(an.TableCell,{children:(0,b.jsx)(am.Skeleton,{className:"h-4 w-20"})}),(0,b.jsx)(an.TableCell,{children:(0,b.jsx)(am.Skeleton,{className:"h-8 w-8"})})]},c))})]})})}function ap({data:a,loading:d,selectedUsers:e,onSelectUser:f,onSelectAll:g,onSort:i,onPageChange:j,onCreateUser:k,onEditUser:l,onActivateUser:m,onDeactivateUser:n,onDeleteUser:o,sortBy:p,sortOrder:q}){let r=a?.users||[],s=a=>a.firstName&&a.lastName?`${a.firstName} ${a.lastName}`:a.username,t=(0,c.useMemo)(()=>[{field:"username",headerName:"User",width:250,pinned:"left",sortable:!0,filterable:!0,cellRenderer:({data:a})=>(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(W.Avatar,{className:"w-8 h-8",children:[(0,b.jsx)(W.AvatarImage,{src:a.avatar,alt:s(a)}),(0,b.jsx)(W.AvatarFallback,{className:"text-xs",children:a.firstName&&a.lastName?`${a.firstName[0]}${a.lastName[0]}`.toUpperCase():a.username.slice(0,2).toUpperCase()})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-gray-900",children:s(a)}),(0,b.jsxs)("div",{className:"text-sm text-gray-500",children:["@",a.username]})]})]})},{field:"email",headerName:"Contact",width:280,sortable:!0,filterable:!0,cellRenderer:({data:a})=>(0,b.jsxs)("div",{className:"space-y-1",children:[a.email&&(0,b.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,b.jsx)(ab.Mail,{className:"w-3 h-3 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:a.email})]}),a.phone&&(0,b.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,b.jsx)(ac.Phone,{className:"w-3 h-3 flex-shrink-0"}),a.phone]})]})},{field:"roleType",headerName:"Role",width:120,type:"select",sortable:!0,filterable:!0,filterOptions:["ADMIN","USER","GUEST"],cellRenderer:({value:a})=>(0,b.jsx)(V.Badge,{variant:(a=>{switch(a.toLowerCase()){case"admin":return"destructive";case"user":return"default";default:return"secondary"}})(a),children:a})},{field:"isActive",headerName:"Status",width:180,type:"boolean",sortable:!0,filterable:!0,cellRenderer:({data:a})=>{let c=a.lockedUntil&&new Date(a.lockedUntil)>new Date;return(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[a.isActive?c?(0,b.jsxs)(V.Badge,{variant:"secondary",className:"bg-orange-100 text-orange-800",children:[(0,b.jsx)(G.AlertCircle,{className:"w-3 h-3 mr-1"}),"Locked"]}):(0,b.jsxs)(V.Badge,{variant:"secondary",className:"bg-green-100 text-green-800",children:[(0,b.jsx)(ae.CheckCircle,{className:"w-3 h-3 mr-1"}),"Active"]}):(0,b.jsxs)(V.Badge,{variant:"secondary",className:"bg-red-100 text-red-800",children:[(0,b.jsx)(af.XCircle,{className:"w-3 h-3 mr-1"}),"Inactive"]}),a.isVerified&&(0,b.jsx)("div",{title:"Verified",children:(0,b.jsx)(h.Shield,{className:"w-4 h-4 text-green-600"})}),a.isTwoFactorEnabled&&(0,b.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full",title:"2FA Enabled"})]})}},{field:"createdAt",headerName:"Joined",width:180,type:"date",sortable:!0,filterable:!0,cellRenderer:({value:a})=>(0,b.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,b.jsx)(ad.Calendar,{className:"w-3 h-3 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:(0,ag.formatDistanceToNow)(new Date(a),{addSuffix:!0})})]})},{field:"lastLoginAt",headerName:"Last Login",width:180,type:"date",sortable:!0,filterable:!0,cellRenderer:({value:a})=>a?(0,b.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,b.jsx)(aa.Clock,{className:"w-3 h-3 flex-shrink-0"}),(0,b.jsx)("span",{className:"truncate",children:(0,ag.formatDistanceToNow)(new Date(a),{addSuffix:!0})})]}):(0,b.jsx)("span",{className:"text-sm text-gray-400",children:"Never"})},{field:"id",headerName:"Actions",width:100,pinned:"right",sortable:!1,filterable:!1,cellRenderer:({data:a})=>(0,b.jsxs)(X.DropdownMenu,{children:[(0,b.jsx)(X.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(w.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:(0,b.jsx)(Y.MoreVertical,{className:"w-4 h-4"})})}),(0,b.jsxs)(X.DropdownMenuContent,{align:"end",children:[(0,b.jsxs)(X.DropdownMenuItem,{onClick:()=>l(a),children:[(0,b.jsx)(L.Edit,{className:"w-4 h-4 mr-2"}),"Edit User"]}),(0,b.jsx)(X.DropdownMenuSeparator,{}),(0,b.jsx)(X.DropdownMenuItem,{onClick:()=>a.isActive?n&&n(a):m&&m(a),children:a.isActive?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(_.default,{className:"w-4 h-4 mr-2"}),"Deactivate"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)($.UserCheck,{className:"w-4 h-4 mr-2"}),"Activate"]})}),(0,b.jsx)(X.DropdownMenuSeparator,{}),(0,b.jsxs)(X.DropdownMenuItem,{className:"text-red-600",onClick:()=>o&&o(a),children:[(0,b.jsx)(Z.Trash2,{className:"w-4 h-4 mr-2"}),"Delete User"]})]})]})}],[l,m,n,o]),u=(0,c.useRef)(new Set(e));(0,c.useEffect)(()=>{u.current=new Set(e)},[e]);let v=(0,c.useMemo)(()=>a=>{let b=a.map(a=>a.id),c=r.map(a=>a.id),d=new Set(b),e=u.current,h=b.filter(a=>!e.has(a)),i=Array.from(e).filter(a=>c.includes(a)&&!d.has(a));u.current=d,(h.length>0||i.length>0)&&(b.length===c.length&&c.length>0?g(c):[...h,...i].forEach(a=>f(a)))},[r,f,g]),x=(0,c.useCallback)(a=>{if(a.length>0){let b=a[0];i(String(b.field),b.direction||"asc")}},[i]),y=(0,c.useCallback)(a=>(k&&k(),Promise.resolve(!0)),[k]),z=(0,c.useCallback)((a,b,c)=>(l(a),Promise.resolve(!0)),[l]),A=(0,c.useCallback)(a=>o&&a.length>0?(a.forEach(a=>o(a)),Promise.resolve(!0)):Promise.resolve(!1),[o]);return d?(0,b.jsx)(ao,{rows:5}):r&&0!==r.length?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(U.AdvancedTable,{columns:t,data:r,config:{enableSorting:!0,enableFiltering:!0,enableColumnPinning:!0,enableColumnResizing:!0,enableColumnHiding:!0,enableRowSelection:!0,enableInlineEditing:!1,enableDialogEditing:!1,enableRowDeletion:!0,rowHeight:60,headerHeight:48,showToolbar:!0,showPagination:!1,virtualScrolling:!1},loading:d,onRowSelect:v,onSort:x,onRowCreate:k?y:void 0,onRowEdit:z,onRowDelete:o?A:void 0,height:600,className:"border rounded-lg"}),a&&a.totalPages>1&&(0,b.jsx)(al,{currentPage:a.page,totalPages:a.totalPages,pageSize:a.size,totalItems:a.total,onPageChange:j})]}):(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"text-gray-500 mb-2",children:"No users found"}),(0,b.jsx)("div",{className:"text-sm text-gray-400",children:"Try adjusting your search criteria"})]})}function aq(){let a,[d,e]=(0,c.useState)({search:"",roleType:void 0,isActive:void 0,isVerified:void 0,page:0,size:20,sortBy:"createdAt",sortOrder:"desc"}),[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(!1),[m,n]=(0,c.useState)(null),[q,s]=(0,c.useState)(!1),{users:t,total:w,page:x,size:y,totalPages:z,loading:A,error:B,refetch:C}=u((0,c.useMemo)(()=>{let a={page:d.page,size:d.size,sortBy:d.sortBy,sortOrder:d.sortOrder};return d.search?.trim()&&(a.search=d.search.trim()),d.roleType&&(a.roleType=d.roleType),void 0!==d.isActive&&(a.isActive=d.isActive),void 0!==d.isVerified&&(a.isVerified=d.isVerified),a},[d])),{data:D,loading:E}=(0,j.useQuery)(o,{fetchPolicy:"cache-and-network",errorPolicy:"all",skip:void 0}),[F,{loading:G}]=(a=(0,l.useApolloClient)(),(0,k.useMutation)(r,{onCompleted:()=>{a.refetchQueries({include:[p,o]})},errorPolicy:"all"})),H=async a=>{try{await F({variables:{input:{userIds:[a.id],action:"delete"}}}),(0,v.toast)({title:"Success",description:`User ${a.username} has been deleted.`,type:"success"}),g(b=>b.filter(b=>b!==a.id)),await C()}catch(a){(0,v.toast)({title:"Error",description:a.message||"Failed to delete user",type:"error",variant:"destructive"})}};return B?(0,b.jsx)(T,{title:"Error Loading Users",message:B.message||"Failed to load users data",onRetry:()=>C(),retryLabel:"Retry Loading Users"}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(ap,{data:{users:t,total:w,page:x,size:y,totalPages:z},loading:A,selectedUsers:f,onSelectUser:a=>{g(b=>b.includes(a)?b.filter(b=>b!==a):[...b,a])},onSelectAll:a=>{a.every(a=>f.includes(a))?g(b=>b.filter(b=>!a.includes(b))):g(b=>{let c=[...b];return a.forEach(a=>{c.includes(a)||c.push(a)}),c})},onSort:(a,b)=>{e(c=>({...c,sortBy:a,sortOrder:b}))},onPageChange:a=>{e(b=>({...b,page:a,page:a}))},onCreateUser:()=>i(!0),onEditUser:n,onDeleteUser:H,sortBy:d.sortBy,sortOrder:d.sortOrder}),(0,b.jsx)(I,{isOpen:h,onClose:()=>i(!1),onSuccess:()=>{i(!1),C()}}),(0,b.jsx)(R,{user:m,isOpen:!!m,onClose:()=>n(null),onSuccess:()=>{n(null),C()}})]})}function ar({message:a="Loading..."}){return(0,b.jsx)("div",{className:"container mx-auto py-8",children:(0,b.jsx)(A.Card,{children:(0,b.jsx)(A.CardContent,{className:"flex items-center justify-center py-12",children:(0,b.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,b.jsx)(F.Loader2,{className:"w-8 h-8 animate-spin text-primary"}),(0,b.jsx)("span",{className:"text-gray-600",children:a})]})})})})}var as=a.i(138436),at=a.i(516482);function au({userRole:a="Unknown",requiredRole:c="ADMIN"}){let e=(0,d.useRouter)();return(0,b.jsx)("div",{className:"container mx-auto py-12 px-4",children:(0,b.jsx)(A.Card,{className:"max-w-md mx-auto border-2 border-yellow-200",children:(0,b.jsx)(A.CardContent,{className:"flex items-center justify-center py-12",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(as.ShieldAlert,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-xl font-semibold text-yellow-900 mb-2",children:"Truy cáº­p bá»‹ háº¡n cháº¿"}),(0,b.jsxs)("p",{className:"text-gray-600 mb-4",children:["Báº¡n cáº§n quyá»n ",(0,b.jsx)("strong",{children:c})," Ä‘á»ƒ truy cáº­p trang nÃ y."]}),(0,b.jsxs)("p",{className:"text-sm text-gray-500 mb-6",children:["Quyá»n hiá»‡n táº¡i: ",(0,b.jsx)("strong",{className:"text-blue-600",children:a})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 font-medium mb-3",children:"ðŸ“Œ LiÃªn há»‡ quáº£n trá»‹ viÃªn Ä‘á»ƒ yÃªu cáº§u quyá»n truy cáº­p:"}),(0,b.jsxs)("a",{href:"mailto:admin@rausachcore.dev?subject=YÃªu cáº§u quyá»n truy cáº­p quáº£n trá»‹",className:"flex items-center justify-center gap-2 w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:[(0,b.jsx)(ab.Mail,{className:"w-4 h-4"}),"Gá»­i email"]})]}),(0,b.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,b.jsxs)(w.Button,{onClick:()=>e.push("/request-access"),variant:"outline",className:"w-full",children:[(0,b.jsx)(at.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Xem hÆ°á»›ng dáº«n yÃªu cáº§u"]})})]})})})})}var av=a.i(269022),aw=a.i(723593),ax=a.i(797945);let ay=m.gql`
  query SearchPermissions($input: PermissionSearchInput!) {
    searchPermissions(input: $input) {
      permissions {
        id
        name
        displayName
        description
        resource
        action
        scope
        category
        conditions
        metadata
        isActive
        isSystemPerm
        createdAt
        updatedAt
      }
      total
      page
      size
      totalPages
    }
  }
`;m.gql`
  query GetPermissionById($id: String!) {
    getPermissionById(id: $id) {
      id
      name
      displayName
      description
      resource
      action
      scope
      category
      conditions
      metadata
      isActive
      isSystemPerm
      createdAt
      updatedAt
    }
  }
`;let az=m.gql`
  mutation CreatePermission($input: CreatePermissionInput!) {
    createPermission(input: $input) {
      id
      name
      displayName
      description
      resource
      action
      scope
      category
      conditions
      metadata
      isActive
      isSystemPerm
      createdAt
      updatedAt
    }
  }
`,aA=m.gql`
  mutation UpdatePermission($id: String!, $input: UpdatePermissionInput!) {
    updatePermission(id: $id, input: $input) {
      id
      name
      displayName
      description
      resource
      action
      scope
      category
      conditions
      metadata
      isActive
      isSystemPerm
      createdAt
      updatedAt
    }
  }
`,aB=m.gql`
  mutation DeletePermission($id: String!) {
    deletePermission(id: $id)
  }
`,aC=m.gql`
  query SearchRoles($input: RoleSearchInput!) {
    searchRoles(input: $input) {
      roles {
        id
        name
        displayName
        description
        isActive
        isSystemRole
        priority
        metadata
        parentId
        createdAt
        updatedAt
        permissions {
          id
          name
          displayName
          resource
          action
          scope
          description
          isActive
        }
        children {
          id
          name
          displayName
        }
      }
      total
      page
      size
      totalPages
    }
  }
`;m.gql`
  query GetRoleById($id: String!) {
    getRoleById(id: $id) {
      id
      name
      displayName
      description
      isActive
      isSystemRole
      priority
      metadata
      parentId
      createdAt
      updatedAt
      permissions {
        id
        effect
        permission {
          id
          name
          displayName
          resource
          action
          scope
        }
      }
      children {
        id
        name
        displayName
      }
    }
  }
`;let aD=m.gql`
  mutation CreateRole($input: CreateRoleInput!) {
    createRole(input: $input) {
      id
      name
      displayName
      description
      isActive
      isSystemRole
      priority
      metadata
      parentId
      createdAt
      updatedAt
      permissions {
        id
        effect
        permission {
          id
          name
          displayName
          resource
          action
          scope
        }
      }
      children {
        id
        name
        displayName
      }
    }
  }
`,aE=m.gql`
  mutation UpdateRole($id: String!, $input: UpdateRoleInput!) {
    updateRole(id: $id, input: $input) {
      id
      name
      displayName
      description
      isActive
      isSystemRole
      priority
      metadata
      parentId
      createdAt
      updatedAt
      permissions {
        id
        effect
        permission {
          id
          name
          displayName
          resource
          action
          scope
        }
      }
      children {
        id
        name
        displayName
      }
    }
  }
`,aF=m.gql`
  mutation DeleteRole($id: String!) {
    deleteRole(id: $id)
  }
`,aG=m.gql`
  mutation AssignRolePermissions($input: AssignRolePermissionInput!) {
    assignRolePermissions(input: $input)
  }
`,aH=m.gql`
  query GetUserRolePermissions($userId: String!) {
    getUserRolePermissions(userId: $userId) {
      userId
      directPermissions {
        id
        effect
        conditions
        metadata
        permission {
          id
          name
          displayName
          resource
          action
          scope
        }
      }
      roleAssignments {
        id
        effect
        conditions
        metadata
        role {
          id
          name
          displayName
          permissions {
            id
            name
            displayName
            resource
            action
            scope
            description
            isActive
          }
        }
      }
      effectivePermissions {
        id
        name
        displayName
        resource
        action
        scope
        description
        isActive
      }
      summary {
        totalDirectPermissions
        totalRoleAssignments
        totalEffectivePermissions
        lastUpdated
      }
    }
  }
`,aI=m.gql`
  mutation AssignUserRoles($input: AssignUserRoleInput!) {
    assignUserRoles(input: $input)
  }
`,aJ=m.gql`
  mutation AssignUserPermissions($input: AssignUserPermissionInput!) {
    assignUserPermissions(input: $input)
  }
`;var aK=a.i(189101);let aL=a=>(0,j.useQuery)(ay,{variables:{input:a},errorPolicy:"all",onError:a=>{console.error("Error searching permissions:",a),aK.toast.error("Failed to search permissions")}}),aM=a=>(0,j.useQuery)(aC,{variables:{input:a},errorPolicy:"all",onError:a=>{console.error("Error searching roles:",a),aK.toast.error("Failed to search roles")}}),aN=a=>(0,j.useQuery)(aH,{variables:{userId:a},skip:!a,errorPolicy:"all",onError:a=>{console.error("Error getting user role permissions:",a),aK.toast.error("Failed to get user permissions")}});var aO=a.i(715398),aP=a.i(335558),aQ=a.i(629432);let aR=({isOpen:a,role:d,onClose:e,onSuccess:f})=>{let[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(""),[l,{loading:m}]=(0,k.useMutation)(aG,{onCompleted:()=>{aK.toast.success("Role permissions updated successfully")},onError:a=>{console.error("Error assigning role permissions:",a),aK.toast.error("Failed to update role permissions")},refetchQueries:["SearchRoles","GetRoleById"]}),{data:n}=aL({page:0,size:100,isActive:!0}),{toast:o}=(0,v.useToast)();(0,c.useEffect)(()=>{a||j("")},[a]),(0,c.useEffect)(()=>{if(d&&n?.searchPermissions?.permissions){let a=n.searchPermissions.permissions,b=d.permissions||[];h(a.map(a=>{let c=b.find(b=>b?.permission?.id===a?.id);return{permissionId:a?.id,effect:c?c.effect:null}}))}},[d,n]);let p=async a=>{a.preventDefault();let b=g.filter(a=>"allow"===a.effect).map(a=>a.permissionId),c=g.filter(a=>"deny"===a.effect).map(a=>a.permissionId);try{await l({variables:{input:{roleId:d.id,permissionIds:b,effect:"allow"}}}),c.length>0&&console.warn("Deny permissions are not fully supported with current backend API"),o({title:"Permissions updated",description:`${b.length} permission(s) assigned to role "${d.displayName}".`,type:"success"}),f(),e()}catch(a){o({title:"Update failed",description:a.message||"Failed to update permissions",type:"error"})}},q=n?.searchPermissions?.permissions||[],r=n?.searchPermissions?.total||0,s=q.filter(a=>a.displayName.toLowerCase().includes(i.toLowerCase())||a.name.toLowerCase().includes(i.toLowerCase())||a.resource.toLowerCase().includes(i.toLowerCase())||a.action.toLowerCase().includes(i.toLowerCase())),t=g.filter(a=>null!==a.effect).length;return(0,b.jsx)(J.Dialog,{open:a,onOpenChange:e,children:(0,b.jsxs)(J.DialogContent,{className:"max-w-4xl max-h-[90vh]",children:[(0,b.jsxs)(J.DialogHeader,{children:[(0,b.jsxs)(J.DialogTitle,{children:["Manage Permissions for: ",d.displayName]}),(0,b.jsx)(J.DialogDescription,{children:'Assign permissions for this role. Choose "Allow" to grant permission or "None" to remove it. Note: "Deny" functionality requires backend API enhancement.'})]}),(0,b.jsxs)("form",{onSubmit:p,className:"space-y-4",children:[r>100&&(0,b.jsx)(C.Alert,{children:(0,b.jsxs)(C.AlertDescription,{children:["Showing first 100 of ",r," permissions. Use search to find specific permissions."]})}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(aQ.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(x.Input,{type:"text",placeholder:"Search permissions...",value:i,onChange:a=>j(a.target.value),className:"pl-10",disabled:m})]}),(0,b.jsxs)(V.Badge,{variant:"secondary",className:"ml-4",children:[t," assigned"]})]}),(0,b.jsx)(aP.ScrollArea,{className:"h-[400px] border rounded-lg",children:(0,b.jsxs)("div",{className:"divide-y",children:[s.map(a=>{let c=g.find(b=>b.permissionId===a.id);return(0,b.jsx)("div",{className:"p-4 hover:bg-muted/50 transition-colors",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsx)("div",{className:"font-medium",children:a.displayName}),a.description&&(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:a.description}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsxs)("code",{className:"px-2 py-0.5 rounded bg-muted text-xs",children:[a.resource,":",a.action,a.scope&&`:${a.scope}`]}),(0,b.jsx)(V.Badge,{variant:"outline",className:"text-xs",children:a.category})]})]}),(0,b.jsxs)(aO.RadioGroup,{value:c?.effect||"none",onValueChange:b=>{var c,d;return c=a.id,d="none"===b?null:b,void h(a=>a.map(a=>a.permissionId===c?{...a,effect:d}:a))},className:"flex gap-4",disabled:m,children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(aO.RadioGroupItem,{value:"none",id:`${a.id}-none`,disabled:m}),(0,b.jsx)(y.Label,{htmlFor:`${a.id}-none`,className:"font-normal cursor-pointer",children:"None"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(aO.RadioGroupItem,{value:"allow",id:`${a.id}-allow`,disabled:m}),(0,b.jsx)(y.Label,{htmlFor:`${a.id}-allow`,className:"font-normal cursor-pointer text-green-600",children:"Allow"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(aO.RadioGroupItem,{value:"deny",id:`${a.id}-deny`,disabled:m}),(0,b.jsx)(y.Label,{htmlFor:`${a.id}-deny`,className:"font-normal cursor-pointer text-destructive",children:"Deny"})]})]})]})},a.id)}),0===s.length&&(0,b.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"No permissions found matching your search."})]})}),(0,b.jsxs)(J.DialogFooter,{children:[(0,b.jsx)(w.Button,{type:"button",variant:"outline",onClick:e,disabled:m,children:"Cancel"}),(0,b.jsx)(w.Button,{type:"submit",disabled:m,children:m?"Saving...":"Save Permissions"})]})]})]})})};var aS=a.i(466577),aT=a.i(928624);let aU=({isOpen:a,onClose:d,onSuccess:e})=>{let[f,g]=(0,c.useState)({name:"",displayName:"",description:"",priority:0,permissionIds:[]}),[h,{loading:i}]=(0,k.useMutation)(aD,{onCompleted:()=>{aK.toast.success("Role created successfully")},onError:a=>{console.error("Error creating role:",a),aK.toast.error("Failed to create role")},refetchQueries:["SearchRoles"]}),{data:j}=aL({page:0,size:100,isActive:!0}),{toast:l}=(0,v.useToast)(),m=async a=>{a.preventDefault();try{await h({variables:{input:f}}),l({title:"Role created",description:`Role "${f.displayName}" has been created successfully.`,type:"success"}),e()}catch(a){l({title:"Create failed",description:a.message||"Failed to create role",type:"error"})}},n=j?.searchPermissions?.permissions||[];return(0,b.jsx)(J.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(J.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(J.DialogHeader,{children:[(0,b.jsx)(J.DialogTitle,{children:"Create New Role"}),(0,b.jsx)(J.DialogDescription,{children:"Create a new role and assign permissions"})]}),(0,b.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"name",children:["Role Name ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(x.Input,{id:"name",required:!0,value:f.name,onChange:a=>g(b=>({...b,name:a.target.value})),placeholder:"e.g., user_manager"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"displayName",children:["Display Name ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(x.Input,{id:"displayName",required:!0,value:f.displayName,onChange:a=>g(b=>({...b,displayName:a.target.value})),placeholder:"e.g., User Manager"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(y.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(aS.Textarea,{id:"description",rows:3,value:f.description||"",onChange:a=>g(b=>({...b,description:a.target.value})),placeholder:"Describe the role's purpose and responsibilities"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(y.Label,{htmlFor:"priority",children:"Priority"}),(0,b.jsx)(x.Input,{id:"priority",type:"number",value:f.priority,onChange:a=>g(b=>({...b,priority:parseInt(a.target.value)||0})),placeholder:"0"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Higher numbers have higher priority"})]}),n.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)(y.Label,{className:"mb-2 block",children:"Permissions"}),(0,b.jsx)(aP.ScrollArea,{className:"h-48 border rounded-md p-3",children:(0,b.jsx)("div",{className:"space-y-3",children:n.map(a=>(0,b.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,b.jsx)(aT.Checkbox,{id:`permission-${a.id}`,checked:f.permissionIds?.includes(a.id)||!1,onCheckedChange:()=>{var b;return b=a.id,void g(a=>({...a,permissionIds:a.permissionIds?.includes(b)?a.permissionIds.filter(a=>a!==b):[...a.permissionIds||[],b]}))}}),(0,b.jsxs)(y.Label,{htmlFor:`permission-${a.id}`,className:"text-sm font-normal cursor-pointer leading-tight",children:[(0,b.jsx)("div",{children:a.displayName}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.resource,":",a.action]})]})]},a.id))})}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[f.permissionIds?.length||0," permissions selected"]})]})]}),(0,b.jsxs)(J.DialogFooter,{children:[(0,b.jsx)(w.Button,{type:"button",variant:"outline",onClick:d,children:"Cancel"}),(0,b.jsx)(w.Button,{type:"submit",disabled:i,children:i?"Creating...":"Create Role"})]})]})]})})},aV=({isOpen:a,role:d,onClose:e,onSuccess:f})=>{let[g,h]=(0,c.useState)({name:"",displayName:"",description:"",priority:0,isActive:!0}),[i,{loading:j}]=(0,k.useMutation)(aE,{onCompleted:()=>{aK.toast.success("Role updated successfully")},onError:a=>{console.error("Error updating role:",a),aK.toast.error("Failed to update role")},refetchQueries:["SearchRoles","GetRoleById"]}),{data:l}=aL({page:0,size:100,isActive:!0}),{toast:m}=(0,v.useToast)();(0,c.useEffect)(()=>{d&&h({name:d.name,displayName:d.displayName,description:d.description||"",priority:d.priority,isActive:d.isActive})},[d]);let n=async a=>{a.preventDefault();try{await i({variables:{id:d.id,input:g}}),m({title:"Role updated",description:`Role "${g.displayName}" has been updated successfully.`,type:"success"}),f()}catch(a){m({title:"Update failed",description:a.message||"Failed to update role",type:"error"})}};return(0,b.jsx)(J.Dialog,{open:a,onOpenChange:e,children:(0,b.jsxs)(J.DialogContent,{className:"max-w-2xl",children:[(0,b.jsxs)(J.DialogHeader,{children:[(0,b.jsxs)(J.DialogTitle,{children:["Edit Role: ",d.displayName]}),(0,b.jsx)(J.DialogDescription,{children:"Update role information and settings"})]}),(0,b.jsxs)("form",{onSubmit:n,className:"space-y-4",children:[d.isSystemRole&&(0,b.jsxs)(C.Alert,{className:"border-yellow-200 bg-yellow-50",children:[(0,b.jsx)(G.AlertCircle,{className:"h-4 w-4 text-yellow-600"}),(0,b.jsxs)(C.AlertDescription,{className:"text-yellow-800",children:[(0,b.jsx)("strong",{children:"System Role:"})," Some properties cannot be modified to ensure system stability."]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"name",children:["Role Name ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(x.Input,{id:"name",required:!0,value:g.name||"",onChange:a=>h(b=>({...b,name:a.target.value})),placeholder:"e.g., user_manager",disabled:d.isSystemRole}),d.isSystemRole&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"System role names cannot be changed"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"displayName",children:["Display Name ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(x.Input,{id:"displayName",required:!0,value:g.displayName||"",onChange:a=>h(b=>({...b,displayName:a.target.value})),placeholder:"e.g., User Manager"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(y.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(aS.Textarea,{id:"description",rows:3,value:g.description||"",onChange:a=>h(b=>({...b,description:a.target.value})),placeholder:"Describe the role's purpose and responsibilities"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(y.Label,{htmlFor:"priority",children:"Priority"}),(0,b.jsx)(x.Input,{id:"priority",type:"number",value:g.priority||0,onChange:a=>h(b=>({...b,priority:parseInt(a.target.value)||0})),placeholder:"0"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Higher numbers have higher priority"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(aT.Checkbox,{id:"isActive",checked:g.isActive||!1,onCheckedChange:a=>h(b=>({...b,isActive:a})),disabled:d.isSystemRole}),(0,b.jsx)(y.Label,{htmlFor:"isActive",className:"text-sm font-normal cursor-pointer",children:"Active"})]}),d.isSystemRole&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"System roles cannot be deactivated"})]}),(0,b.jsxs)(J.DialogFooter,{children:[(0,b.jsx)(w.Button,{type:"button",variant:"outline",onClick:e,children:"Cancel"}),(0,b.jsx)(w.Button,{type:"submit",disabled:j,children:j?"Updating...":"Update Role"})]})]})]})})},aW=({className:a=""})=>{let[d,e]=(0,c.useState)({page:0,size:20,sortBy:"name",sortOrder:"asc"}),[f,h]=(0,c.useState)(!1),[i,j]=(0,c.useState)(null),[l,m]=(0,c.useState)(null),{data:n,loading:o,error:p,refetch:q}=aM(d),[r]=(0,k.useMutation)(aF,{onCompleted:()=>{aK.toast.success("Role deleted successfully")},onError:a=>{console.error("Error deleting role:",a),aK.toast.error("Failed to delete role")},refetchQueries:["SearchRoles"]}),{toast:s}=(0,v.useToast)(),t=a=>{e(b=>({...b,page:a}))},u=async a=>{if(a.isSystemRole)return void s({title:"Cannot delete system role",description:"System roles cannot be deleted for security reasons.",type:"error"});if(window.confirm(`Are you sure you want to delete role "${a.displayName}"?`))try{await r({variables:{id:a.id}}),s({title:"Role deleted",description:`Role "${a.displayName}" has been deleted successfully.`,type:"success"}),q()}catch(a){s({title:"Delete failed",description:a.message||"Failed to delete role",type:"error"})}};if(o)return(0,b.jsxs)(A.Card,{className:a,children:[(0,b.jsxs)(A.CardHeader,{children:[(0,b.jsx)(am.Skeleton,{className:"h-8 w-48"}),(0,b.jsx)(am.Skeleton,{className:"h-4 w-96"})]}),(0,b.jsx)(A.CardContent,{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(am.Skeleton,{className:"h-10 w-10 rounded-full"}),(0,b.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,b.jsx)(am.Skeleton,{className:"h-4 w-[250px]"}),(0,b.jsx)(am.Skeleton,{className:"h-4 w-[200px]"})]})]},c))})]});if(p)return(0,b.jsx)(C.Alert,{className:`border-red-200 bg-red-50 text-red-800 ${a}`,children:(0,b.jsxs)(C.AlertDescription,{children:["Error loading roles: ",p.message]})});let y=n?.searchRoles?.roles||[],B=n?.searchRoles?.total||0,D=n?.searchRoles?.totalPages||0;return(0,b.jsxs)(A.Card,{className:a,children:[(0,b.jsx)(A.CardHeader,{children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(A.CardTitle,{children:"Role Management"}),(0,b.jsx)(A.CardDescription,{children:"Manage system roles and their permissions"})]}),(0,b.jsxs)(w.Button,{onClick:()=>h(!0),children:[(0,b.jsx)(aw.Plus,{className:"mr-2 h-4 w-4"}),"New Role"]})]})}),(0,b.jsxs)(A.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)(x.Input,{type:"text",placeholder:"Search roles...",value:d.search||"",onChange:a=>{var b;return b=a.target.value,void e(a=>({...a,search:b,page:0}))}})}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(z.Select,{value:void 0===d.isActive?"all":d.isActive.toString(),onValueChange:a=>e(b=>({...b,isActive:"all"===a?void 0:"true"===a,page:0})),children:[(0,b.jsx)(z.SelectTrigger,{className:"w-[140px]",children:(0,b.jsx)(z.SelectValue,{placeholder:"All Status"})}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"all",children:"All Status"}),(0,b.jsx)(z.SelectItem,{value:"true",children:"Active"}),(0,b.jsx)(z.SelectItem,{value:"false",children:"Inactive"})]})]}),(0,b.jsxs)(z.Select,{value:void 0===d.isSystemRole?"all":d.isSystemRole.toString(),onValueChange:a=>e(b=>({...b,isSystemRole:"all"===a?void 0:"true"===a,page:0})),children:[(0,b.jsx)(z.SelectTrigger,{className:"w-[140px]",children:(0,b.jsx)(z.SelectValue,{placeholder:"All Types"})}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"all",children:"All Types"}),(0,b.jsx)(z.SelectItem,{value:"true",children:"System"}),(0,b.jsx)(z.SelectItem,{value:"false",children:"Custom"})]})]})]})]}),(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(an.Table,{children:[(0,b.jsx)(an.TableHeader,{children:(0,b.jsxs)(an.TableRow,{children:[(0,b.jsx)(an.TableHead,{children:"Role"}),(0,b.jsx)(an.TableHead,{children:"Permissions"}),(0,b.jsx)(an.TableHead,{children:"Status"}),(0,b.jsx)(an.TableHead,{children:"Priority"}),(0,b.jsx)(an.TableHead,{children:"Created"}),(0,b.jsx)(an.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(an.TableBody,{children:0===y.length?(0,b.jsx)(an.TableRow,{children:(0,b.jsx)(an.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No roles found"})}):y.map(a=>(0,b.jsxs)(an.TableRow,{children:[(0,b.jsx)(an.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(W.Avatar,{children:(0,b.jsx)(W.AvatarFallback,{className:"bg-muted",children:(0,b.jsx)(g.Users,{className:"h-5 w-5 text-muted-foreground"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.displayName}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[a.name,a.isSystemRole&&(0,b.jsx)(V.Badge,{variant:"secondary",className:"text-xs",children:"System"})]}),a.description&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:a.description})]})]})}),(0,b.jsxs)(an.TableCell,{children:[(0,b.jsxs)("div",{children:[a.permissions?.length||0," permissions"]}),a.children&&a.children.length>0&&(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:[a.children.length," child roles"]})]}),(0,b.jsx)(an.TableCell,{children:(0,b.jsx)(V.Badge,{variant:a.isActive?"default":"destructive",children:a.isActive?"Active":"Inactive"})}),(0,b.jsx)(an.TableCell,{children:a.priority}),(0,b.jsx)(an.TableCell,{children:new Date(a.createdAt).toLocaleDateString()}),(0,b.jsx)(an.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(w.Button,{variant:"ghost",size:"icon",onClick:()=>m(a),title:"Manage Permissions",children:(0,b.jsx)(av.ShieldCheck,{className:"h-4 w-4"})}),(0,b.jsx)(w.Button,{variant:"ghost",size:"icon",onClick:()=>j(a),title:"Edit Role",children:(0,b.jsx)(ax.Pencil,{className:"h-4 w-4"})}),!a.isSystemRole&&(0,b.jsx)(w.Button,{variant:"ghost",size:"icon",onClick:()=>u(a),title:"Delete Role",children:(0,b.jsx)(Z.Trash2,{className:"h-4 w-4 text-destructive"})})]})})]},a.id))})]})}),D>1&&(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(d.page||0)*(d.size||20)+1," to"," ",Math.min(((d.page||0)+1)*(d.size||20),B)," of ",B," results"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Button,{variant:"outline",size:"sm",onClick:()=>t((d.page||0)-1),disabled:0>=(d.page||0),children:"Previous"}),(0,b.jsxs)("div",{className:"text-sm font-medium px-3 py-1 bg-muted rounded-md",children:[(d.page||0)+1," / ",D]}),(0,b.jsx)(w.Button,{variant:"outline",size:"sm",onClick:()=>t((d.page||0)+1),disabled:(d.page||0)>=D-1,children:"Next"})]})]})]}),f&&(0,b.jsx)(aU,{isOpen:f,onClose:()=>h(!1),onSuccess:()=>{h(!1),q()}}),i&&(0,b.jsx)(aV,{isOpen:!!i,role:i,onClose:()=>j(null),onSuccess:()=>{j(null),q()}}),l&&(0,b.jsx)(aR,{isOpen:!!l,role:l,onClose:()=>m(null),onSuccess:()=>{m(null),q()}})]})},aX=({isOpen:a,onClose:d,onSuccess:e})=>{let[f,g]=(0,c.useState)({name:"",displayName:"",description:"",resource:"",action:"",scope:"",category:"general"}),[h,{loading:i}]=(0,k.useMutation)(az,{onCompleted:()=>{aK.toast.success("Permission created successfully")},onError:a=>{console.error("Error creating permission:",a),aK.toast.error("Failed to create permission")},refetchQueries:["SearchPermissions"]}),{toast:j}=(0,v.useToast)(),l=async a=>{a.preventDefault();try{await h({variables:{input:{...f,scope:f.scope||void 0}}}),j({title:"Permission created",description:`Permission "${f.displayName}" has been created successfully.`,type:"success"}),e()}catch(a){j({title:"Create failed",description:a.message||"Failed to create permission",type:"error"})}};return(0,b.jsx)(J.Dialog,{open:a,onOpenChange:d,children:(0,b.jsxs)(J.DialogContent,{className:"max-w-2xl",children:[(0,b.jsxs)(J.DialogHeader,{children:[(0,b.jsx)(J.DialogTitle,{children:"Create New Permission"}),(0,b.jsx)(J.DialogDescription,{children:"Define a new permission for the RBAC system. Use the format resource:action:scope for the permission name."})]}),(0,b.jsxs)("form",{onSubmit:l,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"name",children:["Permission Name ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(x.Input,{id:"name",required:!0,value:f.name,onChange:a=>g(b=>({...b,name:a.target.value})),placeholder:"e.g., user:read:own"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Use the format: resource:action:scope"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"displayName",children:["Display Name ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(x.Input,{id:"displayName",required:!0,value:f.displayName,onChange:a=>g(b=>({...b,displayName:a.target.value})),placeholder:"e.g., Read Own User Data"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(y.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(aS.Textarea,{id:"description",rows:3,value:f.description||"",onChange:a=>g(b=>({...b,description:a.target.value})),placeholder:"Describe what this permission allows"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"resource",children:["Resource ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(x.Input,{id:"resource",required:!0,value:f.resource,onChange:a=>g(b=>({...b,resource:a.target.value})),placeholder:"e.g., user, post, comment"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"action",children:["Action ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(x.Input,{id:"action",required:!0,value:f.action,onChange:a=>g(b=>({...b,action:a.target.value})),placeholder:"e.g., read, write, delete"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(y.Label,{htmlFor:"scope",children:"Scope"}),(0,b.jsx)(x.Input,{id:"scope",value:f.scope||"",onChange:a=>g(b=>({...b,scope:a.target.value})),placeholder:"e.g., own, all, team (optional)"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Optional scope qualifier for the permission"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"category",children:["Category ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsxs)(z.Select,{value:f.category||"general",onValueChange:a=>g(b=>({...b,category:a})),children:[(0,b.jsx)(z.SelectTrigger,{children:(0,b.jsx)(z.SelectValue,{})}),(0,b.jsx)(z.SelectContent,{children:["general","user","admin","content","system","reporting","billing","integration"].map(a=>(0,b.jsx)(z.SelectItem,{value:a,children:a.charAt(0).toUpperCase()+a.slice(1)},a))})]})]})]}),(0,b.jsxs)(J.DialogFooter,{children:[(0,b.jsx)(w.Button,{type:"button",variant:"outline",onClick:d,children:"Cancel"}),(0,b.jsx)(w.Button,{type:"submit",disabled:i,children:i?"Creating...":"Create Permission"})]})]})]})})},aY=({isOpen:a,permission:d,onClose:e,onSuccess:f})=>{let[g,h]=(0,c.useState)({name:"",displayName:"",description:"",resource:"",action:"",scope:"",category:"general",isActive:!0}),[i,{loading:j}]=(0,k.useMutation)(aA,{onCompleted:()=>{aK.toast.success("Permission updated successfully")},onError:a=>{console.error("Error updating permission:",a),aK.toast.error("Failed to update permission")},refetchQueries:["SearchPermissions","GetPermissionById"]}),{toast:l}=(0,v.useToast)();(0,c.useEffect)(()=>{d&&h({name:d.name,displayName:d.displayName,description:d.description||"",resource:d.resource,action:d.action,scope:d.scope||"",category:d.category,isActive:d.isActive})},[d]);let m=async a=>{a.preventDefault();try{await i({variables:{id:d.id,input:{...g,scope:g.scope||void 0}}}),l({title:"Permission updated",description:`Permission "${g.displayName}" has been updated successfully.`,type:"success"}),f()}catch(a){l({title:"Update failed",description:a.message||"Failed to update permission",type:"error"})}};return(0,b.jsx)(J.Dialog,{open:a,onOpenChange:e,children:(0,b.jsxs)(J.DialogContent,{className:"max-w-2xl",children:[(0,b.jsxs)(J.DialogHeader,{children:[(0,b.jsxs)(J.DialogTitle,{children:["Edit Permission: ",d.displayName]}),(0,b.jsx)(J.DialogDescription,{children:"Update permission details. System permissions have limited editability to ensure system stability."})]}),(0,b.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[d.isSystemPerm&&(0,b.jsxs)(C.Alert,{children:[(0,b.jsx)(G.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(C.AlertDescription,{children:"This is a system permission. Some properties cannot be modified to ensure system stability."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"name",children:["Permission Name ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(x.Input,{id:"name",required:!0,value:g.name||"",onChange:a=>h(b=>({...b,name:a.target.value})),placeholder:"e.g., user:read:own",disabled:d.isSystemPerm}),d.isSystemPerm&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"System permission names cannot be changed"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"displayName",children:["Display Name ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(x.Input,{id:"displayName",required:!0,value:g.displayName||"",onChange:a=>h(b=>({...b,displayName:a.target.value})),placeholder:"e.g., Read Own User Data"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(y.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(aS.Textarea,{id:"description",rows:3,value:g.description||"",onChange:a=>h(b=>({...b,description:a.target.value})),placeholder:"Describe what this permission allows"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"resource",children:["Resource ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(x.Input,{id:"resource",required:!0,value:g.resource||"",onChange:a=>h(b=>({...b,resource:a.target.value})),placeholder:"e.g., user, post, comment",disabled:d.isSystemPerm})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"action",children:["Action ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(x.Input,{id:"action",required:!0,value:g.action||"",onChange:a=>h(b=>({...b,action:a.target.value})),placeholder:"e.g., read, write, delete",disabled:d.isSystemPerm})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(y.Label,{htmlFor:"scope",children:"Scope"}),(0,b.jsx)(x.Input,{id:"scope",value:g.scope||"",onChange:a=>h(b=>({...b,scope:a.target.value})),placeholder:"e.g., own, all, team (optional)",disabled:d.isSystemPerm}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Optional scope qualifier for the permission"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(y.Label,{htmlFor:"category",children:["Category ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsxs)(z.Select,{value:g.category||"general",onValueChange:a=>h(b=>({...b,category:a})),children:[(0,b.jsx)(z.SelectTrigger,{children:(0,b.jsx)(z.SelectValue,{})}),(0,b.jsx)(z.SelectContent,{children:["general","user","admin","content","system","reporting","billing","integration"].map(a=>(0,b.jsx)(z.SelectItem,{value:a,children:a.charAt(0).toUpperCase()+a.slice(1)},a))})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(aT.Checkbox,{id:"isActive",checked:g.isActive||!1,onCheckedChange:a=>h(b=>({...b,isActive:a})),disabled:d.isSystemPerm}),(0,b.jsx)(y.Label,{htmlFor:"isActive",className:"font-normal cursor-pointer",children:"Active"})]}),d.isSystemPerm&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"System permissions cannot be deactivated"})]}),(0,b.jsxs)(J.DialogFooter,{children:[(0,b.jsx)(w.Button,{type:"button",variant:"outline",onClick:e,children:"Cancel"}),(0,b.jsx)(w.Button,{type:"submit",disabled:j,children:j?"Updating...":"Update Permission"})]})]})]})})},aZ=({className:a=""})=>{let[d,e]=(0,c.useState)({page:0,size:20,sortBy:"name",sortOrder:"asc"}),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(null),{data:j,loading:l,error:m,refetch:n}=aL(d),[o]=(0,k.useMutation)(aB,{onCompleted:()=>{aK.toast.success("Permission deleted successfully")},onError:a=>{console.error("Error deleting permission:",a),aK.toast.error("Failed to delete permission")},refetchQueries:["SearchPermissions"]}),{toast:p}=(0,v.useToast)(),q=a=>{e(b=>({...b,page:a}))},r=async a=>{if(a.isSystemPerm)return void p({title:"Cannot delete system permission",description:"System permissions cannot be deleted for security reasons.",type:"error"});if(window.confirm(`Are you sure you want to delete permission "${a.displayName}"?`))try{await o({variables:{id:a.id}}),p({title:"Permission deleted",description:`Permission "${a.displayName}" has been deleted successfully.`,type:"success"}),n()}catch(a){p({title:"Delete failed",description:a.message||"Failed to delete permission",type:"error"})}};if(l)return(0,b.jsxs)(A.Card,{className:a,children:[(0,b.jsxs)(A.CardHeader,{children:[(0,b.jsx)(am.Skeleton,{className:"h-8 w-48"}),(0,b.jsx)(am.Skeleton,{className:"h-4 w-96"})]}),(0,b.jsx)(A.CardContent,{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(am.Skeleton,{className:"h-10 w-10 rounded-full"}),(0,b.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,b.jsx)(am.Skeleton,{className:"h-4 w-[250px]"}),(0,b.jsx)(am.Skeleton,{className:"h-4 w-[200px]"})]})]},c))})]});if(m)return(0,b.jsx)(C.Alert,{className:`border-red-200 bg-red-50 text-red-800 ${a}`,children:(0,b.jsxs)(C.AlertDescription,{children:["Error loading permissions: ",m.message]})});let s=j?.searchPermissions?.permissions||[],t=j?.searchPermissions?.total||0,u=j?.searchPermissions?.totalPages||0;return(0,b.jsxs)(A.Card,{className:a,children:[(0,b.jsx)(A.CardHeader,{children:(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(A.CardTitle,{children:"Permission Management"}),(0,b.jsx)(A.CardDescription,{children:"Define and manage system permissions"})]}),(0,b.jsxs)(w.Button,{onClick:()=>g(!0),children:[(0,b.jsx)(aw.Plus,{className:"mr-2 h-4 w-4"}),"New Permission"]})]})}),(0,b.jsxs)(A.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)(x.Input,{type:"text",placeholder:"Search permissions...",value:d.search||"",onChange:a=>{var b;return b=a.target.value,void e(a=>({...a,search:b,page:0}))}})}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(x.Input,{type:"text",placeholder:"Resource",value:d.resource||"",onChange:a=>e(b=>({...b,resource:a.target.value||void 0,page:0})),className:"w-32"}),(0,b.jsx)(x.Input,{type:"text",placeholder:"Action",value:d.action||"",onChange:a=>e(b=>({...b,action:a.target.value||void 0,page:0})),className:"w-32"}),(0,b.jsxs)(z.Select,{value:void 0===d.isActive?"all":d.isActive.toString(),onValueChange:a=>e(b=>({...b,isActive:"all"===a?void 0:"true"===a,page:0})),children:[(0,b.jsx)(z.SelectTrigger,{className:"w-[140px]",children:(0,b.jsx)(z.SelectValue,{placeholder:"All Status"})}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"all",children:"All Status"}),(0,b.jsx)(z.SelectItem,{value:"true",children:"Active"}),(0,b.jsx)(z.SelectItem,{value:"false",children:"Inactive"})]})]})]})]}),(0,b.jsx)("div",{className:"rounded-md border",children:(0,b.jsxs)(an.Table,{children:[(0,b.jsx)(an.TableHeader,{children:(0,b.jsxs)(an.TableRow,{children:[(0,b.jsx)(an.TableHead,{children:"Permission"}),(0,b.jsx)(an.TableHead,{children:"Resource:Action"}),(0,b.jsx)(an.TableHead,{children:"Category"}),(0,b.jsx)(an.TableHead,{children:"Status"}),(0,b.jsx)(an.TableHead,{children:"Created"}),(0,b.jsx)(an.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(an.TableBody,{children:0===s.length?(0,b.jsx)(an.TableRow,{children:(0,b.jsx)(an.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No permissions found"})}):s.map(a=>(0,b.jsxs)(an.TableRow,{children:[(0,b.jsx)(an.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(W.Avatar,{children:(0,b.jsx)(W.AvatarFallback,{className:"bg-muted",children:(0,b.jsx)(M.Key,{className:"h-5 w-5 text-muted-foreground"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.displayName}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[a.name,a.isSystemPerm&&(0,b.jsx)(V.Badge,{variant:"secondary",className:"text-xs",children:"System"})]}),a.description&&(0,b.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:a.description})]})]})}),(0,b.jsx)(an.TableCell,{children:(0,b.jsxs)("div",{children:[a.resource,":",a.action,a.scope&&(0,b.jsxs)("span",{className:"text-muted-foreground",children:[":",a.scope]})]})}),(0,b.jsx)(an.TableCell,{children:(0,b.jsx)(V.Badge,{variant:"outline",children:a.category})}),(0,b.jsx)(an.TableCell,{children:(0,b.jsx)(V.Badge,{variant:a.isActive?"default":"destructive",children:a.isActive?"Active":"Inactive"})}),(0,b.jsx)(an.TableCell,{children:new Date(a.createdAt).toLocaleDateString()}),(0,b.jsx)(an.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(w.Button,{variant:"ghost",size:"icon",onClick:()=>i(a),title:"Edit Permission",children:(0,b.jsx)(ax.Pencil,{className:"h-4 w-4"})}),!a.isSystemPerm&&(0,b.jsx)(w.Button,{variant:"ghost",size:"icon",onClick:()=>r(a),title:"Delete Permission",children:(0,b.jsx)(Z.Trash2,{className:"h-4 w-4 text-destructive"})})]})})]},a.id))})]})}),u>1&&(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(d.page||0)*(d.size||20)+1," to"," ",Math.min(((d.page||0)+1)*(d.size||20),t)," of ",t," results"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(w.Button,{variant:"outline",size:"sm",onClick:()=>q((d.page||0)-1),disabled:0>=(d.page||0),children:"Previous"}),(0,b.jsxs)("div",{className:"text-sm font-medium px-3 py-1 bg-muted rounded-md",children:[(d.page||0)+1," / ",u]}),(0,b.jsx)(w.Button,{variant:"outline",size:"sm",onClick:()=>q((d.page||0)+1),disabled:(d.page||0)>=u-1,children:"Next"})]})]})]}),f&&(0,b.jsx)(aX,{isOpen:f,onClose:()=>g(!1),onSuccess:()=>{g(!1),n()}}),h&&(0,b.jsx)(aY,{isOpen:!!h,permission:h,onClose:()=>i(null),onSuccess:()=>{i(null),n()}})]})};var a$=a.i(779149),a_=a.i(785694),a0=a.i(890082);let a1=({isOpen:a,user:d,onClose:e})=>{let[g,i]=(0,c.useState)([]),[j,l]=(0,c.useState)([]),{toast:m}=(0,v.useToast)(),{data:n,loading:o,refetch:p}=aN(d?.id),{data:q}=aM({page:0,size:100,isActive:!0}),{data:r}=aL({page:0,size:100,isActive:!0}),[s,{loading:t}]=(0,k.useMutation)(aI,{onCompleted:()=>{aK.toast.success("User roles updated successfully")},onError:a=>{console.error("Error assigning user roles:",a),aK.toast.error("Failed to update user roles")},refetchQueries:["GetUserRolePermissions","SearchUsers"]}),[u,{loading:x}]=(0,k.useMutation)(aJ,{onCompleted:()=>{aK.toast.success("User permissions updated successfully")},onError:a=>{console.error("Error assigning user permissions:",a),aK.toast.error("Failed to update user permissions")},refetchQueries:["GetUserRolePermissions","SearchUsers"]}),z=q?.searchRoles?.roles||[],B=r?.searchPermissions?.permissions||[];(0,c.useEffect)(()=>{if(n&&z.length>0){let a=n.getUserRolePermissions?.roleAssignments||[];i(z.map(b=>{let c=a.find(a=>a.role.id===b.id);return{roleId:b.id,effect:c?c.effect:null}}))}},[n,z]),(0,c.useEffect)(()=>{if(n&&B.length>0){let a=n.getUserRolePermissions?.directPermissions||[];l(B.map(b=>{let c=a.find(a=>a.permission.id===b.id);return{permissionId:b.id,effect:c?c.effect:null}}))}},[n,B]);let C=async()=>{let a=g.filter(a=>null!==a.effect).map(a=>({roleId:a.roleId,effect:a.effect})),b={userId:d.id,assignments:a};try{await s({variables:{input:b}}),m({title:"Roles updated",description:`Role assignments for ${d.displayName||d.username} have been updated successfully.`,type:"success"}),p()}catch(a){m({title:"Update failed",description:a.message||"Failed to update role assignments",type:"error"})}},D=async()=>{let a=j.filter(a=>null!==a.effect).map(a=>({permissionId:a.permissionId,effect:a.effect})),b={userId:d.id,assignments:a};try{await u({variables:{input:b}}),m({title:"Permissions updated",description:`Permission assignments for ${d.displayName||d.username} have been updated successfully.`,type:"success"}),p()}catch(a){m({title:"Update failed",description:a.message||"Failed to update permission assignments",type:"error"})}},E=n?.getUserRolePermissions?.summary,F=n?.getUserRolePermissions?.effectivePermissions||[],G=g.filter(a=>null!==a.effect).length,H=j.filter(a=>null!==a.effect).length;return(0,b.jsx)(J.Dialog,{open:a,onOpenChange:e,children:(0,b.jsxs)(J.DialogContent,{className:"max-w-6xl max-h-[90vh] p-0",children:[(0,b.jsxs)(J.DialogHeader,{className:"p-6 pb-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,b.jsxs)(W.Avatar,{className:"h-12 w-12",children:[(0,b.jsx)(W.AvatarImage,{src:d?.avatar,alt:d?.displayName||d?.username}),(0,b.jsx)(W.AvatarFallback,{children:(0,b.jsx)(a$.User,{className:"h-6 w-6"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(J.DialogTitle,{children:d?.displayName||d?.username}),(0,b.jsx)(J.DialogDescription,{children:d?.email})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-4 gap-4 mt-4",children:[(0,b.jsx)(A.Card,{children:(0,b.jsxs)(A.CardHeader,{className:"pb-2",children:[(0,b.jsxs)(A.CardDescription,{className:"flex items-center gap-2",children:[(0,b.jsx)(h.Shield,{className:"h-4 w-4"}),"Roles"]}),(0,b.jsx)(A.CardTitle,{className:"text-2xl text-primary",children:E?.totalRoleAssignments||0})]})}),(0,b.jsx)(A.Card,{children:(0,b.jsxs)(A.CardHeader,{className:"pb-2",children:[(0,b.jsxs)(A.CardDescription,{className:"flex items-center gap-2",children:[(0,b.jsx)(M.Key,{className:"h-4 w-4"}),"Direct Permissions"]}),(0,b.jsx)(A.CardTitle,{className:"text-2xl text-green-600",children:E?.totalDirectPermissions||0})]})}),(0,b.jsx)(A.Card,{children:(0,b.jsxs)(A.CardHeader,{className:"pb-2",children:[(0,b.jsxs)(A.CardDescription,{className:"flex items-center gap-2",children:[(0,b.jsx)(a0.CheckCircle2,{className:"h-4 w-4"}),"Total Permissions"]}),(0,b.jsx)(A.CardTitle,{className:"text-2xl text-purple-600",children:E?.totalEffectivePermissions||0})]})}),(0,b.jsx)(A.Card,{children:(0,b.jsxs)(A.CardHeader,{className:"pb-2",children:[(0,b.jsxs)(A.CardDescription,{className:"flex items-center gap-2",children:[(0,b.jsx)(ad.Calendar,{className:"h-4 w-4"}),"Last Updated"]}),(0,b.jsx)(A.CardTitle,{className:"text-sm",children:E?.lastUpdated?new Date(E.lastUpdated).toLocaleDateString():"Never"})]})})]})]}),(0,b.jsxs)(f.Tabs,{defaultValue:"roles",className:"px-6",children:[(0,b.jsxs)(f.TabsList,{className:"grid w-full grid-cols-3",children:[(0,b.jsxs)(f.TabsTrigger,{value:"roles",children:["Role Assignments",G>0&&(0,b.jsx)(V.Badge,{variant:"secondary",className:"ml-2",children:G})]}),(0,b.jsxs)(f.TabsTrigger,{value:"permissions",children:["Permission Assignments",H>0&&(0,b.jsx)(V.Badge,{variant:"secondary",className:"ml-2",children:H})]}),(0,b.jsxs)(f.TabsTrigger,{value:"effective",children:["Effective Permissions",(0,b.jsx)(V.Badge,{variant:"secondary",className:"ml-2",children:F.length})]})]}),(0,b.jsxs)(f.TabsContent,{value:"roles",className:"space-y-4",children:[(0,b.jsx)(aP.ScrollArea,{className:"h-[400px] border rounded-lg",children:(0,b.jsx)("div",{className:"divide-y",children:z.map(a=>{let c=g.find(b=>b.roleId===a.id);return(0,b.jsx)("div",{className:"p-4 hover:bg-muted/50 transition-colors",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(h.Shield,{className:"h-4 w-4 text-primary"}),(0,b.jsx)("span",{className:"font-medium",children:a.displayName}),a.isSystemRole&&(0,b.jsx)(V.Badge,{variant:"secondary",className:"text-xs",children:"System"})]}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:a.name}),a.description&&(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:a.description})]}),(0,b.jsxs)(aO.RadioGroup,{value:c?.effect||"none",onValueChange:b=>{var c,d;return c=a.id,d="none"===b?null:b,void i(a=>a.map(a=>a.roleId===c?{...a,effect:d}:a))},className:"flex gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(aO.RadioGroupItem,{value:"none",id:`role-${a.id}-none`}),(0,b.jsx)(y.Label,{htmlFor:`role-${a.id}-none`,className:"font-normal cursor-pointer",children:"None"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(aO.RadioGroupItem,{value:"allow",id:`role-${a.id}-allow`}),(0,b.jsx)(y.Label,{htmlFor:`role-${a.id}-allow`,className:"font-normal cursor-pointer text-green-600",children:"Assign"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(aO.RadioGroupItem,{value:"deny",id:`role-${a.id}-deny`}),(0,b.jsx)(y.Label,{htmlFor:`role-${a.id}-deny`,className:"font-normal cursor-pointer text-destructive",children:"Deny"})]})]})]})},a.id)})})}),(0,b.jsx)("div",{className:"flex justify-end pt-4 pb-6",children:(0,b.jsx)(w.Button,{onClick:C,disabled:t,children:t?"Saving...":"Save Role Assignments"})})]}),(0,b.jsxs)(f.TabsContent,{value:"permissions",className:"space-y-4",children:[(0,b.jsx)(aP.ScrollArea,{className:"h-[400px] border rounded-lg",children:(0,b.jsx)("div",{className:"divide-y",children:B.map(a=>{let c=j.find(b=>b.permissionId===a.id);return(0,b.jsx)("div",{className:"p-4 hover:bg-muted/50 transition-colors",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(M.Key,{className:"h-4 w-4 text-green-600"}),(0,b.jsx)("span",{className:"font-medium",children:a.displayName})]}),a.description&&(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:a.description}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsxs)("code",{className:"px-2 py-0.5 rounded bg-muted text-xs",children:[a.resource,":",a.action,a.scope&&`:${a.scope}`]}),(0,b.jsx)(V.Badge,{variant:"outline",className:"text-xs",children:a.category})]})]}),(0,b.jsxs)(aO.RadioGroup,{value:c?.effect||"none",onValueChange:b=>{var c,d;return c=a.id,d="none"===b?null:b,void l(a=>a.map(a=>a.permissionId===c?{...a,effect:d}:a))},className:"flex gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(aO.RadioGroupItem,{value:"none",id:`perm-${a.id}-none`}),(0,b.jsx)(y.Label,{htmlFor:`perm-${a.id}-none`,className:"font-normal cursor-pointer",children:"None"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(aO.RadioGroupItem,{value:"allow",id:`perm-${a.id}-allow`}),(0,b.jsx)(y.Label,{htmlFor:`perm-${a.id}-allow`,className:"font-normal cursor-pointer text-green-600",children:"Allow"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(aO.RadioGroupItem,{value:"deny",id:`perm-${a.id}-deny`}),(0,b.jsx)(y.Label,{htmlFor:`perm-${a.id}-deny`,className:"font-normal cursor-pointer text-destructive",children:"Deny"})]})]})]})},a.id)})})}),(0,b.jsx)("div",{className:"flex justify-end pt-4 pb-6",children:(0,b.jsx)(w.Button,{onClick:D,disabled:x,children:x?"Saving...":"Save Permission Assignments"})})]}),(0,b.jsx)(f.TabsContent,{value:"effective",className:"space-y-4",children:(0,b.jsx)(aP.ScrollArea,{className:"h-[450px] border rounded-lg",children:(0,b.jsxs)("div",{className:"divide-y",children:[F.map(a=>(0,b.jsx)("div",{className:"p-4",children:(0,b.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,b.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,b.jsx)("div",{className:"font-medium",children:a.permission.displayName}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:[a.permission.resource,":",a.permission.action,a.permission.scope&&`:${a.permission.scope}`]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,b.jsx)(V.Badge,{variant:"allow"===a.effect?"default":"destructive",children:a.effect}),(0,b.jsx)(V.Badge,{variant:"outline",className:"text-xs",children:a.source}),a.fromRole&&(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["via role: ",a.fromRole.displayName]})]})]})})},a.permission.id)),0===F.length&&(0,b.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"No effective permissions found for this user."})]})})})]})]})})},a2=({user:a})=>{let{data:c,loading:d}=aN(a.id);if(d)return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"grid grid-cols-3 gap-4",children:[void 0,void 0,void 0].map((a,c)=>(0,b.jsxs)("div",{className:"text-center space-y-2",children:[(0,b.jsx)(am.Skeleton,{className:"h-8 w-16 mx-auto"}),(0,b.jsx)(am.Skeleton,{className:"h-4 w-24 mx-auto"})]},c))}),(0,b.jsx)(a_.Separator,{}),(0,b.jsx)(am.Skeleton,{className:"h-32 w-full"})]});let e=c?.getUserRolePermissions?.summary,f=c?.getUserRolePermissions?.roleAssignments||[],g=c?.getUserRolePermissions?.directPermissions||[];return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)(A.Card,{className:"text-center p-4 border-2 hover:border-primary/50 transition-colors",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-primary",children:e?.totalRoleAssignments||0}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Roles"})]}),(0,b.jsxs)(A.Card,{className:"text-center p-4 border-2 hover:border-green-500/50 transition-colors",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:e?.totalDirectPermissions||0}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Direct Permissions"})]}),(0,b.jsxs)(A.Card,{className:"text-center p-4 border-2 hover:border-purple-500/50 transition-colors",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:e?.totalEffectivePermissions||0}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Permissions"})]})]}),(0,b.jsx)(a_.Separator,{}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[(0,b.jsx)(a$.User,{className:"h-4 w-4"}),"Current Roles"]}),0===f.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No roles assigned"}):(0,b.jsxs)("div",{className:"space-y-2",children:[f.slice(0,3).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg bg-accent/50 hover:bg-accent transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(W.Avatar,{className:"h-6 w-6",children:(0,b.jsx)(W.AvatarFallback,{className:"bg-primary/10",children:(0,b.jsx)(a$.User,{className:"h-3 w-3 text-primary"})})}),(0,b.jsx)("p",{className:"text-sm font-medium",children:a.role.displayName})]}),(0,b.jsx)(V.Badge,{variant:"allow"===a.effect?"default":"destructive",children:a.effect})]},a.id)),f.length>3&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground text-center pt-2",children:["+",f.length-3," more roles"]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[(0,b.jsx)(av.ShieldCheck,{className:"h-4 w-4"}),"Direct Permissions"]}),0===g.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No direct permissions assigned"}):(0,b.jsxs)("div",{className:"space-y-2",children:[g.slice(0,3).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg bg-accent/50 hover:bg-accent transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(W.Avatar,{className:"h-6 w-6",children:(0,b.jsx)(W.AvatarFallback,{className:"bg-green-100",children:(0,b.jsx)(av.ShieldCheck,{className:"h-3 w-3 text-green-600"})})}),(0,b.jsx)("p",{className:"text-sm font-medium",children:a.permission.displayName})]}),(0,b.jsx)(V.Badge,{variant:"allow"===a.effect?"default":"destructive",children:a.effect})]},a.id)),g.length>3&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground text-center pt-2",children:["+",g.length-3," more permissions"]})]})]})]})},a3=({className:a=""})=>{let[d,e]=(0,c.useState)(""),[f,g]=(0,c.useState)(null),{data:h,loading:i}=u({search:d,page:0,size:50}),j=h?.searchUsers?.users||[];return i?(0,b.jsxs)("div",{className:`grid grid-cols-1 lg:grid-cols-2 gap-6 ${a}`,children:[(0,b.jsxs)(A.Card,{children:[(0,b.jsxs)(A.CardHeader,{children:[(0,b.jsx)(am.Skeleton,{className:"h-6 w-32"}),(0,b.jsx)(am.Skeleton,{className:"h-4 w-64"})]}),(0,b.jsx)(A.CardContent,{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(am.Skeleton,{className:"h-10 w-10 rounded-full"}),(0,b.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,b.jsx)(am.Skeleton,{className:"h-4 w-[200px]"}),(0,b.jsx)(am.Skeleton,{className:"h-3 w-[150px]"})]})]},c))})]}),(0,b.jsxs)(A.Card,{children:[(0,b.jsxs)(A.CardHeader,{children:[(0,b.jsx)(am.Skeleton,{className:"h-6 w-32"}),(0,b.jsx)(am.Skeleton,{className:"h-4 w-64"})]}),(0,b.jsx)(A.CardContent,{children:(0,b.jsx)(am.Skeleton,{className:"h-48 w-full"})})]})]}):(0,b.jsxs)("div",{className:`${a}`,children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,b.jsxs)(A.Card,{children:[(0,b.jsxs)(A.CardHeader,{children:[(0,b.jsx)(A.CardTitle,{children:"Select User"}),(0,b.jsx)(A.CardDescription,{children:"Choose a user to manage their roles and permissions"})]}),(0,b.jsxs)(A.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(aQ.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(x.Input,{type:"text",placeholder:"Search users...",value:d,onChange:a=>e(a.target.value),className:"pl-10"})]}),(0,b.jsx)(aP.ScrollArea,{className:"h-[400px]",children:0===j.length?(0,b.jsx)("div",{className:"py-8 text-center text-muted-foreground",children:d?"No users found matching your search.":"No users available."}):(0,b.jsx)("div",{className:"space-y-2",children:j.map(a=>(0,b.jsx)("div",{onClick:()=>{g(a)},className:`p-3 rounded-lg hover:bg-accent cursor-pointer transition-colors ${f?.id===a.id?"bg-accent border-l-4 border-primary":""}`,children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(W.Avatar,{className:"h-10 w-10",children:a.avatar?(0,b.jsx)(W.AvatarImage,{src:a.avatar,alt:a.displayName||a.username}):(0,b.jsx)(W.AvatarFallback,{children:(0,b.jsx)(a$.User,{className:"h-5 w-5"})})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium truncate",children:a.displayName||a.username}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:a.email})]}),(0,b.jsx)(V.Badge,{variant:"ADMIN"===a.role?"default":"secondary",className:"shrink-0",children:a.role})]}),!1===a.isActive&&(0,b.jsx)(V.Badge,{variant:"destructive",className:"text-xs mt-1",children:"Inactive"})]})]})},a.id))})})]})]}),(0,b.jsxs)(A.Card,{children:[(0,b.jsx)(A.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(A.CardTitle,{children:f?"Role & Permission Details":"User Details"}),(0,b.jsx)(A.CardDescription,{children:f?`Manage roles and permissions for ${f.displayName||f.username}`:"Select a user to view their role and permission details"})]}),f&&(0,b.jsxs)(w.Button,{onClick:()=>g(f),variant:"secondary",size:"sm",children:[(0,b.jsx)(av.ShieldCheck,{className:"mr-2 h-4 w-4"}),"Manage Access"]})]})}),(0,b.jsx)(A.CardContent,{children:f?(0,b.jsx)(a2,{user:f}):(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(a$.User,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,b.jsx)("h3",{className:"mt-2 text-sm font-medium",children:"No user selected"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Select a user from the list to view their role and permission details."})]})})]})]}),f&&(0,b.jsx)(a1,{isOpen:!!f,user:f,onClose:()=>g(null)})]})},a4=({className:a=""})=>{let c=[{value:"roles",label:"Roles",icon:g.Users,component:aW,description:"Manage system roles and their hierarchies"},{value:"permissions",label:"Permissions",icon:M.Key,component:aZ,description:"Define and manage system permissions"},{value:"assignments",label:"User Assignments",icon:av.ShieldCheck,component:a3,description:"Assign roles and permissions to users"}];return(0,b.jsx)("div",{className:a,children:(0,b.jsxs)(A.Card,{children:[(0,b.jsxs)(A.CardHeader,{children:[(0,b.jsx)(A.CardTitle,{children:"Role & Permission Management"}),(0,b.jsx)(A.CardDescription,{children:"Manage system access control, roles, and permissions"})]}),(0,b.jsx)(A.CardContent,{children:(0,b.jsxs)(f.Tabs,{defaultValue:"roles",className:"w-full",children:[(0,b.jsx)(f.TabsList,{className:"grid w-full grid-cols-3",children:c.map(a=>(0,b.jsxs)(f.TabsTrigger,{value:a.value,className:"flex items-center gap-2",children:[(0,b.jsx)(a.icon,{className:"h-4 w-4"}),a.label]},a.value))}),c.map(a=>(0,b.jsxs)(f.TabsContent,{value:a.value,className:"mt-6",children:[(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.description})}),(0,b.jsx)(a.component,{})]},a.value))]})})]})})};function a5(){let{user:a,loading:f,isAuthenticated:g}=(0,e.useAuth)(),h=(0,d.useRouter)(),[j,k]=(0,c.useState)("users");return((0,c.useEffect)(()=>{f||g?!f&&g&&a?.roleType!=="ADMIN"&&console.log("AdminUsersPage: User is not admin",{roleType:a?.roleType}):(console.log("AdminUsersPage: Not authenticated, redirecting to login"),h.push("/login"))},[f,g,a,h]),f)?(0,b.jsx)(ar,{message:"Loading admin panel..."}):g&&a?.roleType!=="ADMIN"?(0,b.jsx)(au,{userRole:a?.roleType,requiredRole:"ADMIN"}):g?(0,b.jsxs)("div",{className:"container mx-auto py-8 space-y-6",children:[(0,b.jsx)(i,{activeTab:j,onTabChange:k}),"users"===j&&(0,b.jsx)(aq,{}),"rbac"===j&&(0,b.jsx)(a4,{})]}):null}a.s(["default",()=>a5],983657)}];

//# sourceMappingURL=frontend_src_app_admin_users_page_tsx_686b14cb._.js.map