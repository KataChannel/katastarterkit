{"version":3,"sources":["turbopack:///[project]/frontend/src/hooks/useNestedBlockRenderer.ts","turbopack:///[project]/frontend/src/lib/nestedBlockUtils.ts","turbopack:///[project]/frontend/src/components/page-builder/blocks/FlexBlock.tsx","turbopack:///[project]/frontend/src/components/page-builder/blocks/LayoutBlockWrapper.tsx"],"sourcesContent":["/**\n * useNestedBlockRenderer Hook\n * \n * Custom hook ƒë·ªÉ render nested blocks trong container/layout\n * Qu·∫£n l√Ω:\n * - Children rendering\n * - Nested update/delete handlers\n * - Reordering\n * - Drop zone management\n */\n\nimport { useCallback, useMemo } from 'react';\nimport { PageBlock } from '@/types/page-builder';\nimport { getSortedChildren, canHaveChildren } from '@/lib/nestedBlockUtils';\n\ninterface UseNestedBlockRendererProps {\n  parentBlock: PageBlock | null;\n  onUpdateChild?: (childId: string, content: any, style?: any) => void;\n  onDeleteChild?: (childId: string) => void;\n  onReorderChildren?: (parentId: string, orderedIds: string[]) => void;\n  onAddChild?: (parentId: string, blockType: string) => void;\n}\n\ninterface NestedBlockRenderResult {\n  sortedChildren: PageBlock[];\n  childrenCount: number;\n  canAddChildren: boolean;\n  childrenIds: string[];\n  handleUpdateChild: (childId: string, content: any, style?: any) => void;\n  handleDeleteChild: (childId: string) => void;\n  handleReorderChildren: (orderedIds: string[]) => void;\n}\n\n/**\n * Custom hook ƒë·ªÉ qu·∫£n l√Ω nested block rendering\n */\nexport function useNestedBlockRenderer({\n  parentBlock,\n  onUpdateChild,\n  onDeleteChild,\n  onReorderChildren,\n  onAddChild,\n}: UseNestedBlockRendererProps): NestedBlockRenderResult {\n  // Memoize sorted children to prevent unnecessary re-renders\n  const sortedChildren = useMemo(\n    () => getSortedChildren(parentBlock),\n    [parentBlock?.id, parentBlock?.children?.length, parentBlock?.children?.map(c => c.order).join(',')]\n  );\n\n  // Memoize children count\n  const childrenCount = useMemo(() => sortedChildren.length, [sortedChildren.length]);\n\n  // Memoize can add children check\n  const canAddChildren = useMemo(() => canHaveChildren(parentBlock), [parentBlock?.type]);\n\n  // Memoize children IDs for drag-and-drop\n  const childrenIds = useMemo(() => sortedChildren.map(c => c.id), [sortedChildren]);\n\n  // Handle child update with parent ID validation\n  const handleUpdateChild = useCallback(\n    (childId: string, content: any, style?: any) => {\n      if (!parentBlock?.id) return;\n      \n      // Verify child exists in parent\n      const childExists = sortedChildren.some(c => c.id === childId);\n      if (!childExists) {\n        console.warn(`Child block ${childId} not found in parent ${parentBlock.id}`);\n        return;\n      }\n\n      onUpdateChild?.(childId, content, style);\n    },\n    [parentBlock?.id, sortedChildren, onUpdateChild]\n  );\n\n  // Handle child deletion with confirmation feedback\n  const handleDeleteChild = useCallback(\n    (childId: string) => {\n      if (!parentBlock?.id) return;\n\n      // Verify child exists\n      const childExists = sortedChildren.some(c => c.id === childId);\n      if (!childExists) {\n        console.warn(`Child block ${childId} not found in parent ${parentBlock.id}`);\n        return;\n      }\n\n      onDeleteChild?.(childId);\n    },\n    [parentBlock?.id, sortedChildren, onDeleteChild]\n  );\n\n  // Handle reordering with validation\n  const handleReorderChildren = useCallback(\n    (orderedIds: string[]) => {\n      if (!parentBlock?.id) return;\n\n      // Validate all IDs exist\n      const validIds = new Set(sortedChildren.map(c => c.id));\n      const invalidIds = orderedIds.filter(id => !validIds.has(id));\n\n      if (invalidIds.length > 0) {\n        console.warn(`Invalid child IDs in reorder: ${invalidIds.join(', ')}`);\n        return;\n      }\n\n      if (orderedIds.length !== sortedChildren.length) {\n        console.warn(\n          `Reorder IDs count (${orderedIds.length}) doesn't match children count (${sortedChildren.length})`\n        );\n        return;\n      }\n\n      onReorderChildren?.(parentBlock.id, orderedIds);\n    },\n    [parentBlock?.id, sortedChildren, onReorderChildren]\n  );\n\n  return {\n    sortedChildren,\n    childrenCount,\n    canAddChildren,\n    childrenIds,\n    handleUpdateChild,\n    handleDeleteChild,\n    handleReorderChildren,\n  };\n}\n\n/**\n * Hook ƒë·ªÉ detect nested drop zone\n * Tr·∫£ v·ªÅ props c·∫ßn thi·∫øt cho droppable container\n */\ninterface UseNestedDropZoneProps {\n  parentId: string;\n  isContainerType: boolean;\n  isDraggedBlockId?: string;\n}\n\ninterface NestedDropZoneResult {\n  canDrop: boolean;\n  droppableId: string;\n  dropData: {\n    type: 'nested-container';\n    parentId: string;\n  };\n}\n\nexport function useNestedDropZone({\n  parentId,\n  isContainerType,\n  isDraggedBlockId,\n}: UseNestedDropZoneProps): NestedDropZoneResult {\n  const canDrop = useMemo(() => {\n    // Cannot drop into itself\n    if (isDraggedBlockId === parentId) return false;\n    // Can only drop into container types\n    return isContainerType;\n  }, [parentId, isContainerType, isDraggedBlockId]);\n\n  const droppableId = useMemo(() => `nested-container-${parentId}`, [parentId]);\n\n  const dropData = useMemo(\n    () => ({\n      type: 'nested-container' as const,\n      parentId,\n    }),\n    [parentId]\n  );\n\n  return {\n    canDrop,\n    droppableId,\n    dropData,\n  };\n}\n\n/**\n * Hook ƒë·ªÉ manage nested block depth limit\n */\ninterface UseNestedDepthCheckProps {\n  currentBlock: PageBlock | null;\n  maxDepth?: number;\n  getDraggedBlock?: () => PageBlock | null;\n}\n\ninterface NestedDepthCheckResult {\n  canDropDeeper: boolean;\n  currentDepth: number;\n  remainingDepth: number;\n  depthError: string | null;\n}\n\nexport function useNestedDepthCheck({\n  currentBlock,\n  maxDepth = 10,\n  getDraggedBlock,\n}: UseNestedDepthCheckProps): NestedDepthCheckResult {\n  const currentDepth = useMemo(() => currentBlock?.depth || 0, [currentBlock?.depth]);\n\n  const remainingDepth = useMemo(() => Math.max(0, maxDepth - currentDepth), [currentDepth, maxDepth]);\n\n  const canDropDeeper = useMemo(() => remainingDepth > 0, [remainingDepth]);\n\n  const depthError = useMemo(() => {\n    if (canDropDeeper) return null;\n    return `Maximum nesting depth (${maxDepth}) reached`;\n  }, [canDropDeeper, maxDepth]);\n\n  return {\n    canDropDeeper,\n    currentDepth,\n    remainingDepth,\n    depthError,\n  };\n}\n","/**\n * Nested Block Utilities\n * \n * Helper functions for managing nested blocks in container/layout blocks\n * Supports:\n * - Adding nested blocks\n * - Removing nested blocks\n * - Reordering nested blocks\n * - Finding nested blocks\n * - Depth tracking\n */\n\nimport { PageBlock, BlockType } from '@/types/page-builder';\n\n/**\n * Check if a block type can have nested children\n */\nexport const isContainerBlockType = (type: BlockType): boolean => {\n  const containerTypes = [\n    BlockType.CONTAINER,\n    BlockType.SECTION,\n    BlockType.GRID,\n    BlockType.FLEX_ROW,\n    BlockType.FLEX_COLUMN,\n  ];\n  return containerTypes.includes(type);\n};\n\n/**\n * Check if a block can have nested children\n */\nexport const canHaveChildren = (block: PageBlock | null | undefined): boolean => {\n  if (!block) return false;\n  return isContainerBlockType(block.type);\n};\n\n/**\n * Get nested children, sorted by order\n */\nexport const getSortedChildren = (block: PageBlock | null | undefined): PageBlock[] => {\n  if (!block?.children) return [];\n  return [...block.children].sort((a, b) => a.order - b.order);\n};\n\n/**\n * Find a nested block by ID within a block tree\n */\nexport const findNestedBlockById = (\n  block: PageBlock,\n  targetId: string,\n  depth = 0\n): { block: PageBlock; parent: PageBlock | null; depth: number } | null => {\n  if (block.id === targetId) {\n    return { block, parent: null, depth };\n  }\n\n  if (block.children) {\n    for (const child of block.children) {\n      const result = findNestedBlockById(child, targetId, depth + 1);\n      if (result) {\n        // Update parent reference\n        if (result.parent === null) {\n          result.parent = block;\n        }\n        return result;\n      }\n    }\n  }\n\n  return null;\n};\n\n/**\n * Add a new child block to a parent\n */\nexport const addChildBlock = (\n  parent: PageBlock,\n  newChild: PageBlock\n): PageBlock => {\n  if (!canHaveChildren(parent)) {\n    console.warn(`Block type ${parent.type} cannot have children`);\n    return parent;\n  }\n\n  const children = parent.children || [];\n  \n  // Set order to last position\n  newChild.order = children.length > 0 \n    ? Math.max(...children.map(c => c.order)) + 1 \n    : 0;\n  \n  newChild.parentId = parent.id;\n  newChild.depth = (parent.depth || 0) + 1;\n\n  return {\n    ...parent,\n    children: [...children, newChild],\n  };\n};\n\n/**\n * Remove a child block from parent\n */\nexport const removeChildBlock = (\n  parent: PageBlock,\n  childId: string\n): PageBlock => {\n  if (!parent.children) return parent;\n\n  const updatedChildren = parent.children\n    .filter(c => c.id !== childId)\n    // Re-order remaining children\n    .map((c, idx) => ({ ...c, order: idx }));\n\n  return {\n    ...parent,\n    children: updatedChildren,\n  };\n};\n\n/**\n * Update a child block\n */\nexport const updateChildBlock = (\n  parent: PageBlock,\n  childId: string,\n  updatedChild: Partial<PageBlock>\n): PageBlock => {\n  if (!parent.children) return parent;\n\n  const updatedChildren = parent.children.map(c =>\n    c.id === childId ? { ...c, ...updatedChild } : c\n  );\n\n  return {\n    ...parent,\n    children: updatedChildren,\n  };\n};\n\n/**\n * Reorder child blocks\n */\nexport const reorderChildren = (\n  parent: PageBlock,\n  orderedIds: string[]\n): PageBlock => {\n  if (!parent.children) return parent;\n\n  const childMap = new Map(parent.children.map(c => [c.id, c]));\n  const reorderedChildren = orderedIds\n    .map(id => childMap.get(id))\n    .filter((c): c is PageBlock => c !== undefined)\n    .map((c, idx) => ({ ...c, order: idx }));\n\n  return {\n    ...parent,\n    children: reorderedChildren,\n  };\n};\n\n/**\n * Get maximum depth of a block tree\n */\nexport const getMaxDepth = (block: PageBlock, currentDepth = 0): number => {\n  if (!block.children || block.children.length === 0) {\n    return currentDepth;\n  }\n\n  const childDepths = block.children.map(child => getMaxDepth(child, currentDepth + 1));\n  return Math.max(currentDepth, ...childDepths);\n};\n\n/**\n * Flatten nested blocks into a single array (useful for serialization)\n */\nexport const flattenBlocks = (block: PageBlock, depth = 0): (PageBlock & { depth: number })[] => {\n  const flattened: (PageBlock & { depth: number })[] = [{ ...block, depth }];\n\n  if (block.children) {\n    for (const child of block.children) {\n      flattened.push(...flattenBlocks(child, depth + 1));\n    }\n  }\n\n  return flattened;\n};\n\n/**\n * Check if a block has any visible children\n */\nexport const hasVisibleChildren = (block: PageBlock | null | undefined): boolean => {\n  if (!block?.children) return false;\n  return block.children.some(c => c.isVisible);\n};\n\n/**\n * Get all container blocks from a list (for add child dialog filtering)\n */\nexport const filterContainerBlocks = (blocks: PageBlock[]): PageBlock[] => {\n  return blocks.filter(b => isContainerBlockType(b.type));\n};\n\n/**\n * Validate nested block structure\n * Returns validation errors if any\n */\nexport const validateNestedStructure = (\n  block: PageBlock,\n  maxDepth = 10,\n  currentDepth = 0,\n  errors: string[] = []\n): string[] => {\n  // Check max depth\n  if (currentDepth > maxDepth) {\n    errors.push(`Block ${block.id} exceeds maximum nesting depth of ${maxDepth}`);\n    return errors;\n  }\n\n  // Check if non-container has children\n  if (block.children && block.children.length > 0 && !canHaveChildren(block)) {\n    errors.push(`Non-container block ${block.id} (type: ${block.type}) has children`);\n  }\n\n  // Validate children\n  if (block.children) {\n    // Check duplicate IDs\n    const ids = new Set<string>();\n    for (const child of block.children) {\n      if (ids.has(child.id)) {\n        errors.push(`Duplicate child ID: ${child.id}`);\n      }\n      ids.add(child.id);\n\n      // Validate child structure\n      validateNestedStructure(child, maxDepth, currentDepth + 1, errors);\n    }\n  }\n\n  return errors;\n};\n\n/**\n * Create a deep clone of a block with all children\n */\nexport const cloneBlockWithChildren = (\n  block: PageBlock,\n  newParentId?: string\n): PageBlock => {\n  const cloned: PageBlock = {\n    ...block,\n    id: `${block.id}-clone-${Date.now()}`,\n    parentId: newParentId || block.parentId,\n  };\n\n  if (block.children) {\n    cloned.children = block.children.map(child =>\n      cloneBlockWithChildren(child, cloned.id)\n    );\n  }\n\n  return cloned;\n};\n","import React from 'react';\nimport { PageBlock, FlexBlockContent } from '@/types/page-builder';\nimport { Label } from '@/components/ui/label';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Switch } from '@/components/ui/switch';\nimport { LayoutBlockWrapper } from './LayoutBlockWrapper';\n\ninterface FlexBlockProps {\n  block: PageBlock;\n  isEditable?: boolean;\n  onUpdate: (content: any, style?: any) => void;\n  onDelete: () => void;\n  onAddChild?: (parentId: string) => void;\n  onUpdateChild?: (childId: string, content: any, style?: any) => void;\n  onDeleteChild?: (childId: string) => void;\n  children?: React.ReactNode;\n}\n\nexport const FlexBlock: React.FC<FlexBlockProps> = ({\n  block,\n  isEditable = true,\n  onUpdate,\n  onDelete,\n  onAddChild,\n  onUpdateChild,\n  onDeleteChild,\n  children,\n}) => {\n  const content = block.content as FlexBlockContent;\n  const [editContent, setEditContent] = React.useState<FlexBlockContent>(content || {\n    direction: 'row',\n    justifyContent: 'start',\n    alignItems: 'start',\n    wrap: false,\n    gap: 16,\n  });\n\n  const justifyContentMap = {\n    start: 'flex-start',\n    center: 'center',\n    end: 'flex-end',\n    between: 'space-between',\n    around: 'space-around',\n    evenly: 'space-evenly',\n  };\n\n  const alignItemsMap = {\n    start: 'flex-start',\n    center: 'center',\n    end: 'flex-end',\n    stretch: 'stretch',\n  };\n\n  const flexStyles: React.CSSProperties = {\n    display: 'flex',\n    flexDirection: content.direction || 'row',\n    justifyContent: justifyContentMap[content.justifyContent || 'start'],\n    alignItems: alignItemsMap[content.alignItems || 'start'],\n    flexWrap: content.wrap ? 'wrap' : 'nowrap',\n    gap: `${content.gap || 16}px`,\n    width: '100%',\n    position: 'relative',\n    minHeight: children ? 'auto' : '150px',\n    borderRadius: '8px',\n    padding: isEditable ? '16px' : '0',\n  };\n\n  const settingsPanel = (\n    <>\n      <div>\n        <Label className=\"text-xs\">Direction</Label>\n        <Select\n          value={editContent.direction || 'row'}\n          onValueChange={(value) => setEditContent({ ...editContent, direction: value as any })}\n        >\n          <SelectTrigger>\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"row\">Row (Horizontal)</SelectItem>\n            <SelectItem value=\"column\">Column (Vertical)</SelectItem>\n            <SelectItem value=\"row-reverse\">Row Reverse</SelectItem>\n            <SelectItem value=\"column-reverse\">Column Reverse</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div>\n        <Label className=\"text-xs\">Justify Content</Label>\n        <Select\n          value={editContent.justifyContent || 'start'}\n          onValueChange={(value) => setEditContent({ ...editContent, justifyContent: value as any })}\n        >\n          <SelectTrigger>\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"start\">Start</SelectItem>\n            <SelectItem value=\"center\">Center</SelectItem>\n            <SelectItem value=\"end\">End</SelectItem>\n            <SelectItem value=\"between\">Space Between</SelectItem>\n            <SelectItem value=\"around\">Space Around</SelectItem>\n            <SelectItem value=\"evenly\">Space Evenly</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div>\n        <Label className=\"text-xs\">Align Items</Label>\n        <Select\n          value={editContent.alignItems || 'start'}\n          onValueChange={(value) => setEditContent({ ...editContent, alignItems: value as any })}\n        >\n          <SelectTrigger>\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"start\">Start</SelectItem>\n            <SelectItem value=\"center\">Center</SelectItem>\n            <SelectItem value=\"end\">End</SelectItem>\n            <SelectItem value=\"stretch\">Stretch</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div>\n        <Label className=\"text-xs\">Gap (px)</Label>\n        <Input\n          type=\"number\"\n          value={editContent.gap || 16}\n          onChange={(e) => setEditContent({ ...editContent, gap: parseInt(e.target.value) })}\n          className=\"text-xs\"\n        />\n      </div>\n\n      <div className=\"flex items-center justify-between\">\n        <Label htmlFor=\"wrap\" className=\"text-xs\">Wrap</Label>\n        <Switch\n          id=\"wrap\"\n          checked={editContent.wrap || false}\n          onCheckedChange={(checked) => setEditContent({ ...editContent, wrap: checked })}\n        />\n      </div>\n    </>\n  );\n\n  return (\n    <LayoutBlockWrapper\n      block={block}\n      isEditable={isEditable}\n      children={children}\n      onDelete={onDelete}\n      onAddChild={onAddChild}\n      onUpdate={(content) => {\n        setEditContent(content);\n        onUpdate(content);\n      }}\n      onUpdateChild={onUpdateChild}\n      onDeleteChild={onDeleteChild}\n      containerStyles={flexStyles}\n      settingsPanel={settingsPanel}\n      title=\"Flex Block Settings\"\n    />\n  );\n};\n","/**\n * LayoutBlockWrapper Component\n * \n * Reusable wrapper cho Container, Flex, Grid, Section blocks\n * Cung c·∫•p:\n * - Droppable zone cho nested children\n * - Settings panel management\n * - Visual feedback khi hover/drag over\n * - Nested block counter\n */\n\nimport React, { useState } from 'react';\nimport { useDroppable } from '@dnd-kit/core';\nimport { PageBlock, BlockType } from '@/types/page-builder';\nimport { Settings, Trash2, Plus, Package } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useNestedBlockRenderer, useNestedDropZone } from '@/hooks/useNestedBlockRenderer';\nimport { isContainerBlockType } from '@/lib/nestedBlockUtils';\n\ninterface LayoutBlockWrapperProps {\n  block: PageBlock;\n  isEditable?: boolean;\n  children?: React.ReactNode;\n  onDelete: () => void;\n  onAddChild?: (parentId: string) => void;\n  onUpdate: (content: any, style?: any) => void;\n  onUpdateChild?: (childId: string, content: any, style?: any) => void;\n  onDeleteChild?: (childId: string) => void;\n  containerStyles: React.CSSProperties;\n  settingsPanel: React.ReactNode; // Render settings UI here\n  title?: string;\n}\n\nexport const LayoutBlockWrapper: React.FC<LayoutBlockWrapperProps> = ({\n  block,\n  isEditable = true,\n  children,\n  onDelete,\n  onAddChild,\n  onUpdate,\n  onUpdateChild,\n  onDeleteChild,\n  containerStyles,\n  settingsPanel,\n  title = 'Layout Settings',\n}) => {\n  const [isEditing, setIsEditing] = useState(false);\n  const [isHovering, setIsHovering] = useState(false);\n\n  // Debug logging\n  React.useEffect(() => {\n    if (process.env.NODE_ENV === 'development') {\n      console.log(`[LayoutBlockWrapper ${block.id}] Props Debug:`, {\n        hasOnAddChild: !!onAddChild,\n        onAddChildType: typeof onAddChild,\n        hasChildren: !!children,\n        childrenType: typeof children,\n        blockType: block.type,\n        blockId: block.id,\n      });\n    }\n  }, [onAddChild, children, block.id, block.type]);\n\n  // Setup droppable zone\n  const { droppableId, dropData } = useNestedDropZone({\n    parentId: block.id,\n    isContainerType: isContainerBlockType(block.type),\n  });\n\n  const { setNodeRef, isOver } = useDroppable({\n    id: droppableId,\n    data: dropData,\n  });\n\n  // Get nested info\n  const { childrenCount, canAddChildren } = useNestedBlockRenderer({\n    parentBlock: block,\n    onUpdateChild,\n    onDeleteChild,\n  });\n\n  if (!isEditable) {\n    return (\n      <div ref={setNodeRef} style={containerStyles}>\n        {children}\n      </div>\n    );\n  }\n\n  return (\n    <div\n      ref={setNodeRef}\n      style={containerStyles}\n      className={`group transition-all duration-200 relative ${\n        isOver\n          ? 'ring-2 ring-blue-500 bg-blue-50 scale-105'\n          : 'hover:ring-2 hover:ring-gray-300'\n      }`}\n      onMouseEnter={() => setIsHovering(true)}\n      onMouseLeave={() => setIsHovering(false)}\n    >\n      {/* Control Bar */}\n      {isEditable && (isHovering || isEditing) && (\n        <div className=\"absolute top-2 right-2 flex gap-2 z-10 animate-in fade-in duration-200\">\n          {/* Debug: Show button status in development */}\n          {process.env.NODE_ENV === 'development' && (\n            <div className=\"text-xs text-gray-500 absolute -bottom-6 right-0 whitespace-nowrap bg-white px-1 rounded\">\n              canAdd={String(canAddChildren)} | onAddChild={String(!!onAddChild)}\n            </div>\n          )}\n          \n          {canAddChildren && onAddChild && (\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={() => {\n                console.log(`[LayoutBlockWrapper ${block.id}] Add Child clicked:`, { \n                  hasOnAddChild: !!onAddChild, \n                  canAddChildren,\n                  childrenCount,\n                  blockId: block.id,\n                  blockType: block.type,\n                });\n                if (onAddChild) {\n                  onAddChild(block.id);\n                } else {\n                  console.error('[LayoutBlockWrapper] onAddChild is undefined!');\n                }\n              }}\n              className=\"bg-white shadow-sm hover:shadow-md\"\n              title={`Add child block (${childrenCount} nested)`}\n            >\n              <Plus className=\"w-4 h-4 mr-1\" />\n              <span className=\"text-xs\">Add Child</span>\n            </Button>\n          )}\n          \n          {/* Show warning if onAddChild is missing in development */}\n          {process.env.NODE_ENV === 'development' && !onAddChild && (\n            <div className=\"text-xs bg-red-100 text-red-700 px-2 py-1 rounded whitespace-nowrap\">\n              ‚ö†Ô∏è No onAddChild\n            </div>\n          )}\n          \n          <Button\n            size=\"sm\"\n            variant=\"outline\"\n            onClick={() => setIsEditing(!isEditing)}\n            className=\"bg-white shadow-sm hover:shadow-md\"\n            title=\"Edit settings\"\n          >\n            <Settings className=\"w-4 h-4\" />\n          </Button>\n          <Button\n            size=\"sm\"\n            variant=\"destructive\"\n            onClick={onDelete}\n            className=\"shadow-sm hover:shadow-md\"\n            title=\"Delete block\"\n          >\n            <Trash2 className=\"w-4 h-4\" />\n          </Button>\n        </div>\n      )}\n\n      {/* Drop Zone Indicator */}\n      {isOver && (\n        <div className=\"absolute inset-0 pointer-events-none flex items-center justify-center z-50\">\n          <div className=\"bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold shadow-lg\">\n            üìç Drop here to add nested block\n          </div>\n        </div>\n      )}\n\n      {/* Settings Panel */}\n      {isEditing && (\n        <div className=\"absolute top-12 right-2 bg-white p-4 rounded-lg shadow-xl border border-gray-200 z-20 w-80 max-h-96 overflow-y-auto\">\n          <h3 className=\"font-semibold mb-3 text-sm\">{title}</h3>\n\n          <div className=\"space-y-3\">\n            {settingsPanel}\n\n            {/* Nested Info */}\n            <div className=\"pt-3 border-t border-gray-200\">\n              <p className=\"text-xs text-gray-600 flex items-center gap-1\">\n                <Package className=\"w-3 h-3\" />\n                {childrenCount} nested block{childrenCount !== 1 ? 's' : ''}\n              </p>\n            </div>\n\n            <div className=\"flex gap-2 pt-2\">\n              <Button onClick={() => setIsEditing(false)} variant=\"outline\" className=\"flex-1 text-xs py-1\" size=\"sm\">\n                Done\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Children Blocks */}\n      {children ? (\n        <div className=\"nested-children-wrapper w-full\">\n          {children}\n        </div>\n      ) : (\n        <div\n          className={`text-center py-8 transition-colors duration-200 ${\n            isOver ? 'text-blue-600' : 'text-gray-400'\n          }`}\n        >\n          <Package className=\"w-8 h-8 mx-auto mb-2 opacity-50\" />\n          <p className=\"text-sm font-medium\">No nested blocks yet</p>\n          <p className=\"text-xs mt-1 opacity-75\">Drop blocks or click \"Add Child\" to add content</p>\n          {process.env.NODE_ENV === 'development' && (\n            <div className=\"text-xs mt-2 text-red-500\">\n              Debug: children prop is {children === undefined ? 'undefined' : children === null ? 'null' : 'defined but falsy'}\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};\n"],"names":[],"mappings":"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"}