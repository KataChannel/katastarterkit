{"version":3,"sources":["turbopack:///[project]/frontend/src/graphql/queries/pages.ts","turbopack:///[project]/frontend/src/components/page-builder/blocks/BlockRenderer.tsx","turbopack:///[project]/frontend/src/hooks/usePageBuilder.ts","turbopack:///[project]/frontend/src/components/page-builder/contexts/PageStateContext.tsx","turbopack:///[project]/frontend/src/components/page-builder/BlockErrorBoundary.tsx","turbopack:///[project]/frontend/src/components/page-builder/blocks/BlockLoader.tsx"],"sourcesContent":["import { gql } from '@apollo/client';\n\n// Fragment for page fields\nconst PAGE_FRAGMENT = gql`\n  fragment PageFields on Page {\n    id\n    title\n    slug\n    content\n    status\n    isHomepage\n    isDynamic\n    dynamicConfig\n    seoTitle\n    seoDescription\n    seoKeywords\n    createdAt\n    updatedAt\n  }\n`;\n\n// Fragment for page block fields (with nested children support)\nconst PAGE_BLOCK_FRAGMENT = gql`\n  fragment PageBlockFields on PageBlock {\n    id\n    type\n    content\n    style\n    config\n    order\n    parentId\n    depth\n    isVisible\n    children {\n      id\n      type\n      content\n      style\n      config\n      order\n      parentId\n      depth\n      isVisible\n      children {\n        id\n        type\n        content\n        style\n        config\n        order\n        parentId\n        depth\n        isVisible\n        children {\n          id\n          type\n          content\n          style\n          config\n          order\n          parentId\n          depth\n          isVisible\n        }\n      }\n    }\n  }\n`;\n\n// Get paginated list of pages\nexport const GET_PAGES = gql`\n  ${PAGE_FRAGMENT}\n  query GetPages($pagination: PaginationInput, $filters: PageFiltersInput) {\n    getPages(pagination: $pagination, filters: $filters) {\n      items {\n        ...PageFields\n        blocks {\n          id\n          type\n          order\n        }\n      }\n      pagination {\n        currentPage\n        totalPages\n        totalItems\n        hasNextPage\n        hasPreviousPage\n      }\n    }\n  }\n`;\n\n// Get a single page by ID with all blocks\nexport const GET_PAGE_BY_ID = gql`\n  ${PAGE_FRAGMENT}\n  ${PAGE_BLOCK_FRAGMENT}\n  query GetPageById($id: String!) {\n    getPageById(id: $id) {\n      ...PageFields\n      blocks {\n        ...PageBlockFields\n      }\n    }\n  }\n`;\n\n// Get a single page by slug with all blocks (for public pages)\nexport const GET_PAGE_BY_SLUG = gql`\n  ${PAGE_FRAGMENT}\n  ${PAGE_BLOCK_FRAGMENT}\n  query GetPageBySlug($slug: String!) {\n    getPageBySlug(slug: $slug) {\n      ...PageFields\n      blocks {\n        ...PageBlockFields\n      }\n    }\n  }\n`;\n\n// Get homepage\nexport const GET_HOMEPAGE = gql`\n  ${PAGE_FRAGMENT}\n  ${PAGE_BLOCK_FRAGMENT}\n  query GetHomepage {\n    getHomepage {\n      ...PageFields\n      isHomepage\n      blocks {\n        ...PageBlockFields\n      }\n    }\n  }\n`;\n\n// Create a new page\nexport const CREATE_PAGE = gql`\n  ${PAGE_FRAGMENT}\n  mutation CreatePage($input: CreatePageInput!) {\n    createPage(input: $input) {\n      ...PageFields\n    }\n  }\n`;\n\n// Update an existing page\nexport const UPDATE_PAGE = gql`\n  ${PAGE_FRAGMENT}\n  mutation UpdatePage($id: String!, $input: UpdatePageInput!) {\n    updatePage(id: $id, input: $input) {\n      ...PageFields\n    }\n  }\n`;\n\n// Delete a page\nexport const DELETE_PAGE = gql`\n  ${PAGE_FRAGMENT}\n  mutation DeletePage($id: String!) {\n    deletePage(id: $id) {\n      ...PageFields\n    }\n  }\n`;\n\n// Add a block to a page\nexport const ADD_PAGE_BLOCK = gql`\n  fragment PageBlockFields on PageBlock {\n    id\n    type\n    content\n    style\n    config\n    order\n    parentId\n    depth\n    isVisible\n    children {\n      id\n      type\n      content\n      style\n      config\n      order\n      parentId\n      depth\n      isVisible\n      children {\n        id\n        type\n        content\n        style\n        config\n        order\n        parentId\n        depth\n        isVisible\n        children {\n          id\n          type\n          content\n          style\n          config\n          order\n          parentId\n          depth\n          isVisible\n        }\n      }\n    }\n  }\n  mutation AddPageBlock($pageId: String!, $input: CreatePageBlockInput!) {\n    addPageBlock(pageId: $pageId, input: $input) {\n      ...PageBlockFields\n    }\n  }\n`;\n\n// Update a page block\nexport const UPDATE_PAGE_BLOCK = gql`\n  fragment PageBlockFields on PageBlock {\n    id\n    type\n    content\n    style\n    config\n    order\n    parentId\n    depth\n    isVisible\n    children {\n      id\n      type\n      content\n      style\n      config\n      order\n      parentId\n      depth\n      isVisible\n      children {\n        id\n        type\n        content\n        style\n        config\n        order\n        parentId\n        depth\n        isVisible\n        children {\n          id\n          type\n          content\n          style\n          config\n          order\n          parentId\n          depth\n          isVisible\n        }\n      }\n    }\n  }\n  mutation UpdatePageBlock($id: String!, $input: UpdatePageBlockInput!) {\n    updatePageBlock(id: $id, input: $input) {\n      ...PageBlockFields\n    }\n  }\n`;\n\n// Delete a page block\nexport const DELETE_PAGE_BLOCK = gql`\n  fragment PageBlockFields on PageBlock {\n    id\n    type\n    content\n    style\n    config\n    order\n    parentId\n    depth\n    isVisible\n    children {\n      id\n      type\n      content\n      style\n      config\n      order\n      parentId\n      depth\n      isVisible\n      children {\n        id\n        type\n        content\n        style\n        config\n        order\n        parentId\n        depth\n        isVisible\n        children {\n          id\n          type\n          content\n          style\n          config\n          order\n          parentId\n          depth\n          isVisible\n        }\n      }\n    }\n  }\n  mutation DeletePageBlock($id: String!) {\n    deletePageBlock(id: $id) {\n      ...PageBlockFields\n    }\n  }\n`;\n\n// Update the order of multiple page blocks\nexport const UPDATE_PAGE_BLOCKS_ORDER = gql`\n  fragment PageBlockFields on PageBlock {\n    id\n    type\n    content\n    style\n    config\n    order\n    parentId\n    depth\n    isVisible\n    children {\n      id\n      type\n      content\n      style\n      config\n      order\n      parentId\n      depth\n      isVisible\n      children {\n        id\n        type\n        content\n        style\n        config\n        order\n        parentId\n        depth\n        isVisible\n        children {\n          id\n          type\n          content\n          style\n          config\n          order\n          parentId\n          depth\n          isVisible\n        }\n      }\n    }\n  }\n  mutation UpdatePageBlocksOrder($pageId: String!, $updates: [BulkUpdateBlockOrderInput!]!) {\n    updatePageBlocksOrder(pageId: $pageId, updates: $updates) {\n      ...PageBlockFields\n    }\n  }\n`;","import React, { useContext, useEffect } from 'react';\nimport { PageBlock, BlockType } from '@/types/page-builder';\nimport { PageStateContext } from '../contexts/PageStateContext';\nimport { BlockLoader } from './BlockLoader';\nimport BlockErrorBoundary from '../BlockErrorBoundary';\n\nexport interface BlockRendererProps {\n  block: PageBlock;\n  isEditing?: boolean;\n  onUpdate: (content: any, style?: any) => void;\n  onDelete: () => void;\n  onAddChild?: (parentId: string) => void;\n  onUpdateChild?: (blockId: string, content: any, style?: any) => void;\n  onDeleteChild?: (blockId: string) => void;\n  onSelect?: (blockId: string | null) => void;\n  depth?: number;\n}\n\nexport const BlockRenderer: React.FC<BlockRendererProps> = ({\n  block,\n  isEditing = true,\n  onUpdate,\n  onDelete,\n  onAddChild,\n  onUpdateChild,\n  onDeleteChild,\n  onSelect,\n  depth = 0,\n}) => {\n  // Get selected block ID from context for visual highlighting (optional - for editor only)\n  // Use context directly instead of usePageState to make it optional\n  const pageState = useContext(PageStateContext);\n  const selectedBlockId = pageState?.selectedBlockId ?? null;\n  const isSelected = selectedBlockId === block.id;\n\n  const commonProps = {\n    block,\n    isEditable: isEditing,\n    onUpdate: (content: any, style?: any) => onUpdate(content, style),\n    onDelete,\n  };\n\n  // Handle block selection\n  const handleBlockClick = (e: React.MouseEvent) => {\n    if (isEditing && onSelect) {\n      e.stopPropagation(); // Prevent parent blocks from being selected\n      onSelect(block.id);\n    }\n  };\n\n  const isContainerBlock = [\n    BlockType.CONTAINER,\n    BlockType.SECTION,\n    BlockType.GRID,\n    BlockType.FLEX_ROW,\n    BlockType.FLEX_COLUMN,\n  ].includes(block.type);\n\n  const renderChildren = () => {\n    if (!block.children || block.children.length === 0) return undefined;\n\n    // For GRID blocks: Render children directly without wrapper (each child is a grid cell)\n    if (block.type === BlockType.GRID) {\n      return [...block.children]\n        .sort((a, b) => a.order - b.order)\n        .map((childBlock) => (\n          <div key={childBlock.id} className=\"grid-item\">\n            <BlockRenderer\n              block={childBlock}\n              isEditing={isEditing}\n              onUpdate={(content, style) => onUpdateChild?.(childBlock.id, content, style)}\n              onDelete={() => onDeleteChild?.(childBlock.id)}\n              onAddChild={onAddChild}\n              onUpdateChild={onUpdateChild}\n              onDeleteChild={onDeleteChild}\n              onSelect={onSelect}\n              depth={depth + 1}\n            />\n          </div>\n        ));\n    }\n\n    // For other container blocks: Keep visual indicators\n    return (\n      <div className=\"nested-blocks-container border-l-4 border-blue-200 ml-4 pl-4 mt-2 space-y-2\">\n        <div className=\"text-xs text-blue-600 font-semibold mb-2 flex items-center gap-1\">\n          ðŸ“¦ Nested Blocks ({block.children.length})\n        </div>\n        {[...block.children]\n          .sort((a, b) => a.order - b.order)\n          .map((childBlock) => {\n            return (\n              <div \n                key={childBlock.id} \n                className=\"nested-block-item bg-blue-50/30 rounded-lg p-2 border border-blue-100\"\n              >\n                <BlockRenderer\n                  block={childBlock}\n                  isEditing={isEditing}\n                  onUpdate={(content, style) => onUpdateChild?.(childBlock.id, content, style)}\n                  onDelete={() => onDeleteChild?.(childBlock.id)}\n                  onAddChild={onAddChild}\n                  onUpdateChild={onUpdateChild}\n                  onDeleteChild={onDeleteChild}\n                  onSelect={onSelect}\n                  depth={depth + 1}\n                />\n              </div>\n            );\n          })}\n      </div>\n    );\n  };\n\n  const containerProps = {\n    ...commonProps,\n    onAddChild: isContainerBlock ? () => {\n      console.log(`[BlockRenderer ${block.id}] onAddChild wrapper called, isContainerBlock=${isContainerBlock}, onAddChild=${!!onAddChild}`);\n      onAddChild?.(block.id);\n    } : undefined,\n    children: isContainerBlock ? renderChildren() : undefined,\n  };\n\n  // Debug log\n  if (isContainerBlock) {\n    console.log(`[BlockRenderer] Rendering container block ${block.id}:`, {\n      isContainerBlock,\n      onAddChildDefined: !!containerProps.onAddChild,\n      blockType: block.type,\n    });\n  }\n\n  // Debug logging trong development mode\n  useEffect(() => {\n    if (isContainerBlock && process.env.NODE_ENV === 'development') {\n      console.log(`[BlockRenderer ${block.id}] Container Block Debug:`, {\n        blockType: block.type,\n        hasChildren: !!block.children,\n        childrenCount: block.children?.length || 0,\n        onAddChildDefined: !!onAddChild,\n        onUpdateChildDefined: !!onUpdateChild,\n        onDeleteChildDefined: !!onDeleteChild,\n        depth,\n        children: block.children?.map(c => ({ id: c.id, type: c.type })),\n      });\n    }\n  }, [block.id, isContainerBlock, block.children, onAddChild, onUpdateChild, onDeleteChild, depth, block.type]);\n\n  // Render block based on type using lazy loading\n  const renderBlockContent = () => {\n    // Use BlockLoader for all blocks (handles lazy loading and error boundaries)\n    const isContainerType = [\n      BlockType.CONTAINER,\n      BlockType.SECTION,\n      BlockType.GRID,\n      BlockType.FLEX_ROW,\n      BlockType.FLEX_COLUMN,\n    ].includes(block.type);\n\n    const props = isContainerType ? containerProps : commonProps;\n\n    return (\n      <BlockLoader\n        blockType={block.type}\n        blockId={block.id}\n        props={props}\n        skeletonHeight=\"200px\"\n      />\n    );\n  };\n\n  let blockContent = renderBlockContent();\n\n  // Wrap in clickable div for selection (only in edit mode)\n  if (isEditing && onSelect) {\n    return (\n      <div \n        onClick={handleBlockClick}\n        className={`\n          w-full cursor-pointer transition-all \n          ${isSelected \n            ? 'ring-2 ring-blue-500 ring-opacity-100 shadow-lg' \n            : 'hover:ring-2 hover:ring-blue-400 hover:ring-opacity-50'\n          }\n        `}\n        role=\"button\"\n        tabIndex={0}\n        onKeyDown={(e) => {\n          if (e.key === 'Enter' || e.key === ' ') {\n            e.preventDefault();\n            onSelect(block.id);\n          }\n        }}\n      >\n        {blockContent}\n      </div>\n    );\n  }\n\n  return blockContent;\n};\n","import { useMutation, useQuery } from '@apollo/client';\nimport { useEffect, useRef, useCallback } from 'react';\nimport { \n  GET_PAGES, \n  GET_PAGE_BY_ID, \n  CREATE_PAGE, \n  UPDATE_PAGE, \n  DELETE_PAGE,\n  ADD_PAGE_BLOCK,\n  UPDATE_PAGE_BLOCK,\n  DELETE_PAGE_BLOCK,\n  UPDATE_PAGE_BLOCKS_ORDER\n} from '@/graphql/queries/pages';\nimport { \n  Page, \n  PaginatedPages, \n  CreatePageInput, \n  UpdatePageInput,\n  CreatePageBlockInput,\n  UpdatePageBlockInput,\n  BulkUpdateBlockOrderInput,\n  PageFiltersInput\n} from '@/types/page-builder';\nimport { PaginationInput } from '@/types/common';\nimport { toast } from 'sonner';\n\n// Constants for validation\nconst MAX_BLOCK_DEPTH = 5;\nconst MAX_BLOCKS_PER_PAGE = 100;\nconst MAX_CHILDREN_PER_CONTAINER = 20;\nconst AUTO_SAVE_DELAY = 30000; // 30 seconds\n\n// Hook for managing pages\nexport const usePages = (pagination?: PaginationInput, filters?: PageFiltersInput, options?: { skip?: boolean }) => {\n  const { data, loading, error, refetch } = useQuery<{ getPages: PaginatedPages }>(GET_PAGES, {\n    variables: { pagination, filters },\n    errorPolicy: 'all',\n    skip: options?.skip || false, // Allow skipping the query if needed\n  });\n\n  return {\n    pages: data?.getPages,\n    loading,\n    error,\n    refetch\n  };\n};\n\n// Hook for managing a single page\nexport const usePage = (id: string) => {\n  const { data, loading, error, refetch } = useQuery<{ getPageById: Page }>(GET_PAGE_BY_ID, {\n    variables: { id },\n    skip: !id,\n    errorPolicy: 'all'\n  });\n\n  return {\n    page: data?.getPageById,\n    loading,\n    error,\n    refetch\n  };\n};\n\n// Hook for page with auto-save functionality\nexport const usePageWithAutoSave = (id: string, onSave?: (page: Page) => Promise<void>) => {\n  const { page, loading, error, refetch } = usePage(id);\n  const autoSaveTimer = useRef<NodeJS.Timeout | null>(null);\n  const lastSavedState = useRef<string>('');\n  const hasChanges = useRef<boolean>(false);\n\n  // Auto-save logic\n  useEffect(() => {\n    if (!page || !onSave) return;\n\n    const currentState = JSON.stringify(page);\n    \n    // Check if there are changes\n    if (currentState !== lastSavedState.current && lastSavedState.current !== '') {\n      hasChanges.current = true;\n      \n      // Clear existing timer\n      if (autoSaveTimer.current) {\n        clearTimeout(autoSaveTimer.current);\n      }\n\n      // Set new auto-save timer\n      autoSaveTimer.current = setTimeout(async () => {\n        if (hasChanges.current) {\n          try {\n            await onSave(page);\n            lastSavedState.current = currentState;\n            hasChanges.current = false;\n            toast.success('Auto-saved', { duration: 2000 });\n          } catch (error) {\n            toast.error('Auto-save failed');\n          }\n        }\n      }, AUTO_SAVE_DELAY);\n    } else if (lastSavedState.current === '') {\n      // Initialize last saved state\n      lastSavedState.current = currentState;\n    }\n\n    // Cleanup\n    return () => {\n      if (autoSaveTimer.current) {\n        clearTimeout(autoSaveTimer.current);\n      }\n    };\n  }, [page, onSave]);\n\n  // Manual save function\n  const manualSave = useCallback(async () => {\n    if (!page || !onSave || !hasChanges.current) return;\n\n    try {\n      await onSave(page);\n      lastSavedState.current = JSON.stringify(page);\n      hasChanges.current = false;\n      toast.success('Saved successfully');\n    } catch (error) {\n      toast.error('Save failed');\n      throw error;\n    }\n  }, [page, onSave]);\n\n  return {\n    page,\n    loading,\n    error,\n    refetch,\n    hasUnsavedChanges: hasChanges.current,\n    manualSave\n  };\n};\n\n// Hook for page operations\nexport const usePageOperations = () => {\n  const [createPage] = useMutation(CREATE_PAGE);\n  const [updatePage] = useMutation(UPDATE_PAGE);\n  const [deletePage] = useMutation(DELETE_PAGE);\n\n  const handleCreatePage = async (input: CreatePageInput) => {\n    try {\n      console.log('Creating new page:', input);\n      const { data } = await createPage({\n        variables: { input },\n        refetchQueries: [GET_PAGES]\n      });\n      toast.success('Page created successfully!');\n      return data?.createPage;\n    } catch (error: any) {\n      toast.error(error.message || 'Failed to create page');\n      throw error;\n    }\n  };\n\n  const handleUpdatePage = async (id: string, input: UpdatePageInput) => {\n    try {\n      const { data } = await updatePage({\n        variables: { id, input },\n        refetchQueries: [GET_PAGES]\n      });\n      toast.success('Page updated successfully!');\n      return data?.updatePage;\n    } catch (error: any) {\n      toast.error(error.message || 'Failed to update page');\n      throw error;\n    }\n  };\n\n  const handleDeletePage = async (id: string) => {\n    try {\n      await deletePage({\n        variables: { id },\n        refetchQueries: [GET_PAGES]\n      });\n      toast.success('Page deleted successfully!');\n    } catch (error: any) {\n      toast.error(error.message || 'Failed to delete page');\n      throw error;\n    }\n  };\n\n  return {\n    createPage: handleCreatePage,\n    updatePage: handleUpdatePage,\n    deletePage: handleDeletePage\n  };\n};\n\n// Hook for block operations\nexport const useBlockOperations = (pageId: string) => {\n  const [addBlock] = useMutation(ADD_PAGE_BLOCK);\n  const [updateBlock] = useMutation(UPDATE_PAGE_BLOCK);\n  const [deleteBlock] = useMutation(DELETE_PAGE_BLOCK);\n  const [updateBlocksOrder] = useMutation(UPDATE_PAGE_BLOCKS_ORDER);\n\n  const handleAddBlock = async (input: CreatePageBlockInput) => {\n    try {\n      const { data } = await addBlock({\n        variables: { pageId, input },\n        refetchQueries: [{ query: GET_PAGE_BY_ID, variables: { id: pageId } }]\n      });\n      toast.success('Block added successfully!');\n      return data?.addPageBlock;\n    } catch (error: any) {\n      toast.error(error.message || 'Failed to add block');\n      throw error;\n    }\n  };\n\n  const handleUpdateBlock = async (id: string, input: UpdatePageBlockInput) => {\n    try {\n      const { data } = await updateBlock({\n        variables: { id, input },\n        refetchQueries: [{ query: GET_PAGE_BY_ID, variables: { id: pageId } }]\n      });\n      // Don't show toast for style updates as they happen frequently\n      // Only show toast for content updates\n      if (input.content !== undefined) {\n        toast.success('Block updated successfully!');\n      }\n      return data?.updatePageBlock;\n    } catch (error: any) {\n      toast.error(error.message || 'Failed to update block');\n      throw error;\n    }\n  };\n\n  const handleDeleteBlock = async (id: string) => {\n    try {\n      await deleteBlock({\n        variables: { id },\n        refetchQueries: [{ query: GET_PAGE_BY_ID, variables: { id: pageId } }]\n      });\n      toast.success('Block deleted successfully!');\n    } catch (error: any) {\n      toast.error(error.message || 'Failed to delete block');\n      throw error;\n    }\n  };\n\n  const handleUpdateBlocksOrder = async (updates: BulkUpdateBlockOrderInput[]) => {\n    try {\n      await updateBlocksOrder({\n        variables: { pageId, updates },\n        refetchQueries: [{ query: GET_PAGE_BY_ID, variables: { id: pageId } }]\n      });\n      // Don't show toast for drag operations as they happen frequently\n    } catch (error: any) {\n      toast.error(error.message || 'Failed to reorder blocks');\n      throw error;\n    }\n  };\n\n  return {\n    addBlock: handleAddBlock,\n    updateBlock: handleUpdateBlock,\n    deleteBlock: handleDeleteBlock,\n    updateBlocksOrder: handleUpdateBlocksOrder\n  };\n};\n\n// Hook for nested block operations\nexport const useNestedBlockOperations = (pageId: string) => {\n  const { addBlock, updateBlock, deleteBlock } = useBlockOperations(pageId);\n  const { page, refetch } = usePage(pageId);\n\n  /**\n   * Get all blocks in a flat array\n   */\n  const getAllBlocks = () => {\n    if (!page?.blocks) return [];\n    return flattenBlocks(page.blocks);\n  };\n\n  /**\n   * Add a child block to a parent container\n   */\n  const addChildBlock = async (\n    parentId: string,\n    blockType: string,\n    content: any = {},\n    style: any = {}\n  ) => {\n    const allBlocks = getAllBlocks();\n    const parentBlock = allBlocks.find(b => b.id === parentId);\n    \n    if (!parentBlock) {\n      throw new Error('Parent block not found');\n    }\n\n    // Validation: Check if parent can accept children\n    if (!isContainerBlock(parentBlock.type)) {\n      toast.error('This block type cannot contain child blocks');\n      throw new Error('Parent block is not a container');\n    }\n\n    // Validation: Check max depth\n    const parentDepth = parentBlock.depth || 0;\n    if (parentDepth >= MAX_BLOCK_DEPTH - 1) {\n      toast.error(`Maximum nesting depth (${MAX_BLOCK_DEPTH} levels) reached`);\n      throw new Error(`Maximum depth of ${MAX_BLOCK_DEPTH} exceeded`);\n    }\n\n    // Validation: Check max children\n    const siblings = allBlocks.filter(b => b.parentId === parentId);\n    if (siblings.length >= MAX_CHILDREN_PER_CONTAINER) {\n      toast.error(`Maximum ${MAX_CHILDREN_PER_CONTAINER} blocks per container`);\n      throw new Error(`Maximum children limit (${MAX_CHILDREN_PER_CONTAINER}) exceeded`);\n    }\n\n    // Validation: Check max total blocks\n    if (allBlocks.length >= MAX_BLOCKS_PER_PAGE) {\n      toast.error(`Maximum ${MAX_BLOCKS_PER_PAGE} blocks per page`);\n      throw new Error(`Maximum blocks limit (${MAX_BLOCKS_PER_PAGE}) exceeded`);\n    }\n\n    // Don't calculate order - let backend handle it to avoid race conditions\n    const input: CreatePageBlockInput = {\n      type: blockType as any,\n      content: content || {},\n      style: style || {},\n      parentId,\n      depth: parentDepth + 1,\n      // order is NOT sent, backend will auto-calculate\n      isVisible: true\n    };\n\n    try {\n      const result = await addBlock(input);\n      await refetch();\n      return result;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  /**\n   * Move block to a different container or position\n   */\n  const moveBlockToContainer = async (\n    blockId: string,\n    newParentId: string | null,\n    newOrder?: number\n  ) => {\n    const allBlocks = getAllBlocks();\n    const block = allBlocks.find(b => b.id === blockId);\n    \n    if (!block) {\n      throw new Error('Block not found');\n    }\n\n    // Calculate new depth\n    let newDepth = 0;\n    if (newParentId) {\n      const newParent = allBlocks.find(b => b.id === newParentId);\n      if (!newParent) {\n        throw new Error('New parent block not found');\n      }\n\n      // Validation: Check if new parent can accept children\n      if (!isContainerBlock(newParent.type)) {\n        toast.error('Target block cannot contain child blocks');\n        throw new Error('New parent is not a container');\n      }\n\n      newDepth = (newParent.depth || 0) + 1;\n\n      // Validation: Check if move would exceed max depth\n      const descendants = getBlockDescendants(blockId);\n      const maxDescendantDepth = descendants.reduce((max, d) => {\n        const relativeDepth = (d.depth || 0) - (block.depth || 0);\n        return Math.max(max, relativeDepth);\n      }, 0);\n\n      if (newDepth + maxDescendantDepth >= MAX_BLOCK_DEPTH) {\n        toast.error(`Moving this block would exceed maximum depth (${MAX_BLOCK_DEPTH} levels)`);\n        throw new Error('Move would exceed maximum depth');\n      }\n\n      // Validation: Check max children in new parent\n      const newSiblings = allBlocks.filter(b => b.parentId === newParentId && b.id !== blockId);\n      if (newSiblings.length >= MAX_CHILDREN_PER_CONTAINER) {\n        toast.error(`Target container has reached maximum ${MAX_CHILDREN_PER_CONTAINER} blocks`);\n        throw new Error('Target container is full');\n      }\n    }\n\n    // Calculate order if not provided\n    let calculatedOrder = newOrder;\n    if (calculatedOrder === undefined) {\n      const siblings = allBlocks.filter(b => b.parentId === newParentId && b.id !== blockId);\n      calculatedOrder = siblings.length;\n    }\n\n    const input: UpdatePageBlockInput = {\n      parentId: newParentId,\n      depth: newDepth,\n      order: calculatedOrder\n    };\n\n    try {\n      await updateBlock(blockId, input);\n      \n      // Update depths of all descendants\n      const descendants = getBlockDescendants(blockId);\n      const depthDiff = newDepth - (block.depth || 0);\n      \n      if (depthDiff !== 0 && descendants.length > 0) {\n        for (const descendant of descendants) {\n          await updateBlock(descendant.id, {\n            depth: (descendant.depth || 0) + depthDiff\n          });\n        }\n      }\n      \n      await refetch();\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  /**\n   * Get block tree structure (nested)\n   */\n  const getBlockTree = () => {\n    if (!page?.blocks) return [];\n    return buildBlockTree(page.blocks);\n  };\n\n  /**\n   * Get children of a specific block\n   */\n  const getBlockChildren = (blockId: string) => {\n    const allBlocks = getAllBlocks();\n    return allBlocks\n      .filter(b => b.parentId === blockId)\n      .sort((a, b) => a.order - b.order);\n  };\n\n  /**\n   * Get parent of a specific block\n   */\n  const getBlockParent = (blockId: string) => {\n    const allBlocks = getAllBlocks();\n    const block = allBlocks.find(b => b.id === blockId);\n    if (!block?.parentId) return null;\n    return allBlocks.find(b => b.id === block.parentId) || null;\n  };\n\n  /**\n   * Get all ancestors of a block (parent, grandparent, etc.)\n   */\n  const getBlockAncestors = (blockId: string) => {\n    const ancestors = [];\n    let currentBlock = getAllBlocks().find(b => b.id === blockId);\n    \n    while (currentBlock?.parentId) {\n      const parent = getAllBlocks().find(b => b.id === currentBlock!.parentId);\n      if (parent) {\n        ancestors.push(parent);\n        currentBlock = parent;\n      } else {\n        break;\n      }\n    }\n    \n    return ancestors;\n  };\n\n  /**\n   * Get all descendants of a block (children, grandchildren, etc.)\n   */\n  const getBlockDescendants = (blockId: string) => {\n    const descendants: any[] = [];\n    const allBlocks = getAllBlocks();\n    \n    const collectDescendants = (parentId: string) => {\n      const children = allBlocks.filter(b => b.parentId === parentId);\n      for (const child of children) {\n        descendants.push(child);\n        collectDescendants(child.id);\n      }\n    };\n    \n    collectDescendants(blockId);\n    return descendants;\n  };\n\n  /**\n   * Check if a block can accept children (is a container)\n   */\n  const isContainerBlock = (blockType: string) => {\n    const containerTypes = [\n      'CONTAINER',\n      'SECTION',\n      'GRID',\n      'FLEX_ROW',\n      'FLEX_COLUMN'\n    ];\n    return containerTypes.includes(blockType);\n  };\n\n  /**\n   * Duplicate a block with all its children\n   */\n  const duplicateBlock = async (blockId: string) => {\n    const allBlocks = getAllBlocks();\n    const block = allBlocks.find(b => b.id === blockId);\n    \n    if (!block) {\n      throw new Error('Block not found');\n    }\n\n    // Create copy of the block\n    const siblings = allBlocks.filter(b => b.parentId === block.parentId);\n    const newOrder = siblings.length;\n\n    const newBlockInput: CreatePageBlockInput = {\n      type: block.type,\n      content: JSON.parse(JSON.stringify(block.content)),\n      style: JSON.parse(JSON.stringify(block.style || {})),\n      parentId: block.parentId,\n      depth: block.depth || 0,\n      order: newOrder,\n      isVisible: block.isVisible,\n      config: block.config ? JSON.parse(JSON.stringify(block.config)) : undefined\n    };\n\n    try {\n      const newBlock = await addBlock(newBlockInput);\n      \n      // Recursively duplicate children\n      const children = getBlockChildren(blockId);\n      if (children.length > 0 && newBlock?.id) {\n        for (const child of children) {\n          await duplicateBlockRecursive(child, newBlock.id);\n        }\n      }\n      \n      await refetch();\n      return newBlock;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  /**\n   * Helper: Recursively duplicate a block and its children\n   */\n  const duplicateBlockRecursive = async (block: any, newParentId: string) => {\n    const allBlocks = getAllBlocks();\n    const parent = allBlocks.find(b => b.id === newParentId);\n    const siblings = allBlocks.filter(b => b.parentId === newParentId);\n\n    const newBlockInput: CreatePageBlockInput = {\n      type: block.type,\n      content: JSON.parse(JSON.stringify(block.content)),\n      style: JSON.parse(JSON.stringify(block.style || {})),\n      parentId: newParentId,\n      depth: (parent?.depth || 0) + 1,\n      order: siblings.length,\n      isVisible: block.isVisible,\n      config: block.config ? JSON.parse(JSON.stringify(block.config)) : undefined\n    };\n\n    const newBlock = await addBlock(newBlockInput);\n    \n    const children = getBlockChildren(block.id);\n    if (children.length > 0 && newBlock?.id) {\n      for (const child of children) {\n        await duplicateBlockRecursive(child, newBlock.id);\n      }\n    }\n    \n    return newBlock;\n  };\n\n  return {\n    // Basic operations\n    addBlock,\n    updateBlock,\n    deleteBlock,\n    \n    // Nested operations\n    addChildBlock,\n    moveBlockToContainer,\n    duplicateBlock,\n    \n    // Query helpers\n    getAllBlocks,\n    getBlockTree,\n    getBlockChildren,\n    getBlockParent,\n    getBlockAncestors,\n    getBlockDescendants,\n    isContainerBlock,\n    \n    // Page data\n    page,\n    refetch\n  };\n};\n\n/**\n * Utility: Flatten nested blocks into a single array\n */\nexport const flattenBlocks = (blocks: any[]): any[] => {\n  const result: any[] = [];\n  \n  const flatten = (block: any) => {\n    result.push(block);\n    if (block.children && block.children.length > 0) {\n      block.children.forEach((child: any) => flatten(child));\n    }\n  };\n  \n  blocks.forEach(flatten);\n  return result;\n};\n\n/**\n * Utility: Build nested tree structure from flat array\n */\nexport const unflattenBlocks = (blocks: any[]): any[] => {\n  return buildBlockTree(blocks);\n};\n\n/**\n * Utility: Build tree structure from blocks\n */\nconst buildBlockTree = (blocks: any[]): any[] => {\n  const blockMap = new Map();\n  const rootBlocks: any[] = [];\n\n  // Create a map of all blocks\n  blocks.forEach(block => {\n    blockMap.set(block.id, { ...block, children: [] });\n  });\n\n  // Build the tree\n  blocks.forEach(block => {\n    const currentBlock = blockMap.get(block.id);\n    \n    if (!block.parentId) {\n      // Root level block\n      rootBlocks.push(currentBlock);\n    } else {\n      // Child block\n      const parent = blockMap.get(block.parentId);\n      if (parent) {\n        parent.children.push(currentBlock);\n      }\n    }\n  });\n\n  // Sort children by order\n  const sortChildren = (block: any) => {\n    if (block.children && block.children.length > 0) {\n      block.children.sort((a: any, b: any) => a.order - b.order);\n      block.children.forEach((child: any) => sortChildren(child));\n    }\n  };\n\n  rootBlocks.forEach(sortChildren);\n  rootBlocks.sort((a, b) => a.order - b.order);\n\n  return rootBlocks;\n};","'use client';\n\nimport React, { createContext, useContext, useState, useEffect, useCallback, useMemo, ReactNode } from 'react';\nimport { usePage } from '@/hooks/usePageBuilder';\nimport { Page, PageBlock, PageStatus } from '@/types/page-builder';\n\n/**\n * Page State Context - Manages page and blocks state\n */\ninterface PageStateContextType {\n  // Page state\n  page: Page | null;\n  editingPage: Page | null;\n  isNewPageMode: boolean;\n  loading: boolean;\n  \n  // Blocks state\n  blocks: PageBlock[];\n  selectedBlockId: string | null;\n  selectedBlock: PageBlock | null;\n  \n  // Drag state\n  draggedBlock: PageBlock | null;\n  \n  // State setters\n  setEditingPage: (page: Page | null) => void;\n  setBlocks: (blocks: PageBlock[]) => void;\n  setSelectedBlockId: (id: string | null) => void;\n  setDraggedBlock: (block: PageBlock | null) => void;\n  \n  // Refetch function\n  refetch: () => Promise<any>;\n}\n\nconst PageStateContext = createContext<PageStateContextType | undefined>(undefined);\n\n// Export the context for direct usage in components that need optional access\nexport { PageStateContext };\n\ninterface PageStateProviderProps {\n  children: ReactNode;\n  pageId?: string;\n}\n\nexport function PageStateProvider({ children, pageId }: PageStateProviderProps) {\n  // Page state\n  const isNewPageModeBool = !pageId;\n  const [isNewPageMode, setIsNewPageMode] = useState(isNewPageModeBool);\n  \n  // Initialize editingPage with default values for new page mode\n  const [editingPage, setEditingPageState] = useState<Page | null>(\n    isNewPageModeBool ? {\n      id: '',\n      title: 'Untitled Page',\n      slug: 'untitled-page',\n      content: {},\n      status: PageStatus.DRAFT,\n      blocks: [],\n      seoTitle: '',\n      seoDescription: '',\n      seoKeywords: [],\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString(),\n    } : null\n  );\n  \n  // Blocks state\n  const [blocks, setBlocksState] = useState<PageBlock[]>([]);\n  const [selectedBlockId, setSelectedBlockIdState] = useState<string | null>(null);\n  const [draggedBlock, setDraggedBlockState] = useState<PageBlock | null>(null);\n  \n  // Hooks\n  // FIX: Only fetch page if we have a valid pageId (for existing pages)\n  // Pass pageId directly (not || '') so Apollo knows when it changes\n  const { page, loading, refetch } = usePage(pageId || '');\n  \n  // Memoized setters for stable references\n  const setEditingPage = useCallback((page: Page | null) => {\n    setEditingPageState(page);\n  }, []);\n  \n  const setBlocks = useCallback((blocks: PageBlock[]) => {\n    setBlocksState(blocks);\n  }, []);\n  \n  const setSelectedBlockId = useCallback((id: string | null) => {\n    setSelectedBlockIdState(id);\n  }, []);\n  \n  const setDraggedBlock = useCallback((block: PageBlock | null) => {\n    setDraggedBlockState(block);\n  }, []);\n  \n  // Track pageId changes and refetch when it changes\n  useEffect(() => {\n    if (pageId) {\n      setIsNewPageMode(false);\n      // Refetch when pageId changes\n      refetch();\n    } else {\n      setIsNewPageMode(true);\n    }\n  }, [pageId, refetch]);\n  \n  // Initialize editing page when page loads (for existing pages)\n  useEffect(() => {\n    if (page && !isNewPageMode) {\n      setEditingPageState(page);\n    }\n  }, [page, isNewPageMode]);\n  \n  // Initialize blocks from page\n  useEffect(() => {\n    if (page?.blocks) {\n      setBlocksState(page.blocks as PageBlock[]);\n    }\n  }, [page?.blocks]);\n  \n  // Calculate selected block with useMemo for performance\n  const selectedBlock = useMemo(() => {\n    if (!selectedBlockId) return null;\n    \n    const findBlock = (blocks: PageBlock[]): PageBlock | null => {\n      for (const block of blocks) {\n        if (block.id === selectedBlockId) return block;\n        if (block.children) {\n          const found = findBlock(block.children);\n          if (found) return found;\n        }\n      }\n      return null;\n    };\n    \n    return findBlock(blocks);\n  }, [selectedBlockId, blocks]);\n  \n  const value: PageStateContextType = {\n    page: page || null,\n    editingPage,\n    isNewPageMode,\n    loading,\n    blocks,\n    selectedBlockId,\n    selectedBlock,\n    draggedBlock,\n    setEditingPage,\n    setBlocks,\n    setSelectedBlockId,\n    setDraggedBlock,\n    refetch,\n  };\n  \n  return (\n    <PageStateContext.Provider value={value}>\n      {children}\n    </PageStateContext.Provider>\n  );\n}\n\nexport function usePageState() {\n  const context = useContext(PageStateContext);\n  if (context === undefined) {\n    // Return default values instead of throwing during SSR or initial render\n    if (typeof window === 'undefined') {\n      return {\n        page: null,\n        editingPage: null,\n        isNewPageMode: true,\n        loading: false,\n        blocks: [],\n        selectedBlockId: null,\n        selectedBlock: null,\n        draggedBlock: null,\n        setEditingPage: () => {},\n        setBlocks: () => {},\n        setSelectedBlockId: () => {},\n        setDraggedBlock: () => {},\n        refetch: async () => {},\n      } as PageStateContextType;\n    }\n    throw new Error(\n      'usePageState must be used within a PageStateProvider. ' +\n      'Make sure your component is wrapped with <PageBuilderProvider>'\n    );\n  }\n  return context;\n}\n","'use client';\n\nimport React, { Component, ErrorInfo, ReactNode } from 'react';\nimport { AlertCircle } from 'lucide-react';\n\ninterface Props {\n  children: ReactNode;\n  blockId?: string;\n  onError?: (error: Error, errorInfo: ErrorInfo) => void;\n}\n\ninterface State {\n  hasError: boolean;\n  error: Error | null;\n}\n\n/**\n * Error Boundary for individual block rendering\n * Handles errors during block component rendering and block-specific operations\n */\nexport class BlockErrorBoundary extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n    };\n  }\n\n  static getDerivedStateFromError(error: Error): State {\n    return {\n      hasError: true,\n      error,\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    if (process.env.NODE_ENV === 'development') {\n      console.error(`Block Error (ID: ${this.props.blockId}):`, error);\n      console.error('Component Stack:', errorInfo.componentStack);\n    }\n\n    if (this.props.onError) {\n      this.props.onError(error, errorInfo);\n    }\n  }\n\n  handleReset = () => {\n    this.setState({\n      hasError: false,\n      error: null,\n    });\n  };\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\"p-3 bg-orange-50 border border-orange-200 rounded\">\n          <div className=\"flex gap-2 items-start\">\n            <AlertCircle className=\"h-4 w-4 text-orange-600 flex-shrink-0 mt-0.5\" />\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"font-medium text-orange-900 text-sm\">\n                Block Render Error\n                {this.props.blockId && ` (${this.props.blockId})`}\n              </p>\n              <p className=\"text-xs text-orange-800 mt-0.5\">\n                {this.state.error?.message || 'Failed to render this block'}\n              </p>\n              {process.env.NODE_ENV === 'development' && (\n                <details className=\"mt-1\">\n                  <summary className=\"text-xs text-orange-700 cursor-pointer\">\n                    Details\n                  </summary>\n                  <pre className=\"text-xs mt-1 p-2 bg-white rounded overflow-auto max-h-24\">\n                    {this.state.error?.toString()}\n                  </pre>\n                </details>\n              )}\n              <button\n                onClick={this.handleReset}\n                className=\"mt-2 text-xs px-2 py-1 bg-orange-600 text-white rounded hover:bg-orange-700 transition-colors\"\n              >\n                Retry\n              </button>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nexport default BlockErrorBoundary;\n","'use client';\n\nimport React, { lazy, Suspense } from 'react';\nimport { BlockType } from '@/types/page-builder';\nimport BlockErrorBoundary from '../BlockErrorBoundary';\n\n/**\n * Lazy-loaded block components\n * Imported dynamically to reduce initial bundle size\n */\nconst TextBlock = lazy(() => import('./TextBlock').then(m => ({ default: m.TextBlock })));\nconst RichTextBlock = lazy(() => import('./RichTextBlock').then(m => ({ default: m.default })));\nconst ImageBlock = lazy(() => import('./ImageBlock').then(m => ({ default: m.ImageBlock })));\nconst HeroBlock = lazy(() => import('./HeroBlock').then(m => ({ default: m.HeroBlock })));\nconst ButtonBlock = lazy(() => import('./ButtonBlock').then(m => ({ default: m.ButtonBlock })));\nconst DividerBlock = lazy(() => import('./DividerBlock').then(m => ({ default: m.DividerBlock })));\nconst SpacerBlock = lazy(() => import('./SpacerBlock').then(m => ({ default: m.SpacerBlock })));\nconst TeamBlock = lazy(() => import('./TeamBlock').then(m => ({ default: m.TeamBlock })));\nconst StatsBlock = lazy(() => import('./StatsBlock').then(m => ({ default: m.StatsBlock })));\nconst ContactInfoBlock = lazy(() => import('./ContactInfoBlock').then(m => ({ default: m.ContactInfoBlock })));\nconst ContainerBlock = lazy(() => import('./ContainerBlock').then(m => ({ default: m.ContainerBlock })));\nconst SectionBlock = lazy(() => import('./SectionBlock').then(m => ({ default: m.SectionBlock })));\nconst GridBlock = lazy(() => import('./GridBlock').then(m => ({ default: m.GridBlock })));\nconst FlexBlock = lazy(() => import('./FlexBlock').then(m => ({ default: m.FlexBlock })));\nconst DynamicBlock = lazy(() => import('./DynamicBlock').then(m => ({ default: m.DynamicBlock })));\nconst CarouselBlock = lazy(() => import('./CarouselBlock').then(m => ({ default: m.CarouselBlock })));\nconst ProductListBlock = lazy(() => import('./ProductListBlock').then(m => ({ default: m.ProductListBlock })));\nconst ProductDetailBlock = lazy(() => import('./ProductDetailBlock').then(m => ({ default: m.ProductDetailBlock })));\nconst ProductCarouselBlock = lazy(() => import('./ProductCarouselBlock').then(m => ({ default: m.ProductCarouselBlock })));\nconst VideoBlock = lazy(() => import('./VideoBlock').then(m => ({ default: m.VideoBlock })));\nconst SearchBlock = lazy(() => import('./SearchBlock').then(m => ({ default: m.SearchBlock })));\nconst BookmarkBlock = lazy(() => import('./BookmarkBlock').then(m => ({ default: m.BookmarkBlock })));\n\n/**\n * Block component map for lazy loading\n * Mapped by BlockType enum string values ('TEXT', 'IMAGE', etc.)\n */\nexport const LAZY_BLOCK_COMPONENTS: Record<BlockType | string, React.ComponentType<any>> = {\n  // Content Blocks\n  [BlockType.TEXT]: TextBlock,\n  [BlockType.RICH_TEXT]: RichTextBlock,\n  [BlockType.IMAGE]: ImageBlock,\n  [BlockType.VIDEO]: VideoBlock,\n  [BlockType.CAROUSEL]: CarouselBlock,\n  [BlockType.HERO]: HeroBlock,\n  [BlockType.BUTTON]: ButtonBlock,\n  [BlockType.DIVIDER]: DividerBlock,\n  [BlockType.SPACER]: SpacerBlock,\n  [BlockType.TEAM]: TeamBlock,\n  [BlockType.STATS]: StatsBlock,\n  [BlockType.CONTACT_INFO]: ContactInfoBlock,\n  [BlockType.GALLERY]: ImageBlock,             // Fallback: uses ImageBlock\n  [BlockType.CARD]: TextBlock,                 // Fallback: uses TextBlock\n  [BlockType.TESTIMONIAL]: TextBlock,          // Fallback: uses TextBlock\n  [BlockType.FAQ]: TextBlock,                  // Fallback: uses TextBlock\n  [BlockType.CONTACT_FORM]: TextBlock,         // Fallback: uses TextBlock\n  [BlockType.COMPLETED_TASKS]: TextBlock,      // Fallback: uses TextBlock\n  [BlockType.SEARCH]: SearchBlock,\n  [BlockType.BOOKMARK]: BookmarkBlock,\n  \n  // Container/Layout Blocks\n  [BlockType.CONTAINER]: ContainerBlock,\n  [BlockType.SECTION]: SectionBlock,\n  [BlockType.GRID]: GridBlock,\n  [BlockType.FLEX_ROW]: FlexBlock,\n  [BlockType.FLEX_COLUMN]: FlexBlock,\n  [BlockType.COLUMN]: FlexBlock,               // Fallback: uses FlexBlock\n  [BlockType.ROW]: FlexBlock,                  // Fallback: uses FlexBlock\n  \n  // Dynamic Block\n  [BlockType.DYNAMIC]: DynamicBlock,\n  \n  // E-commerce Blocks\n  [BlockType.PRODUCT_LIST]: ProductListBlock,\n  [BlockType.PRODUCT_DETAIL]: ProductDetailBlock,\n  [BlockType.PRODUCT_CAROUSEL]: ProductCarouselBlock,\n};\n\n/**\n * Block loading skeleton\n */\nexport const BlockSkeleton: React.FC<{ height?: string }> = ({ height = '200px' }) => (\n  <div className=\"animate-pulse bg-gray-200 rounded\" style={{ height }} />\n);\n\n/**\n * Get block component by type\n * Returns lazy-loaded component or placeholder\n * Supports BlockType string values ('TEXT', 'IMAGE', etc.)\n */\nexport function getBlockComponent(blockType: BlockType | string) {\n  if (!blockType) return null;\n  \n  // Normalize to uppercase in case of case mismatch\n  const normalizedType = typeof blockType === 'string' ? blockType.toUpperCase() : blockType;\n  \n  return LAZY_BLOCK_COMPONENTS[normalizedType] || null;\n}\n\n/**\n * Block Loader Component Props\n */\nexport interface BlockLoaderProps {\n  blockType: BlockType | string;\n  blockId: string;\n  props: any;\n  skeletonHeight?: string;\n}\n\n/**\n * Block Loader Component\n * Handles lazy loading, suspense, and error boundaries for blocks\n */\nexport const BlockLoader: React.FC<BlockLoaderProps> = ({\n  blockType,\n  blockId,\n  props,\n  skeletonHeight = '200px',\n}) => {\n  const Component = getBlockComponent(blockType);\n\n  if (!Component) {\n    console.error(`[BlockLoader] Unknown block type: ${blockType} (type: ${typeof blockType}, blockId: ${blockId})`);\n    return (\n      <div className=\"p-4 border border-red-300 bg-red-50 text-red-600 rounded\">\n        Unknown block type: {blockType}\n      </div>\n    );\n  }\n\n  return (\n    <BlockErrorBoundary blockId={blockId}>\n      <Suspense fallback={<BlockSkeleton height={skeletonHeight} />}>\n        <Component {...props} />\n      </Suspense>\n    </BlockErrorBoundary>\n  );\n};\n\nexport default BlockLoader;\n"],"names":[],"mappings":"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"}