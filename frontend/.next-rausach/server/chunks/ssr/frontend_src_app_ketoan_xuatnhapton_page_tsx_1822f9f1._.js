module.exports=[106232,a=>{"use strict";var b=a.i(321248),c=a.i(651332),d=a.i(189101),e=a.i(359379),f=a.i(202979),g=a.i(327987),h=a.i(755820),i=a.i(478184),j=a.i(441405);let k=({isOpen:a,currentConfig:d,onSave:e,onClose:g})=>{let[k,l]=c.default.useState(d?.mst||""),[m,n]=c.default.useState(d?.companyName||"");return c.default.useEffect(()=>{d&&(l(d.mst),n(d.companyName))},[d]),(0,b.jsx)(h.Dialog,{open:a,onOpenChange:g,children:(0,b.jsxs)(h.DialogContent,{className:"sm:max-w-[500px]",children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:"Cáº¥u HÃ¬nh MÃ£ Sá»‘ Thuáº¿"}),(0,b.jsx)(h.DialogDescription,{children:"Nháº­p mÃ£ sá»‘ thuáº¿ Ä‘á»ƒ phÃ¢n loáº¡i hÃ³a Ä‘Æ¡n bÃ¡n/mua tá»± Ä‘á»™ng"})]}),(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),k.trim()&&e({mst:k.trim(),companyName:m.trim()})},children:[(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsxs)(j.Label,{htmlFor:"mst",children:["MÃ£ Sá»‘ Thuáº¿ (MST) ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)(i.Input,{id:"mst",value:k,onChange:a=>l(a.target.value),placeholder:"Nháº­p mÃ£ sá»‘ thuáº¿ cá»§a báº¡n",required:!0}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"MST dÃ¹ng Ä‘á»ƒ phÃ¢n loáº¡i hÃ³a Ä‘Æ¡n bÃ¡n/mua"})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(j.Label,{htmlFor:"companyName",children:"TÃªn CÃ´ng Ty"}),(0,b.jsx)(i.Input,{id:"companyName",value:m,onChange:a=>n(a.target.value),placeholder:"Nháº­p tÃªn cÃ´ng ty"})]})]}),(0,b.jsxs)(h.DialogFooter,{children:[(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:g,children:"Há»§y"}),(0,b.jsx)(f.Button,{type:"submit",children:"LÆ°u Cáº¥u HÃ¬nh"})]})]})]})})},l=a=>null==a?"0 â‚«":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(a),m=a=>null==a?"0":new Intl.NumberFormat("vi-VN").format(a),n=a=>{if(!a)return"";try{let b=new Date(a);return new Intl.DateTimeFormat("vi-VN").format(b)}catch(b){return a}},o=a=>{let b=a.getFullYear(),c=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0");return`${b}-${c}-${d}`},p=!1,q=(a,b,c,d,e,f,g,h)=>{console.log("ðŸ”§ calculateInventory START:",{invoices:a.length,details:b.length,products:c.length});let i=new Map,j=a.filter(a=>{if(!a.tdlap)return!1;let b=new Date(a.tdlap),c=new Date(f),d=new Date(g);return d.setHours(23,59,59,999),b>=c&&b<=d});console.log("ðŸ“… Filtered by date:",j.length,"invoices");let k=0,l=0,m=0,n=0;j.forEach(a=>{let f=((a,b)=>{if(!b||!a)return null;let c=b.trim().toLowerCase(),d=a.nbmst?.trim().toLowerCase(),e=a.nmmst?.trim().toLowerCase();return(p||(console.log("ðŸ” classifyInvoice DEBUG:",{userMST:c,nbmst:d,nmmst:e,matchesSeller:d===c,matchesBuyer:e===c,invoice:a}),p=!0),d===c)?"sale":e===c?"purchase":null})(a,d);if(!f)return void l++;k++,"sale"===f&&m++,"purchase"===f&&n++;let g=b.filter(b=>b.idhdonServer===a.idServer);k<=2&&console.log(`ðŸ“„ Processing invoice #${k}:`,{type:f,id:a.id,idServer:a.idServer,nbmst:a.nbmst,nmmst:a.nmmst,detailsCount:g.length}),g.forEach(b=>{if(!b.ten)return;let{key:d,code:g,unit:h}=((a,b,c)=>{if(!b||0===b.length)return console.warn("âš ï¸ No products available for mapping, using original name"),{key:a,code:null,unit:null};let d=b.find(b=>b.ten?.toLowerCase()===a.toLowerCase());if(d)return{key:"ma"===c?d.ma||a:d.ten2||a,code:d.ma,unit:d.dvt};let e=b.find(b=>b.ten?.toLowerCase().includes(a.toLowerCase())||a.toLowerCase().includes(b.ten?.toLowerCase()||""));return e?{key:"ma"===c?e.ma||a:e.ten2||a,code:e.ma,unit:e.dvt}:{key:a,code:null,unit:null}})(b.ten,c,e),j=a.tdlap?new Date(a.tdlap).toISOString().split("T")[0]:"",k=`${d}_${j}`,l=i.get(k);l||(l={productName:d,originalName:b.ten,productCode:g,unit:h||b.dvtinh,date:j,openingQuantity:0,openingAmount:0,importQuantity:0,importAmount:0,exportQuantity:0,exportAmount:0,exportCostPrice:0,exportSalePrice:0,exportSaleAmount:0,closingQuantity:0,closingAmount:0},i.set(k,l));let m=Number(b.sluong)||0,n=Number(b.thtien)||0,o=Number(b.dgia)||0;"purchase"===f?(l.importQuantity+=m,l.importAmount+=n):"sale"===f&&(l.exportQuantity+=m,l.exportSalePrice=o,l.exportSaleAmount+=o*m)})}),console.log("âœ… Processed invoices:",k,"| Sales:",m,"| Purchases:",n,"| Skipped (no type):",l),console.log("ðŸ“¦ Inventory map size:",i.size);let o=Array.from(i.values());console.log("ðŸ“Š Inventory rows before grouping:",o.length);let q=new Map;o.forEach(a=>{let b=a.productName;q.has(b)||q.set(b,[]),q.get(b).push(a)}),console.log("ðŸ·ï¸ Product groups:",q.size);let r=[];return q.forEach(a=>{a.sort((a,b)=>a.date.localeCompare(b.date));let b=a[0].productName,c=h?.get(b),d=c?.quantity||0,e=c?.amount||0;c&&console.log(`ðŸ”µ Using opening balance for "${b}":`,{quantity:d,amount:e}),a.forEach(a=>{a.openingQuantity=d,a.openingAmount=e;let b=a.openingQuantity+a.importQuantity,c=a.openingAmount+a.importAmount,f=b>0?c/b:0;a.exportCostPrice=f,a.exportAmount=f*a.exportQuantity,a.closingQuantity=a.openingQuantity+a.importQuantity-a.exportQuantity,a.closingAmount=a.openingAmount+a.importAmount-a.exportAmount,d=a.closingQuantity,e=a.closingAmount,r.push(a)})}),console.log("ðŸŽ¯ FINAL ROWS:",r.length),r.length>0&&console.log("Sample row:",r[0]),r};var r=a.i(715561);let s=a=>({totalProducts:new Set(a.map(a=>a.productName)).size,totalRecords:a.length,totalOpeningQuantity:a.reduce((a,b)=>a+b.openingQuantity,0),totalOpeningAmount:a.reduce((a,b)=>a+b.openingAmount,0),totalImportQuantity:a.reduce((a,b)=>a+b.importQuantity,0),totalImportAmount:a.reduce((a,b)=>a+b.importAmount,0),totalExportQuantity:a.reduce((a,b)=>a+b.exportQuantity,0),totalExportAmount:a.reduce((a,b)=>a+b.exportAmount,0),totalExportSaleAmount:a.reduce((a,b)=>a+b.exportSaleAmount,0),totalClosingQuantity:a.reduce((a,b)=>a+b.closingQuantity,0),totalClosingAmount:a.reduce((a,b)=>a+b.closingAmount,0)});var t=a.i(975780),u=a.i(79028),v=a.i(893795),v=v,w=a.i(889159),w=w,x=a.i(253322),y=a.i(193070),z=a.i(57597),A=a.i(772451);let B=({summary:a,loading:c})=>c?(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 mb-6",children:[1,2,3,4,5,6].map(a=>(0,b.jsxs)(t.Card,{children:[(0,b.jsxs)(t.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(A.Skeleton,{className:"h-4 w-[100px]"}),(0,b.jsx)(A.Skeleton,{className:"h-4 w-4"})]}),(0,b.jsxs)(t.CardContent,{children:[(0,b.jsx)(A.Skeleton,{className:"h-8 w-[120px] mb-1"}),(0,b.jsx)(A.Skeleton,{className:"h-3 w-[80px]"})]})]},a))}):(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 mb-6",children:[(0,b.jsxs)(t.Card,{className:"border-l-4 border-l-slate-500",children:[(0,b.jsxs)(t.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(t.CardTitle,{className:"text-sm font-medium",children:"Tá»•ng Báº£n Ghi"}),(0,b.jsx)(y.ListOrdered,{className:"h-4 w-4 text-slate-500"})]}),(0,b.jsxs)(t.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:m(a.totalRecords)}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[m(a.totalProducts)," sáº£n pháº©m"]})]})]}),(0,b.jsxs)(t.Card,{className:"border-l-4 border-l-indigo-500",children:[(0,b.jsxs)(t.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(t.CardTitle,{className:"text-sm font-medium",children:"Tá»“n Äáº§u Ká»³"}),(0,b.jsx)(z.TrendingUp,{className:"h-4 w-4 text-indigo-500"})]}),(0,b.jsxs)(t.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:m(a.totalOpeningQuantity)}),(0,b.jsx)("p",{className:"text-xs text-indigo-600",children:l(a.totalOpeningAmount)})]})]}),(0,b.jsxs)(t.Card,{className:"border-l-4 border-l-green-500",children:[(0,b.jsxs)(t.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(t.CardTitle,{className:"text-sm font-medium",children:"Tá»•ng Nháº­p"}),(0,b.jsx)(v.default,{className:"h-4 w-4 text-green-500"})]}),(0,b.jsxs)(t.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:m(a.totalImportQuantity)}),(0,b.jsx)("p",{className:"text-xs text-green-600",children:l(a.totalImportAmount)})]})]}),(0,b.jsxs)(t.Card,{className:"border-l-4 border-l-orange-500",children:[(0,b.jsxs)(t.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(t.CardTitle,{className:"text-sm font-medium",children:"Tá»•ng Xuáº¥t"}),(0,b.jsx)(w.default,{className:"h-4 w-4 text-orange-500"})]}),(0,b.jsxs)(t.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:m(a.totalExportQuantity)}),(0,b.jsxs)("p",{className:"text-xs text-orange-600",title:"GiÃ¡ vá»‘n",children:["Vá»‘n: ",l(a.totalExportAmount)]}),(0,b.jsxs)("p",{className:"text-xs text-orange-800 font-medium",title:"Doanh thu bÃ¡n",children:["BÃ¡n: ",l(a.totalExportSaleAmount)]})]})]}),(0,b.jsxs)(t.Card,{className:"border-l-4 border-l-purple-500",children:[(0,b.jsxs)(t.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(t.CardTitle,{className:"text-sm font-medium",children:"Tá»“n Cuá»‘i Ká»³"}),(0,b.jsx)(x.Archive,{className:"h-4 w-4 text-purple-500"})]}),(0,b.jsxs)(t.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:m(a.totalClosingQuantity)}),(0,b.jsx)("p",{className:"text-xs text-purple-600",children:l(a.totalClosingAmount)})]})]}),(0,b.jsxs)(t.Card,{className:"border-l-4 border-l-blue-500",children:[(0,b.jsxs)(t.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(t.CardTitle,{className:"text-sm font-medium",children:"Sáº£n Pháº©m"}),(0,b.jsx)(u.Package,{className:"h-4 w-4 text-blue-500"})]}),(0,b.jsxs)(t.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:m(a.totalProducts)}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Unique SKU"})]})]})]});var C=a.i(144932),D=a.i(629432),E=a.i(325521),F=a.i(519732),G=a.i(84135),H=a.i(596739),I=a.i(733554);let J=({searchTerm:a,onSearchChange:d,dateRange:e,onDateRangeChange:g,onSearch:h,groupBy:k,onGroupByChange:l,sortField:m,sortDirection:n,onSortChange:o,onExport:p,onRefresh:q,onConfig:r,loading:s,totalRecords:u=0,displayedRecords:v=0,isSearching:w=!1})=>{let[x,y]=(0,c.useState)(e);(0,c.useEffect)(()=>{y(e)},[e]);let z=x.startDate!==e.startDate||x.endDate!==e.endDate||x.periodStartDate!==e.periodStartDate;return(0,b.jsx)(t.Card,{className:"mb-6",children:(0,b.jsxs)(t.CardContent,{className:"pt-6 space-y-4",children:[x.periodStartDate&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm bg-green-50 dark:bg-green-950 border border-green-200 dark:border-green-800 px-4 py-2 rounded-md",children:[(0,b.jsxs)("span",{className:"text-green-700 dark:text-green-300",children:["ðŸ”µ ",(0,b.jsx)("strong",{children:"NgÃ y chá»‘t Ä‘áº§u ká»³:"})," ",new Date(x.periodStartDate).toLocaleDateString("vi-VN")]}),(0,b.jsx)("span",{className:"text-xs text-green-600 dark:text-green-400",children:"(Tá»“n Ä‘áº§u tÃ­nh tá»« 5 nÄƒm trÆ°á»›c)"})]}),u>0&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-blue-50 dark:bg-blue-950 px-4 py-2 rounded-md",children:[(0,b.jsxs)("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:["Tá»•ng sá»‘: ",u.toLocaleString()," báº£n ghi"]}),u!==v&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{children:"â€¢"}),(0,b.jsxs)("span",{className:"text-amber-700 dark:text-amber-300",children:["Hiá»ƒn thá»‹: ",v.toLocaleString()," báº£n ghi"]}),(0,b.jsx)("span",{className:"text-xs",children:"(Xuáº¥t Excel Ä‘á»ƒ xem Ä‘áº§y Ä‘á»§)"})]})]}),(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[w?(0,b.jsx)(I.Loader2,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-primary animate-spin"}):(0,b.jsx)(D.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(i.Input,{value:a,onChange:a=>d(a.target.value),placeholder:"TÃ¬m kiáº¿m theo tÃªn, mÃ£ sáº£n pháº©m, Ä‘Æ¡n vá»‹...",className:"pl-9 transition-all duration-200 focus:ring-2 focus:ring-primary"}),a&&(0,b.jsx)("button",{onClick:()=>d(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",title:"XÃ³a tÃ¬m kiáº¿m",children:"âœ•"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(f.Button,{variant:"outline",size:"default",onClick:r,children:[(0,b.jsx)(E.Settings,{className:"h-4 w-4 mr-2"}),"Cáº¥u HÃ¬nh"]}),(0,b.jsxs)(f.Button,{variant:"outline",size:"default",onClick:q,disabled:s,children:[(0,b.jsx)(F.RefreshCw,{className:`h-4 w-4 mr-2 ${s?"animate-spin":""}`}),"LÃ m Má»›i"]}),(0,b.jsxs)(f.Button,{variant:"default",size:"default",onClick:p,children:[(0,b.jsx)(G.FileSpreadsheet,{className:"h-4 w-4 mr-2"}),"Xuáº¥t Excel"]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(j.Label,{htmlFor:"periodStartDate",className:"flex items-center gap-1",children:["NgÃ y Chá»‘t Äáº§u Ká»³",(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"(optional)"})]}),(0,b.jsx)(i.Input,{id:"periodStartDate",type:"date",value:x.periodStartDate||"",onChange:a=>y({...x,periodStartDate:a.target.value||void 0}),placeholder:"Chá»n ngÃ y chá»‘t",title:"Chá»n ngÃ y chá»‘t Ä‘áº§u ká»³ Ä‘á»ƒ tÃ­nh tá»“n Ä‘áº§u tá»« 5 nÄƒm trÆ°á»›c"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"TÃ­nh tá»“n Ä‘áº§u tá»« giao dá»‹ch 5 nÄƒm trÆ°á»›c"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"startDate",children:"Tá»« NgÃ y"}),(0,b.jsx)(i.Input,{id:"startDate",type:"date",value:x.startDate,onChange:a=>y({...x,startDate:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"endDate",children:"Äáº¿n NgÃ y"}),(0,b.jsx)(i.Input,{id:"endDate",type:"date",value:x.endDate,onChange:a=>y({...x,endDate:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{className:"opacity-0",children:"Action"}),(0,b.jsxs)(f.Button,{variant:z?"default":"outline",size:"default",onClick:()=>{g(x),h()},disabled:s,className:"w-full",children:[(0,b.jsx)(D.Search,{className:"h-4 w-4 mr-2"}),z?"TÃ¬m kiáº¿m":"ÄÃ£ cáº­p nháº­t"]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{htmlFor:"groupBy",children:"NhÃ³m Theo"}),(0,b.jsxs)(C.Select,{value:k,onValueChange:a=>l(a),children:[(0,b.jsx)(C.SelectTrigger,{id:"groupBy",children:(0,b.jsx)(C.SelectValue,{})}),(0,b.jsxs)(C.SelectContent,{children:[(0,b.jsx)(C.SelectItem,{value:"ma",children:"MÃ£ Sáº£n Pháº©m"}),(0,b.jsx)(C.SelectItem,{value:"ten2",children:"TÃªn Chuáº©n HÃ³a"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(j.Label,{children:"Sáº¯p Xáº¿p"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(C.Select,{value:m,onValueChange:a=>o(a,n),children:[(0,b.jsx)(C.SelectTrigger,{className:"flex-1",children:(0,b.jsx)(C.SelectValue,{})}),(0,b.jsxs)(C.SelectContent,{children:[(0,b.jsx)(C.SelectItem,{value:"date",children:"NgÃ y"}),(0,b.jsx)(C.SelectItem,{value:"productName",children:"TÃªn SP"}),(0,b.jsx)(C.SelectItem,{value:"closingQuantity",children:"SL Tá»“n"}),(0,b.jsx)(C.SelectItem,{value:"closingAmount",children:"TT Tá»“n"})]})]}),(0,b.jsx)(f.Button,{variant:"outline",size:"icon",onClick:()=>o(m,"asc"===n?"desc":"asc"),title:"asc"===n?"TÄƒng dáº§n":"Giáº£m dáº§n",children:(0,b.jsx)(H.ArrowUpDown,{className:"h-4 w-4"})})]})]})]})]})})};var K=a.i(920283);let L=({rows:a,currentPage:c,itemsPerPage:d,loading:e,totalRecords:f=0,isLimited:g=!1,searchTerm:h="",isSearching:i=!1})=>{let j=(c-1)*d,k=Math.min(j+d,a.length),o=a.slice(j,k);console.log("rows",a),console.log("ðŸ“‹ InventoryTable render:",{totalRows:a.length,displayRows:o.length,currentPage:c,itemsPerPage:d,startIndex:j,endIndex:k,loading:e,searchTerm:h,isSearching:i});let p=(a,c)=>{if(!a||!c)return a||"-";let d=a.toLowerCase(),e=c.toLowerCase(),f=d.indexOf(e);if(-1===f)return a;let g=a.slice(0,f),h=a.slice(f,f+c.length),i=a.slice(f+c.length);return(0,b.jsxs)(b.Fragment,{children:[g,(0,b.jsx)("mark",{className:"bg-yellow-200 dark:bg-yellow-800 font-semibold",children:h}),i]})};return e?(0,b.jsx)(t.Card,{children:(0,b.jsx)(t.CardContent,{className:"p-8",children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center text-center",children:[(0,b.jsx)(I.Loader2,{className:"h-8 w-8 animate-spin text-primary mb-2"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Äang táº£i dá»¯ liá»‡u..."})]})})}):0===a.length?(0,b.jsx)(t.Card,{children:(0,b.jsx)(t.CardContent,{className:"p-8",children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center text-center",children:[(0,b.jsx)(u.Package,{className:"h-12 w-12 text-muted-foreground mb-2"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ hiá»ƒn thá»‹"})]})})}):(0,b.jsxs)(t.Card,{children:[g&&f>a.length&&(0,b.jsx)("div",{className:"bg-amber-50 dark:bg-amber-950 border-b border-amber-200 dark:border-amber-800 px-4 py-3",children:(0,b.jsxs)("p",{className:"text-sm text-amber-800 dark:text-amber-200",children:["âš ï¸ Hiá»ƒn thá»‹ ",a.length.toLocaleString()," / ",f.toLocaleString()," báº£n ghi Ä‘á»ƒ tá»‘i Æ°u hiá»‡u suáº¥t.",(0,b.jsx)("span",{className:"font-medium",children:' Sá»­ dá»¥ng "Xuáº¥t Excel" Ä‘á»ƒ xem toÃ n bá»™ dá»¯ liá»‡u.'})]})}),h&&(0,b.jsx)("div",{className:"bg-blue-50 dark:bg-blue-950 border-b border-blue-200 dark:border-blue-800 px-4 py-3",children:(0,b.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["ðŸ” TÃ¬m kiáº¿m: ",(0,b.jsxs)("span",{className:"font-semibold",children:['"',h,'"']})," -",i?(0,b.jsx)("span",{className:"ml-2 italic",children:"Äang tÃ¬m kiáº¿m..."}):(0,b.jsxs)("span",{className:"ml-2",children:["TÃ¬m tháº¥y ",a.length.toLocaleString()," káº¿t quáº£"]})]})}),(0,b.jsx)(t.CardContent,{className:"p-0",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(K.Table,{children:[(0,b.jsxs)(K.TableHeader,{children:[(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableHead,{className:"w-[60px]",children:"STT"}),(0,b.jsx)(K.TableHead,{className:"w-[120px]",children:"NgÃ y"}),(0,b.jsx)(K.TableHead,{className:"min-w-[250px]",children:"TÃªn Sáº£n Pháº©m"}),(0,b.jsx)(K.TableHead,{className:"min-w-[250px]",children:"TÃªn Gá»‘c (HÃ³a ÄÆ¡n)"}),(0,b.jsx)(K.TableHead,{className:"w-[120px]",children:"MÃ£ SP"}),(0,b.jsx)(K.TableHead,{className:"w-[80px]",children:"ÄVT"}),(0,b.jsx)(K.TableHead,{colSpan:2,className:"text-center bg-blue-50",children:"Tá»“n Äáº§u"}),(0,b.jsx)(K.TableHead,{colSpan:2,className:"text-center bg-green-50",children:"Nháº­p"}),(0,b.jsx)(K.TableHead,{colSpan:5,className:"text-center bg-orange-50",children:"Xuáº¥t"}),(0,b.jsx)(K.TableHead,{colSpan:2,className:"text-center bg-purple-50",children:"Tá»“n Cuá»‘i"})]}),(0,b.jsxs)(K.TableRow,{children:[(0,b.jsx)(K.TableHead,{colSpan:6}),(0,b.jsx)(K.TableHead,{className:"text-right bg-blue-50",children:"SL"}),(0,b.jsx)(K.TableHead,{className:"text-right bg-blue-50",children:"ThÃ nh Tiá»n"}),(0,b.jsx)(K.TableHead,{className:"text-right bg-green-50",children:"SL"}),(0,b.jsx)(K.TableHead,{className:"text-right bg-green-50",children:"ThÃ nh Tiá»n"}),(0,b.jsx)(K.TableHead,{className:"text-right bg-orange-50",children:"SL"}),(0,b.jsx)(K.TableHead,{className:"text-right bg-orange-50",children:"GiÃ¡ Vá»‘n"}),(0,b.jsx)(K.TableHead,{className:"text-right bg-orange-50",children:"TT Vá»‘n"}),(0,b.jsx)(K.TableHead,{className:"text-right bg-orange-50",children:"GiÃ¡ BÃ¡n"}),(0,b.jsx)(K.TableHead,{className:"text-right bg-orange-50",children:"TT BÃ¡n"}),(0,b.jsx)(K.TableHead,{className:"text-right bg-purple-50",children:"SL"}),(0,b.jsx)(K.TableHead,{className:"text-right bg-purple-50",children:"ThÃ nh Tiá»n"})]})]}),(0,b.jsx)(K.TableBody,{children:o.map((a,c)=>(0,b.jsxs)(K.TableRow,{className:"animate-in fade-in duration-200",style:{animationDelay:`${20*c}ms`},children:[(0,b.jsx)(K.TableCell,{className:"font-medium",children:j+c+1}),(0,b.jsx)(K.TableCell,{className:"whitespace-nowrap",children:n(a.date)}),(0,b.jsx)(K.TableCell,{className:"font-medium",children:p(a.productName,h)}),(0,b.jsx)(K.TableCell,{className:"text-muted-foreground text-sm",children:p(a.originalName,h)}),(0,b.jsx)(K.TableCell,{className:"text-muted-foreground",children:p(a.productCode,h)}),(0,b.jsx)(K.TableCell,{className:"text-muted-foreground",children:p(a.unit,h)}),(0,b.jsx)(K.TableCell,{className:"text-right bg-blue-50",children:m(a.openingQuantity)}),(0,b.jsx)(K.TableCell,{className:"text-right text-blue-600 bg-blue-50",children:l(a.openingAmount)}),(0,b.jsx)(K.TableCell,{className:"text-right bg-green-50",children:m(a.importQuantity)}),(0,b.jsx)(K.TableCell,{className:"text-right text-green-600 bg-green-50",children:l(a.importAmount)}),(0,b.jsx)(K.TableCell,{className:"text-right bg-orange-50",children:m(a.exportQuantity)}),(0,b.jsx)(K.TableCell,{className:"text-right text-orange-600 bg-orange-50",title:"GiÃ¡ vá»‘n bÃ¬nh quÃ¢n gia quyá»n",children:l(a.exportCostPrice)}),(0,b.jsx)(K.TableCell,{className:"text-right text-orange-600 bg-orange-50",title:"ThÃ nh tiá»n vá»‘n",children:l(a.exportAmount)}),(0,b.jsx)(K.TableCell,{className:"text-right text-orange-700 bg-orange-50",title:"GiÃ¡ bÃ¡n (tá»« Ä‘Æ¡n hÃ ng)",children:l(a.exportSalePrice)}),(0,b.jsx)(K.TableCell,{className:"text-right text-orange-800 font-medium bg-orange-50",title:"ThÃ nh tiá»n bÃ¡n",children:l(a.exportSaleAmount)}),(0,b.jsx)(K.TableCell,{className:"text-right font-semibold bg-purple-50",children:m(a.closingQuantity)}),(0,b.jsx)(K.TableCell,{className:"text-right font-semibold text-purple-600 bg-purple-50",children:l(a.closingAmount)})]},`${a.productName}-${a.date}-${c}`))})]})})})]})};var M=a.i(510071),N=a.i(300827);let O=({currentPage:a,totalPages:c,totalItems:d,itemsPerPage:e,onPageChange:g,canGoPrev:h,canGoNext:i,totalRecords:j=0,isLimited:k=!1})=>{let l=Math.min(a*e,d);return 0===d?null:(0,b.jsxs)("div",{className:"flex items-center justify-between px-2 py-4",children:[(0,b.jsxs)("div",{className:"flex-1 text-sm text-muted-foreground",children:["Hiá»ƒn thá»‹ ",(0,b.jsx)("span",{className:"font-medium",children:(a-1)*e+1})," Ä‘áº¿n"," ",(0,b.jsx)("span",{className:"font-medium",children:l})," trong tá»•ng sá»‘"," ",(0,b.jsx)("span",{className:"font-medium",children:d})," káº¿t quáº£",k&&j>d&&(0,b.jsxs)("span",{className:"ml-2 text-amber-600 dark:text-amber-400",children:["(",j.toLocaleString()," tá»•ng - giá»›i háº¡n hiá»ƒn thá»‹)"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>g(a-1),disabled:!h,children:[(0,b.jsx)(M.ChevronLeft,{className:"h-4 w-4 mr-1"}),"TrÆ°á»›c"]}),(0,b.jsx)("div",{className:"hidden md:flex items-center gap-1",children:(()=>{let b=[];if(c<=5)for(let a=1;a<=c;a++)b.push(a);else{b.push(1),a>3&&b.push("...");let d=Math.max(2,a-1),e=Math.min(c-1,a+1);for(let a=d;a<=e;a++)b.push(a);a<c-2&&b.push("..."),b.push(c)}return b})().map((c,d)=>"..."===c?(0,b.jsx)("span",{className:"px-2",children:"..."},`ellipsis-${d}`):(0,b.jsx)(f.Button,{variant:a===c?"default":"outline",size:"sm",onClick:()=>g(c),className:"w-9",children:c},c))}),(0,b.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>g(a+1),disabled:!i,children:["Sau",(0,b.jsx)(N.ChevronRight,{className:"h-4 w-4 ml-1"})]})]})]})};var P=a.i(624461);function Q(){let a,h,[i,j]=(0,c.useState)(null),[l,m]=(0,c.useState)(!1),[p,t]=(0,c.useState)((a=new Date,(h=new Date).setDate(h.getDate()-30),{startDate:o(h),endDate:o(a)})),[u,v]=(0,c.useState)(""),w=function(a,b=300){let[d,e]=(0,c.useState)(a);return(0,c.useEffect)(()=>{let c=setTimeout(()=>{e(a)},b);return()=>{clearTimeout(c)}},[a,b]),d}(u,300),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)("ma"),[C,D]=(0,c.useState)("date"),[E,F]=(0,c.useState)("desc"),[G]=(0,c.useState)(50),{invoices:H,details:I,products:K,loading:M,error:N,isReady:Q,refetch:R}=(()=>{let[a,b]=(0,c.useState)(!1),[d,e]=(0,c.useState)(!1),[f,g]=(0,c.useState)(!1),{data:h,loading:i,error:j,refetch:k}=(0,P.useDynamicQuery)("GET_ALL","ext_listhoadon",{fetchPolicy:"network-only"});console.log("invoicesData",h);let{data:l,loading:m,error:n,refetch:o}=(0,P.useDynamicQuery)("GET_ALL","ext_detailhoadon",{fetchPolicy:"network-only"}),{data:p,loading:q,error:r,refetch:s}=(0,P.useDynamicQuery)("GET_ALL","ext_sanphamhoadon",{fetchPolicy:"network-only"}),t=h?.getext_listhoadons||[],u=l?.getext_detailhoadons||[],v=p?.getext_sanphamhoadons||[];(0,c.useEffect)(()=>{t.length>0&&!d&&(console.log("ðŸ“‹ Sample invoice:",t[0]),console.log("ðŸ“‹ Invoice fields:",Object.keys(t[0])),e(!0)),u.length>0&&!f&&(console.log("ðŸ“„ Sample detail:",u[0]),console.log("ðŸ“„ Detail fields:",Object.keys(u[0])),g(!0))},[t,u,d,f]),(0,c.useEffect)(()=>{i||m||q||b(!0)},[i,m,q]);let w=async()=>{await Promise.all([k(),o(),s()])};return{invoices:t,details:u,products:v,loading:{invoices:i,details:m,products:q,any:i||m||q},error:{invoices:j?.message||null,details:n?.message||null,products:r?.message||null,any:j||n||r},isReady:a,refetch:w}})();(0,c.useEffect)(()=>{m(!0)},[]);let S=(({rows:a,searchTerm:b,sortField:d,sortDirection:e})=>(0,c.useMemo)(()=>{let c=performance.now(),f=[...a];if(b){let d=b.toLowerCase().trim();f=f.filter(a=>a.productName?.toLowerCase().includes(d)||a.productCode?.toLowerCase().includes(d)||a.unit?.toLowerCase().includes(d));let e=performance.now();console.log(`ðŸ” Search completed in ${(e-c).toFixed(2)}ms - Found ${f.length}/${a.length} records`)}return f.sort((a,b)=>{let c,f;switch(d){case"date":c=new Date(a.date).getTime(),f=new Date(b.date).getTime();break;case"productName":c=(a.productName||"").toLowerCase(),f=(b.productName||"").toLowerCase();break;case"closingQuantity":c=a.closingQuantity||0,f=b.closingQuantity||0;break;case"closingAmount":c=a.closingAmount||0,f=b.closingAmount||0;break;default:c=0,f=0}let g=c<f?-1:+(c>f);return"asc"===e?g:-g}),f},[a,b,d,e]))({rows:(0,c.useMemo)(()=>{let a;if(!i||!Q)return console.log("âš ï¸ Inventory calculation skipped:",{hasUserConfig:!!i,isReady:Q,userConfig:i}),[];console.log("ðŸ“Š Calculating inventory with:",{invoicesCount:H.length,detailsCount:I.length,productsCount:K.length,userMST:i.mst,groupBy:z,dateRange:p,periodStartDate:p.periodStartDate,sampleInvoice:H[0],sampleDetail:I[0],sampleProduct:K[0]});let b=i.mst.trim().toLowerCase(),c=H.filter(a=>a.nbmst?.trim().toLowerCase()===b),d=H.filter(a=>a.nmmst?.trim().toLowerCase()===b);if(console.log("ðŸ” MST Matching Debug:",{userMST:i.mst,userMSTLower:b,matchingSalesCount:c.length,matchingPurchasesCount:d.length,sampleSaleInvoice:c[0],samplePurchaseInvoice:d[0],firstInvoiceNbmst:H[0]?.nbmst,firstInvoiceNmmst:H[0]?.nmmst}),p.periodStartDate){var e,f;let b,c,d,g,h;console.log("ðŸ”µ Calculating opening balance from period start:",p.periodStartDate),e=i.mst,console.log("ðŸ”µ calculateOpeningBalance START:",{periodStartDate:f=p.periodStartDate}),(c=new Date(b=new Date(f))).setFullYear(b.getFullYear()-5),console.log("ðŸ“… Date range for opening balance:",{from:c.toISOString().split("T")[0],to:f}),(d=new Date(b)).setDate(d.getDate()-1),g=q(H,I,K,e,z,c.toISOString().split("T")[0],d.toISOString().split("T")[0]),h=new Map,g.forEach(a=>{let b=h.get(a.productName);b?(b.quantity+=a.closingQuantity,b.amount+=a.closingAmount):h.set(a.productName,{productName:a.productName,quantity:a.closingQuantity,amount:a.closingAmount})}),console.log("âœ… Opening balance calculated for",h.size,"products"),h.size>0&&console.log("Sample opening balances:",Array.from(h.values()).slice(0,3)),console.log("âœ… Opening balance calculated for",(a=h).size,"products")}let g=q(H,I,K,i.mst,z,p.startDate,p.endDate,a);return console.log("âœ… Inventory rows calculated:",g.length),g.length>0?console.log("Sample result rows (first 3):",g.slice(0,3)):console.warn("âš ï¸ No inventory rows generated! Check MST matching logic."),g},[H,I,K,i,z,p,Q]),searchTerm:w,sortField:C,sortDirection:E});(0,c.useEffect)(()=>{u!==w?y(!0):y(!1)},[u,w]),console.log("ðŸ” Filtered rows:",S.length,{searchTerm:w,sortField:C,sortDirection:E});let T=S.length,U=S.slice(0,100),V=T>100,W=(0,c.useMemo)(()=>s(U),[U]),{currentPage:X,totalPages:Y,startIndex:Z,endIndex:$,goToPage:_,nextPage:aa,prevPage:ab,canGoNext:ac,canGoPrev:ad}=(({totalItems:a,itemsPerPage:b})=>{let[d,e]=(0,c.useState)(1),f=Math.ceil(a/b),g=(d-1)*b,h=Math.min(g+b,a);return(0,c.useEffect)(()=>{d>f&&f>0&&e(1)},[d,f]),{currentPage:d,totalPages:f,startIndex:g,endIndex:h,goToPage:a=>{a>=1&&a<=f&&e(a)},nextPage:()=>{d<f&&e(a=>a+1)},prevPage:()=>{d>1&&e(a=>a-1)},canGoNext:d<f,canGoPrev:d>1}})({totalItems:U.length,itemsPerPage:G}),ae=async()=>{try{await R(),d.toast.success("ÄÃ£ lÃ m má»›i dá»¯ liá»‡u")}catch(a){console.error("Refresh error:",a),d.toast.error("Lá»—i khi lÃ m má»›i dá»¯ liá»‡u")}};(0,c.useEffect)(()=>{N.any&&(N.invoices&&d.toast.error(`Lá»—i táº£i h\xf3a Ä‘Æ¡n: ${N.invoices}`),N.details&&d.toast.error(`Lá»—i táº£i chi tiáº¿t: ${N.details}`),N.products&&d.toast.error(`Lá»—i táº£i sáº£n pháº©m: ${N.products}`))},[N]);let af=!i&&!l;return(0,b.jsxs)("div",{className:"container mx-auto px-4 py-6 space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"BÃ¡o CÃ¡o Xuáº¥t Nháº­p Tá»“n"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"Quáº£n lÃ½ vÃ  theo dÃµi xuáº¥t nháº­p tá»“n kho theo hÃ³a Ä‘Æ¡n"}),i&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["MST: ",(0,b.jsx)("span",{className:"font-medium",children:i.mst}),i.companyName&&` - ${i.companyName}`]})]}),af&&(0,b.jsxs)(e.Alert,{className:"border-yellow-500 bg-yellow-50",children:[(0,b.jsx)(g.AlertCircle,{className:"h-4 w-4 text-yellow-600"}),(0,b.jsxs)(e.AlertDescription,{className:"text-yellow-700",children:[(0,b.jsx)("span",{className:"font-medium",children:"Cáº§n cáº¥u hÃ¬nh MST:"})," Vui lÃ²ng cáº¥u hÃ¬nh mÃ£ sá»‘ thuáº¿ (MST) Ä‘á»ƒ phÃ¢n loáº¡i hÃ³a Ä‘Æ¡n bÃ¡n/mua."," ",(0,b.jsx)(f.Button,{variant:"link",className:"h-auto p-0 text-yellow-800 underline",onClick:()=>m(!0),children:"Cáº¥u hÃ¬nh ngay"})]})]}),(0,b.jsx)(k,{isOpen:l,currentConfig:i,onSave:a=>{j(a),m(!1),d.toast.success("ÄÃ£ lÆ°u cáº¥u hÃ¬nh MST")},onClose:()=>m(!1)}),(0,b.jsx)(B,{summary:W,loading:M.any}),(0,b.jsx)(J,{searchTerm:u,onSearchChange:v,dateRange:p,onDateRangeChange:t,onSearch:()=>{d.toast.info(`T\xecm tháº¥y ${T} báº£n ghi${V?`, hiá»ƒn thá»‹ 100 Ä‘áº§u ti\xean`:""}`)},groupBy:z,onGroupByChange:A,sortField:C,sortDirection:E,onSortChange:(a,b)=>{D(a),F(b)},onExport:()=>{if(!i){d.toast.error("Vui lÃ²ng cáº¥u hÃ¬nh MST trÆ°á»›c"),m(!0);return}if(0===S.length)return void d.toast.error("KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ xuáº¥t");try{var a;let b,c,e,f,g,h=s(S);a=i.companyName||"CÃ´ng ty",b=r.utils.book_new(),(c=[]).push(["BÃO CÃO XUáº¤T NHáº¬P Tá»’N"]),c.push([a]),c.push([`Tá»« ng\xe0y: ${n(p.startDate)} - Äáº¿n ng\xe0y: ${n(p.endDate)}`]),c.push([]),c.push(["NgÃ y","TÃªn Sáº£n Pháº©m","MÃ£ SP","ÄVT","SL Tá»“n Äáº§u","TT Tá»“n Äáº§u","SL Nháº­p","TT Nháº­p","SL Xuáº¥t","GiÃ¡ Vá»‘n","TT Vá»‘n","GiÃ¡ BÃ¡n","TT BÃ¡n","SL Tá»“n Cuá»‘i","TT Tá»“n Cuá»‘i"]),S.forEach(a=>{c.push([n(a.date),a.productName,a.productCode||"",a.unit||"",a.openingQuantity,a.openingAmount,a.importQuantity,a.importAmount,a.exportQuantity,a.exportCostPrice,a.exportAmount,a.exportSalePrice,a.exportSaleAmount,a.closingQuantity,a.closingAmount])}),c.push([]),c.push(["Tá»”NG Há»¢P"]),c.push(["Tá»•ng sá»‘ sáº£n pháº©m:",h.totalProducts]),c.push(["Tá»•ng SL nháº­p:",h.totalImportQuantity]),c.push(["Tá»•ng TT nháº­p:",h.totalImportAmount]),c.push(["Tá»•ng SL xuáº¥t:",h.totalExportQuantity]),c.push(["Tá»•ng TT vá»‘n:",h.totalExportAmount]),c.push(["Tá»•ng TT bÃ¡n:",h.totalExportSaleAmount]),c.push(["Tá»•ng SL tá»“n cuá»‘i:",h.totalClosingQuantity]),c.push(["Tá»•ng TT tá»“n cuá»‘i:",h.totalClosingAmount]),(e=r.utils.aoa_to_sheet(c))["!cols"]=[{wch:12},{wch:40},{wch:15},{wch:10},{wch:12},{wch:15},{wch:12},{wch:15},{wch:12},{wch:15},{wch:15},{wch:15},{wch:15},{wch:12},{wch:15}],e["!merges"]=[{s:{r:0,c:0},e:{r:0,c:14}},{s:{r:1,c:0},e:{r:1,c:14}},{s:{r:2,c:0},e:{r:2,c:14}}],r.utils.book_append_sheet(b,e,"Xuáº¥t Nháº­p Tá»“n"),f=new Date().toISOString().split("T")[0],g=`XuatNhapTon_${f}.xlsx`,r.writeFile(b,g),d.toast.success(`Ä\xe3 xuáº¥t ${S.length.toLocaleString()} báº£n ghi ra Excel`)}catch(a){console.error("Export error:",a),d.toast.error("Lá»—i khi xuáº¥t file Excel")}},onRefresh:ae,onConfig:()=>m(!0),loading:M.any,totalRecords:T,displayedRecords:U.length,isSearching:x}),(0,b.jsx)(L,{rows:U,currentPage:X,itemsPerPage:G,loading:M.any,totalRecords:T,isLimited:V,searchTerm:w,isSearching:x}),(0,b.jsx)(O,{currentPage:X,totalPages:Y,totalItems:U.length,itemsPerPage:G,onPageChange:_,canGoPrev:ad,canGoNext:ac,totalRecords:T,isLimited:V})]})}a.s(["default",()=>Q],106232)}];

//# sourceMappingURL=frontend_src_app_ketoan_xuatnhapton_page_tsx_1822f9f1._.js.map