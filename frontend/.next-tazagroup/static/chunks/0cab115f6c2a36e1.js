(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,495043,e=>{"use strict";var s=e.i(217696);e.s(["MoreVertical",()=>s.default])},495280,e=>{"use strict";var s=e.i(46213);e.s(["MessageSquare",()=>s.default])},825098,e=>{"use strict";var s=e.i(555234);e.s(["Mail",()=>s.default])},99529,e=>{"use strict";var s=e.i(128832);e.s(["Phone",()=>s.default])},581329,e=>{"use strict";var s=e.i(856584);e.s(["Facebook",()=>s.default])},608153,e=>{"use strict";var s=e.i(44990),t=e.i(403055),a=e.i(292706),r=e.i(533614),i=e.i(429105),l=e.i(950988),n=e.i(123959),c=e.i(216749),o=e.i(495280),d=e.i(850384),x=e.i(495043),m=e.i(451177),h=e.i(576873),u=e.i(99529),g=e.i(825098),b=e.i(796283),p=e.i(581329),N=e.i(36455);function f(){let{user:e}=(0,n.useAuth)(),[f,v]=(0,t.useState)(null),[j,y]=(0,t.useState)([]),[w,T]=(0,t.useState)(""),[A,E]=(0,t.useState)(null),[S,C]=(0,t.useState)("all"),[I,k]=(0,t.useState)(""),[M,O]=(0,t.useState)({total:0,active:0,waiting:0,avgResponseTime:0}),{data:P,refetch:G}=(0,i.useQuery)(c.GET_SUPPORT_CONVERSATIONS,{variables:{where:"all"!==S?{status:S.toUpperCase()}:void 0,take:50}}),{data:_}=(0,i.useQuery)(c.GET_SUPPORT_CONVERSATION,{variables:{id:f?.id},skip:!f}),[R]=(0,l.useMutation)(c.SEND_SUPPORT_MESSAGE),[U]=(0,l.useMutation)(c.ASSIGN_CONVERSATION_TO_AGENT),[K]=(0,l.useMutation)(c.UPDATE_CONVERSATION_STATUS),V=P?.supportConversations||[];(0,t.useEffect)(()=>{let e=V.length;O({total:e,active:V.filter(e=>"ACTIVE"===e.status).length,waiting:V.filter(e=>"WAITING"===e.status).length,avgResponseTime:45})},[V]),(0,t.useEffect)(()=>{_?.supportConversation?.messages&&y(_.supportConversation.messages)},[_]),(0,t.useEffect)(()=>{let e=(0,r.io)("http://localhost:3001/support-chat");return e.on("connect",()=>{console.log("Admin connected to support chat")}),e.on("new_conversation",()=>{G()}),e.on("new_message",e=>{f&&e.conversationId===f.id&&y(s=>[...s,e]),G()}),E(e),()=>{e.disconnect()}},[f,G]),(0,t.useEffect)(()=>{G()},[S,G]);let $=async()=>{if(w.trim()&&f&&e){T("");try{await R({variables:{input:{conversationId:f.id,content:w,senderType:"AGENT",senderId:e.id,senderName:e.username||"Agent"}}}),A&&A.emit("send_message",{conversationId:f.id,content:w,senderType:"AGENT",senderId:e.id,senderName:e.username||"Agent"})}catch(e){console.error("Error sending message:",e),T(w)}}},D=async()=>{if(f&&e)try{await U({variables:{conversationId:f.id,agentId:e.id}}),G()}catch(e){console.error("Error assigning conversation:",e)}};return(0,s.jsxs)("div",{className:"h-screen bg-gray-50 flex flex-col",children:[(0,s.jsxs)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Hỗ trợ khách hàng"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Quản lý tất cả hội thoại"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:M.total}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Tổng số"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:M.active}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Đang xử lý"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:M.waiting}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Chờ xử lý"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[M.avgResponseTime,"s"]}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Thời gian phản hồi"})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4 mt-4",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(d.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,s.jsx)("input",{type:"text",value:I,onChange:e=>k(e.target.value),placeholder:"Tìm kiếm khách hàng...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>C("all"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${"all"===S?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Tất cả"}),(0,s.jsx)("button",{onClick:()=>C("waiting"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${"waiting"===S?"bg-yellow-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Chờ xử lý"}),(0,s.jsx)("button",{onClick:()=>C("active"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${"active"===S?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"Đang xử lý"})]})]})]}),(0,s.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,s.jsx)("div",{className:"w-96 bg-white border-r border-gray-200 overflow-y-auto",children:V.map(t=>(0,s.jsx)(a.motion.div,{whileHover:{backgroundColor:"#f9fafb"},onClick:()=>{v(t),A&&e&&A.emit("join_conversation",{conversationId:t.id,userId:e.id})},className:`p-4 border-b border-gray-200 cursor-pointer transition-colors ${f?.id===t.id?"bg-blue-50":""}`,children:(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold flex-shrink-0",children:t.customerName?.[0]?.toUpperCase()||"K"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 truncate",children:t.customerName||"Khách hàng"}),(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(e=>{switch(e){case"FACEBOOK":return(0,s.jsx)(p.Facebook,{className:"w-4 h-4"});case"ZALO":return(0,s.jsx)(N.MessageCircle,{className:"w-4 h-4"});default:return(0,s.jsx)(o.MessageSquare,{className:"w-4 h-4"})}})(t.platform),(0,s.jsx)("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${(e=>{switch(e){case"URGENT":return"text-red-600 bg-red-100";case"HIGH":return"text-orange-600 bg-orange-100";case"MEDIUM":return"text-yellow-600 bg-yellow-100";default:return"text-gray-600 bg-gray-100"}})(t.priority)}`,children:t.priority})]})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 truncate",children:t.lastMessagePreview||"Chưa có tin nhắn"}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,s.jsx)("span",{className:"text-xs text-gray-400",children:t.lastMessageAt?new Date(t.lastMessageAt).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}):""}),t.assignedAgent&&(0,s.jsx)("span",{className:"text-xs text-blue-600",children:t.assignedAgent.username})]})]})]})},t.id))}),f?(0,s.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,s.jsx)("div",{className:"bg-white border-b border-gray-200 p-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold",children:f.customerName?.[0]?.toUpperCase()||"K"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:f.customerName||"Khách hàng"}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[f.customerEmail&&(0,s.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,s.jsx)(g.Mail,{className:"w-3 h-3"}),(0,s.jsx)("span",{children:f.customerEmail})]}),f.customerPhone&&(0,s.jsxs)("span",{className:"flex items-center space-x-1",children:[(0,s.jsx)(u.Phone,{className:"w-3 h-3"}),(0,s.jsx)("span",{children:f.customerPhone})]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:D,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Nhận hội thoại"}),(0,s.jsx)("button",{className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,s.jsx)(x.MoreVertical,{className:"w-5 h-5 text-gray-600"})})]})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:j.map(e=>(0,s.jsx)("div",{className:`flex ${"AGENT"===e.senderType?"justify-end":"justify-start"}`,children:(0,s.jsxs)("div",{className:`max-w-[70%] rounded-2xl px-4 py-2.5 ${"AGENT"===e.senderType?"bg-blue-600 text-white rounded-br-sm":"bg-white text-gray-900 rounded-bl-sm shadow-sm"}`,children:["AGENT"!==e.senderType&&e.isAIGenerated&&(0,s.jsxs)("div",{className:"flex items-center space-x-1 mb-1",children:[(0,s.jsx)(b.Bot,{className:"w-3 h-3 text-blue-500"}),(0,s.jsx)("span",{className:"text-xs font-medium text-gray-600",children:"AI"})]}),(0,s.jsx)("p",{className:"text-sm leading-relaxed",children:e.content}),(0,s.jsx)("span",{className:`text-xs block mt-1 ${"AGENT"===e.senderType?"text-blue-100":"text-gray-400"}`,children:new Date(e.sentAt).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})})]})},e.id))}),(0,s.jsx)("div",{className:"bg-white border-t border-gray-200 p-4",children:(0,s.jsxs)("div",{className:"flex items-end space-x-2",children:[(0,s.jsx)("button",{className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,s.jsx)(h.Paperclip,{className:"w-5 h-5 text-gray-500"})}),(0,s.jsx)("textarea",{value:w,onChange:e=>T(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),$())},placeholder:"Nhập tin nhắn...",rows:1,className:"flex-1 px-4 py-2.5 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none resize-none"}),(0,s.jsx)("button",{onClick:$,disabled:!w.trim(),className:"p-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,s.jsx)(m.Send,{className:"w-5 h-5"})})]})})]}):(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(o.MessageSquare,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Chọn một hội thoại để bắt đầu"})]})})]})]})}e.s(["default",()=>f])}]);