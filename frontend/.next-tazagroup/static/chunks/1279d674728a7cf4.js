(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,217554,e=>{"use strict";var s=e.i(44990),a=e.i(403055),i=e.i(130775),r=e.i(123959),t=e.i(996517),l=e.i(771564),n=e.i(68645);function c({activeTab:e,onTabChange:a}){return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Báº£ng Äiá»u Khiá»ƒn Quáº£n Trá»‹"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2",children:"Quáº£n lÃ½ ngÆ°á»i dÃ¹ng, vai trÃ² vÃ  quyá»n háº¡n trÃªn toÃ n há»‡ thá»‘ng"})]})}),(0,s.jsx)(t.Tabs,{value:e,onValueChange:e=>a(e),children:(0,s.jsxs)(t.TabsList,{className:"grid w-full max-w-md grid-cols-2",children:[(0,s.jsxs)(t.TabsTrigger,{value:"users",className:"gap-2",children:[(0,s.jsx)(l.Users,{className:"w-4 h-4"}),"User Management"]}),(0,s.jsxs)(t.TabsTrigger,{value:"rbac",className:"gap-2",children:[(0,s.jsx)(n.Shield,{className:"w-4 h-4"}),"RBAC & Permissions"]})]})})]})}var d=e.i(429105),o=e.i(950988),m=e.i(529590),h=e.i(984804),x=e.i(574375);h.gql`
  query SearchUsers($input: UserSearchInput!) {
    searchUsers(input: $input) {
      users {
        ...UserFragment
      }
      total
      page
      size
      totalPages
    }
  }
  ${x.USER_FRAGMENT}
`;let u=h.gql`
  query GetUserStats {
    getUserStats {
      totalUsers
      activeUsers
      verifiedUsers
      newUsersThisMonth
      adminUsers
      regularUsers
      guestUsers
    }
  }
`;h.gql`
  query GetUserById($id: String!) {
    getUserById(id: $id) {
      ...UserFragment
    }
  }
  ${x.USER_FRAGMENT}
`;let p=h.gql`
  query GetAllUsers {
    getUsers {
      ...UserFragment
    }
  }
  ${x.USER_FRAGMENT}
`,j=h.gql`
  mutation AdminUpdateUser($id: String!, $input: AdminUpdateUserInput!) {
    adminUpdateUser(id: $id, input: $input) {
      ...UserFragment
    }
  }
  ${x.USER_FRAGMENT}
`,g=h.gql`
  mutation BulkUserAction($input: BulkUserActionInput!) {
    bulkUserAction(input: $input) {
      success
      affectedCount
      errors
      message
    }
  }
`,N=h.gql`
  mutation AdminCreateUser($input: AdminCreateUserInput!) {
    adminCreateUser(input: $input) {
      ...UserFragment
    }
  }
  ${x.USER_FRAGMENT}
`;h.gql`
  mutation DeleteUser($id: String!) {
    deleteUser(id: $id)
  }
`,h.gql`
  mutation UpdateUser($id: String!, $input: UpdateUserInput!) {
    updateUser(id: $id, input: $input) {
      ...UserFragment
    }
  }
  ${x.USER_FRAGMENT}
`;var v=e.i(850816);function f(e={},s){var i,r,t,l;let n=(0,a.useMemo)(()=>{let s={};return e.search&&e.search.trim()&&(s.OR=[{email:{contains:e.search,mode:"insensitive"}},{username:{contains:e.search,mode:"insensitive"}},{firstName:{contains:e.search,mode:"insensitive"}},{lastName:{contains:e.search,mode:"insensitive"}}]),e.roleType&&(s.roleType={equals:e.roleType}),void 0!==e.isActive&&(s.isActive={equals:e.isActive}),void 0!==e.isVerified&&(s.isVerified={equals:e.isVerified}),e.createdAfter&&(s.createdAt={...s.createdAt||{},gte:e.createdAfter}),e.createdBefore&&(s.createdAt={...s.createdAt||{},lte:e.createdBefore}),s},[e.search,e.roleType,e.isActive,e.isVerified,e.createdAfter,e.createdBefore]),c=(0,a.useMemo)(()=>({[e.sortBy||"createdAt"]:e.sortOrder||"desc"}),[e.sortBy,e.sortOrder]),o=e.page||0,m=e.size||20,{data:h,loading:x,error:u,refetch:p}=(i={model:"user",where:n,orderBy:c,pagination:{page:o,limit:m,sortBy:e.sortBy||"createdAt",sortOrder:e.sortOrder||"desc"},select:{id:!0,email:!0,username:!0,firstName:!0,lastName:!0,phone:!0,avatar:!0,roleType:!0,isActive:!0,isVerified:!0,isTwoFactorEnabled:!0,failedLoginAttempts:!0,lockedUntil:!0,lastLoginAt:!0,createdAt:!0,updatedAt:!0}},r={fetchPolicy:"cache-and-network",skip:s?.skip},(0,d.useQuery)(v.DYNAMIC_FIND_MANY,{variables:{input:i},...r})),{data:j,loading:g,error:N}=(t={model:"user",where:n},l={fetchPolicy:"cache-and-network",skip:s?.skip},(0,d.useQuery)(v.DYNAMIC_COUNT,{variables:{input:t},...l})),y=h?.dynamicFindMany?.data||[],b=j?.dynamicCount?.data||0,w=Math.ceil(b/m);return{data:{searchUsers:{users:y,total:b,page:o,size:m,totalPages:w}},users:y,total:b,page:o,size:m,totalPages:w,loading:x||g,error:u||N,refetch:async e=>{e&&console.warn("useSearchUsers: refetch with new input not fully supported. Re-render component with new input instead."),await Promise.all([p()])}}}var y=e.i(4993),b=e.i(885205),w=e.i(696134),C=e.i(165429),S=e.i(183194),A=e.i(775680),T=e.i(276664),k=e.i(415733),R=e.i(888540),P=e.i(320309),U=e.i(169989),I=e.i(198513);let D={username:"",email:"",firstName:"",lastName:"",phone:"",password:"",roleType:"USER",isActive:!0,isVerified:!1};function F({isOpen:e,onClose:i,onSuccess:r}){let t,[l,{loading:n}]=(t=(0,m.useApolloClient)(),(0,o.useMutation)(N,{onCompleted:()=>{t.refetchQueries({include:[p,u]})},errorPolicy:"all"})),[c,d]=(0,a.useState)(D),[h,x]=(0,a.useState)({}),[j,g]=(0,a.useState)(null);(0,a.useEffect)(()=>{e&&(d(D),x({}),g(null))},[e]);let v=(0,a.useCallback)(()=>{let e={};return c.username.trim()?c.username.length<3?e.username="Username must be at least 3 characters":/^[a-zA-Z0-9_-]+$/.test(c.username)||(e.username="Username can only contain letters, numbers, underscores, and hyphens"):e.username="Username is required",c.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)&&(e.email="Please enter a valid email address"),c.password?c.password.length<8?e.password="Password must be at least 8 characters":/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(c.password)||(e.password="Password must contain uppercase, lowercase, and number"):e.password="Password is required",c.phone&&!/^[\d\s+()-]+$/.test(c.phone)&&(e.phone="Please enter a valid phone number"),x(e),0===Object.keys(e).length},[c]),f=(0,a.useCallback)(async e=>{if(e.preventDefault(),g(null),v())try{let e=await l({variables:{input:{username:c.username.trim(),email:c.email.trim()||void 0,password:c.password,firstName:c.firstName.trim()||void 0,lastName:c.lastName.trim()||void 0,phone:c.phone.trim()||void 0,roleType:c.roleType,isActive:c.isActive,isVerified:c.isVerified}}});e.data?.adminCreateUser&&((0,y.toast)({title:"User created successfully",description:`User "${e.data.adminCreateUser.username}" has been created.`,type:"success"}),r(),i())}catch(s){let e=s.graphQLErrors?.[0]?.message||s.message||"Failed to create user";g(e),(0,y.toast)({title:"Failed to create user",description:e,type:"error",variant:"destructive"})}},[c,v,l,r,i]),F=(0,a.useCallback)((e,s)=>{d(a=>({...a,[e]:s})),h[e]&&x(s=>({...s,[e]:void 0}))},[h]),$=(0,a.useCallback)(()=>{n||i()},[n,i]);return e?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)(A.Card,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(A.CardHeader,{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(P.UserPlus,{className:"h-5 w-5"}),(0,s.jsx)(A.CardTitle,{children:"Create New User"})]}),(0,s.jsx)(b.Button,{variant:"ghost",size:"icon",onClick:$,disabled:n,className:"h-8 w-8",children:(0,s.jsx)(R.X,{className:"h-4 w-4"})})]}),(0,s.jsx)(A.CardDescription,{children:"Fill in the details below to create a new user account"})]}),(0,s.jsx)(A.CardContent,{children:(0,s.jsxs)("form",{onSubmit:f,className:"space-y-6",children:[j&&(0,s.jsxs)(k.Alert,{className:"border-red-500 bg-red-50",children:[(0,s.jsx)(I.AlertCircle,{className:"h-4 w-4"}),(0,s.jsx)(k.AlertDescription,{children:j})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Account Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{htmlFor:"username",className:"required",children:"Username"}),(0,s.jsx)(w.Input,{id:"username",type:"text",value:c.username,onChange:e=>F("username",e.target.value),placeholder:"Enter username",disabled:n,className:h.username?"border-red-500":"",autoFocus:!0}),h.username&&(0,s.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,s.jsx)(I.AlertCircle,{className:"h-3 w-3"}),h.username]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{htmlFor:"email",children:"Email"}),(0,s.jsx)(w.Input,{id:"email",type:"email",value:c.email,onChange:e=>F("email",e.target.value),placeholder:"user@example.com",disabled:n,className:h.email?"border-red-500":""}),h.email&&(0,s.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,s.jsx)(I.AlertCircle,{className:"h-3 w-3"}),h.email]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{htmlFor:"password",className:"required",children:"Password"}),(0,s.jsx)(w.Input,{id:"password",type:"password",value:c.password,onChange:e=>F("password",e.target.value),placeholder:"Enter secure password",disabled:n,className:h.password?"border-red-500":""}),h.password&&(0,s.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,s.jsx)(I.AlertCircle,{className:"h-3 w-3"}),h.password]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Must be at least 8 characters with uppercase, lowercase, and number"})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Personal Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{htmlFor:"firstName",children:"First Name"}),(0,s.jsx)(w.Input,{id:"firstName",type:"text",value:c.firstName,onChange:e=>F("firstName",e.target.value),placeholder:"Enter first name",disabled:n})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{htmlFor:"lastName",children:"Last Name"}),(0,s.jsx)(w.Input,{id:"lastName",type:"text",value:c.lastName,onChange:e=>F("lastName",e.target.value),placeholder:"Enter last name",disabled:n})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{htmlFor:"phone",children:"Phone Number"}),(0,s.jsx)(w.Input,{id:"phone",type:"tel",value:c.phone,onChange:e=>F("phone",e.target.value),placeholder:"+1 (555) 123-4567",disabled:n,className:h.phone?"border-red-500":""}),h.phone&&(0,s.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,s.jsx)(I.AlertCircle,{className:"h-3 w-3"}),h.phone]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Role & Permissions"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{htmlFor:"roleType",children:"Role Type"}),(0,s.jsxs)(S.Select,{value:c.roleType,onValueChange:e=>F("roleType",e),disabled:n,children:[(0,s.jsx)(S.SelectTrigger,{id:"roleType",children:(0,s.jsx)(S.SelectValue,{placeholder:"Select role"})}),(0,s.jsxs)(S.SelectContent,{children:[(0,s.jsx)(S.SelectItem,{value:"ADMIN",children:"Admin"}),(0,s.jsx)(S.SelectItem,{value:"USER",children:"User"}),(0,s.jsx)(S.SelectItem,{value:"GUEST",children:"Guest"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsx)(C.Label,{htmlFor:"isActive",className:"cursor-pointer",children:"Active Status"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"User can log in and access the system"})]}),(0,s.jsx)(T.Switch,{id:"isActive",checked:c.isActive,onCheckedChange:e=>F("isActive",e),disabled:n})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsx)(C.Label,{htmlFor:"isVerified",className:"cursor-pointer",children:"Verified Status"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"User's email/account has been verified"})]}),(0,s.jsx)(T.Switch,{id:"isVerified",checked:c.isVerified,onCheckedChange:e=>F("isVerified",e),disabled:n})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,s.jsx)(b.Button,{type:"button",variant:"outline",onClick:$,disabled:n,className:"flex-1",children:"Cancel"}),(0,s.jsx)(b.Button,{type:"submit",disabled:n,className:"flex-1",children:n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(U.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(P.UserPlus,{className:"mr-2 h-4 w-4"}),"Create User"]})})]})]})})]})}):null}var $=e.i(137651),E=e.i(553082),B=e.i(965120),L=e.i(498697),M=e.i(985937),q=e.i(796374),H=e.i(791174);let V=h.gql`
  mutation AdminResetPassword($input: AdminResetPasswordInput!) {
    adminResetPassword(input: $input) {
      success
      message
      newPassword
      user {
        id
        username
        email
        firstName
        lastName
      }
    }
  }
`;function z({user:e,isOpen:i,onClose:r,onSuccess:t}){let l,[n,{loading:c}]=(l=(0,m.useApolloClient)(),(0,o.useMutation)(j,{onCompleted:()=>{l.refetchQueries({include:[p,u]})},errorPolicy:"all"})),[d,{loading:h}]=(0,o.useMutation)(V),[x,g]=(0,a.useState)({username:"",email:"",firstName:"",lastName:"",phone:"",roleType:"USER",isActive:!0,isVerified:!1,isTwoFactorEnabled:!1}),[N,v]=(0,a.useState)({}),[f,P]=(0,a.useState)(null),[D,F]=(0,a.useState)(!1),[z,O]=(0,a.useState)(!1),[G,Q]=(0,a.useState)(""),[_,K]=(0,a.useState)(!1);(0,a.useEffect)(()=>{e&&i&&(g({username:e.username||"",email:e.email||"",firstName:e.firstName||"",lastName:e.lastName||"",phone:e.phone||"",roleType:e.roleType||"USER",isActive:e.isActive??!0,isVerified:e.isVerified??!1,isTwoFactorEnabled:e.isTwoFactorEnabled??!1}),v({}),P(null),F(!1))},[e,i]);let Y=(0,a.useCallback)(()=>{let e={};return x.username.trim()?x.username.length<3?e.username="Username must be at least 3 characters":/^[a-zA-Z0-9_-]+$/.test(x.username)||(e.username="Username can only contain letters, numbers, underscores, and hyphens"):e.username="Username is required",x.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x.email)&&(e.email="Please enter a valid email address"),x.phone&&!/^[\d\s+()-]+$/.test(x.phone)&&(e.phone="Please enter a valid phone number"),v(e),0===Object.keys(e).length},[x]),X=(0,a.useCallback)(async s=>{if((s.preventDefault(),e)&&(P(null),Y()))try{let s=await n({variables:{id:e.id,input:{username:x.username.trim(),email:x.email.trim()||void 0,firstName:x.firstName.trim()||void 0,lastName:x.lastName.trim()||void 0,phone:x.phone.trim()||void 0,roleType:x.roleType,isActive:x.isActive,isVerified:x.isVerified,isTwoFactorEnabled:x.isTwoFactorEnabled}}});s.data?.adminUpdateUser&&((0,y.toast)({title:"User updated successfully",description:`Changes to "${s.data.adminUpdateUser.username}" have been saved.`,type:"success"}),t(),r())}catch(s){let e=s.graphQLErrors?.[0]?.message||s.message||"Failed to update user";P(e),(0,y.toast)({title:"Failed to update user",description:e,type:"error"})}},[e,x,Y,n,t,r]),Z=(0,a.useCallback)((e,s)=>{g(a=>({...a,[e]:s})),F(!0),N[e]&&v(s=>({...s,[e]:void 0}))},[N]),J=(0,a.useCallback)(()=>{!c&&!h&&(!D||confirm("You have unsaved changes. Are you sure you want to close?"))&&r()},[c,h,D,r]),W=(0,a.useCallback)(async()=>{if(e&&confirm(`Báº¡n c\xf3 cháº¯c muá»‘n reset máº­t kháº©u cho user "${e.username}"?

Máº­t kháº©u má»›i sáº½ Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng.`))try{let{data:s}=await d({variables:{input:{userId:e.id}}});s?.adminResetPassword?.success&&(Q(s.adminResetPassword.newPassword),O(!0),(0,y.toast)({title:"Reset máº­t kháº©u thÃ nh cÃ´ng",description:`Máº­t kháº©u má»›i Ä‘\xe3 Ä‘Æ°á»£c táº¡o cho "${e.username}"`,type:"success"}))}catch(s){let e=s.graphQLErrors?.[0]?.message||s.message||"KhÃ´ng thá»ƒ reset máº­t kháº©u";(0,y.toast)({title:"Reset máº­t kháº©u tháº¥t báº¡i",description:e,type:"error"})}},[e,d]),ee=(0,a.useCallback)(async()=>{try{await navigator.clipboard.writeText(G),K(!0),(0,y.toast)({title:"ÄÃ£ copy",description:"Máº­t kháº©u Ä‘Ã£ Ä‘Æ°á»£c copy vÃ o clipboard",type:"success"}),setTimeout(()=>K(!1),2e3)}catch(e){(0,y.toast)({title:"Lá»—i",description:"KhÃ´ng thá»ƒ copy máº­t kháº©u",type:"error"})}},[G]),es=(0,a.useCallback)(()=>{O(!1),Q(""),K(!1)},[]);return i&&e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,s.jsxs)(A.Card,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(A.CardHeader,{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(B.Edit,{className:"h-5 w-5"}),(0,s.jsx)(A.CardTitle,{children:"Edit User"})]}),(0,s.jsx)(b.Button,{variant:"ghost",size:"icon",onClick:J,disabled:c||h,className:"h-8 w-8",children:(0,s.jsx)(R.X,{className:"h-4 w-4"})})]}),(0,s.jsxs)(A.CardDescription,{children:["Update information for ",e.username]})]}),(0,s.jsx)(A.CardContent,{children:(0,s.jsxs)("form",{onSubmit:X,className:"space-y-6",children:[f&&(0,s.jsxs)(k.Alert,{className:"border-red-500 bg-red-50",children:[(0,s.jsx)(I.AlertCircle,{className:"h-4 w-4"}),(0,s.jsx)(k.AlertDescription,{children:f})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Account Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{htmlFor:"username",className:"required",children:"Username"}),(0,s.jsx)(w.Input,{id:"username",type:"text",value:x.username,onChange:e=>Z("username",e.target.value),placeholder:"Enter username",disabled:c,className:N.username?"border-red-500":"",autoFocus:!0}),N.username&&(0,s.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,s.jsx)(I.AlertCircle,{className:"h-3 w-3"}),N.username]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{htmlFor:"email",children:"Email"}),(0,s.jsx)(w.Input,{id:"email",type:"email",value:x.email,onChange:e=>Z("email",e.target.value),placeholder:"user@example.com",disabled:c,className:N.email?"border-red-500":""}),N.email&&(0,s.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,s.jsx)(I.AlertCircle,{className:"h-3 w-3"}),N.email]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Personal Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{htmlFor:"firstName",children:"First Name"}),(0,s.jsx)(w.Input,{id:"firstName",type:"text",value:x.firstName,onChange:e=>Z("firstName",e.target.value),placeholder:"Enter first name",disabled:c})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{htmlFor:"lastName",children:"Last Name"}),(0,s.jsx)(w.Input,{id:"lastName",type:"text",value:x.lastName,onChange:e=>Z("lastName",e.target.value),placeholder:"Enter last name",disabled:c})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{htmlFor:"phone",children:"Phone Number"}),(0,s.jsx)(w.Input,{id:"phone",type:"tel",value:x.phone,onChange:e=>Z("phone",e.target.value),placeholder:"+1 (555) 123-4567",disabled:c,className:N.phone?"border-red-500":""}),N.phone&&(0,s.jsxs)("p",{className:"text-xs text-red-500 flex items-center gap-1",children:[(0,s.jsx)(I.AlertCircle,{className:"h-3 w-3"}),N.phone]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Role & Permissions"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{htmlFor:"roleType",children:"Role Type"}),(0,s.jsxs)(S.Select,{value:x.roleType,onValueChange:e=>Z("roleType",e),disabled:c,children:[(0,s.jsx)(S.SelectTrigger,{id:"roleType",children:(0,s.jsx)(S.SelectValue,{placeholder:"Select role"})}),(0,s.jsxs)(S.SelectContent,{children:[(0,s.jsx)(S.SelectItem,{value:"ADMIN",children:"Admin"}),(0,s.jsx)(S.SelectItem,{value:"USER",children:"User"}),(0,s.jsx)(S.SelectItem,{value:"GUEST",children:"Guest"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsx)(C.Label,{htmlFor:"isActive",className:"cursor-pointer",children:"Active Status"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"User can log in and access the system"})]}),(0,s.jsx)(T.Switch,{id:"isActive",checked:x.isActive,onCheckedChange:e=>Z("isActive",e),disabled:c})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsx)(C.Label,{htmlFor:"isVerified",className:"cursor-pointer",children:"Verified Status"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"User's email/account has been verified"})]}),(0,s.jsx)(T.Switch,{id:"isVerified",checked:x.isVerified,onCheckedChange:e=>Z("isVerified",e),disabled:c})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsx)(C.Label,{htmlFor:"isTwoFactorEnabled",className:"cursor-pointer",children:"Two-Factor Authentication"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Require 2FA for enhanced security"})]}),(0,s.jsx)(T.Switch,{id:"isTwoFactorEnabled",checked:x.isTwoFactorEnabled,onCheckedChange:e=>Z("isTwoFactorEnabled",e),disabled:c})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Security Actions"}),(0,s.jsxs)(k.Alert,{className:"border-amber-200 bg-amber-50",children:[(0,s.jsx)(L.Key,{className:"h-4 w-4 text-amber-600"}),(0,s.jsx)(k.AlertDescription,{className:"text-sm",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-amber-800 font-medium",children:"Reset máº­t kháº©u cho nhÃ¢n viÃªn"}),(0,s.jsx)("p",{className:"text-xs text-amber-700",children:"Há»‡ thá»‘ng sáº½ táº¡o máº­t kháº©u ngáº«u nhiÃªn máº¡nh. Báº¡n cÃ³ thá»ƒ copy vÃ  gá»­i cho nhÃ¢n viÃªn."}),(0,s.jsx)(b.Button,{type:"button",variant:"outline",size:"sm",onClick:W,disabled:c||h,className:"w-full sm:w-auto mt-2 border-amber-300 text-amber-700 hover:bg-amber-100 hover:text-amber-800",children:h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(U.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Äang reset..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(H.RefreshCw,{className:"mr-2 h-4 w-4"}),"Reset Password"]})})]})})]})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 pt-4",children:[(0,s.jsx)(b.Button,{type:"button",variant:"outline",onClick:J,disabled:c||h,className:"flex-1",children:"Cancel"}),(0,s.jsx)(b.Button,{type:"submit",disabled:c||h||!D,className:"flex-1",children:c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(U.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(E.Save,{className:"mr-2 h-4 w-4"}),"Save Changes"]})})]})]})})]})}),(0,s.jsx)($.Dialog,{open:z,onOpenChange:O,children:(0,s.jsxs)($.DialogContent,{className:"sm:max-w-md",children:[(0,s.jsxs)($.DialogHeader,{children:[(0,s.jsxs)($.DialogTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(L.Key,{className:"h-5 w-5 text-green-600"}),"Máº­t kháº©u má»›i Ä‘Ã£ Ä‘Æ°á»£c táº¡o"]}),(0,s.jsx)($.DialogDescription,{children:"Copy máº­t kháº©u nÃ y vÃ  gá»­i cho nhÃ¢n viÃªn. Máº­t kháº©u sáº½ khÃ´ng hiá»ƒn thá»‹ láº¡i."})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(C.Label,{className:"text-sm font-medium",children:"Máº­t kháº©u má»›i"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(w.Input,{type:"text",value:G,readOnly:!0,className:"pr-12 font-mono text-base sm:text-lg font-semibold bg-gray-50 border-2 border-green-300"}),(0,s.jsx)(b.Button,{type:"button",size:"icon",variant:"ghost",onClick:ee,className:"absolute right-1 top-1/2 -translate-y-1/2 h-8 w-8 hover:bg-green-100",title:"Copy password",children:_?(0,s.jsx)(q.CheckCheck,{className:"h-4 w-4 text-green-600"}):(0,s.jsx)(M.Copy,{className:"h-4 w-4"})})]})]}),(0,s.jsxs)(k.Alert,{className:"border-blue-200 bg-blue-50",children:[(0,s.jsx)(I.AlertCircle,{className:"h-4 w-4 text-blue-600"}),(0,s.jsxs)(k.AlertDescription,{className:"text-sm space-y-1",children:[(0,s.jsx)("p",{className:"font-medium text-blue-900",children:"ThÃ´ng tin ngÆ°á»i dÃ¹ng:"}),(0,s.jsxs)("div",{className:"text-xs text-blue-800 space-y-0.5",children:[(0,s.jsxs)("p",{children:["â€¢ Username: ",(0,s.jsx)("span",{className:"font-mono font-semibold",children:e.username})]}),e.email&&(0,s.jsxs)("p",{children:["â€¢ Email: ",(0,s.jsx)("span",{className:"font-mono",children:e.email})]}),e.firstName&&e.lastName&&(0,s.jsxs)("p",{children:["â€¢ Há» tÃªn: ",e.firstName," ",e.lastName]})]})]})]}),(0,s.jsxs)(k.Alert,{className:"border-amber-200 bg-amber-50",children:[(0,s.jsx)(I.AlertCircle,{className:"h-4 w-4 text-amber-600"}),(0,s.jsxs)(k.AlertDescription,{className:"text-xs text-amber-800",children:[(0,s.jsx)("p",{className:"font-medium mb-1",children:"âš ï¸ LÆ°u Ã½ quan trá»ng:"}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-0.5 ml-1",children:[(0,s.jsx)("li",{children:"Máº­t kháº©u nÃ y chá»‰ hiá»ƒn thá»‹ 1 láº§n duy nháº¥t"}),(0,s.jsx)("li",{children:"HÃ£y copy vÃ  gá»­i cho nhÃ¢n viÃªn ngay"}),(0,s.jsx)("li",{children:"NhÃ¢n viÃªn nÃªn Ä‘á»•i máº­t kháº©u sau láº§n Ä‘Äƒng nháº­p Ä‘áº§u"})]})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-3",children:[(0,s.jsx)(b.Button,{type:"button",variant:"outline",onClick:ee,className:"flex-1",children:_?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q.CheckCheck,{className:"mr-2 h-4 w-4 text-green-600"}),"ÄÃ£ copy!"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.Copy,{className:"mr-2 h-4 w-4"}),"Copy Password"]})}),(0,s.jsx)(b.Button,{type:"button",onClick:es,className:"flex-1",children:"ÄÃ³ng"})]})]})})]}):null}var O=e.i(169100);function G({title:e="Error",message:a,onRetry:i,retryLabel:r="Retry"}){return(0,s.jsx)("div",{className:"container mx-auto py-8",children:(0,s.jsx)(A.Card,{children:(0,s.jsx)(A.CardContent,{className:"flex items-center justify-center py-12",children:(0,s.jsxs)("div",{className:"text-center max-w-md",children:[(0,s.jsx)(O.AlertTriangle,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:e}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:a}),i&&(0,s.jsxs)(b.Button,{onClick:i,variant:"outline",children:[(0,s.jsx)(H.RefreshCw,{className:"w-4 h-4 mr-2"}),r]})]})})})})}e.i(538638);var Q=e.i(450681),_=e.i(702470),K=e.i(41714),Y=e.i(135369),X=e.i(495043),Z=e.i(138227),J=e.i(263953),W=e.i(407830),W=W,ee=e.i(415588),es=e.i(825098),ea=e.i(99529),ei=e.i(435635),er=e.i(822390),et=e.i(257117),el=e.i(975620),en=e.i(630596),ec=e.i(567961),ed=e.i(763673),eo=e.i(590719);function em({currentPage:e,totalPages:a,pageSize:i,totalItems:r,onPageChange:t,onPageSizeChange:l,pageSizeOptions:n=[10,20,50,100]}){let c=Math.min((e+1)*i,r);return(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4 border-t pt-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(0,s.jsx)("span",{className:"font-medium",children:e*i+1})," to"," ",(0,s.jsx)("span",{className:"font-medium",children:c})," of"," ",(0,s.jsx)("span",{className:"font-medium",children:r})," results"]}),l&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Show"}),(0,s.jsxs)(S.Select,{value:String(i),onValueChange:e=>l(Number(e)),children:[(0,s.jsx)(S.SelectTrigger,{className:"w-[70px]",children:(0,s.jsx)(S.SelectValue,{})}),(0,s.jsx)(S.SelectContent,{children:n.map(e=>(0,s.jsx)(S.SelectItem,{value:String(e),children:e},e))})]})]})]}),a>1&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(b.Button,{variant:"outline",size:"icon",onClick:()=>t(0),disabled:0===e,title:"First page",children:(0,s.jsx)(ed.ChevronsLeft,{className:"h-4 w-4"})}),(0,s.jsx)(b.Button,{variant:"outline",size:"icon",onClick:()=>t(e-1),disabled:0===e,title:"Previous page",children:(0,s.jsx)(en.ChevronLeft,{className:"h-4 w-4"})}),(0,s.jsx)("div",{className:"flex items-center gap-1",children:(()=>{let s=[];if(a<=5)for(let e=0;e<a;e++)s.push(e);else{s.push(0);let i=Math.max(1,e-1),r=Math.min(a-2,e+1);e<=2?r=3:e>=a-3&&(i=a-4),i>1&&s.push("...");for(let e=i;e<=r;e++)s.push(e);r<a-2&&s.push("..."),s.push(a-1)}return s})().map((a,i)=>"..."===a?(0,s.jsx)("span",{className:"px-2 text-muted-foreground",children:"..."},`ellipsis-${i}`):(0,s.jsx)(b.Button,{variant:a===e?"default":"outline",size:"icon",onClick:()=>t(a),className:"w-9 h-9",children:a+1},a))}),(0,s.jsx)(b.Button,{variant:"outline",size:"icon",onClick:()=>t(e+1),disabled:e>=a-1,title:"Next page",children:(0,s.jsx)(ec.ChevronRight,{className:"h-4 w-4"})}),(0,s.jsx)(b.Button,{variant:"outline",size:"icon",onClick:()=>t(a-1),disabled:e>=a-1,title:"Last page",children:(0,s.jsx)(eo.ChevronsRight,{className:"h-4 w-4"})})]})]})}var eh=e.i(774309),ex=e.i(741850);function eu({rows:e=5}){return(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)(ex.Table,{children:[(0,s.jsx)(ex.TableHeader,{children:(0,s.jsxs)(ex.TableRow,{children:[(0,s.jsx)(ex.TableHead,{className:"w-[50px]",children:(0,s.jsx)(eh.Skeleton,{className:"h-4 w-4"})}),(0,s.jsx)(ex.TableHead,{children:(0,s.jsx)(eh.Skeleton,{className:"h-4 w-20"})}),(0,s.jsx)(ex.TableHead,{children:(0,s.jsx)(eh.Skeleton,{className:"h-4 w-16"})}),(0,s.jsx)(ex.TableHead,{children:(0,s.jsx)(eh.Skeleton,{className:"h-4 w-24"})}),(0,s.jsx)(ex.TableHead,{children:(0,s.jsx)(eh.Skeleton,{className:"h-4 w-16"})}),(0,s.jsx)(ex.TableHead,{children:(0,s.jsx)(eh.Skeleton,{className:"h-4 w-20"})}),(0,s.jsx)(ex.TableHead,{className:"w-[100px]",children:(0,s.jsx)(eh.Skeleton,{className:"h-4 w-16"})})]})}),(0,s.jsx)(ex.TableBody,{children:Array.from({length:e}).map((e,a)=>(0,s.jsxs)(ex.TableRow,{children:[(0,s.jsx)(ex.TableCell,{children:(0,s.jsx)(eh.Skeleton,{className:"h-4 w-4"})}),(0,s.jsx)(ex.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(eh.Skeleton,{className:"h-10 w-10 rounded-full"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eh.Skeleton,{className:"h-4 w-32"}),(0,s.jsx)(eh.Skeleton,{className:"h-3 w-24"})]})]})}),(0,s.jsx)(ex.TableCell,{children:(0,s.jsx)(eh.Skeleton,{className:"h-4 w-16"})}),(0,s.jsx)(ex.TableCell,{children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(eh.Skeleton,{className:"h-4 w-40"}),(0,s.jsx)(eh.Skeleton,{className:"h-3 w-32"})]})}),(0,s.jsx)(ex.TableCell,{children:(0,s.jsx)(eh.Skeleton,{className:"h-5 w-14 rounded-full"})}),(0,s.jsx)(ex.TableCell,{children:(0,s.jsx)(eh.Skeleton,{className:"h-4 w-20"})}),(0,s.jsx)(ex.TableCell,{children:(0,s.jsx)(eh.Skeleton,{className:"h-8 w-8"})})]},a))})]})})}function ep({data:e,loading:i,selectedUsers:r,onSelectUser:t,onSelectAll:l,onSort:c,onPageChange:d,onCreateUser:o,onEditUser:m,onActivateUser:h,onDeactivateUser:x,onDeleteUser:u,sortBy:p,sortOrder:j}){let g=e?.users||[],N=e=>e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:e.username,v=(0,a.useMemo)(()=>[{field:"username",headerName:"User",width:250,pinned:"left",sortable:!0,filterable:!0,cellRenderer:({data:e})=>(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)(K.Avatar,{className:"w-8 h-8",children:[(0,s.jsx)(K.AvatarImage,{src:e.avatar,alt:N(e)}),(0,s.jsx)(K.AvatarFallback,{className:"text-xs",children:e.firstName&&e.lastName?`${e.firstName[0]}${e.lastName[0]}`.toUpperCase():e.username.slice(0,2).toUpperCase()})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-gray-900",children:N(e)}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["@",e.username]})]})]})},{field:"email",headerName:"Contact",width:280,sortable:!0,filterable:!0,cellRenderer:({data:e})=>(0,s.jsxs)("div",{className:"space-y-1",children:[e.email&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,s.jsx)(es.Mail,{className:"w-3 h-3 flex-shrink-0"}),(0,s.jsx)("span",{className:"truncate",children:e.email})]}),e.phone&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,s.jsx)(ea.Phone,{className:"w-3 h-3 flex-shrink-0"}),e.phone]})]})},{field:"roleType",headerName:"Role",width:120,type:"select",sortable:!0,filterable:!0,filterOptions:["ADMIN","USER","GUEST"],cellRenderer:({value:e})=>(0,s.jsx)(_.Badge,{variant:(e=>{switch(e.toLowerCase()){case"admin":return"destructive";case"user":return"default";default:return"secondary"}})(e),children:e})},{field:"isActive",headerName:"Status",width:180,type:"boolean",sortable:!0,filterable:!0,cellRenderer:({data:e})=>{let a=e.lockedUntil&&new Date(e.lockedUntil)>new Date;return(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.isActive?a?(0,s.jsxs)(_.Badge,{variant:"secondary",className:"bg-orange-100 text-orange-800",children:[(0,s.jsx)(I.AlertCircle,{className:"w-3 h-3 mr-1"}),"Locked"]}):(0,s.jsxs)(_.Badge,{variant:"secondary",className:"bg-green-100 text-green-800",children:[(0,s.jsx)(er.CheckCircle,{className:"w-3 h-3 mr-1"}),"Active"]}):(0,s.jsxs)(_.Badge,{variant:"secondary",className:"bg-red-100 text-red-800",children:[(0,s.jsx)(et.XCircle,{className:"w-3 h-3 mr-1"}),"Inactive"]}),e.isVerified&&(0,s.jsx)("div",{title:"Verified",children:(0,s.jsx)(n.Shield,{className:"w-4 h-4 text-green-600"})}),e.isTwoFactorEnabled&&(0,s.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full",title:"2FA Enabled"})]})}},{field:"createdAt",headerName:"Joined",width:180,type:"date",sortable:!0,filterable:!0,cellRenderer:({value:e})=>(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,s.jsx)(ei.Calendar,{className:"w-3 h-3 flex-shrink-0"}),(0,s.jsx)("span",{className:"truncate",children:(0,el.formatDistanceToNow)(new Date(e),{addSuffix:!0})})]})},{field:"lastLoginAt",headerName:"Last Login",width:180,type:"date",sortable:!0,filterable:!0,cellRenderer:({value:e})=>e?(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,s.jsx)(ee.Clock,{className:"w-3 h-3 flex-shrink-0"}),(0,s.jsx)("span",{className:"truncate",children:(0,el.formatDistanceToNow)(new Date(e),{addSuffix:!0})})]}):(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"Never"})},{field:"id",headerName:"Actions",width:100,pinned:"right",sortable:!1,filterable:!1,cellRenderer:({data:e})=>(0,s.jsxs)(Y.DropdownMenu,{children:[(0,s.jsx)(Y.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsx)(b.Button,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:(0,s.jsx)(X.MoreVertical,{className:"w-4 h-4"})})}),(0,s.jsxs)(Y.DropdownMenuContent,{align:"end",children:[(0,s.jsxs)(Y.DropdownMenuItem,{onClick:()=>m(e),children:[(0,s.jsx)(B.Edit,{className:"w-4 h-4 mr-2"}),"Edit User"]}),(0,s.jsx)(Y.DropdownMenuSeparator,{}),(0,s.jsx)(Y.DropdownMenuItem,{onClick:()=>e.isActive?x&&x(e):h&&h(e),children:e.isActive?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(W.default,{className:"w-4 h-4 mr-2"}),"Deactivate"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(J.UserCheck,{className:"w-4 h-4 mr-2"}),"Activate"]})}),(0,s.jsx)(Y.DropdownMenuSeparator,{}),(0,s.jsxs)(Y.DropdownMenuItem,{className:"text-red-600",onClick:()=>u&&u(e),children:[(0,s.jsx)(Z.Trash2,{className:"w-4 h-4 mr-2"}),"Delete User"]})]})]})}],[m,h,x,u]),f=(0,a.useRef)(new Set(r));(0,a.useEffect)(()=>{f.current=new Set(r)},[r]);let y=(0,a.useMemo)(()=>e=>{let s=e.map(e=>e.id),a=g.map(e=>e.id),i=new Set(s),r=f.current,n=s.filter(e=>!r.has(e)),c=Array.from(r).filter(e=>a.includes(e)&&!i.has(e));f.current=i,(n.length>0||c.length>0)&&(s.length===a.length&&a.length>0?l(a):[...n,...c].forEach(e=>t(e)))},[g,t,l]),w=(0,a.useCallback)(e=>{if(e.length>0){let s=e[0];c(String(s.field),s.direction||"asc")}},[c]),C=(0,a.useCallback)(e=>(o&&o(),Promise.resolve(!0)),[o]),S=(0,a.useCallback)((e,s,a)=>(m(e),Promise.resolve(!0)),[m]),A=(0,a.useCallback)(e=>u&&e.length>0?(e.forEach(e=>u(e)),Promise.resolve(!0)):Promise.resolve(!1),[u]);return i?(0,s.jsx)(eu,{rows:5}):g&&0!==g.length?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(Q.AdvancedTable,{columns:v,data:g,config:{enableSorting:!0,enableFiltering:!0,enableColumnPinning:!0,enableColumnResizing:!0,enableColumnHiding:!0,enableRowSelection:!0,enableInlineEditing:!1,enableDialogEditing:!1,enableRowDeletion:!0,rowHeight:60,headerHeight:48,showToolbar:!0,showPagination:!1,virtualScrolling:!1},loading:i,onRowSelect:y,onSort:w,onRowCreate:o?C:void 0,onRowEdit:S,onRowDelete:u?A:void 0,height:600,className:"border rounded-lg"}),e&&e.totalPages>1&&(0,s.jsx)(em,{currentPage:e.page,totalPages:e.totalPages,pageSize:e.size,totalItems:e.total,onPageChange:d})]}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"text-gray-500 mb-2",children:"No users found"}),(0,s.jsx)("div",{className:"text-sm text-gray-400",children:"Try adjusting your search criteria"})]})}function ej(){let e,[i,r]=(0,a.useState)({search:"",roleType:void 0,isActive:void 0,isVerified:void 0,page:0,size:20,sortBy:"createdAt",sortOrder:"desc"}),[t,l]=(0,a.useState)([]),[n,c]=(0,a.useState)(!1),[h,x]=(0,a.useState)(null),[j,N]=(0,a.useState)(!1),{users:v,total:b,page:w,size:C,totalPages:S,loading:A,error:T,refetch:k}=f((0,a.useMemo)(()=>{let e={page:i.page,size:i.size,sortBy:i.sortBy,sortOrder:i.sortOrder};return i.search?.trim()&&(e.search=i.search.trim()),i.roleType&&(e.roleType=i.roleType),void 0!==i.isActive&&(e.isActive=i.isActive),void 0!==i.isVerified&&(e.isVerified=i.isVerified),e},[i])),{data:R,loading:P}=(0,d.useQuery)(u,{fetchPolicy:"cache-and-network",errorPolicy:"all",skip:void 0}),[U,{loading:I}]=(e=(0,m.useApolloClient)(),(0,o.useMutation)(g,{onCompleted:()=>{e.refetchQueries({include:[p,u]})},errorPolicy:"all"})),D=async e=>{try{await U({variables:{input:{userIds:[e.id],action:"delete"}}}),(0,y.toast)({title:"Success",description:`User ${e.username} has been deleted.`,type:"success"}),l(s=>s.filter(s=>s!==e.id)),await k()}catch(e){(0,y.toast)({title:"Error",description:e.message||"Failed to delete user",type:"error",variant:"destructive"})}};return T?(0,s.jsx)(G,{title:"Error Loading Users",message:T.message||"Failed to load users data",onRetry:()=>k(),retryLabel:"Retry Loading Users"}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(ep,{data:{users:v,total:b,page:w,size:C,totalPages:S},loading:A,selectedUsers:t,onSelectUser:e=>{l(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},onSelectAll:e=>{e.every(e=>t.includes(e))?l(s=>s.filter(s=>!e.includes(s))):l(s=>{let a=[...s];return e.forEach(e=>{a.includes(e)||a.push(e)}),a})},onSort:(e,s)=>{r(a=>({...a,sortBy:e,sortOrder:s}))},onPageChange:e=>{r(s=>({...s,page:e,page:e}))},onCreateUser:()=>c(!0),onEditUser:x,onDeleteUser:D,sortBy:i.sortBy,sortOrder:i.sortOrder}),(0,s.jsx)(F,{isOpen:n,onClose:()=>c(!1),onSuccess:()=>{c(!1),k()}}),(0,s.jsx)(z,{user:h,isOpen:!!h,onClose:()=>x(null),onSuccess:()=>{x(null),k()}})]})}function eg({message:e="Loading..."}){return(0,s.jsx)("div",{className:"container mx-auto py-8",children:(0,s.jsx)(A.Card,{children:(0,s.jsx)(A.CardContent,{className:"flex items-center justify-center py-12",children:(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,s.jsx)(U.Loader2,{className:"w-8 h-8 animate-spin text-primary"}),(0,s.jsx)("span",{className:"text-gray-600",children:e})]})})})})}var eN=e.i(397163),ev=e.i(519647);function ef({userRole:e="Unknown",requiredRole:a="ADMIN"}){let r=(0,i.useRouter)();return(0,s.jsx)("div",{className:"container mx-auto py-12 px-4",children:(0,s.jsx)(A.Card,{className:"max-w-md mx-auto border-2 border-yellow-200",children:(0,s.jsx)(A.CardContent,{className:"flex items-center justify-center py-12",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(eN.ShieldAlert,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-yellow-900 mb-2",children:"Truy cáº­p bá»‹ háº¡n cháº¿"}),(0,s.jsxs)("p",{className:"text-gray-600 mb-4",children:["Báº¡n cáº§n quyá»n ",(0,s.jsx)("strong",{children:a})," Ä‘á»ƒ truy cáº­p trang nÃ y."]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 mb-6",children:["Quyá»n hiá»‡n táº¡i: ",(0,s.jsx)("strong",{className:"text-blue-600",children:e})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 font-medium mb-3",children:"ðŸ“Œ LiÃªn há»‡ quáº£n trá»‹ viÃªn Ä‘á»ƒ yÃªu cáº§u quyá»n truy cáº­p:"}),(0,s.jsxs)("a",{href:"mailto:admin@rausachcore.dev?subject=YÃªu cáº§u quyá»n truy cáº­p quáº£n trá»‹",className:"flex items-center justify-center gap-2 w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:[(0,s.jsx)(es.Mail,{className:"w-4 h-4"}),"Gá»­i email"]})]}),(0,s.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,s.jsxs)(b.Button,{onClick:()=>r.push("/admin/request-access"),variant:"outline",className:"w-full",children:[(0,s.jsx)(ev.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Xem hÆ°á»›ng dáº«n yÃªu cáº§u"]})})]})})})})}var ey=e.i(2188),eb=e.i(606443),ew=e.i(31968);let eC=h.gql`
  query SearchPermissions($input: PermissionSearchInput!) {
    searchPermissions(input: $input) {
      permissions {
        id
        name
        displayName
        description
        resource
        action
        scope
        category
        conditions
        metadata
        isActive
        isSystemPerm
        createdAt
        updatedAt
      }
      total
      page
      size
      totalPages
    }
  }
`;h.gql`
  query GetPermissionById($id: String!) {
    getPermissionById(id: $id) {
      id
      name
      displayName
      description
      resource
      action
      scope
      category
      conditions
      metadata
      isActive
      isSystemPerm
      createdAt
      updatedAt
    }
  }
`;let eS=h.gql`
  mutation CreatePermission($input: CreatePermissionInput!) {
    createPermission(input: $input) {
      id
      name
      displayName
      description
      resource
      action
      scope
      category
      conditions
      metadata
      isActive
      isSystemPerm
      createdAt
      updatedAt
    }
  }
`,eA=h.gql`
  mutation UpdatePermission($id: String!, $input: UpdatePermissionInput!) {
    updatePermission(id: $id, input: $input) {
      id
      name
      displayName
      description
      resource
      action
      scope
      category
      conditions
      metadata
      isActive
      isSystemPerm
      createdAt
      updatedAt
    }
  }
`,eT=h.gql`
  mutation DeletePermission($id: String!) {
    deletePermission(id: $id)
  }
`,ek=h.gql`
  query SearchRoles($input: RoleSearchInput!) {
    searchRoles(input: $input) {
      roles {
        id
        name
        displayName
        description
        isActive
        isSystemRole
        priority
        metadata
        parentId
        createdAt
        updatedAt
        permissions {
          id
          name
          displayName
          resource
          action
          scope
          description
          isActive
        }
        children {
          id
          name
          displayName
        }
      }
      total
      page
      size
      totalPages
    }
  }
`;h.gql`
  query GetRoleById($id: String!) {
    getRoleById(id: $id) {
      id
      name
      displayName
      description
      isActive
      isSystemRole
      priority
      metadata
      parentId
      createdAt
      updatedAt
      permissions {
        id
        effect
        permission {
          id
          name
          displayName
          resource
          action
          scope
        }
      }
      children {
        id
        name
        displayName
      }
    }
  }
`;let eR=h.gql`
  mutation CreateRole($input: CreateRoleInput!) {
    createRole(input: $input) {
      id
      name
      displayName
      description
      isActive
      isSystemRole
      priority
      metadata
      parentId
      createdAt
      updatedAt
      permissions {
        id
        effect
        permission {
          id
          name
          displayName
          resource
          action
          scope
        }
      }
      children {
        id
        name
        displayName
      }
    }
  }
`,eP=h.gql`
  mutation UpdateRole($id: String!, $input: UpdateRoleInput!) {
    updateRole(id: $id, input: $input) {
      id
      name
      displayName
      description
      isActive
      isSystemRole
      priority
      metadata
      parentId
      createdAt
      updatedAt
      permissions {
        id
        effect
        permission {
          id
          name
          displayName
          resource
          action
          scope
        }
      }
      children {
        id
        name
        displayName
      }
    }
  }
`,eU=h.gql`
  mutation DeleteRole($id: String!) {
    deleteRole(id: $id)
  }
`,eI=h.gql`
  mutation AssignRolePermissions($input: AssignRolePermissionInput!) {
    assignRolePermissions(input: $input)
  }
`,eD=h.gql`
  query GetUserRolePermissions($userId: String!) {
    getUserRolePermissions(userId: $userId) {
      userId
      directPermissions {
        id
        effect
        conditions
        metadata
        permission {
          id
          name
          displayName
          resource
          action
          scope
        }
      }
      roleAssignments {
        id
        effect
        conditions
        metadata
        role {
          id
          name
          displayName
          permissions {
            id
            name
            displayName
            resource
            action
            scope
            description
            isActive
          }
        }
      }
      effectivePermissions {
        id
        name
        displayName
        resource
        action
        scope
        description
        isActive
      }
      summary {
        totalDirectPermissions
        totalRoleAssignments
        totalEffectivePermissions
        lastUpdated
      }
    }
  }
`,eF=h.gql`
  mutation AssignUserRoles($input: AssignUserRoleInput!) {
    assignUserRoles(input: $input)
  }
`,e$=h.gql`
  mutation AssignUserPermissions($input: AssignUserPermissionInput!) {
    assignUserPermissions(input: $input)
  }
`;var eE=e.i(835819);let eB=e=>(0,d.useQuery)(eC,{variables:{input:e},errorPolicy:"all",onError:e=>{console.error("Error searching permissions:",e),eE.toast.error("Failed to search permissions")}}),eL=e=>(0,d.useQuery)(ek,{variables:{input:e},errorPolicy:"all",onError:e=>{console.error("Error searching roles:",e),eE.toast.error("Failed to search roles")}}),eM=e=>(0,d.useQuery)(eD,{variables:{userId:e},skip:!e,errorPolicy:"all",onError:e=>{console.error("Error getting user role permissions:",e),eE.toast.error("Failed to get user permissions")}});var eq=e.i(840864),eH=e.i(632800),eV=e.i(850384);let ez=({isOpen:e,role:i,onClose:r,onSuccess:t})=>{let[l,n]=(0,a.useState)([]),[c,d]=(0,a.useState)(""),[m,{loading:h}]=(0,o.useMutation)(eI,{onCompleted:()=>{eE.toast.success("Role permissions updated successfully")},onError:e=>{console.error("Error assigning role permissions:",e),eE.toast.error("Failed to update role permissions")},refetchQueries:["SearchRoles","GetRoleById"]}),{data:x}=eB({page:0,size:100,isActive:!0}),{toast:u}=(0,y.useToast)();(0,a.useEffect)(()=>{e||d("")},[e]),(0,a.useEffect)(()=>{if(i&&x?.searchPermissions?.permissions){let e=x.searchPermissions.permissions,s=i.permissions||[];n(e.map(e=>{let a=s.find(s=>s?.permission?.id===e?.id);return{permissionId:e?.id,effect:a?a.effect:null}}))}},[i,x]);let p=async e=>{e.preventDefault();let s=l.filter(e=>"allow"===e.effect).map(e=>e.permissionId),a=l.filter(e=>"deny"===e.effect).map(e=>e.permissionId);try{await m({variables:{input:{roleId:i.id,permissionIds:s,effect:"allow"}}}),a.length>0&&console.warn("Deny permissions are not fully supported with current backend API"),u({title:"Permissions updated",description:`${s.length} permission(s) assigned to role "${i.displayName}".`,type:"success"}),t(),r()}catch(e){u({title:"Update failed",description:e.message||"Failed to update permissions",type:"error"})}},j=x?.searchPermissions?.permissions||[],g=x?.searchPermissions?.total||0,N=j.filter(e=>e.displayName.toLowerCase().includes(c.toLowerCase())||e.name.toLowerCase().includes(c.toLowerCase())||e.resource.toLowerCase().includes(c.toLowerCase())||e.action.toLowerCase().includes(c.toLowerCase())),v=l.filter(e=>null!==e.effect).length;return(0,s.jsx)($.Dialog,{open:e,onOpenChange:r,children:(0,s.jsxs)($.DialogContent,{className:"max-w-4xl max-h-[90vh]",children:[(0,s.jsxs)($.DialogHeader,{children:[(0,s.jsxs)($.DialogTitle,{children:["Manage Permissions for: ",i.displayName]}),(0,s.jsx)($.DialogDescription,{children:'Assign permissions for this role. Choose "Allow" to grant permission or "None" to remove it. Note: "Deny" functionality requires backend API enhancement.'})]}),(0,s.jsxs)("form",{onSubmit:p,className:"space-y-4",children:[g>100&&(0,s.jsx)(k.Alert,{children:(0,s.jsxs)(k.AlertDescription,{children:["Showing first 100 of ",g," permissions. Use search to find specific permissions."]})}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"relative flex-1",children:[(0,s.jsx)(eV.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(w.Input,{type:"text",placeholder:"Search permissions...",value:c,onChange:e=>d(e.target.value),className:"pl-10",disabled:h})]}),(0,s.jsxs)(_.Badge,{variant:"secondary",className:"ml-4",children:[v," assigned"]})]}),(0,s.jsx)(eH.ScrollArea,{className:"h-[400px] border rounded-lg",children:(0,s.jsxs)("div",{className:"divide-y",children:[N.map(e=>{let a=l.find(s=>s.permissionId===e.id);return(0,s.jsx)("div",{className:"p-4 hover:bg-muted/50 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,s.jsx)("div",{className:"font-medium",children:e.displayName}),e.description&&(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:e.description}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsxs)("code",{className:"px-2 py-0.5 rounded bg-muted text-xs",children:[e.resource,":",e.action,e.scope&&`:${e.scope}`]}),(0,s.jsx)(_.Badge,{variant:"outline",className:"text-xs",children:e.category})]})]}),(0,s.jsxs)(eq.RadioGroup,{value:a?.effect||"none",onValueChange:s=>{var a,i;return a=e.id,i="none"===s?null:s,void n(e=>e.map(e=>e.permissionId===a?{...e,effect:i}:e))},className:"flex gap-4",disabled:h,children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eq.RadioGroupItem,{value:"none",id:`${e.id}-none`,disabled:h}),(0,s.jsx)(C.Label,{htmlFor:`${e.id}-none`,className:"font-normal cursor-pointer",children:"None"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eq.RadioGroupItem,{value:"allow",id:`${e.id}-allow`,disabled:h}),(0,s.jsx)(C.Label,{htmlFor:`${e.id}-allow`,className:"font-normal cursor-pointer text-green-600",children:"Allow"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eq.RadioGroupItem,{value:"deny",id:`${e.id}-deny`,disabled:h}),(0,s.jsx)(C.Label,{htmlFor:`${e.id}-deny`,className:"font-normal cursor-pointer text-destructive",children:"Deny"})]})]})]})},e.id)}),0===N.length&&(0,s.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"No permissions found matching your search."})]})}),(0,s.jsxs)($.DialogFooter,{children:[(0,s.jsx)(b.Button,{type:"button",variant:"outline",onClick:r,disabled:h,children:"Cancel"}),(0,s.jsx)(b.Button,{type:"submit",disabled:h,children:h?"Saving...":"Save Permissions"})]})]})]})})};var eO=e.i(600547),eG=e.i(172362);let eQ=({isOpen:e,onClose:i,onSuccess:r})=>{let[t,l]=(0,a.useState)({name:"",displayName:"",description:"",priority:0,permissionIds:[]}),[n,{loading:c}]=(0,o.useMutation)(eR,{onCompleted:()=>{eE.toast.success("Role created successfully")},onError:e=>{console.error("Error creating role:",e),eE.toast.error("Failed to create role")},refetchQueries:["SearchRoles"]}),{data:d}=eB({page:0,size:100,isActive:!0}),{toast:m}=(0,y.useToast)(),h=async e=>{e.preventDefault();try{await n({variables:{input:t}}),m({title:"Role created",description:`Role "${t.displayName}" has been created successfully.`,type:"success"}),r()}catch(e){m({title:"Create failed",description:e.message||"Failed to create role",type:"error"})}},x=d?.searchPermissions?.permissions||[];return(0,s.jsx)($.Dialog,{open:e,onOpenChange:i,children:(0,s.jsxs)($.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)($.DialogHeader,{children:[(0,s.jsx)($.DialogTitle,{children:"Create New Role"}),(0,s.jsx)($.DialogDescription,{children:"Create a new role and assign permissions"})]}),(0,s.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"name",children:["Role Name ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(w.Input,{id:"name",required:!0,value:t.name,onChange:e=>l(s=>({...s,name:e.target.value})),placeholder:"e.g., user_manager"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"displayName",children:["Display Name ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(w.Input,{id:"displayName",required:!0,value:t.displayName,onChange:e=>l(s=>({...s,displayName:e.target.value})),placeholder:"e.g., User Manager"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(C.Label,{htmlFor:"description",children:"Description"}),(0,s.jsx)(eO.Textarea,{id:"description",rows:3,value:t.description||"",onChange:e=>l(s=>({...s,description:e.target.value})),placeholder:"Describe the role's purpose and responsibilities"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(C.Label,{htmlFor:"priority",children:"Priority"}),(0,s.jsx)(w.Input,{id:"priority",type:"number",value:t.priority,onChange:e=>l(s=>({...s,priority:parseInt(e.target.value)||0})),placeholder:"0"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Higher numbers have higher priority"})]}),x.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)(C.Label,{className:"mb-2 block",children:"Permissions"}),(0,s.jsx)(eH.ScrollArea,{className:"h-48 border rounded-md p-3",children:(0,s.jsx)("div",{className:"space-y-3",children:x.map(e=>(0,s.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,s.jsx)(eG.Checkbox,{id:`permission-${e.id}`,checked:t.permissionIds?.includes(e.id)||!1,onCheckedChange:()=>{var s;return s=e.id,void l(e=>({...e,permissionIds:e.permissionIds?.includes(s)?e.permissionIds.filter(e=>e!==s):[...e.permissionIds||[],s]}))}}),(0,s.jsxs)(C.Label,{htmlFor:`permission-${e.id}`,className:"text-sm font-normal cursor-pointer leading-tight",children:[(0,s.jsx)("div",{children:e.displayName}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.resource,":",e.action]})]})]},e.id))})}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[t.permissionIds?.length||0," permissions selected"]})]})]}),(0,s.jsxs)($.DialogFooter,{children:[(0,s.jsx)(b.Button,{type:"button",variant:"outline",onClick:i,children:"Cancel"}),(0,s.jsx)(b.Button,{type:"submit",disabled:c,children:c?"Creating...":"Create Role"})]})]})]})})},e_=({isOpen:e,role:i,onClose:r,onSuccess:t})=>{let[l,n]=(0,a.useState)({name:"",displayName:"",description:"",priority:0,isActive:!0}),[c,{loading:d}]=(0,o.useMutation)(eP,{onCompleted:()=>{eE.toast.success("Role updated successfully")},onError:e=>{console.error("Error updating role:",e),eE.toast.error("Failed to update role")},refetchQueries:["SearchRoles","GetRoleById"]}),{data:m}=eB({page:0,size:100,isActive:!0}),{toast:h}=(0,y.useToast)();(0,a.useEffect)(()=>{i&&n({name:i.name,displayName:i.displayName,description:i.description||"",priority:i.priority,isActive:i.isActive})},[i]);let x=async e=>{e.preventDefault();try{await c({variables:{id:i.id,input:l}}),h({title:"Role updated",description:`Role "${l.displayName}" has been updated successfully.`,type:"success"}),t()}catch(e){h({title:"Update failed",description:e.message||"Failed to update role",type:"error"})}};return(0,s.jsx)($.Dialog,{open:e,onOpenChange:r,children:(0,s.jsxs)($.DialogContent,{className:"max-w-2xl",children:[(0,s.jsxs)($.DialogHeader,{children:[(0,s.jsxs)($.DialogTitle,{children:["Edit Role: ",i.displayName]}),(0,s.jsx)($.DialogDescription,{children:"Update role information and settings"})]}),(0,s.jsxs)("form",{onSubmit:x,className:"space-y-4",children:[i.isSystemRole&&(0,s.jsxs)(k.Alert,{className:"border-yellow-200 bg-yellow-50",children:[(0,s.jsx)(I.AlertCircle,{className:"h-4 w-4 text-yellow-600"}),(0,s.jsxs)(k.AlertDescription,{className:"text-yellow-800",children:[(0,s.jsx)("strong",{children:"System Role:"})," Some properties cannot be modified to ensure system stability."]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"name",children:["Role Name ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(w.Input,{id:"name",required:!0,value:l.name||"",onChange:e=>n(s=>({...s,name:e.target.value})),placeholder:"e.g., user_manager",disabled:i.isSystemRole}),i.isSystemRole&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"System role names cannot be changed"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"displayName",children:["Display Name ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(w.Input,{id:"displayName",required:!0,value:l.displayName||"",onChange:e=>n(s=>({...s,displayName:e.target.value})),placeholder:"e.g., User Manager"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(C.Label,{htmlFor:"description",children:"Description"}),(0,s.jsx)(eO.Textarea,{id:"description",rows:3,value:l.description||"",onChange:e=>n(s=>({...s,description:e.target.value})),placeholder:"Describe the role's purpose and responsibilities"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(C.Label,{htmlFor:"priority",children:"Priority"}),(0,s.jsx)(w.Input,{id:"priority",type:"number",value:l.priority||0,onChange:e=>n(s=>({...s,priority:parseInt(e.target.value)||0})),placeholder:"0"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Higher numbers have higher priority"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eG.Checkbox,{id:"isActive",checked:l.isActive||!1,onCheckedChange:e=>n(s=>({...s,isActive:e})),disabled:i.isSystemRole}),(0,s.jsx)(C.Label,{htmlFor:"isActive",className:"text-sm font-normal cursor-pointer",children:"Active"})]}),i.isSystemRole&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"System roles cannot be deactivated"})]}),(0,s.jsxs)($.DialogFooter,{children:[(0,s.jsx)(b.Button,{type:"button",variant:"outline",onClick:r,children:"Cancel"}),(0,s.jsx)(b.Button,{type:"submit",disabled:d,children:d?"Updating...":"Update Role"})]})]})]})})},eK=({className:e=""})=>{let[i,r]=(0,a.useState)({page:0,size:20,sortBy:"name",sortOrder:"asc"}),[t,n]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null),[m,h]=(0,a.useState)(null),{data:x,loading:u,error:p,refetch:j}=eL(i),[g]=(0,o.useMutation)(eU,{onCompleted:()=>{eE.toast.success("Role deleted successfully")},onError:e=>{console.error("Error deleting role:",e),eE.toast.error("Failed to delete role")},refetchQueries:["SearchRoles"]}),{toast:N}=(0,y.useToast)(),v=e=>{r(s=>({...s,page:e}))},f=async e=>{if(e.isSystemRole)return void N({title:"Cannot delete system role",description:"System roles cannot be deleted for security reasons.",type:"error"});if(window.confirm(`Are you sure you want to delete role "${e.displayName}"?`))try{await g({variables:{id:e.id}}),N({title:"Role deleted",description:`Role "${e.displayName}" has been deleted successfully.`,type:"success"}),j()}catch(e){N({title:"Delete failed",description:e.message||"Failed to delete role",type:"error"})}};if(u)return(0,s.jsxs)(A.Card,{className:e,children:[(0,s.jsxs)(A.CardHeader,{children:[(0,s.jsx)(eh.Skeleton,{className:"h-8 w-48"}),(0,s.jsx)(eh.Skeleton,{className:"h-4 w-96"})]}),(0,s.jsx)(A.CardContent,{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(eh.Skeleton,{className:"h-10 w-10 rounded-full"}),(0,s.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,s.jsx)(eh.Skeleton,{className:"h-4 w-[250px]"}),(0,s.jsx)(eh.Skeleton,{className:"h-4 w-[200px]"})]})]},a))})]});if(p)return(0,s.jsx)(k.Alert,{className:`border-red-200 bg-red-50 text-red-800 ${e}`,children:(0,s.jsxs)(k.AlertDescription,{children:["Error loading roles: ",p.message]})});let C=x?.searchRoles?.roles||[],T=x?.searchRoles?.total||0,R=x?.searchRoles?.totalPages||0;return(0,s.jsxs)(A.Card,{className:e,children:[(0,s.jsx)(A.CardHeader,{children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(A.CardTitle,{children:"Role Management"}),(0,s.jsx)(A.CardDescription,{children:"Manage system roles and their permissions"})]}),(0,s.jsxs)(b.Button,{onClick:()=>n(!0),children:[(0,s.jsx)(eb.Plus,{className:"mr-2 h-4 w-4"}),"New Role"]})]})}),(0,s.jsxs)(A.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(w.Input,{type:"text",placeholder:"Search roles...",value:i.search||"",onChange:e=>{var s;return s=e.target.value,void r(e=>({...e,search:s,page:0}))}})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(S.Select,{value:void 0===i.isActive?"all":i.isActive.toString(),onValueChange:e=>r(s=>({...s,isActive:"all"===e?void 0:"true"===e,page:0})),children:[(0,s.jsx)(S.SelectTrigger,{className:"w-[140px]",children:(0,s.jsx)(S.SelectValue,{placeholder:"All Status"})}),(0,s.jsxs)(S.SelectContent,{children:[(0,s.jsx)(S.SelectItem,{value:"all",children:"All Status"}),(0,s.jsx)(S.SelectItem,{value:"true",children:"Active"}),(0,s.jsx)(S.SelectItem,{value:"false",children:"Inactive"})]})]}),(0,s.jsxs)(S.Select,{value:void 0===i.isSystemRole?"all":i.isSystemRole.toString(),onValueChange:e=>r(s=>({...s,isSystemRole:"all"===e?void 0:"true"===e,page:0})),children:[(0,s.jsx)(S.SelectTrigger,{className:"w-[140px]",children:(0,s.jsx)(S.SelectValue,{placeholder:"All Types"})}),(0,s.jsxs)(S.SelectContent,{children:[(0,s.jsx)(S.SelectItem,{value:"all",children:"All Types"}),(0,s.jsx)(S.SelectItem,{value:"true",children:"System"}),(0,s.jsx)(S.SelectItem,{value:"false",children:"Custom"})]})]})]})]}),(0,s.jsx)("div",{className:"rounded-md border",children:(0,s.jsxs)(ex.Table,{children:[(0,s.jsx)(ex.TableHeader,{children:(0,s.jsxs)(ex.TableRow,{children:[(0,s.jsx)(ex.TableHead,{children:"Role"}),(0,s.jsx)(ex.TableHead,{children:"Permissions"}),(0,s.jsx)(ex.TableHead,{children:"Status"}),(0,s.jsx)(ex.TableHead,{children:"Priority"}),(0,s.jsx)(ex.TableHead,{children:"Created"}),(0,s.jsx)(ex.TableHead,{className:"text-right",children:"Actions"})]})}),(0,s.jsx)(ex.TableBody,{children:0===C.length?(0,s.jsx)(ex.TableRow,{children:(0,s.jsx)(ex.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No roles found"})}):C.map(e=>(0,s.jsxs)(ex.TableRow,{children:[(0,s.jsx)(ex.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(K.Avatar,{children:(0,s.jsx)(K.AvatarFallback,{className:"bg-muted",children:(0,s.jsx)(l.Users,{className:"h-5 w-5 text-muted-foreground"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.displayName}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.name,e.isSystemRole&&(0,s.jsx)(_.Badge,{variant:"secondary",className:"text-xs",children:"System"})]}),e.description&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:e.description})]})]})}),(0,s.jsxs)(ex.TableCell,{children:[(0,s.jsxs)("div",{children:[e.permissions?.length||0," permissions"]}),e.children&&e.children.length>0&&(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[e.children.length," child roles"]})]}),(0,s.jsx)(ex.TableCell,{children:(0,s.jsx)(_.Badge,{variant:e.isActive?"default":"destructive",children:e.isActive?"Active":"Inactive"})}),(0,s.jsx)(ex.TableCell,{children:e.priority}),(0,s.jsx)(ex.TableCell,{children:new Date(e.createdAt).toLocaleDateString()}),(0,s.jsx)(ex.TableCell,{className:"text-right",children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(b.Button,{variant:"ghost",size:"icon",onClick:()=>h(e),title:"Manage Permissions",children:(0,s.jsx)(ey.ShieldCheck,{className:"h-4 w-4"})}),(0,s.jsx)(b.Button,{variant:"ghost",size:"icon",onClick:()=>d(e),title:"Edit Role",children:(0,s.jsx)(ew.Pencil,{className:"h-4 w-4"})}),!e.isSystemRole&&(0,s.jsx)(b.Button,{variant:"ghost",size:"icon",onClick:()=>f(e),title:"Delete Role",children:(0,s.jsx)(Z.Trash2,{className:"h-4 w-4 text-destructive"})})]})})]},e.id))})]})}),R>1&&(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(i.page||0)*(i.size||20)+1," to"," ",Math.min(((i.page||0)+1)*(i.size||20),T)," of ",T," results"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(b.Button,{variant:"outline",size:"sm",onClick:()=>v((i.page||0)-1),disabled:0>=(i.page||0),children:"Previous"}),(0,s.jsxs)("div",{className:"text-sm font-medium px-3 py-1 bg-muted rounded-md",children:[(i.page||0)+1," / ",R]}),(0,s.jsx)(b.Button,{variant:"outline",size:"sm",onClick:()=>v((i.page||0)+1),disabled:(i.page||0)>=R-1,children:"Next"})]})]})]}),t&&(0,s.jsx)(eQ,{isOpen:t,onClose:()=>n(!1),onSuccess:()=>{n(!1),j()}}),c&&(0,s.jsx)(e_,{isOpen:!!c,role:c,onClose:()=>d(null),onSuccess:()=>{d(null),j()}}),m&&(0,s.jsx)(ez,{isOpen:!!m,role:m,onClose:()=>h(null),onSuccess:()=>{h(null),j()}})]})},eY=({isOpen:e,onClose:i,onSuccess:r})=>{let[t,l]=(0,a.useState)({name:"",displayName:"",description:"",resource:"",action:"",scope:"",category:"general"}),[n,{loading:c}]=(0,o.useMutation)(eS,{onCompleted:()=>{eE.toast.success("Permission created successfully")},onError:e=>{console.error("Error creating permission:",e),eE.toast.error("Failed to create permission")},refetchQueries:["SearchPermissions"]}),{toast:d}=(0,y.useToast)(),m=async e=>{e.preventDefault();try{await n({variables:{input:{...t,scope:t.scope||void 0}}}),d({title:"Permission created",description:`Permission "${t.displayName}" has been created successfully.`,type:"success"}),r()}catch(e){d({title:"Create failed",description:e.message||"Failed to create permission",type:"error"})}};return(0,s.jsx)($.Dialog,{open:e,onOpenChange:i,children:(0,s.jsxs)($.DialogContent,{className:"max-w-2xl",children:[(0,s.jsxs)($.DialogHeader,{children:[(0,s.jsx)($.DialogTitle,{children:"Create New Permission"}),(0,s.jsx)($.DialogDescription,{children:"Define a new permission for the RBAC system. Use the format resource:action:scope for the permission name."})]}),(0,s.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"name",children:["Permission Name ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(w.Input,{id:"name",required:!0,value:t.name,onChange:e=>l(s=>({...s,name:e.target.value})),placeholder:"e.g., user:read:own"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Use the format: resource:action:scope"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"displayName",children:["Display Name ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(w.Input,{id:"displayName",required:!0,value:t.displayName,onChange:e=>l(s=>({...s,displayName:e.target.value})),placeholder:"e.g., Read Own User Data"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(C.Label,{htmlFor:"description",children:"Description"}),(0,s.jsx)(eO.Textarea,{id:"description",rows:3,value:t.description||"",onChange:e=>l(s=>({...s,description:e.target.value})),placeholder:"Describe what this permission allows"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"resource",children:["Resource ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(w.Input,{id:"resource",required:!0,value:t.resource,onChange:e=>l(s=>({...s,resource:e.target.value})),placeholder:"e.g., user, post, comment"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"action",children:["Action ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(w.Input,{id:"action",required:!0,value:t.action,onChange:e=>l(s=>({...s,action:e.target.value})),placeholder:"e.g., read, write, delete"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(C.Label,{htmlFor:"scope",children:"Scope"}),(0,s.jsx)(w.Input,{id:"scope",value:t.scope||"",onChange:e=>l(s=>({...s,scope:e.target.value})),placeholder:"e.g., own, all, team (optional)"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Optional scope qualifier for the permission"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"category",children:["Category ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsxs)(S.Select,{value:t.category||"general",onValueChange:e=>l(s=>({...s,category:e})),children:[(0,s.jsx)(S.SelectTrigger,{children:(0,s.jsx)(S.SelectValue,{})}),(0,s.jsx)(S.SelectContent,{children:["general","user","admin","content","system","reporting","billing","integration"].map(e=>(0,s.jsx)(S.SelectItem,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]})]}),(0,s.jsxs)($.DialogFooter,{children:[(0,s.jsx)(b.Button,{type:"button",variant:"outline",onClick:i,children:"Cancel"}),(0,s.jsx)(b.Button,{type:"submit",disabled:c,children:c?"Creating...":"Create Permission"})]})]})]})})},eX=({isOpen:e,permission:i,onClose:r,onSuccess:t})=>{let[l,n]=(0,a.useState)({name:"",displayName:"",description:"",resource:"",action:"",scope:"",category:"general",isActive:!0}),[c,{loading:d}]=(0,o.useMutation)(eA,{onCompleted:()=>{eE.toast.success("Permission updated successfully")},onError:e=>{console.error("Error updating permission:",e),eE.toast.error("Failed to update permission")},refetchQueries:["SearchPermissions","GetPermissionById"]}),{toast:m}=(0,y.useToast)();(0,a.useEffect)(()=>{i&&n({name:i.name,displayName:i.displayName,description:i.description||"",resource:i.resource,action:i.action,scope:i.scope||"",category:i.category,isActive:i.isActive})},[i]);let h=async e=>{e.preventDefault();try{await c({variables:{id:i.id,input:{...l,scope:l.scope||void 0}}}),m({title:"Permission updated",description:`Permission "${l.displayName}" has been updated successfully.`,type:"success"}),t()}catch(e){m({title:"Update failed",description:e.message||"Failed to update permission",type:"error"})}};return(0,s.jsx)($.Dialog,{open:e,onOpenChange:r,children:(0,s.jsxs)($.DialogContent,{className:"max-w-2xl",children:[(0,s.jsxs)($.DialogHeader,{children:[(0,s.jsxs)($.DialogTitle,{children:["Edit Permission: ",i.displayName]}),(0,s.jsx)($.DialogDescription,{children:"Update permission details. System permissions have limited editability to ensure system stability."})]}),(0,s.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[i.isSystemPerm&&(0,s.jsxs)(k.Alert,{children:[(0,s.jsx)(I.AlertCircle,{className:"h-4 w-4"}),(0,s.jsx)(k.AlertDescription,{children:"This is a system permission. Some properties cannot be modified to ensure system stability."})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"name",children:["Permission Name ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(w.Input,{id:"name",required:!0,value:l.name||"",onChange:e=>n(s=>({...s,name:e.target.value})),placeholder:"e.g., user:read:own",disabled:i.isSystemPerm}),i.isSystemPerm&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"System permission names cannot be changed"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"displayName",children:["Display Name ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(w.Input,{id:"displayName",required:!0,value:l.displayName||"",onChange:e=>n(s=>({...s,displayName:e.target.value})),placeholder:"e.g., Read Own User Data"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(C.Label,{htmlFor:"description",children:"Description"}),(0,s.jsx)(eO.Textarea,{id:"description",rows:3,value:l.description||"",onChange:e=>n(s=>({...s,description:e.target.value})),placeholder:"Describe what this permission allows"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"resource",children:["Resource ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(w.Input,{id:"resource",required:!0,value:l.resource||"",onChange:e=>n(s=>({...s,resource:e.target.value})),placeholder:"e.g., user, post, comment",disabled:i.isSystemPerm})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"action",children:["Action ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(w.Input,{id:"action",required:!0,value:l.action||"",onChange:e=>n(s=>({...s,action:e.target.value})),placeholder:"e.g., read, write, delete",disabled:i.isSystemPerm})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(C.Label,{htmlFor:"scope",children:"Scope"}),(0,s.jsx)(w.Input,{id:"scope",value:l.scope||"",onChange:e=>n(s=>({...s,scope:e.target.value})),placeholder:"e.g., own, all, team (optional)",disabled:i.isSystemPerm}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Optional scope qualifier for the permission"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(C.Label,{htmlFor:"category",children:["Category ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsxs)(S.Select,{value:l.category||"general",onValueChange:e=>n(s=>({...s,category:e})),children:[(0,s.jsx)(S.SelectTrigger,{children:(0,s.jsx)(S.SelectValue,{})}),(0,s.jsx)(S.SelectContent,{children:["general","user","admin","content","system","reporting","billing","integration"].map(e=>(0,s.jsx)(S.SelectItem,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eG.Checkbox,{id:"isActive",checked:l.isActive||!1,onCheckedChange:e=>n(s=>({...s,isActive:e})),disabled:i.isSystemPerm}),(0,s.jsx)(C.Label,{htmlFor:"isActive",className:"font-normal cursor-pointer",children:"Active"})]}),i.isSystemPerm&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"System permissions cannot be deactivated"})]}),(0,s.jsxs)($.DialogFooter,{children:[(0,s.jsx)(b.Button,{type:"button",variant:"outline",onClick:r,children:"Cancel"}),(0,s.jsx)(b.Button,{type:"submit",disabled:d,children:d?"Updating...":"Update Permission"})]})]})]})})},eZ=({className:e=""})=>{let[i,r]=(0,a.useState)({page:0,size:20,sortBy:"name",sortOrder:"asc"}),[t,l]=(0,a.useState)(!1),[n,c]=(0,a.useState)(null),{data:d,loading:m,error:h,refetch:x}=eB(i),[u]=(0,o.useMutation)(eT,{onCompleted:()=>{eE.toast.success("Permission deleted successfully")},onError:e=>{console.error("Error deleting permission:",e),eE.toast.error("Failed to delete permission")},refetchQueries:["SearchPermissions"]}),{toast:p}=(0,y.useToast)(),j=e=>{r(s=>({...s,page:e}))},g=async e=>{if(e.isSystemPerm)return void p({title:"Cannot delete system permission",description:"System permissions cannot be deleted for security reasons.",type:"error"});if(window.confirm(`Are you sure you want to delete permission "${e.displayName}"?`))try{await u({variables:{id:e.id}}),p({title:"Permission deleted",description:`Permission "${e.displayName}" has been deleted successfully.`,type:"success"}),x()}catch(e){p({title:"Delete failed",description:e.message||"Failed to delete permission",type:"error"})}};if(m)return(0,s.jsxs)(A.Card,{className:e,children:[(0,s.jsxs)(A.CardHeader,{children:[(0,s.jsx)(eh.Skeleton,{className:"h-8 w-48"}),(0,s.jsx)(eh.Skeleton,{className:"h-4 w-96"})]}),(0,s.jsx)(A.CardContent,{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(eh.Skeleton,{className:"h-10 w-10 rounded-full"}),(0,s.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,s.jsx)(eh.Skeleton,{className:"h-4 w-[250px]"}),(0,s.jsx)(eh.Skeleton,{className:"h-4 w-[200px]"})]})]},a))})]});if(h)return(0,s.jsx)(k.Alert,{className:`border-red-200 bg-red-50 text-red-800 ${e}`,children:(0,s.jsxs)(k.AlertDescription,{children:["Error loading permissions: ",h.message]})});let N=d?.searchPermissions?.permissions||[],v=d?.searchPermissions?.total||0,f=d?.searchPermissions?.totalPages||0;return(0,s.jsxs)(A.Card,{className:e,children:[(0,s.jsx)(A.CardHeader,{children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(A.CardTitle,{children:"Permission Management"}),(0,s.jsx)(A.CardDescription,{children:"Define and manage system permissions"})]}),(0,s.jsxs)(b.Button,{onClick:()=>l(!0),children:[(0,s.jsx)(eb.Plus,{className:"mr-2 h-4 w-4"}),"New Permission"]})]})}),(0,s.jsxs)(A.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(w.Input,{type:"text",placeholder:"Search permissions...",value:i.search||"",onChange:e=>{var s;return s=e.target.value,void r(e=>({...e,search:s,page:0}))}})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(w.Input,{type:"text",placeholder:"Resource",value:i.resource||"",onChange:e=>r(s=>({...s,resource:e.target.value||void 0,page:0})),className:"w-32"}),(0,s.jsx)(w.Input,{type:"text",placeholder:"Action",value:i.action||"",onChange:e=>r(s=>({...s,action:e.target.value||void 0,page:0})),className:"w-32"}),(0,s.jsxs)(S.Select,{value:void 0===i.isActive?"all":i.isActive.toString(),onValueChange:e=>r(s=>({...s,isActive:"all"===e?void 0:"true"===e,page:0})),children:[(0,s.jsx)(S.SelectTrigger,{className:"w-[140px]",children:(0,s.jsx)(S.SelectValue,{placeholder:"All Status"})}),(0,s.jsxs)(S.SelectContent,{children:[(0,s.jsx)(S.SelectItem,{value:"all",children:"All Status"}),(0,s.jsx)(S.SelectItem,{value:"true",children:"Active"}),(0,s.jsx)(S.SelectItem,{value:"false",children:"Inactive"})]})]})]})]}),(0,s.jsx)("div",{className:"rounded-md border",children:(0,s.jsxs)(ex.Table,{children:[(0,s.jsx)(ex.TableHeader,{children:(0,s.jsxs)(ex.TableRow,{children:[(0,s.jsx)(ex.TableHead,{children:"Permission"}),(0,s.jsx)(ex.TableHead,{children:"Resource:Action"}),(0,s.jsx)(ex.TableHead,{children:"Category"}),(0,s.jsx)(ex.TableHead,{children:"Status"}),(0,s.jsx)(ex.TableHead,{children:"Created"}),(0,s.jsx)(ex.TableHead,{className:"text-right",children:"Actions"})]})}),(0,s.jsx)(ex.TableBody,{children:0===N.length?(0,s.jsx)(ex.TableRow,{children:(0,s.jsx)(ex.TableCell,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No permissions found"})}):N.map(e=>(0,s.jsxs)(ex.TableRow,{children:[(0,s.jsx)(ex.TableCell,{children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(K.Avatar,{children:(0,s.jsx)(K.AvatarFallback,{className:"bg-muted",children:(0,s.jsx)(L.Key,{className:"h-5 w-5 text-muted-foreground"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.displayName}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.name,e.isSystemPerm&&(0,s.jsx)(_.Badge,{variant:"secondary",className:"text-xs",children:"System"})]}),e.description&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:e.description})]})]})}),(0,s.jsx)(ex.TableCell,{children:(0,s.jsxs)("div",{children:[e.resource,":",e.action,e.scope&&(0,s.jsxs)("span",{className:"text-muted-foreground",children:[":",e.scope]})]})}),(0,s.jsx)(ex.TableCell,{children:(0,s.jsx)(_.Badge,{variant:"outline",children:e.category})}),(0,s.jsx)(ex.TableCell,{children:(0,s.jsx)(_.Badge,{variant:e.isActive?"default":"destructive",children:e.isActive?"Active":"Inactive"})}),(0,s.jsx)(ex.TableCell,{children:new Date(e.createdAt).toLocaleDateString()}),(0,s.jsx)(ex.TableCell,{className:"text-right",children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(b.Button,{variant:"ghost",size:"icon",onClick:()=>c(e),title:"Edit Permission",children:(0,s.jsx)(ew.Pencil,{className:"h-4 w-4"})}),!e.isSystemPerm&&(0,s.jsx)(b.Button,{variant:"ghost",size:"icon",onClick:()=>g(e),title:"Delete Permission",children:(0,s.jsx)(Z.Trash2,{className:"h-4 w-4 text-destructive"})})]})})]},e.id))})]})}),f>1&&(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",(i.page||0)*(i.size||20)+1," to"," ",Math.min(((i.page||0)+1)*(i.size||20),v)," of ",v," results"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(b.Button,{variant:"outline",size:"sm",onClick:()=>j((i.page||0)-1),disabled:0>=(i.page||0),children:"Previous"}),(0,s.jsxs)("div",{className:"text-sm font-medium px-3 py-1 bg-muted rounded-md",children:[(i.page||0)+1," / ",f]}),(0,s.jsx)(b.Button,{variant:"outline",size:"sm",onClick:()=>j((i.page||0)+1),disabled:(i.page||0)>=f-1,children:"Next"})]})]})]}),t&&(0,s.jsx)(eY,{isOpen:t,onClose:()=>l(!1),onSuccess:()=>{l(!1),x()}}),n&&(0,s.jsx)(eX,{isOpen:!!n,permission:n,onClose:()=>c(null),onSuccess:()=>{c(null),x()}})]})};var eJ=e.i(909905),eW=e.i(67087),e0=e.i(112641);let e4=({isOpen:e,user:i,onClose:r})=>{let[l,c]=(0,a.useState)([]),[d,m]=(0,a.useState)([]),{toast:h}=(0,y.useToast)(),{data:x,loading:u,refetch:p}=eM(i?.id),{data:j}=eL({page:0,size:100,isActive:!0}),{data:g}=eB({page:0,size:100,isActive:!0}),[N,{loading:v}]=(0,o.useMutation)(eF,{onCompleted:()=>{eE.toast.success("User roles updated successfully")},onError:e=>{console.error("Error assigning user roles:",e),eE.toast.error("Failed to update user roles")},refetchQueries:["GetUserRolePermissions","SearchUsers"]}),[f,{loading:w}]=(0,o.useMutation)(e$,{onCompleted:()=>{eE.toast.success("User permissions updated successfully")},onError:e=>{console.error("Error assigning user permissions:",e),eE.toast.error("Failed to update user permissions")},refetchQueries:["GetUserRolePermissions","SearchUsers"]}),S=j?.searchRoles?.roles||[],T=g?.searchPermissions?.permissions||[];(0,a.useEffect)(()=>{if(x&&S.length>0){let e=x.getUserRolePermissions?.roleAssignments||[];c(S.map(s=>{let a=e.find(e=>e.role.id===s.id);return{roleId:s.id,effect:a?a.effect:null}}))}},[x,S]),(0,a.useEffect)(()=>{if(x&&T.length>0){let e=x.getUserRolePermissions?.directPermissions||[];m(T.map(s=>{let a=e.find(e=>e.permission.id===s.id);return{permissionId:s.id,effect:a?a.effect:null}}))}},[x,T]);let k=async()=>{let e=l.filter(e=>null!==e.effect).map(e=>({roleId:e.roleId,effect:e.effect})),s={userId:i.id,assignments:e};try{await N({variables:{input:s}}),h({title:"Roles updated",description:`Role assignments for ${i.displayName||i.username} have been updated successfully.`,type:"success"}),p()}catch(e){h({title:"Update failed",description:e.message||"Failed to update role assignments",type:"error"})}},R=async()=>{let e=d.filter(e=>null!==e.effect).map(e=>({permissionId:e.permissionId,effect:e.effect})),s={userId:i.id,assignments:e};try{await f({variables:{input:s}}),h({title:"Permissions updated",description:`Permission assignments for ${i.displayName||i.username} have been updated successfully.`,type:"success"}),p()}catch(e){h({title:"Update failed",description:e.message||"Failed to update permission assignments",type:"error"})}},P=x?.getUserRolePermissions?.summary,U=x?.getUserRolePermissions?.effectivePermissions||[],I=l.filter(e=>null!==e.effect).length,D=d.filter(e=>null!==e.effect).length;return(0,s.jsx)($.Dialog,{open:e,onOpenChange:r,children:(0,s.jsxs)($.DialogContent,{className:"max-w-6xl max-h-[90vh] p-0",children:[(0,s.jsxs)($.DialogHeader,{className:"p-6 pb-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,s.jsxs)(K.Avatar,{className:"h-12 w-12",children:[(0,s.jsx)(K.AvatarImage,{src:i?.avatar,alt:i?.displayName||i?.username}),(0,s.jsx)(K.AvatarFallback,{children:(0,s.jsx)(eJ.User,{className:"h-6 w-6"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)($.DialogTitle,{children:i?.displayName||i?.username}),(0,s.jsx)($.DialogDescription,{children:i?.email})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4 mt-4",children:[(0,s.jsx)(A.Card,{children:(0,s.jsxs)(A.CardHeader,{className:"pb-2",children:[(0,s.jsxs)(A.CardDescription,{className:"flex items-center gap-2",children:[(0,s.jsx)(n.Shield,{className:"h-4 w-4"}),"Roles"]}),(0,s.jsx)(A.CardTitle,{className:"text-2xl text-primary",children:P?.totalRoleAssignments||0})]})}),(0,s.jsx)(A.Card,{children:(0,s.jsxs)(A.CardHeader,{className:"pb-2",children:[(0,s.jsxs)(A.CardDescription,{className:"flex items-center gap-2",children:[(0,s.jsx)(L.Key,{className:"h-4 w-4"}),"Direct Permissions"]}),(0,s.jsx)(A.CardTitle,{className:"text-2xl text-green-600",children:P?.totalDirectPermissions||0})]})}),(0,s.jsx)(A.Card,{children:(0,s.jsxs)(A.CardHeader,{className:"pb-2",children:[(0,s.jsxs)(A.CardDescription,{className:"flex items-center gap-2",children:[(0,s.jsx)(e0.CheckCircle2,{className:"h-4 w-4"}),"Total Permissions"]}),(0,s.jsx)(A.CardTitle,{className:"text-2xl text-purple-600",children:P?.totalEffectivePermissions||0})]})}),(0,s.jsx)(A.Card,{children:(0,s.jsxs)(A.CardHeader,{className:"pb-2",children:[(0,s.jsxs)(A.CardDescription,{className:"flex items-center gap-2",children:[(0,s.jsx)(ei.Calendar,{className:"h-4 w-4"}),"Last Updated"]}),(0,s.jsx)(A.CardTitle,{className:"text-sm",children:P?.lastUpdated?new Date(P.lastUpdated).toLocaleDateString():"Never"})]})})]})]}),(0,s.jsxs)(t.Tabs,{defaultValue:"roles",className:"px-6",children:[(0,s.jsxs)(t.TabsList,{className:"grid w-full grid-cols-3",children:[(0,s.jsxs)(t.TabsTrigger,{value:"roles",children:["Role Assignments",I>0&&(0,s.jsx)(_.Badge,{variant:"secondary",className:"ml-2",children:I})]}),(0,s.jsxs)(t.TabsTrigger,{value:"permissions",children:["Permission Assignments",D>0&&(0,s.jsx)(_.Badge,{variant:"secondary",className:"ml-2",children:D})]}),(0,s.jsxs)(t.TabsTrigger,{value:"effective",children:["Effective Permissions",(0,s.jsx)(_.Badge,{variant:"secondary",className:"ml-2",children:U.length})]})]}),(0,s.jsxs)(t.TabsContent,{value:"roles",className:"space-y-4",children:[(0,s.jsx)(eH.ScrollArea,{className:"h-[400px] border rounded-lg",children:(0,s.jsx)("div",{className:"divide-y",children:S.map(e=>{let a=l.find(s=>s.roleId===e.id);return(0,s.jsx)("div",{className:"p-4 hover:bg-muted/50 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.Shield,{className:"h-4 w-4 text-primary"}),(0,s.jsx)("span",{className:"font-medium",children:e.displayName}),e.isSystemRole&&(0,s.jsx)(_.Badge,{variant:"secondary",className:"text-xs",children:"System"})]}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:e.name}),e.description&&(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:e.description})]}),(0,s.jsxs)(eq.RadioGroup,{value:a?.effect||"none",onValueChange:s=>{var a,i;return a=e.id,i="none"===s?null:s,void c(e=>e.map(e=>e.roleId===a?{...e,effect:i}:e))},className:"flex gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eq.RadioGroupItem,{value:"none",id:`role-${e.id}-none`}),(0,s.jsx)(C.Label,{htmlFor:`role-${e.id}-none`,className:"font-normal cursor-pointer",children:"None"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eq.RadioGroupItem,{value:"allow",id:`role-${e.id}-allow`}),(0,s.jsx)(C.Label,{htmlFor:`role-${e.id}-allow`,className:"font-normal cursor-pointer text-green-600",children:"Assign"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eq.RadioGroupItem,{value:"deny",id:`role-${e.id}-deny`}),(0,s.jsx)(C.Label,{htmlFor:`role-${e.id}-deny`,className:"font-normal cursor-pointer text-destructive",children:"Deny"})]})]})]})},e.id)})})}),(0,s.jsx)("div",{className:"flex justify-end pt-4 pb-6",children:(0,s.jsx)(b.Button,{onClick:k,disabled:v,children:v?"Saving...":"Save Role Assignments"})})]}),(0,s.jsxs)(t.TabsContent,{value:"permissions",className:"space-y-4",children:[(0,s.jsx)(eH.ScrollArea,{className:"h-[400px] border rounded-lg",children:(0,s.jsx)("div",{className:"divide-y",children:T.map(e=>{let a=d.find(s=>s.permissionId===e.id);return(0,s.jsx)("div",{className:"p-4 hover:bg-muted/50 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(L.Key,{className:"h-4 w-4 text-green-600"}),(0,s.jsx)("span",{className:"font-medium",children:e.displayName})]}),e.description&&(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:e.description}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsxs)("code",{className:"px-2 py-0.5 rounded bg-muted text-xs",children:[e.resource,":",e.action,e.scope&&`:${e.scope}`]}),(0,s.jsx)(_.Badge,{variant:"outline",className:"text-xs",children:e.category})]})]}),(0,s.jsxs)(eq.RadioGroup,{value:a?.effect||"none",onValueChange:s=>{var a,i;return a=e.id,i="none"===s?null:s,void m(e=>e.map(e=>e.permissionId===a?{...e,effect:i}:e))},className:"flex gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eq.RadioGroupItem,{value:"none",id:`perm-${e.id}-none`}),(0,s.jsx)(C.Label,{htmlFor:`perm-${e.id}-none`,className:"font-normal cursor-pointer",children:"None"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eq.RadioGroupItem,{value:"allow",id:`perm-${e.id}-allow`}),(0,s.jsx)(C.Label,{htmlFor:`perm-${e.id}-allow`,className:"font-normal cursor-pointer text-green-600",children:"Allow"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eq.RadioGroupItem,{value:"deny",id:`perm-${e.id}-deny`}),(0,s.jsx)(C.Label,{htmlFor:`perm-${e.id}-deny`,className:"font-normal cursor-pointer text-destructive",children:"Deny"})]})]})]})},e.id)})})}),(0,s.jsx)("div",{className:"flex justify-end pt-4 pb-6",children:(0,s.jsx)(b.Button,{onClick:R,disabled:w,children:w?"Saving...":"Save Permission Assignments"})})]}),(0,s.jsx)(t.TabsContent,{value:"effective",className:"space-y-4",children:(0,s.jsx)(eH.ScrollArea,{className:"h-[450px] border rounded-lg",children:(0,s.jsxs)("div",{className:"divide-y",children:[U.map(e=>(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,s.jsx)("div",{className:"font-medium",children:e.permission.displayName}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:[e.permission.resource,":",e.permission.action,e.permission.scope&&`:${e.permission.scope}`]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,s.jsx)(_.Badge,{variant:"allow"===e.effect?"default":"destructive",children:e.effect}),(0,s.jsx)(_.Badge,{variant:"outline",className:"text-xs",children:e.source}),e.fromRole&&(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:["via role: ",e.fromRole.displayName]})]})]})})},e.permission.id)),0===U.length&&(0,s.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"No effective permissions found for this user."})]})})})]})]})})},e1=({user:e})=>{let{data:a,loading:i}=eM(e.id);if(i)return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"grid grid-cols-3 gap-4",children:[void 0,void 0,void 0].map((e,a)=>(0,s.jsxs)("div",{className:"text-center space-y-2",children:[(0,s.jsx)(eh.Skeleton,{className:"h-8 w-16 mx-auto"}),(0,s.jsx)(eh.Skeleton,{className:"h-4 w-24 mx-auto"})]},a))}),(0,s.jsx)(eW.Separator,{}),(0,s.jsx)(eh.Skeleton,{className:"h-32 w-full"})]});let r=a?.getUserRolePermissions?.summary,t=a?.getUserRolePermissions?.roleAssignments||[],l=a?.getUserRolePermissions?.directPermissions||[];return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,s.jsxs)(A.Card,{className:"text-center p-4 border-2 hover:border-primary/50 transition-colors",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-primary",children:r?.totalRoleAssignments||0}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Roles"})]}),(0,s.jsxs)(A.Card,{className:"text-center p-4 border-2 hover:border-green-500/50 transition-colors",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:r?.totalDirectPermissions||0}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Direct Permissions"})]}),(0,s.jsxs)(A.Card,{className:"text-center p-4 border-2 hover:border-purple-500/50 transition-colors",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:r?.totalEffectivePermissions||0}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Permissions"})]})]}),(0,s.jsx)(eW.Separator,{}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[(0,s.jsx)(eJ.User,{className:"h-4 w-4"}),"Current Roles"]}),0===t.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No roles assigned"}):(0,s.jsxs)("div",{className:"space-y-2",children:[t.slice(0,3).map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg bg-accent/50 hover:bg-accent transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(K.Avatar,{className:"h-6 w-6",children:(0,s.jsx)(K.AvatarFallback,{className:"bg-primary/10",children:(0,s.jsx)(eJ.User,{className:"h-3 w-3 text-primary"})})}),(0,s.jsx)("p",{className:"text-sm font-medium",children:e.role.displayName})]}),(0,s.jsx)(_.Badge,{variant:"allow"===e.effect?"default":"destructive",children:e.effect})]},e.id)),t.length>3&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground text-center pt-2",children:["+",t.length-3," more roles"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[(0,s.jsx)(ey.ShieldCheck,{className:"h-4 w-4"}),"Direct Permissions"]}),0===l.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No direct permissions assigned"}):(0,s.jsxs)("div",{className:"space-y-2",children:[l.slice(0,3).map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-lg bg-accent/50 hover:bg-accent transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(K.Avatar,{className:"h-6 w-6",children:(0,s.jsx)(K.AvatarFallback,{className:"bg-green-100",children:(0,s.jsx)(ey.ShieldCheck,{className:"h-3 w-3 text-green-600"})})}),(0,s.jsx)("p",{className:"text-sm font-medium",children:e.permission.displayName})]}),(0,s.jsx)(_.Badge,{variant:"allow"===e.effect?"default":"destructive",children:e.effect})]},e.id)),l.length>3&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground text-center pt-2",children:["+",l.length-3," more permissions"]})]})]})]})},e2=({className:e=""})=>{let[i,r]=(0,a.useState)(""),[t,l]=(0,a.useState)(null),{data:n,loading:c}=f({search:i,page:0,size:50}),d=n?.searchUsers?.users||[];return c?(0,s.jsxs)("div",{className:`grid grid-cols-1 lg:grid-cols-2 gap-6 ${e}`,children:[(0,s.jsxs)(A.Card,{children:[(0,s.jsxs)(A.CardHeader,{children:[(0,s.jsx)(eh.Skeleton,{className:"h-6 w-32"}),(0,s.jsx)(eh.Skeleton,{className:"h-4 w-64"})]}),(0,s.jsx)(A.CardContent,{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,a)=>(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(eh.Skeleton,{className:"h-10 w-10 rounded-full"}),(0,s.jsxs)("div",{className:"space-y-2 flex-1",children:[(0,s.jsx)(eh.Skeleton,{className:"h-4 w-[200px]"}),(0,s.jsx)(eh.Skeleton,{className:"h-3 w-[150px]"})]})]},a))})]}),(0,s.jsxs)(A.Card,{children:[(0,s.jsxs)(A.CardHeader,{children:[(0,s.jsx)(eh.Skeleton,{className:"h-6 w-32"}),(0,s.jsx)(eh.Skeleton,{className:"h-4 w-64"})]}),(0,s.jsx)(A.CardContent,{children:(0,s.jsx)(eh.Skeleton,{className:"h-48 w-full"})})]})]}):(0,s.jsxs)("div",{className:`${e}`,children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(A.Card,{children:[(0,s.jsxs)(A.CardHeader,{children:[(0,s.jsx)(A.CardTitle,{children:"Select User"}),(0,s.jsx)(A.CardDescription,{children:"Choose a user to manage their roles and permissions"})]}),(0,s.jsxs)(A.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(eV.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(w.Input,{type:"text",placeholder:"Search users...",value:i,onChange:e=>r(e.target.value),className:"pl-10"})]}),(0,s.jsx)(eH.ScrollArea,{className:"h-[400px]",children:0===d.length?(0,s.jsx)("div",{className:"py-8 text-center text-muted-foreground",children:i?"No users found matching your search.":"No users available."}):(0,s.jsx)("div",{className:"space-y-2",children:d.map(e=>(0,s.jsx)("div",{onClick:()=>{l(e)},className:`p-3 rounded-lg hover:bg-accent cursor-pointer transition-colors ${t?.id===e.id?"bg-accent border-l-4 border-primary":""}`,children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(K.Avatar,{className:"h-10 w-10",children:e.avatar?(0,s.jsx)(K.AvatarImage,{src:e.avatar,alt:e.displayName||e.username}):(0,s.jsx)(K.AvatarFallback,{children:(0,s.jsx)(eJ.User,{className:"h-5 w-5"})})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium truncate",children:e.displayName||e.username}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e.email})]}),(0,s.jsx)(_.Badge,{variant:"ADMIN"===e.role?"default":"secondary",className:"shrink-0",children:e.role})]}),!1===e.isActive&&(0,s.jsx)(_.Badge,{variant:"destructive",className:"text-xs mt-1",children:"Inactive"})]})]})},e.id))})})]})]}),(0,s.jsxs)(A.Card,{children:[(0,s.jsx)(A.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(A.CardTitle,{children:t?"Role & Permission Details":"User Details"}),(0,s.jsx)(A.CardDescription,{children:t?`Manage roles and permissions for ${t.displayName||t.username}`:"Select a user to view their role and permission details"})]}),t&&(0,s.jsxs)(b.Button,{onClick:()=>l(t),variant:"secondary",size:"sm",children:[(0,s.jsx)(ey.ShieldCheck,{className:"mr-2 h-4 w-4"}),"Manage Access"]})]})}),(0,s.jsx)(A.CardContent,{children:t?(0,s.jsx)(e1,{user:t}):(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(eJ.User,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,s.jsx)("h3",{className:"mt-2 text-sm font-medium",children:"No user selected"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Select a user from the list to view their role and permission details."})]})})]})]}),t&&(0,s.jsx)(e4,{isOpen:!!t,user:t,onClose:()=>l(null)})]})},e3=({className:e=""})=>{let a=[{value:"roles",label:"Roles",icon:l.Users,component:eK,description:"Manage system roles and their hierarchies"},{value:"permissions",label:"Permissions",icon:L.Key,component:eZ,description:"Define and manage system permissions"},{value:"assignments",label:"User Assignments",icon:ey.ShieldCheck,component:e2,description:"Assign roles and permissions to users"}];return(0,s.jsx)("div",{className:e,children:(0,s.jsxs)(A.Card,{children:[(0,s.jsxs)(A.CardHeader,{children:[(0,s.jsx)(A.CardTitle,{children:"Role & Permission Management"}),(0,s.jsx)(A.CardDescription,{children:"Manage system access control, roles, and permissions"})]}),(0,s.jsx)(A.CardContent,{children:(0,s.jsxs)(t.Tabs,{defaultValue:"roles",className:"w-full",children:[(0,s.jsx)(t.TabsList,{className:"grid w-full grid-cols-3",children:a.map(e=>(0,s.jsxs)(t.TabsTrigger,{value:e.value,className:"flex items-center gap-2",children:[(0,s.jsx)(e.icon,{className:"h-4 w-4"}),e.label]},e.value))}),a.map(e=>(0,s.jsxs)(t.TabsContent,{value:e.value,className:"mt-6",children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description})}),(0,s.jsx)(e.component,{})]},e.value))]})})]})})};function e5(){let{user:e,loading:t,isAuthenticated:l}=(0,r.useAuth)(),n=(0,i.useRouter)(),[d,o]=(0,a.useState)("users");return((0,a.useEffect)(()=>{t||l?!t&&l&&e?.roleType!=="ADMIN"&&console.log("AdminUsersPage: User is not admin",{roleType:e?.roleType}):(console.log("AdminUsersPage: Not authenticated, redirecting to login"),n.push("/login"))},[t,l,e,n]),t)?(0,s.jsx)(eg,{message:"Loading admin panel..."}):l&&e?.roleType!=="ADMIN"?(0,s.jsx)(ef,{userRole:e?.roleType,requiredRole:"ADMIN"}):l?(0,s.jsxs)("div",{className:"container mx-auto py-8 space-y-6",children:[(0,s.jsx)(c,{activeTab:d,onTabChange:o}),"users"===d&&(0,s.jsx)(ej,{}),"rbac"===d&&(0,s.jsx)(e3,{})]}):null}e.s(["default",()=>e5],217554)}]);