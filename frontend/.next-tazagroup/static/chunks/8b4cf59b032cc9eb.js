(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,774482,318381,319013,e=>{"use strict";var s=e.i(44990),t=e.i(403055),a=e.i(245421),r=e.i(606443),i=e.i(742049),l=e.i(771564),n=e.i(495280),c=e.i(474187),d=e.i(320309),o=e.i(885205),m=e.i(632800),u=e.i(41714),x=e.i(702470),h=e.i(746814),p=e.i(137651),j=e.i(696134),g=e.i(600547),N=e.i(165429),v=e.i(4993);function f({open:e,onOpenChange:t}){let{toast:r}=(0,v.useToast)(),[i,{loading:l}]=(()=>{let[e,{data:s,loading:t,error:r}]=(0,a.useCreateOne)("project");return[async s=>({data:{createProject:await e({data:s.variables.input,select:{id:!0,name:!0,description:!0,avatar:!0,isArchived:!0,createdAt:!0,updatedAt:!0,userId:!0},include:{members:{include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}}}},_count:{select:{tasks:!0,chatMessages:!0}}}})}}),{loading:t,error:r}]})(),{register:n,handleSubmit:c,reset:d,formState:{errors:m}}=(0,h.useForm)(),u=async e=>{try{await i({variables:{input:{name:e.name,description:e.description||void 0,avatar:e.avatar||void 0}}}),r({title:"Success",description:"Project created successfully",type:"success"}),d(),t(!1)}catch(e){console.error("Create project error:",e),r({title:"Error",description:e.message||"Failed to create project",variant:"destructive",type:"error"})}};return(0,s.jsx)(p.Dialog,{open:e,onOpenChange:t,children:(0,s.jsxs)(p.DialogContent,{className:"sm:max-w-[500px] flex flex-col max-h-[90vh] p-0",children:[(0,s.jsxs)(p.DialogHeader,{className:"px-6 pt-6 pb-4 border-b",children:[(0,s.jsx)(p.DialogTitle,{children:"Create New Project"}),(0,s.jsx)(p.DialogDescription,{children:"Create a project to collaborate with your team"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:(0,s.jsxs)("form",{id:"create-project-form",onSubmit:c(u),className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(N.Label,{htmlFor:"name",children:["Project Name ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(j.Input,{id:"name",placeholder:"e.g., Website Redesign",...n("name",{required:"Project name is required"}),className:m.name?"border-destructive":""}),m.name&&(0,s.jsx)("p",{className:"text-sm text-destructive mt-1",children:m.name.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.Label,{htmlFor:"description",children:"Description"}),(0,s.jsx)(g.Textarea,{id:"description",placeholder:"Describe your project...",rows:4,...n("description")})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.Label,{htmlFor:"avatar",children:"Avatar URL (optional)"}),(0,s.jsx)(j.Input,{id:"avatar",type:"url",placeholder:"https://example.com/image.jpg",...n("avatar")})]})]})}),(0,s.jsx)("div",{className:"px-6 py-4 border-t bg-muted/30",children:(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)(o.Button,{type:"button",variant:"outline",onClick:()=>{d(),t(!1)},disabled:l,children:"Cancel"}),(0,s.jsx)(o.Button,{type:"submit",form:"create-project-form",disabled:l,children:l?"Creating...":"Create Project"})]})})]})})}function y({selectedProjectId:e,onSelectProject:i,onInviteClick:l}){let{data:n,loading:c,error:d}=((e=!1)=>{let s=(0,t.useMemo)(()=>{if(!e)return{isArchived:{equals:!1}}},[e]),{data:r,loading:i,error:l,refetch:n}=(0,a.useFindMany)("project",{where:s,orderBy:{createdAt:"desc"},include:{members:{include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}}}},_count:{select:{tasks:!0,chatMessages:!0}}}});return{data:{myProjects:r||[]},loading:i,error:l,refetch:n}})(!1),[u,x]=(0,t.useState)(!1),[h,p]=(0,t.useState)(!1);if((0,t.useEffect)(()=>{p(!0)},[]),!h)return(0,s.jsxs)("div",{className:"h-full flex flex-col bg-background border-r",children:[(0,s.jsx)("div",{className:"p-4 border-b",children:(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Projects"}),(0,s.jsx)(o.Button,{size:"sm",onClick:()=>x(!0),className:"h-8 w-8 p-0",children:(0,s.jsx)(r.Plus,{className:"h-4 w-4"})})]})}),(0,s.jsx)("div",{className:"flex-1"})]});if(c)return(0,s.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(d)return(0,s.jsx)("div",{className:"h-full flex items-center justify-center p-4",children:(0,s.jsx)("p",{className:"text-sm text-destructive",children:"Failed to load projects"})});let j=n?.myProjects||[];return(0,s.jsxs)("div",{className:"h-full flex flex-col bg-background border-r",children:[(0,s.jsx)("div",{className:"p-4 border-b",children:(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Projects"}),(0,s.jsx)(o.Button,{size:"sm",onClick:()=>x(!0),className:"h-8 w-8 p-0",children:(0,s.jsx)(r.Plus,{className:"h-4 w-4"})})]})}),(0,s.jsx)(m.ScrollArea,{className:"flex-1",children:(0,s.jsx)("div",{className:"p-2 space-y-1",children:0===j.length?(0,s.jsxs)("div",{className:"text-center py-8 px-4",children:[(0,s.jsx)("div",{className:"text-muted-foreground text-sm mb-4",children:"No projects yet"}),(0,s.jsxs)(o.Button,{variant:"outline",size:"sm",onClick:()=>x(!0),children:[(0,s.jsx)(r.Plus,{className:"h-4 w-4 mr-2"}),"Create First Project"]})]}):j.map(t=>(0,s.jsx)(b,{project:t,isSelected:t.id===e,onClick:()=>i(t.id),onInviteClick:l},t.id))})}),(0,s.jsx)(f,{open:u,onOpenChange:x})]})}function b({project:e,isSelected:t,onClick:a,onInviteClick:r}){return(0,s.jsxs)("div",{role:"button",tabIndex:0,onClick:a,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),a())},className:`
        w-full p-3 rounded-lg text-left transition-colors relative group cursor-pointer
        ${t?"bg-primary/10 border border-primary":"hover:bg-accent border border-transparent"}
      `,children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 mb-2",children:[(0,s.jsxs)(u.Avatar,{className:"h-10 w-10 flex-shrink-0",children:[(0,s.jsx)(u.AvatarImage,{src:e.avatar}),(0,s.jsx)(u.AvatarFallback,{className:"bg-primary/20 text-primary text-xs",children:e.name.substring(0,2).toUpperCase()})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h3",{className:"font-medium text-sm truncate",children:e.name}),e.description&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:e.description})]}),r&&(0,s.jsx)(o.Button,{variant:"ghost",size:"icon",className:"h-7 w-7 opacity-0 group-hover:opacity-100 transition-opacity",onClick:s=>{s.stopPropagation(),r?.(e.id)},title:"M·ªùi th√†nh vi√™n",children:(0,s.jsx)(d.UserPlus,{className:"h-3.5 w-3.5"})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(c.CheckSquare,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:e._count?.tasks||0})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(n.MessageSquare,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:e._count?.chatMessages||0})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(l.Users,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:e.members?.length||0})]})]}),e.members?.find(e=>"owner"===e.role)&&(0,s.jsx)(x.Badge,{variant:"secondary",className:"mt-2 text-xs",children:e.members.find(e=>"owner"===e.role)?.role}),e.isArchived&&(0,s.jsxs)(x.Badge,{variant:"outline",className:"mt-2 text-xs",children:[(0,s.jsx)(i.Archive,{className:"h-3 w-3 mr-1"}),"Archived"]})]})}e.s(["default",()=>y],774482);var w=e.i(173416),D=e.i(850384),S=e.i(982087),C=e.i(435635),k=e.i(198513),T=e.i(415588),E=e.i(909905),A=e.i(576884),I=e.i(172362);function M({task:e,onClick:t}){let[r]=(()=>{let[e,{data:s,loading:t,error:r}]=(0,a.useUpdateOne)("task");return[async s=>{let t={status:s.variables.input.status};return"COMPLETED"===s.variables.input.status?t.completedAt=new Date().toISOString():t.completedAt=null,{data:{updateTask:await e({where:s.variables.input.id,data:t,select:{id:!0,status:!0,completedAt:!0}})}}},{loading:t,error:r}]})(),i=async s=>{try{await r({variables:{input:{id:e.id,status:s?"COMPLETED":"IN_PROGRESS"}}})}catch(e){console.error("Failed to update task status:",e)}},l=e=>{switch(e){case"URGENT":return"bg-red-500 text-white";case"HIGH":return"bg-orange-500 text-white";case"MEDIUM":return"bg-yellow-500 text-white";case"LOW":return"bg-green-500 text-white";default:return"bg-gray-500 text-white"}},d=e.dueDate&&new Date(e.dueDate)<new Date&&"COMPLETED"!==e.status;return(0,s.jsxs)("div",{className:`
        p-4 rounded-lg border-2 transition-all cursor-pointer
        hover:shadow-md hover:border-primary/50
        ${(e=>{switch(e){case"COMPLETED":return"border-green-500 bg-green-50";case"IN_PROGRESS":return"border-blue-500 bg-blue-50";case"PENDING":default:return"border-gray-300 bg-white";case"CANCELLED":return"border-red-300 bg-red-50"}})(e.status)}
        ${"COMPLETED"===e.status?"opacity-60":""}
      `,onClick:t,children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,s.jsx)(I.Checkbox,{checked:"COMPLETED"===e.status,onCheckedChange:i,onClick:e=>e.stopPropagation(),className:"mt-1"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("h3",{className:`font-medium mb-1 ${"COMPLETED"===e.status?"line-through text-muted-foreground":""}`,children:e.title}),e.description&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-2",children:e.description}),e.tags&&e.tags.length>0&&(0,s.jsx)("div",{className:"flex items-center gap-1 flex-wrap mb-2",children:e.tags.map((e,t)=>(0,s.jsxs)(x.Badge,{variant:"secondary",className:"text-xs",children:[(0,s.jsx)(A.Tag,{className:"h-3 w-3 mr-1"}),e]},t))}),(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-wrap text-xs text-muted-foreground",children:[(0,s.jsx)(x.Badge,{className:`${l(e.priority)} text-xs`,children:e.priority}),e.dueDate&&(0,s.jsxs)("div",{className:`flex items-center gap-1 ${d?"text-red-600 font-medium":""}`,children:[d?(0,s.jsx)(k.AlertCircle,{className:"h-3 w-3"}):(0,s.jsx)(C.Calendar,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:(0,S.format)(new Date(e.dueDate),"MMM dd")})]}),e._count?.comments>0&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(n.MessageSquare,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:e._count.comments})]}),e._count?.subtasks>0&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(c.CheckSquare,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:e._count.subtasks})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(T.Clock,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:(0,S.format)(new Date(e.createdAt),"MMM dd, HH:mm")})]})]})]}),(0,s.jsx)("div",{className:`w-1 h-full rounded-full ${l(e.priority)}`})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t",children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:e.assignedTo&&e.assignedTo.length>0?(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(E.User,{className:"h-3 w-3 text-muted-foreground"}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:[e.assignedTo.length," assigned"]})]}):(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"No assignees"})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(u.Avatar,{className:"h-6 w-6",children:[(0,s.jsx)(u.AvatarImage,{src:e.user?.avatar}),(0,s.jsxs)(u.AvatarFallback,{className:"text-xs",children:[e.user?.firstName?.[0],e.user?.lastName?.[0]]})]}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:[e.user?.firstName," ",e.user?.lastName]})]})]})]})}var _=e.i(123959),P=e.i(183194),O=e.i(630596),L=e.i(567961),B=e.i(541428),F=e.i(982579),U=e.i(602860),R=e.i(991163),H=e.i(98810),G=e.i(134955);function K(e,s,t){let a=(0,F.toDate)(e,t?.in);if(isNaN(s))return(0,G.constructFrom)(t?.in||e,NaN);if(!s)return a;let r=a.getDate(),i=(0,G.constructFrom)(t?.in||e,a.getTime());return(i.setMonth(a.getMonth()+s+1,0),r>=i.getDate())?i:(a.setFullYear(i.getFullYear(),i.getMonth(),r),a)}var z=e.i(195325),q=e.i(654554);function V(e,s,t){let[a,r]=(0,z.normalizeDates)(t?.in,e,s);return+(0,q.startOfDay)(a)==+(0,q.startOfDay)(r)}function $({mode:e="single",selected:a,onSelect:r,className:i}){let[l,n]=t.useState(a||new Date);return(0,s.jsxs)("div",{className:(0,B.cn)("p-3",i),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-2 py-2",children:[(0,s.jsx)(o.Button,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>n(K(l,-1,void 0)),children:(0,s.jsx)(O.ChevronLeft,{className:"h-4 w-4"})}),(0,s.jsx)("div",{className:"text-sm font-medium",children:(0,S.format)(l,"MMMM yyyy")}),(0,s.jsx)(o.Button,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>n(K(l,1)),children:(0,s.jsx)(L.ChevronRight,{className:"h-4 w-4"})})]}),(0,s.jsx)("div",{className:"grid grid-cols-7 gap-1 px-2",children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(e=>(0,s.jsx)("div",{className:"flex h-9 w-9 items-center justify-center text-xs font-medium text-muted-foreground",children:e},e))}),(()=>{let e,t,i,n,c,d=((e=(0,F.toDate)(l,void 0)).setDate(1),e.setHours(0,0,0,0),e),o=(0,U.endOfMonth)(d),m=(0,R.startOfWeek)(d),u=(t=(0,H.getDefaultOptions)(),i=(void 0)??void 0??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,c=(n=(0,F.toDate)(o,void 0)).getDay(),n.setDate(n.getDate()+((c<i?-7:0)+6-(c-i))),n.setHours(23,59,59,999),n),x=[],h=[],p=m;for(;p<=u;){for(let e=0;e<7;e++){let e=p;h.push((0,s.jsx)("button",{type:"button",onClick:()=>r?.(e),className:(0,B.cn)("h-9 w-9 rounded-md text-sm transition-colors hover:bg-accent hover:text-accent-foreground",!function(e,s,t){let[a,r]=(0,z.normalizeDates)(void 0,e,s);return a.getFullYear()===r.getFullYear()&&a.getMonth()===r.getMonth()}(p,d)&&"text-muted-foreground opacity-50",a&&V(p,a)&&"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground",V(p,new Date)&&"border border-primary"),children:(0,S.format)(p,"d")},p.toString())),p=function(e,s,t){let a=(0,F.toDate)(e,void 0);return isNaN(1)?(0,G.constructFrom)(e,NaN):(a.setDate(a.getDate()+1),a)}(p,0)}x.push((0,s.jsx)("div",{className:"grid grid-cols-7 gap-1 px-2",children:h},p.toString())),h=[]}return(0,s.jsx)("div",{className:"space-y-1",children:x})})()]})}var W=e.i(340043),Y=e.i(782145),Y=Y,J=e.i(888540);function X({open:e,onOpenChange:r,projectId:i}){let{user:l}=(0,_.useAuth)(),[n,{loading:c}]=(e=>{let[s,{data:t,loading:r,error:i}]=(0,a.useCreateOne)("task");return[async e=>{let{userId:t,...a}=e.variables.input;if(!t)throw Error("userId is required to create a task");return{data:{createProjectTask:await s({data:{...a,projectId:e.variables.projectId,status:"PENDING",order:0,user:{connect:{id:t}}},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{comments:!0,subtasks:!0}}}})}}},{loading:r,error:i}]})(0),{data:d}=(e=>{let{data:s,loading:t,error:r,refetch:i}=(0,a.useFindMany)("projectMember",{where:{projectId:{equals:e}},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}}},orderBy:{joinedAt:"asc"}},{skip:!e});return{data:{projectMembers:s||[]},loading:t,error:r,refetch:i}})(i),{register:m,handleSubmit:u,reset:x,setValue:v,watch:f,formState:{errors:y}}=(0,h.useForm)({defaultValues:{priority:"MEDIUM",category:"OTHER"}}),[b,w]=(0,t.useState)(),[D,C]=(0,t.useState)([]),[k,T]=(0,t.useState)([]),[E,A]=(0,t.useState)(""),I=async e=>{if(!l?.id)return void console.error("User not authenticated");try{await n({variables:{projectId:i,input:{title:e.title,description:e.description||"",priority:e.priority,category:e.category,dueDate:b?.toISOString(),assignedTo:D,tags:k,userId:l.id}}}),x(),w(void 0),C([]),T([]),r(!1)}catch(e){console.error("Failed to create task:",e)}},M=()=>{E.trim()&&!k.includes(E.trim())&&(T([...k,E.trim()]),A(""))},O=d?.projectMembers||[];return(0,s.jsx)(p.Dialog,{open:e,onOpenChange:r,children:(0,s.jsxs)(p.DialogContent,{className:"sm:max-w-[600px] flex flex-col max-h-[90vh] p-0",children:[(0,s.jsxs)(p.DialogHeader,{className:"px-6 pt-6 pb-4 border-b",children:[(0,s.jsx)(p.DialogTitle,{children:"Create New Task"}),(0,s.jsx)(p.DialogDescription,{children:"Add a task to your project (like posting on Facebook)"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:(0,s.jsxs)("form",{id:"create-task-form",onSubmit:u(I),className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(N.Label,{htmlFor:"title",children:["Task Title ",(0,s.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,s.jsx)(j.Input,{id:"title",placeholder:"e.g., Design homepage mockup",...m("title",{required:"Title is required"}),className:y.title?"border-destructive":""}),y.title&&(0,s.jsx)("p",{className:"text-sm text-destructive mt-1",children:y.title.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.Label,{htmlFor:"description",children:"Description"}),(0,s.jsx)(g.Textarea,{id:"description",placeholder:"Describe the task in detail...",rows:4,...m("description")}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Use @username to mention team members"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.Label,{htmlFor:"priority",children:"Priority"}),(0,s.jsxs)(P.Select,{defaultValue:"MEDIUM",onValueChange:e=>v("priority",e),children:[(0,s.jsx)(P.SelectTrigger,{children:(0,s.jsx)(P.SelectValue,{})}),(0,s.jsxs)(P.SelectContent,{children:[(0,s.jsx)(P.SelectItem,{value:"LOW",children:"üü¢ Low"}),(0,s.jsx)(P.SelectItem,{value:"MEDIUM",children:"üü° Medium"}),(0,s.jsx)(P.SelectItem,{value:"HIGH",children:"üü† High"}),(0,s.jsx)(P.SelectItem,{value:"URGENT",children:"üî¥ Urgent"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.Label,{htmlFor:"category",children:"Category"}),(0,s.jsxs)(P.Select,{defaultValue:"OTHER",onValueChange:e=>v("category",e),children:[(0,s.jsx)(P.SelectTrigger,{children:(0,s.jsx)(P.SelectValue,{})}),(0,s.jsxs)(P.SelectContent,{children:[(0,s.jsx)(P.SelectItem,{value:"WORK",children:"üíº Work"}),(0,s.jsx)(P.SelectItem,{value:"PERSONAL",children:"üë§ Personal"}),(0,s.jsx)(P.SelectItem,{value:"SHOPPING",children:"üõí Shopping"}),(0,s.jsx)(P.SelectItem,{value:"HEALTH",children:"üè• Health"}),(0,s.jsx)(P.SelectItem,{value:"OTHER",children:"üìå Other"})]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.Label,{children:"Due Date"}),(0,s.jsxs)(W.Popover,{children:[(0,s.jsx)(W.PopoverTrigger,{asChild:!0,children:(0,s.jsxs)(o.Button,{variant:"outline",className:(0,B.cn)("w-full justify-start text-left font-normal",!b&&"text-muted-foreground"),children:[(0,s.jsx)(Y.default,{className:"mr-2 h-4 w-4"}),b?(0,S.format)(b,"PPP"):"Pick a date"]})}),(0,s.jsx)(W.PopoverContent,{className:"w-auto p-0",children:(0,s.jsx)($,{mode:"single",selected:b,onSelect:w,initialFocus:!0})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.Label,{children:"Assign to (optional)"}),(0,s.jsxs)(P.Select,{onValueChange:e=>{D.includes(e)||C([...D,e])},children:[(0,s.jsx)(P.SelectTrigger,{children:(0,s.jsx)(P.SelectValue,{placeholder:"Select team members"})}),(0,s.jsx)(P.SelectContent,{children:O.map(e=>(0,s.jsxs)(P.SelectItem,{value:e.userId,children:[e.user.firstName," ",e.user.lastName," (",e.role,")"]},e.userId))})]}),D.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:D.map(e=>{let t=O.find(s=>s.userId===e);return(0,s.jsxs)("div",{className:"flex items-center gap-1 bg-secondary px-2 py-1 rounded-md text-sm",children:[(0,s.jsx)("span",{children:t?.user.firstName}),(0,s.jsx)("button",{type:"button",onClick:()=>C(D.filter(s=>s!==e)),className:"hover:text-destructive",children:(0,s.jsx)(J.X,{className:"h-3 w-3"})})]},e)})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.Label,{children:"Tags"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(j.Input,{placeholder:"Add tag (e.g., urgent, backend)",value:E,onChange:e=>A(e.target.value),onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),M())}}),(0,s.jsx)(o.Button,{type:"button",variant:"outline",onClick:M,children:"Add"})]}),k.length>0&&(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:k.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-1 bg-primary/10 px-2 py-1 rounded-md text-sm",children:[(0,s.jsx)("span",{children:e}),(0,s.jsx)("button",{type:"button",onClick:()=>{T(k.filter(s=>s!==e))},className:"hover:text-destructive",children:(0,s.jsx)(J.X,{className:"h-3 w-3"})})]},e))})]})]})}),(0,s.jsx)("div",{className:"px-6 py-4 border-t bg-muted/30",children:(0,s.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,s.jsx)(o.Button,{type:"button",variant:"outline",onClick:()=>{x(),w(void 0),C([]),T([]),r(!1)},disabled:c,children:"Cancel"}),(0,s.jsx)(o.Button,{type:"submit",form:"create-task-form",disabled:c,children:c?"Creating...":"Create Task"})]})})]})})}var Q=e.i(451177),Z=e.i(965120),ee=e.i(138227),es=e.i(519536),et=e.i(495043),ea=e.i(135369);function er({taskId:e}){let{toast:r}=(0,v.useToast)(),{data:i,loading:l,refetch:c}=(e=>{let s=(0,t.useMemo)(()=>{if(e)return{taskId:{equals:e},parentId:{equals:null}}},[e]),{data:r,loading:i,error:l,refetch:n}=(0,a.useFindMany)("taskComment",{where:s,orderBy:{createdAt:"asc"},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},replies:{orderBy:{createdAt:"asc"},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{replies:!0}}}},_count:{select:{replies:!0}}}},{skip:!e,fetchPolicy:"cache-and-network"});return{data:r||[],loading:i,error:l,refetch:n}})(e),[d,{loading:u}]=(()=>{let[e,{data:s,loading:t,error:r}]=(0,a.useCreateOne)("taskComment");return[async s=>({data:{createComment:await e({data:s.variables.input,include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{replies:!0}}}})}}),{loading:t,error:r}]})(),[x,h]=(0,t.useState)(""),[p,j]=(0,t.useState)(null),N=async s=>{if(s.preventDefault(),x.trim())try{await d({variables:{input:{content:x,taskId:e,parentId:p||void 0}}}),r({title:"Success",description:"Comment added",type:"success"}),h(""),j(null),c()}catch(e){r({title:"Error",description:"Failed to add comment",variant:"destructive",type:"error"})}};return l?(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(m.ScrollArea,{className:"h-[400px] pr-4",children:0===i.length?(0,s.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,s.jsx)(n.MessageSquare,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,s.jsx)("p",{children:"No comments yet"}),(0,s.jsx)("p",{className:"text-sm",children:"Be the first to comment!"})]}):(0,s.jsx)("div",{className:"space-y-4",children:i.map(t=>(0,s.jsx)(ei,{comment:t,taskId:e,onReply:e=>j(e),onUpdate:c},t.id))})}),p&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-muted/50 p-2 rounded",children:[(0,s.jsx)(es.Reply,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"Replying to comment"}),(0,s.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:()=>j(null),className:"h-6 ml-auto",children:"Cancel"})]}),(0,s.jsxs)("form",{onSubmit:N,className:"space-y-2",children:[(0,s.jsx)(g.Textarea,{value:x,onChange:e=>h(e.target.value),placeholder:"Write a comment...",rows:3,className:"resize-none"}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsxs)(o.Button,{type:"submit",disabled:u||!x.trim(),children:[(0,s.jsx)(Q.Send,{className:"h-4 w-4 mr-2"}),p?"Reply":"Comment"]})})]})]})}function ei({comment:e,taskId:r,onReply:i,onUpdate:l,depth:n=0}){let{toast:c}=(0,v.useToast)(),[d,{loading:m}]=(()=>{let[e,{data:s,loading:t,error:r}]=(0,a.useUpdateOne)("taskComment");return[async s=>({data:{updateComment:await e({where:s.variables.id,data:s.variables.input,include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}}}})}}),{loading:t,error:r}]})(),[x,{loading:h}]=(()=>{let[e,{data:s,loading:t,error:r}]=(0,a.useDeleteOne)("taskComment");return[async s=>({data:{deleteComment:await e({where:s.variables.id,select:{id:!0}})}}),{loading:t,error:r}]})(),[p,j]=(0,t.useState)(!1),[N,f]=(0,t.useState)(e.content),y=async()=>{if(N.trim())try{await d({variables:{id:e.id,input:{content:N}}}),c({title:"Success",description:"Comment updated",type:"success"}),j(!1),l()}catch(e){c({title:"Error",description:"Failed to update comment",variant:"destructive",type:"error"})}},b=async()=>{if(confirm("Delete this comment?"))try{await x({variables:{id:e.id}}),c({title:"Success",description:"Comment deleted",type:"success"}),l()}catch(e){c({title:"Error",description:"Failed to delete comment",variant:"destructive",type:"error"})}};return(0,s.jsxs)("div",{className:`${n>0?"ml-8 mt-2":""}`,children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 group",children:[(0,s.jsxs)(u.Avatar,{className:"h-8 w-8 flex-shrink-0",children:[(0,s.jsx)(u.AvatarImage,{src:e.user?.avatar}),(0,s.jsxs)(u.AvatarFallback,{className:"text-xs",children:[e.user?.firstName?.[0],e.user?.lastName?.[0]]})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsxs)("span",{className:"font-medium text-sm",children:[e.user?.firstName," ",e.user?.lastName]}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:(0,S.format)(new Date(e.createdAt),"MMM dd, HH:mm")}),e.updatedAt!==e.createdAt&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"(edited)"})]}),p?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(g.Textarea,{value:N,onChange:e=>f(e.target.value),rows:2,className:"text-sm"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(o.Button,{size:"sm",onClick:y,disabled:m,children:"Save"}),(0,s.jsx)(o.Button,{size:"sm",variant:"outline",onClick:()=>{j(!1),f(e.content)},children:"Cancel"})]})]}):(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.content}),!p&&(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,s.jsxs)(o.Button,{variant:"ghost",size:"sm",onClick:()=>i(e.id),className:"h-6 text-xs opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,s.jsx)(es.Reply,{className:"h-3 w-3 mr-1"}),"Reply"]}),(0,s.jsxs)(ea.DropdownMenu,{children:[(0,s.jsx)(ea.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsx)(o.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)(et.MoreVertical,{className:"h-3 w-3"})})}),(0,s.jsxs)(ea.DropdownMenuContent,{align:"end",children:[(0,s.jsxs)(ea.DropdownMenuItem,{onClick:()=>j(!0),children:[(0,s.jsx)(Z.Edit,{className:"h-3 w-3 mr-2"}),"Edit"]}),(0,s.jsxs)(ea.DropdownMenuItem,{onClick:b,className:"text-destructive",children:[(0,s.jsx)(ee.Trash2,{className:"h-3 w-3 mr-2"}),"Delete"]})]})]})]})]})]}),e.replies&&e.replies.length>0&&(0,s.jsx)("div",{className:"mt-2 space-y-2",children:e.replies.map(e=>(0,s.jsx)(ei,{comment:e,taskId:r,onReply:i,onUpdate:l,depth:n+1},e.id))})]})}let el=e=>{let s=(0,t.useMemo)(()=>{if(e)return{parentId:{equals:e}}},[e]),{data:r,loading:i,error:l,refetch:n}=(0,a.useFindMany)("task",{where:s,orderBy:{createdAt:"asc"},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},subtasks:{orderBy:{order:"asc"},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}}}},_count:{select:{subtasks:!0}}}},{skip:!e,fetchPolicy:"cache-and-network"});return{data:r||[],loading:i,error:l,refetch:n}};var en=e.i(645030),ec=e.i(112641),ed=e.i(477219),eo=e.i(784386);function em({taskId:e}){let{toast:i}=(0,v.useToast)(),{user:l}=(0,_.useAuth)(),{data:n,loading:c,refetch:d}=el(e),m=(e=>{let{data:s,loading:a,error:r}=el(e);return{...(0,t.useMemo)(()=>{let e=s.length,t=s.filter(e=>"COMPLETED"===e.status).length,a=e>0?Math.round(t/e*100):0;return{total:e,completed:t,percentage:a}},[s]),loading:a,error:r}})(e),[u,{loading:x}]=(()=>{let[e,{data:s,loading:t,error:r}]=(0,a.useCreateOne)("task");return[async s=>{let{userId:t,...a}=s.variables.input;if(!t)throw Error("userId is required to create a subtask");return{data:{createSubtask:await e({data:{...a,status:"PENDING",category:"OTHER",order:0,user:{connect:{id:t}}},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{subtasks:!0}}}})}}},{loading:t,error:r}]})(),[h,p]=(0,t.useState)(""),[g,N]=(0,t.useState)(new Set),f=async s=>{if(s.preventDefault(),h.trim()){if(!l?.id)return void i({title:"Error",description:"User not authenticated",variant:"destructive",type:"error"});try{await u({variables:{input:{title:h,parentId:e,userId:l.id}}}),i({title:"Success",description:"Subtask created",type:"success"}),p(""),d()}catch(e){i({title:"Error",description:"Failed to create subtask",variant:"destructive",type:"error"})}}};return c?(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(0,s.jsxs)("div",{className:"space-y-4",children:[m&&n.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"font-medium",children:"Progress"}),(0,s.jsxs)("span",{className:"text-muted-foreground",children:[m.completed," / ",m.total," completed"]})]}),(0,s.jsx)(en.Progress,{value:m.percentage,className:"h-2"}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground text-right",children:[m.percentage.toFixed(0),"% complete"]})]}),(0,s.jsx)("div",{className:"space-y-2",children:0===n.length?(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(ed.Circle,{className:"h-10 w-10 mx-auto mb-2 opacity-50"}),(0,s.jsx)("p",{children:"No subtasks yet"}),(0,s.jsx)("p",{className:"text-sm",children:"Break this task into smaller steps"})]}):n.map(e=>(0,s.jsx)(eu,{subtask:e,onUpdate:d,isExpanded:g.has(e.id),onToggleExpanded:()=>{var s;return s=e.id,void N(e=>{let t=new Set(e);return t.has(s)?t.delete(s):t.add(s),t})}},e.id))}),(0,s.jsxs)("form",{onSubmit:f,className:"flex gap-2",children:[(0,s.jsx)(j.Input,{value:h,onChange:e=>p(e.target.value),placeholder:"Add a subtask...",className:"flex-1"}),(0,s.jsxs)(o.Button,{type:"submit",disabled:x||!h.trim(),children:[(0,s.jsx)(r.Plus,{className:"h-4 w-4 mr-2"}),"Add"]})]})]})}function eu({subtask:e,onUpdate:t,depth:r=0,isExpanded:i=!1,onToggleExpanded:l}){let{toast:n}=(0,v.useToast)(),[c,{loading:d}]=(()=>{let[e,{data:s,loading:t,error:r}]=(0,a.useUpdateOne)("task");return[async s=>({data:{toggleSubtask:await e({where:s.variables.id,data:{status:s.variables.completed?"COMPLETED":"PENDING",completedAt:s.variables.completed?new Date().toISOString():null},select:{id:!0,status:!0,completedAt:!0}})}}),{loading:t,error:r}]})(),[m,{loading:u}]=(()=>{let[e,{data:s,loading:t,error:r}]=(0,a.useDeleteOne)("task");return[async s=>({data:{deleteSubtask:await e({where:s.variables.id,select:{id:!0}})}}),{loading:t,error:r}]})(),x=async()=>{try{let s="COMPLETED"!==e.status;await c({variables:{id:e.id,completed:s}}),t()}catch(e){n({title:"Error",description:"Failed to update subtask",variant:"destructive",type:"error"})}},h=async()=>{if(confirm("Delete this subtask?"))try{await m({variables:{id:e.id}}),n({title:"Success",description:"Subtask deleted",type:"success"}),t()}catch(e){n({title:"Error",description:"Failed to delete subtask",variant:"destructive",type:"error"})}},p="COMPLETED"===e.status,j=e.subtasks&&e.subtasks.length>0;return(0,s.jsxs)("div",{className:`${r>0?"ml-6 mt-1":""}`,children:[(0,s.jsxs)("div",{className:"group flex items-center gap-2 p-2 rounded-lg hover:bg-muted/50 transition-colors",children:[j&&(0,s.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:l,className:"h-6 w-6 p-0",children:i?(0,s.jsx)(eo.ChevronDown,{className:"h-3 w-3"}):(0,s.jsx)(L.ChevronRight,{className:"h-3 w-3"})}),(0,s.jsx)(I.Checkbox,{checked:p,onCheckedChange:x,disabled:d,className:"flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:(0,B.cn)("text-sm truncate",p&&"line-through text-muted-foreground"),children:e.title}),e.dueDate&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Due: ",(0,S.format)(new Date(e.dueDate),"MMM dd")]})]}),p?(0,s.jsx)(ec.CheckCircle2,{className:"h-4 w-4 text-green-600 flex-shrink-0"}):(0,s.jsx)(ed.Circle,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),j&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full",children:e.subtasks.length}),(0,s.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:h,disabled:u,className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)(ee.Trash2,{className:"h-3 w-3 text-destructive"})})]}),j&&i&&(0,s.jsx)("div",{className:"mt-1 space-y-1",children:e.subtasks.map(e=>(0,s.jsx)(eu,{subtask:e,onUpdate:t,depth:r+1},e.id))})]})}var ex=e.i(975620);let eh=(e,s)=>{let r=(0,t.useMemo)(()=>{if(!e)return;let t={taskId:{equals:e}};return s?.action&&(t.action={equals:s.action}),s?.userId&&(t.userId={equals:s.userId}),(s?.fromDate||s?.toDate)&&(t.createdAt={},s.fromDate&&(t.createdAt.gte=s.fromDate),s.toDate&&(t.createdAt.lte=s.toDate)),t},[e,s]),{data:i,loading:l,error:n,refetch:c}=(0,a.useFindMany)("taskActivityLog",{where:r,orderBy:{createdAt:"desc"},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}}}},{skip:!e,fetchPolicy:"cache-and-network"});return{data:i||[],loading:l,error:n,refetch:c}},ep=e=>{switch(e){case"TASK_CREATED":return"‚ú®";case"TASK_UPDATED":case"COMMENT_EDITED":case"TITLE_CHANGED":return"‚úèÔ∏è";case"TASK_DELETED":case"COMMENT_DELETED":case"FILE_DELETED":return"üóëÔ∏è";case"TASK_STATUS_CHANGED":return"üìã";case"TASK_PRIORITY_CHANGED":return"üî•";case"TASK_ASSIGNED":return"üë§";case"TASK_UNASSIGNED":return"üëã";case"COMMENT_ADDED":return"üí¨";case"SUBTASK_ADDED":return"‚ûï";case"SUBTASK_COMPLETED":return"‚úÖ";case"SUBTASK_DELETED":return"‚ùå";case"FILE_UPLOADED":return"üìé";case"DUE_DATE_CHANGED":return"üìÖ";case"DESCRIPTION_CHANGED":return"üìù";default:return"üìå"}};var ej=e.i(759727);let eg=["TASK_CREATED","TASK_UPDATED","TASK_DELETED","TASK_STATUS_CHANGED","TASK_PRIORITY_CHANGED","TASK_ASSIGNED","TASK_UNASSIGNED","COMMENT_ADDED","COMMENT_EDITED","COMMENT_DELETED","SUBTASK_ADDED","SUBTASK_COMPLETED","SUBTASK_DELETED","FILE_UPLOADED","FILE_DELETED","DUE_DATE_CHANGED","DESCRIPTION_CHANGED","TITLE_CHANGED"];function eN({taskId:e}){let[a,r]=(0,t.useState)("ALL"),[i,l]=(0,t.useState)(!1),{data:n,loading:c}=eh(e,"ALL"!==a?{action:a}:void 0),{data:d,loading:u}=eh(e,{fromDate:(0,t.useMemo)(()=>{let e=new Date;return e.setHours(e.getHours()-24),e.toISOString()},[])}),{stats:x}=(e=>{let{data:s,loading:a,error:r}=eh(e);return{stats:(0,t.useMemo)(()=>{let e={};return s.forEach(s=>{e[s.action]=(e[s.action]||0)+1}),e},[s]),loading:a,error:r}})(e),h=i?d:n;return(i?u:c)?(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(w.Filter,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)(P.Select,{value:a,onValueChange:e=>r(e),children:[(0,s.jsx)(P.SelectTrigger,{className:"w-[200px]",children:(0,s.jsx)(P.SelectValue,{placeholder:"Filter by type"})}),(0,s.jsxs)(P.SelectContent,{children:[(0,s.jsx)(P.SelectItem,{value:"ALL",children:"All Activities"}),eg.map(e=>(0,s.jsxs)(P.SelectItem,{value:e,children:[ep(e)," ",e.replace(/_/g," ")]},e))]})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(o.Button,{variant:i?"default":"outline",size:"sm",onClick:()=>l(!i),children:[(0,s.jsx)(T.Clock,{className:"h-4 w-4 mr-2"}),"Last 24h"]})})]}),x&&Object.keys(x).length>0&&(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2 p-3 bg-muted/50 rounded-lg",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold",children:Object.values(x).reduce((e,s)=>e+s,0)}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Total"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:x.TASK_STATUS_CHANGED||0}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Status Changes"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:x.COMMENT_ADDED||0}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Comments"})]})]}),(0,s.jsx)(m.ScrollArea,{className:"h-[400px] pr-4",children:0===h.length?(0,s.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,s.jsx)(ej.TrendingUp,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,s.jsx)("p",{children:"No activity yet"}),(0,s.jsx)("p",{className:"text-sm",children:i?"No activity in the last 24 hours":"Activity will appear here"})]}):(0,s.jsx)("div",{className:"space-y-4",children:h.map(e=>(0,s.jsx)(ev,{activity:e},e.id))})})]})}function ev({activity:e}){let t=ep(e.action),a=(e=>{switch(e){case"TASK_CREATED":case"SUBTASK_ADDED":case"SUBTASK_COMPLETED":return"text-green-600";case"TASK_DELETED":case"COMMENT_DELETED":case"SUBTASK_DELETED":case"FILE_DELETED":return"text-red-600";case"TASK_STATUS_CHANGED":return"text-blue-600";case"TASK_PRIORITY_CHANGED":return"text-orange-600";case"COMMENT_ADDED":return"text-purple-600";case"FILE_UPLOADED":return"text-indigo-600";default:return"text-gray-600"}})(e.action),r=e.oldValue?"string"==typeof e.oldValue?e.oldValue:JSON.stringify(e.oldValue):null,i=e.newValue?"string"==typeof e.newValue?e.newValue:JSON.stringify(e.newValue):null;return(0,s.jsxs)("div",{className:"flex items-start gap-3 group",children:[(0,s.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,s.jsx)("div",{className:(0,B.cn)("w-8 h-8 rounded-full flex items-center justify-center text-sm",a),children:t}),(0,s.jsx)("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 w-0.5 h-full bg-border"})]}),(0,s.jsx)("div",{className:"flex-1 min-w-0 pb-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-2 mb-1",children:[(0,s.jsxs)(u.Avatar,{className:"h-6 w-6 flex-shrink-0",children:[(0,s.jsx)(u.AvatarImage,{src:e.user?.avatar}),(0,s.jsxs)(u.AvatarFallback,{className:"text-xs",children:[e.user?.firstName?.[0],e.user?.lastName?.[0]]})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,s.jsxs)("span",{className:"font-medium text-sm",children:[e.user?.firstName," ",e.user?.lastName]}),(0,s.jsx)(x.Badge,{variant:"outline",className:"text-xs",children:e.action.replace(/_/g," ")})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-0.5",children:e.description}),(r||i)&&(0,s.jsxs)("div",{className:"mt-2 p-2 bg-muted/50 rounded text-xs space-y-1",children:[r&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"From:"})," ",(0,s.jsx)("span",{className:"font-mono text-red-600",children:r})]}),i&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"To:"})," ",(0,s.jsx)("span",{className:"font-mono text-green-600",children:i})]})]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[(0,ex.formatDistanceToNow)(new Date(e.createdAt),{addSuffix:!0})," ","¬∑ ",(0,S.format)(new Date(e.createdAt),"MMM dd, HH:mm")]})]})]})})]})}let ef=e.i(425101).Root;var ey=e.i(67087),eb=e.i(996517),ew=e.i(553082);function eD({taskId:e,projectId:r,open:i,onOpenChange:l}){let{toast:d}=(0,v.useToast)(),{data:m,loading:h,error:f,refetch:y}=(e=>{let{data:s,loading:t,error:r,refetch:i}=(0,a.useFindUnique)("task",e||"",{include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{comments:!0,subtasks:!0}}}},{skip:!e});return{data:s?{task:s}:void 0,loading:t,error:r,refetch:i}})(e),[b,{loading:w}]=(()=>{let[e,{data:s,loading:t,error:r}]=(0,a.useUpdateOne)("task");return[async s=>({data:{updateTask:await e({where:s.variables.id,data:s.variables.input,include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{comments:!0,subtasks:!0}}}})}}),{loading:t,error:r}]})(),[D,{loading:I}]=(e=>{let[s,{data:t,loading:r,error:i}]=(0,a.useDeleteOne)("task");return[async e=>({data:{deleteTask:await s({where:e.variables.id,select:{id:!0}})}}),{loading:r,error:i}]})(0),[M,_]=(0,t.useState)(!1),[O,L]=(0,t.useState)(""),[B,F]=(0,t.useState)(""),U=m?.task;if(t.default.useEffect(()=>{U&&(L(U.title),F(U.description||""))},[U]),!i||!e)return null;if(h)return(0,s.jsx)(p.Dialog,{open:i,onOpenChange:l,children:(0,s.jsxs)(p.DialogContent,{className:"max-w-4xl flex flex-col max-h-[90vh] p-0",children:[(0,s.jsx)(ef,{children:(0,s.jsx)(p.DialogTitle,{children:"Loading task details"})}),(0,s.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})]})});if(f||!U)return(0,s.jsx)(p.Dialog,{open:i,onOpenChange:l,children:(0,s.jsxs)(p.DialogContent,{className:"max-w-4xl flex flex-col max-h-[90vh] p-0",children:[(0,s.jsx)(ef,{children:(0,s.jsx)(p.DialogTitle,{children:"Error loading task"})}),(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("p",{className:"text-destructive",children:"Failed to load task details"})})]})});let R=async()=>{try{await b({variables:{id:e,input:{title:O,description:B}}}),d({title:"Success",description:"Task updated successfully",type:"success"}),_(!1),y()}catch(e){d({title:"Error",description:"Failed to update task",variant:"destructive",type:"error"})}},H=async()=>{if(confirm("Are you sure you want to delete this task?"))try{await D({variables:{id:e}}),d({title:"Success",description:"Task deleted successfully",type:"success"}),l(!1)}catch(e){d({title:"Error",description:"Failed to delete task",variant:"destructive",type:"error"})}},G=async s=>{try{await b({variables:{id:e,input:{status:s}}}),d({title:"Success",description:"Status updated",type:"success"}),y()}catch(e){d({title:"Error",description:"Failed to update status",variant:"destructive",type:"error"})}},K=async s=>{try{await b({variables:{id:e,input:{priority:s}}}),d({title:"Success",description:"Priority updated",type:"success"}),y()}catch(e){d({title:"Error",description:"Failed to update priority",variant:"destructive",type:"error"})}},z=U.dueDate&&new Date(U.dueDate)<new Date&&"COMPLETED"!==U.status;return(0,s.jsx)(p.Dialog,{open:i,onOpenChange:l,children:(0,s.jsxs)(p.DialogContent,{className:"max-w-4xl flex flex-col max-h-[90vh] p-0",children:[(0,s.jsx)(p.DialogHeader,{className:"px-6 pt-6 pb-4 border-b",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,s.jsx)("div",{className:"flex-1",children:M?(0,s.jsx)(j.Input,{value:O,onChange:e=>L(e.target.value),className:"text-lg font-semibold",placeholder:"Task title"}):(0,s.jsx)(p.DialogTitle,{className:"text-xl",children:U.title})}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:M?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o.Button,{size:"sm",onClick:R,disabled:w,children:[(0,s.jsx)(ew.Save,{className:"h-4 w-4 mr-2"}),"Save"]}),(0,s.jsxs)(o.Button,{size:"sm",variant:"outline",onClick:()=>_(!1),children:[(0,s.jsx)(J.X,{className:"h-4 w-4 mr-2"}),"Cancel"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o.Button,{size:"sm",variant:"outline",onClick:()=>_(!0),children:[(0,s.jsx)(Z.Edit,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,s.jsxs)(o.Button,{size:"sm",variant:"destructive",onClick:H,disabled:I,children:[(0,s.jsx)(ee.Trash2,{className:"h-4 w-4 mr-2"}),"Delete"]})]})})]})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.Label,{children:"Status"}),(0,s.jsxs)(P.Select,{value:U.status,onValueChange:G,children:[(0,s.jsx)(P.SelectTrigger,{children:(0,s.jsx)(P.SelectValue,{})}),(0,s.jsxs)(P.SelectContent,{children:[(0,s.jsx)(P.SelectItem,{value:"PENDING",children:"üìã Pending"}),(0,s.jsx)(P.SelectItem,{value:"IN_PROGRESS",children:"‚ö° In Progress"}),(0,s.jsx)(P.SelectItem,{value:"COMPLETED",children:"‚úÖ Completed"}),(0,s.jsx)(P.SelectItem,{value:"CANCELLED",children:"‚ùå Cancelled"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.Label,{children:"Priority"}),(0,s.jsxs)(P.Select,{value:U.priority,onValueChange:K,children:[(0,s.jsx)(P.SelectTrigger,{children:(0,s.jsx)(P.SelectValue,{})}),(0,s.jsxs)(P.SelectContent,{children:[(0,s.jsx)(P.SelectItem,{value:"LOW",children:"üü¢ Low"}),(0,s.jsx)(P.SelectItem,{value:"MEDIUM",children:"üü° Medium"}),(0,s.jsx)(P.SelectItem,{value:"HIGH",children:"üü† High"}),(0,s.jsx)(P.SelectItem,{value:"URGENT",children:"üî¥ Urgent"})]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.Label,{children:"Description"}),M?(0,s.jsx)(g.Textarea,{value:B,onChange:e=>F(e.target.value),rows:5,placeholder:"Task description..."}):(0,s.jsx)("div",{className:"p-3 bg-muted/50 rounded-md min-h-[100px]",children:U.description||(0,s.jsx)("span",{className:"text-muted-foreground italic",children:"No description"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-4 bg-muted/30 rounded-lg",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(C.Calendar,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Due Date"}),(0,s.jsx)("div",{className:`text-sm font-medium ${z?"text-red-600":""}`,children:U.dueDate?(0,s.jsxs)(s.Fragment,{children:[(0,S.format)(new Date(U.dueDate),"PPP"),z&&(0,s.jsx)(k.AlertCircle,{className:"inline h-3 w-3 ml-1"})]}):"No due date"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(E.User,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Created By"}),(0,s.jsxs)("div",{className:"text-sm font-medium flex items-center gap-2",children:[(0,s.jsxs)(u.Avatar,{className:"h-5 w-5",children:[(0,s.jsx)(u.AvatarImage,{src:U.user?.avatar}),(0,s.jsxs)(u.AvatarFallback,{className:"text-xs",children:[U.user?.firstName?.[0],U.user?.lastName?.[0]]})]}),U.user?.firstName," ",U.user?.lastName]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(T.Clock,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Created"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:(0,S.format)(new Date(U.createdAt),"PPp")})]})]}),U.completedAt&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(c.CheckSquare,{className:"h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:"Completed"}),(0,s.jsx)("div",{className:"text-sm font-medium",children:(0,S.format)(new Date(U.completedAt),"PPp")})]})]})]})]}),U.tags&&U.tags.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.Label,{children:"Tags"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:U.tags.map((e,t)=>(0,s.jsxs)(x.Badge,{variant:"secondary",children:[(0,s.jsx)(A.Tag,{className:"h-3 w-3 mr-1"}),e]},t))})]}),U.assignedTo&&U.assignedTo.length>0&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.Label,{children:"Assigned To"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,s.jsx)(E.User,{className:"h-4 w-4"}),U.assignedTo.length," member(s) assigned"]})]}),(0,s.jsx)(ey.Separator,{}),(0,s.jsxs)(eb.Tabs,{defaultValue:"comments",className:"w-full",children:[(0,s.jsxs)(eb.TabsList,{className:"grid w-full grid-cols-3",children:[(0,s.jsxs)(eb.TabsTrigger,{value:"comments",children:[(0,s.jsx)(n.MessageSquare,{className:"h-4 w-4 mr-2"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Comments"}),(0,s.jsx)("span",{className:"sm:hidden",children:"üí¨"}),(0,s.jsxs)("span",{className:"ml-1",children:["(",U._count?.comments||0,")"]})]}),(0,s.jsxs)(eb.TabsTrigger,{value:"subtasks",children:[(0,s.jsx)(c.CheckSquare,{className:"h-4 w-4 mr-2"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Subtasks"}),(0,s.jsx)("span",{className:"sm:hidden",children:"‚úì"}),(0,s.jsxs)("span",{className:"ml-1",children:["(",U._count?.subtasks||0,")"]})]}),(0,s.jsxs)(eb.TabsTrigger,{value:"activity",children:[(0,s.jsx)(T.Clock,{className:"h-4 w-4 mr-2"}),(0,s.jsx)("span",{className:"hidden sm:inline",children:"Activity"}),(0,s.jsx)("span",{className:"sm:hidden",children:"‚è±"})]})]}),(0,s.jsx)(eb.TabsContent,{value:"comments",className:"space-y-4 pt-4",children:(0,s.jsx)(er,{taskId:e})}),(0,s.jsx)(eb.TabsContent,{value:"subtasks",className:"space-y-4 pt-4",children:(0,s.jsx)(em,{taskId:e})}),(0,s.jsx)(eb.TabsContent,{value:"activity",className:"space-y-4 pt-4",children:(0,s.jsx)(eN,{taskId:e})})]})]})}),(0,s.jsx)("div",{className:"px-6 py-4 border-t bg-muted/30",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:[(0,s.jsxs)("div",{className:"text-xs text-muted-foreground text-center sm:text-left",children:["Last updated ",(0,S.format)(new Date(U.updatedAt),"PPp")]}),(0,s.jsx)(o.Button,{variant:"outline",onClick:()=>l(!1),children:"Close"})]})})]})})}function eS({projectId:e}){let[i,l]=(0,t.useState)(""),[n,c]=(0,t.useState)(!1),[d,u]=(0,t.useState)(null),[h,p]=(0,t.useState)(null),{data:g,loading:N,error:v}=((e,s)=>{let r=(0,t.useMemo)(()=>{if(!e)return;let t={projectId:{equals:e}};return s?.status&&(t.status={equals:s.status}),s?.priority&&(t.priority={equals:s.priority}),s?.category&&(t.category={equals:s.category}),s?.search&&(t.OR=[{title:{contains:s.search,mode:"insensitive"}},{description:{contains:s.search,mode:"insensitive"}}]),(s?.dueDateFrom||s?.dueDateTo)&&(t.dueDate={},s.dueDateFrom&&(t.dueDate.gte=s.dueDateFrom),s.dueDateTo&&(t.dueDate.lte=s.dueDateTo)),s?.assignedTo&&s.assignedTo.length>0&&(t.assignedTo={hasSome:s.assignedTo}),s?.tags&&s.tags.length>0&&(t.tags={hasSome:s.tags}),t},[e,s]),{data:i,loading:l,error:n,refetch:c}=(0,a.useFindMany)("task",{where:r,orderBy:{createdAt:"desc"},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{comments:!0,subtasks:!0}}}},{skip:!e,fetchPolicy:"cache-and-network"});return{data:{projectTasks:i||[]},loading:l,error:n,refetch:c}})(e,{search:i||void 0,status:d||void 0});if(!e)return(0,s.jsx)("div",{className:"h-full flex items-center justify-center bg-background",children:(0,s.jsxs)("div",{className:"text-center max-w-md px-4",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"üìã"}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Project Selected"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select a project from the sidebar to view and manage tasks"})]})});let f=g?.projectTasks||[];return(0,s.jsxs)("div",{className:"h-full flex flex-col bg-background",children:[(0,s.jsxs)("div",{className:"p-4 border-b space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Task Feed"}),(0,s.jsxs)(o.Button,{size:"sm",onClick:()=>c(!0),children:[(0,s.jsx)(r.Plus,{className:"h-4 w-4 mr-2"}),"New Task"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"relative flex-1",children:[(0,s.jsx)(D.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(j.Input,{placeholder:"Search tasks...",value:i,onChange:e=>l(e.target.value),className:"pl-9"})]}),(0,s.jsxs)(o.Button,{variant:"outline",size:"sm",children:[(0,s.jsx)(w.Filter,{className:"h-4 w-4 mr-2"}),"Filter"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,s.jsx)(x.Badge,{variant:d?"outline":"default",className:"cursor-pointer",onClick:()=>u(null),children:"All Tasks"}),(0,s.jsx)(x.Badge,{variant:"IN_PROGRESS"===d?"default":"outline",className:"cursor-pointer",onClick:()=>u("IN_PROGRESS"),children:"In Progress"}),(0,s.jsx)(x.Badge,{variant:"PENDING"===d?"default":"outline",className:"cursor-pointer",onClick:()=>u("PENDING"),children:"Pending"}),(0,s.jsx)(x.Badge,{variant:"COMPLETED"===d?"default":"outline",className:"cursor-pointer",onClick:()=>u("COMPLETED"),children:"Completed"})]})]}),(0,s.jsx)(m.ScrollArea,{className:"flex-1",children:(0,s.jsxs)("div",{className:"p-4 space-y-3",children:[N&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-3",children:"Loading tasks..."})]}),v&&(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("p",{className:"text-sm text-destructive",children:"Failed to load tasks"})}),!N&&!v&&0===f.length&&(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("div",{className:"text-5xl mb-4",children:"‚úÖ"}),(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Tasks Yet"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Create your first task to get started"}),(0,s.jsxs)(o.Button,{onClick:()=>c(!0),children:[(0,s.jsx)(r.Plus,{className:"h-4 w-4 mr-2"}),"Create Task"]})]}),!N&&!v&&f.length>0&&(0,s.jsx)(s.Fragment,{children:f.map(e=>(0,s.jsx)(M,{task:e,onClick:()=>p(e.id)},e.id))})]})}),(0,s.jsx)(X,{open:n,onOpenChange:c,projectId:e}),(0,s.jsx)(eD,{taskId:h,projectId:e,open:!!h,onOpenChange:e=>!e&&p(null)})]})}e.s(["default",()=>eS],318381),e.i(308140);var eC=e.i(533614),ek=e.i(36428),ek=ek,eT=e.i(576873),eE=e.i(799668),eE=eE;function eA({projectId:e,userToken:a}){let[r,i]=(0,t.useState)(null),[l,c]=(0,t.useState)([]),[d,x]=(0,t.useState)(""),[h,p]=(0,t.useState)(!1),[g,N]=(0,t.useState)([]),[f,y]=(0,t.useState)([]),[b,w]=(0,t.useState)(!1),D=(0,t.useRef)(null),{toast:S}=(0,v.useToast)(),C=(0,t.useRef)(void 0);(0,t.useEffect)(()=>{let s=a||localStorage.getItem("accessToken");if(!e)return;if(!s)return void console.error("[ChatPanel] Missing authentication token");let t="https://v3api.tazagroup.com";console.log("[ChatPanel] Connecting to:",`${t}/project-chat`);let r=(0,eC.io)(`${t}/project-chat`,{auth:{token:s.startsWith("Bearer ")?s:`Bearer ${s}`},reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5});return r.on("connect",()=>{w(!0),console.log("‚úÖ Connected to chat"),r.emit("join_project",{projectId:e}),r.emit("load_messages",{projectId:e,take:50,skip:0})}),r.on("disconnect",()=>{w(!1),console.log("‚ùå Disconnected from chat")}),r.on("new_message",e=>{c(s=>[...s,{...e,createdAt:new Date(e.createdAt)}])}),r.on("messages_loaded",e=>{c(e.map(e=>({...e,createdAt:new Date(e.createdAt)})))}),r.on("message_edited",e=>{c(s=>s.map(s=>s.id===e.messageId?{...s,content:e.content,isEdited:!0}:s))}),r.on("message_deleted",e=>{c(s=>s.filter(s=>s.id!==e.messageId))}),r.on("reaction_added",e=>{c(s=>s.map(s=>{if(s.id===e.messageId){let t=s.reactions||{};return t[e.emoji]=t[e.emoji]||[],t[e.emoji].includes(e.userId)||t[e.emoji].push(e.userId),{...s,reactions:t}}return s}))}),r.on("user_typing",e=>{y(s=>s.find(s=>s.userId===e.userId)?s:[...s,e])}),r.on("user_stopped_typing",e=>{y(s=>s.filter(s=>s.userId!==e.userId))}),r.on("online_users",e=>{N(e)}),r.on("user_joined",e=>{S({title:"User Joined",description:`${e.userName} joined the chat`,type:"info"})}),r.on("user_left",e=>{S({title:"User Left",description:`${e.userName} left the chat`,type:"info"})}),r.on("error",e=>{S({title:"Error",description:`Chat error: ${e.message}`,type:"error"})}),i(r),()=>{r.emit("leave_project",{projectId:e}),r.close()}},[e,a,S]),(0,t.useEffect)(()=>{D.current&&(D.current.scrollTop=D.current.scrollHeight)},[l]);let k=()=>{d.trim()&&r&&b&&(r.emit("send_message",{projectId:e,content:d,attachments:[]}),x(""),r.emit("typing_stop",{projectId:e}))},T=(e,s)=>{r&&b&&r.emit("message_reaction",{messageId:e,emoji:s})};return e?(0,s.jsxs)("div",{className:"h-full flex flex-col bg-background",children:[(0,s.jsx)("div",{className:"p-4 border-b bg-white sticky top-0",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(n.MessageSquare,{className:"h-4 w-4"}),(0,s.jsx)("h3",{className:"font-semibold",children:"Project Chat"}),b?(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 text-xs text-green-600",children:[(0,s.jsx)("span",{className:"h-2 w-2 rounded-full bg-green-600"}),"Connected"]}):(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 text-xs text-gray-500",children:[(0,s.jsx)(eE.default,{className:"h-3 w-3 animate-spin"}),"Connecting..."]})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[g.length," online"]})]})}),(0,s.jsx)(m.ScrollArea,{className:"flex-1 p-4",ref:D,children:(0,s.jsxs)("div",{className:"space-y-4",children:[0===l.length?(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"No messages yet. Start the conversation!"})}):l.map(e=>(0,s.jsxs)("div",{className:"flex gap-3 group",children:[(0,s.jsxs)(u.Avatar,{className:"h-8 w-8 flex-shrink-0",children:[(0,s.jsx)(u.AvatarImage,{src:e.userAvatar}),(0,s.jsx)(u.AvatarFallback,{children:e.userName.charAt(0)})]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm font-semibold",children:e.userName}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:e.createdAt.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})}),e.isEdited&&(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"(edited)"})]}),(0,s.jsx)("p",{className:"text-sm text-foreground break-words",children:e.content}),e.reactions&&Object.keys(e.reactions).length>0&&(0,s.jsx)("div",{className:"flex gap-1 mt-1 flex-wrap",children:Object.entries(e.reactions).map(([t,a])=>(0,s.jsxs)("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-gray-100 rounded-full text-xs cursor-pointer hover:bg-gray-200",onClick:()=>T(e.id,t),children:[(0,s.jsx)("span",{children:t}),(0,s.jsx)("span",{className:"text-gray-600",children:a.length})]},t))}),(0,s.jsxs)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex gap-1 mt-1",children:[(0,s.jsx)(o.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>T(e.id,"üëç"),children:"üëç"}),(0,s.jsx)(o.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>T(e.id,"‚ù§Ô∏è"),children:"‚ù§Ô∏è"}),(0,s.jsxs)(ea.DropdownMenu,{children:[(0,s.jsx)(ea.DropdownMenuTrigger,{asChild:!0,children:(0,s.jsx)(o.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",children:(0,s.jsx)(et.MoreVertical,{className:"h-3 w-3"})})}),(0,s.jsx)(ea.DropdownMenuContent,{align:"end",children:(0,s.jsx)(ea.DropdownMenuItem,{onClick:()=>{var s;return s=e.id,void(r&&b&&r.emit("delete_message",{messageId:s}))},children:"Delete"})})]})]})]})]},e.id)),f.length>0&&(0,s.jsxs)("div",{className:"flex gap-2 text-xs text-gray-500",children:[(0,s.jsxs)("span",{children:[f.map(e=>e.userName).join(", ")," is typing..."]}),(0,s.jsx)("span",{className:"animate-pulse",children:"‚óè‚óè‚óè"})]})]})}),(0,s.jsx)("div",{className:"p-4 border-t bg-white",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(o.Button,{size:"sm",variant:"ghost",className:"h-10 w-10 p-0",children:(0,s.jsx)(eT.Paperclip,{className:"h-4 w-4"})}),(0,s.jsx)(j.Input,{placeholder:"Type a message...",value:d,onChange:s=>{x(s.target.value),r&&b&&(r.emit("typing_start",{projectId:e}),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{r.emit("typing_stop",{projectId:e})},3e3))},onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),k())},disabled:!b,className:"flex-1"}),(0,s.jsx)(o.Button,{size:"sm",variant:"ghost",className:"h-10 w-10 p-0",onClick:()=>T(l[l.length-1]?.id||"","üòä"),children:(0,s.jsx)(ek.default,{className:"h-4 w-4"})}),(0,s.jsx)(o.Button,{size:"sm",onClick:k,disabled:!b||h,className:"h-10 w-10 p-0",children:h?(0,s.jsx)(eE.default,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(Q.Send,{className:"h-4 w-4"})})]})})]}):(0,s.jsx)("div",{className:"h-full flex items-center justify-center bg-muted/30",children:(0,s.jsxs)("div",{className:"text-center max-w-xs px-4",children:[(0,s.jsx)(n.MessageSquare,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select a project to view chat"})]})})}e.s(["default",()=>eA],319013)}]);