module.exports=[646239,291364,136569,a=>{"use strict";var b=a.i(321248),c=a.i(651332),d=a.i(235746),e=a.i(723593),f=a.i(253322),g=a.i(358054),h=a.i(638735),i=a.i(373004),j=a.i(607226),k=a.i(202979),l=a.i(335558),m=a.i(251326),n=a.i(293470),o=a.i(948428),p=a.i(755820),q=a.i(478184),r=a.i(466577),s=a.i(441405),t=a.i(234211);function u({open:a,onOpenChange:c}){let{toast:e}=(0,t.useToast)(),[f,{loading:g}]=(()=>{let[a,{data:b,loading:c,error:e}]=(0,d.useCreateOne)("project");return[async b=>({data:{createProject:await a({data:b.variables.input,select:{id:!0,name:!0,description:!0,avatar:!0,isArchived:!0,createdAt:!0,updatedAt:!0,userId:!0},include:{members:{include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}}}},_count:{select:{tasks:!0,chatMessages:!0}}}})}}),{loading:c,error:e}]})(),{register:h,handleSubmit:i,reset:j,formState:{errors:l}}=(0,o.useForm)(),m=async a=>{try{await f({variables:{input:{name:a.name,description:a.description||void 0,avatar:a.avatar||void 0}}}),e({title:"Success",description:"Project created successfully",type:"success"}),j(),c(!1)}catch(a){console.error("Create project error:",a),e({title:"Error",description:a.message||"Failed to create project",variant:"destructive",type:"error"})}};return(0,b.jsx)(p.Dialog,{open:a,onOpenChange:c,children:(0,b.jsxs)(p.DialogContent,{className:"sm:max-w-[500px] flex flex-col max-h-[90vh] p-0",children:[(0,b.jsxs)(p.DialogHeader,{className:"px-6 pt-6 pb-4 border-b",children:[(0,b.jsx)(p.DialogTitle,{children:"Create New Project"}),(0,b.jsx)(p.DialogDescription,{children:"Create a project to collaborate with your team"})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:(0,b.jsxs)("form",{id:"create-project-form",onSubmit:i(m),className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(s.Label,{htmlFor:"name",children:["Project Name ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(q.Input,{id:"name",placeholder:"e.g., Website Redesign",...h("name",{required:"Project name is required"}),className:l.name?"border-destructive":""}),l.name&&(0,b.jsx)("p",{className:"text-sm text-destructive mt-1",children:l.name.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(s.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(r.Textarea,{id:"description",placeholder:"Describe your project...",rows:4,...h("description")})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(s.Label,{htmlFor:"avatar",children:"Avatar URL (optional)"}),(0,b.jsx)(q.Input,{id:"avatar",type:"url",placeholder:"https://example.com/image.jpg",...h("avatar")})]})]})}),(0,b.jsx)("div",{className:"px-6 py-4 border-t bg-muted/30",children:(0,b.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,b.jsx)(k.Button,{type:"button",variant:"outline",onClick:()=>{j(),c(!1)},disabled:g,children:"Cancel"}),(0,b.jsx)(k.Button,{type:"submit",form:"create-project-form",disabled:g,children:g?"Creating...":"Create Project"})]})})]})})}function v({selectedProjectId:a,onSelectProject:f,onInviteClick:g}){let{data:h,loading:i,error:j}=((a=!1)=>{let b=(0,c.useMemo)(()=>{if(!a)return{isArchived:{equals:!1}}},[a]),{data:e,loading:f,error:g,refetch:h}=(0,d.useFindMany)("project",{where:b,orderBy:{createdAt:"desc"},include:{members:{include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}}}},_count:{select:{tasks:!0,chatMessages:!0}}}});return{data:{myProjects:e||[]},loading:f,error:g,refetch:h}})(!1),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(!1);if((0,c.useEffect)(()=>{p(!0)},[]),!o)return(0,b.jsxs)("div",{className:"h-full flex flex-col bg-background border-r",children:[(0,b.jsx)("div",{className:"p-4 border-b",children:(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Projects"}),(0,b.jsx)(k.Button,{size:"sm",onClick:()=>n(!0),className:"h-8 w-8 p-0",children:(0,b.jsx)(e.Plus,{className:"h-4 w-4"})})]})}),(0,b.jsx)("div",{className:"flex-1"})]});if(i)return(0,b.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(j)return(0,b.jsx)("div",{className:"h-full flex items-center justify-center p-4",children:(0,b.jsx)("p",{className:"text-sm text-destructive",children:"Failed to load projects"})});let q=h?.myProjects||[];return(0,b.jsxs)("div",{className:"h-full flex flex-col bg-background border-r",children:[(0,b.jsx)("div",{className:"p-4 border-b",children:(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Projects"}),(0,b.jsx)(k.Button,{size:"sm",onClick:()=>n(!0),className:"h-8 w-8 p-0",children:(0,b.jsx)(e.Plus,{className:"h-4 w-4"})})]})}),(0,b.jsx)(l.ScrollArea,{className:"flex-1",children:(0,b.jsx)("div",{className:"p-2 space-y-1",children:0===q.length?(0,b.jsxs)("div",{className:"text-center py-8 px-4",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-sm mb-4",children:"No projects yet"}),(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>n(!0),children:[(0,b.jsx)(e.Plus,{className:"h-4 w-4 mr-2"}),"Create First Project"]})]}):q.map(c=>(0,b.jsx)(w,{project:c,isSelected:c.id===a,onClick:()=>f(c.id),onInviteClick:g},c.id))})}),(0,b.jsx)(u,{open:m,onOpenChange:n})]})}function w({project:a,isSelected:c,onClick:d,onInviteClick:e}){return(0,b.jsxs)("div",{role:"button",tabIndex:0,onClick:d,onKeyDown:a=>{("Enter"===a.key||" "===a.key)&&(a.preventDefault(),d())},className:`
        w-full p-3 rounded-lg text-left transition-colors relative group cursor-pointer
        ${c?"bg-primary/10 border border-primary":"hover:bg-accent border border-transparent"}
      `,children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 mb-2",children:[(0,b.jsxs)(m.Avatar,{className:"h-10 w-10 flex-shrink-0",children:[(0,b.jsx)(m.AvatarImage,{src:a.avatar}),(0,b.jsx)(m.AvatarFallback,{className:"bg-primary/20 text-primary text-xs",children:a.name.substring(0,2).toUpperCase()})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"font-medium text-sm truncate",children:a.name}),a.description&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:a.description})]}),e&&(0,b.jsx)(k.Button,{variant:"ghost",size:"icon",className:"h-7 w-7 opacity-0 group-hover:opacity-100 transition-opacity",onClick:b=>{b.stopPropagation(),e?.(a.id)},title:"M·ªùi th√†nh vi√™n",children:(0,b.jsx)(j.UserPlus,{className:"h-3.5 w-3.5"})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(i.CheckSquare,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:a._count?.tasks||0})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(h.MessageSquare,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:a._count?.chatMessages||0})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(g.Users,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:a.members?.length||0})]})]}),a.members?.find(a=>"owner"===a.role)&&(0,b.jsx)(n.Badge,{variant:"secondary",className:"mt-2 text-xs",children:a.members.find(a=>"owner"===a.role)?.role}),a.isArchived&&(0,b.jsxs)(n.Badge,{variant:"outline",className:"mt-2 text-xs",children:[(0,b.jsx)(f.Archive,{className:"h-3 w-3 mr-1"}),"Archived"]})]})}a.s(["default",()=>v],646239);var x=a.i(681768),y=a.i(629432),z=a.i(585291),A=a.i(128348),B=a.i(327987),C=a.i(411185),D=a.i(779149),E=a.i(871925),F=a.i(928624);function G({task:a,onClick:c}){let[e]=(()=>{let[a,{data:b,loading:c,error:e}]=(0,d.useUpdateOne)("task");return[async b=>{let c={status:b.variables.input.status};return"COMPLETED"===b.variables.input.status?c.completedAt=new Date().toISOString():c.completedAt=null,{data:{updateTask:await a({where:b.variables.input.id,data:c,select:{id:!0,status:!0,completedAt:!0}})}}},{loading:c,error:e}]})(),f=async b=>{try{await e({variables:{input:{id:a.id,status:b?"COMPLETED":"IN_PROGRESS"}}})}catch(a){console.error("Failed to update task status:",a)}},g=a=>{switch(a){case"URGENT":return"bg-red-500 text-white";case"HIGH":return"bg-orange-500 text-white";case"MEDIUM":return"bg-yellow-500 text-white";case"LOW":return"bg-green-500 text-white";default:return"bg-gray-500 text-white"}},j=a.dueDate&&new Date(a.dueDate)<new Date&&"COMPLETED"!==a.status;return(0,b.jsxs)("div",{className:`
        p-4 rounded-lg border-2 transition-all cursor-pointer
        hover:shadow-md hover:border-primary/50
        ${(a=>{switch(a){case"COMPLETED":return"border-green-500 bg-green-50";case"IN_PROGRESS":return"border-blue-500 bg-blue-50";case"PENDING":default:return"border-gray-300 bg-white";case"CANCELLED":return"border-red-300 bg-red-50"}})(a.status)}
        ${"COMPLETED"===a.status?"opacity-60":""}
      `,onClick:c,children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,b.jsx)(F.Checkbox,{checked:"COMPLETED"===a.status,onCheckedChange:f,onClick:a=>a.stopPropagation(),className:"mt-1"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:`font-medium mb-1 ${"COMPLETED"===a.status?"line-through text-muted-foreground":""}`,children:a.title}),a.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-2",children:a.description}),a.tags&&a.tags.length>0&&(0,b.jsx)("div",{className:"flex items-center gap-1 flex-wrap mb-2",children:a.tags.map((a,c)=>(0,b.jsxs)(n.Badge,{variant:"secondary",className:"text-xs",children:[(0,b.jsx)(E.Tag,{className:"h-3 w-3 mr-1"}),a]},c))}),(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-wrap text-xs text-muted-foreground",children:[(0,b.jsx)(n.Badge,{className:`${g(a.priority)} text-xs`,children:a.priority}),a.dueDate&&(0,b.jsxs)("div",{className:`flex items-center gap-1 ${j?"text-red-600 font-medium":""}`,children:[j?(0,b.jsx)(B.AlertCircle,{className:"h-3 w-3"}):(0,b.jsx)(A.Calendar,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:(0,z.format)(new Date(a.dueDate),"MMM dd")})]}),a._count?.comments>0&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(h.MessageSquare,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:a._count.comments})]}),a._count?.subtasks>0&&(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(i.CheckSquare,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:a._count.subtasks})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(C.Clock,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:(0,z.format)(new Date(a.createdAt),"MMM dd, HH:mm")})]})]})]}),(0,b.jsx)("div",{className:`w-1 h-full rounded-full ${g(a.priority)}`})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t",children:[(0,b.jsx)("div",{className:"flex items-center gap-2",children:a.assignedTo&&a.assignedTo.length>0?(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(D.User,{className:"h-3 w-3 text-muted-foreground"}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[a.assignedTo.length," assigned"]})]}):(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"No assignees"})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(m.Avatar,{className:"h-6 w-6",children:[(0,b.jsx)(m.AvatarImage,{src:a.user?.avatar}),(0,b.jsxs)(m.AvatarFallback,{className:"text-xs",children:[a.user?.firstName?.[0],a.user?.lastName?.[0]]})]}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[a.user?.firstName," ",a.user?.lastName]})]})]})]})}var H=a.i(40947),I=a.i(144932),J=a.i(510071),K=a.i(300827),L=a.i(422171),M=a.i(266186),N=a.i(402852),O=a.i(93552),P=a.i(549142),Q=a.i(544169);function R(a,b,c){let d=(0,M.toDate)(a,c?.in);if(isNaN(b))return(0,Q.constructFrom)(c?.in||a,NaN);if(!b)return d;let e=d.getDate(),f=(0,Q.constructFrom)(c?.in||a,d.getTime());return(f.setMonth(d.getMonth()+b+1,0),e>=f.getDate())?f:(d.setFullYear(f.getFullYear(),f.getMonth(),e),d)}var S=a.i(282672),T=a.i(794908);function U(a,b,c){let[d,e]=(0,S.normalizeDates)(c?.in,a,b);return+(0,T.startOfDay)(d)==+(0,T.startOfDay)(e)}function V({mode:a="single",selected:d,onSelect:e,className:f}){let[g,h]=c.useState(d||new Date);return(0,b.jsxs)("div",{className:(0,L.cn)("p-3",f),children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-2 py-2",children:[(0,b.jsx)(k.Button,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>h(R(g,-1,void 0)),children:(0,b.jsx)(J.ChevronLeft,{className:"h-4 w-4"})}),(0,b.jsx)("div",{className:"text-sm font-medium",children:(0,z.format)(g,"MMMM yyyy")}),(0,b.jsx)(k.Button,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>h(R(g,1)),children:(0,b.jsx)(K.ChevronRight,{className:"h-4 w-4"})})]}),(0,b.jsx)("div",{className:"grid grid-cols-7 gap-1 px-2",children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(a=>(0,b.jsx)("div",{className:"flex h-9 w-9 items-center justify-center text-xs font-medium text-muted-foreground",children:a},a))}),(()=>{let a,c,f,h,i,j=((a=(0,M.toDate)(g,void 0)).setDate(1),a.setHours(0,0,0,0),a),k=(0,N.endOfMonth)(j),l=(0,O.startOfWeek)(j),m=(c=(0,P.getDefaultOptions)(),f=(void 0)??void 0??c.weekStartsOn??c.locale?.options?.weekStartsOn??0,i=(h=(0,M.toDate)(k,void 0)).getDay(),h.setDate(h.getDate()+((i<f?-7:0)+6-(i-f))),h.setHours(23,59,59,999),h),n=[],o=[],p=l;for(;p<=m;){for(let a=0;a<7;a++){let a=p;o.push((0,b.jsx)("button",{type:"button",onClick:()=>e?.(a),className:(0,L.cn)("h-9 w-9 rounded-md text-sm transition-colors hover:bg-accent hover:text-accent-foreground",!function(a,b,c){let[d,e]=(0,S.normalizeDates)(void 0,a,b);return d.getFullYear()===e.getFullYear()&&d.getMonth()===e.getMonth()}(p,j)&&"text-muted-foreground opacity-50",d&&U(p,d)&&"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground",U(p,new Date)&&"border border-primary"),children:(0,z.format)(p,"d")},p.toString())),p=function(a,b,c){let d=(0,M.toDate)(a,void 0);return isNaN(1)?(0,Q.constructFrom)(a,NaN):(d.setDate(d.getDate()+1),d)}(p,0)}n.push((0,b.jsx)("div",{className:"grid grid-cols-7 gap-1 px-2",children:o},p.toString())),o=[]}return(0,b.jsx)("div",{className:"space-y-1",children:n})})()]})}var W=a.i(794155),X=a.i(722112),X=X,Y=a.i(363615);function Z({open:a,onOpenChange:e,projectId:f}){let{user:g}=(0,H.useAuth)(),[h,{loading:i}]=(a=>{let[b,{data:c,loading:e,error:f}]=(0,d.useCreateOne)("task");return[async a=>{let{userId:c,...d}=a.variables.input;if(!c)throw Error("userId is required to create a task");return{data:{createProjectTask:await b({data:{...d,projectId:a.variables.projectId,status:"PENDING",order:0,user:{connect:{id:c}}},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{comments:!0,subtasks:!0}}}})}}},{loading:e,error:f}]})(0),{data:j}=(a=>{let{data:b,loading:c,error:e,refetch:f}=(0,d.useFindMany)("projectMember",{where:{projectId:{equals:a}},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}}},orderBy:{joinedAt:"asc"}},{skip:!a});return{data:{projectMembers:b||[]},loading:c,error:e,refetch:f}})(f),{register:l,handleSubmit:m,reset:n,setValue:t,watch:u,formState:{errors:v}}=(0,o.useForm)({defaultValues:{priority:"MEDIUM",category:"OTHER"}}),[w,x]=(0,c.useState)(),[y,A]=(0,c.useState)([]),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)(""),F=async a=>{if(!g?.id)return void console.error("User not authenticated");try{await h({variables:{projectId:f,input:{title:a.title,description:a.description||"",priority:a.priority,category:a.category,dueDate:w?.toISOString(),assignedTo:y,tags:B,userId:g.id}}}),n(),x(void 0),A([]),C([]),e(!1)}catch(a){console.error("Failed to create task:",a)}},G=()=>{D.trim()&&!B.includes(D.trim())&&(C([...B,D.trim()]),E(""))},J=j?.projectMembers||[];return(0,b.jsx)(p.Dialog,{open:a,onOpenChange:e,children:(0,b.jsxs)(p.DialogContent,{className:"sm:max-w-[600px] flex flex-col max-h-[90vh] p-0",children:[(0,b.jsxs)(p.DialogHeader,{className:"px-6 pt-6 pb-4 border-b",children:[(0,b.jsx)(p.DialogTitle,{children:"Create New Task"}),(0,b.jsx)(p.DialogDescription,{children:"Add a task to your project (like posting on Facebook)"})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:(0,b.jsxs)("form",{id:"create-task-form",onSubmit:m(F),className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)(s.Label,{htmlFor:"title",children:["Task Title ",(0,b.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,b.jsx)(q.Input,{id:"title",placeholder:"e.g., Design homepage mockup",...l("title",{required:"Title is required"}),className:v.title?"border-destructive":""}),v.title&&(0,b.jsx)("p",{className:"text-sm text-destructive mt-1",children:v.title.message})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(s.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(r.Textarea,{id:"description",placeholder:"Describe the task in detail...",rows:4,...l("description")}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Use @username to mention team members"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(s.Label,{htmlFor:"priority",children:"Priority"}),(0,b.jsxs)(I.Select,{defaultValue:"MEDIUM",onValueChange:a=>t("priority",a),children:[(0,b.jsx)(I.SelectTrigger,{children:(0,b.jsx)(I.SelectValue,{})}),(0,b.jsxs)(I.SelectContent,{children:[(0,b.jsx)(I.SelectItem,{value:"LOW",children:"üü¢ Low"}),(0,b.jsx)(I.SelectItem,{value:"MEDIUM",children:"üü° Medium"}),(0,b.jsx)(I.SelectItem,{value:"HIGH",children:"üü† High"}),(0,b.jsx)(I.SelectItem,{value:"URGENT",children:"üî¥ Urgent"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(s.Label,{htmlFor:"category",children:"Category"}),(0,b.jsxs)(I.Select,{defaultValue:"OTHER",onValueChange:a=>t("category",a),children:[(0,b.jsx)(I.SelectTrigger,{children:(0,b.jsx)(I.SelectValue,{})}),(0,b.jsxs)(I.SelectContent,{children:[(0,b.jsx)(I.SelectItem,{value:"WORK",children:"üíº Work"}),(0,b.jsx)(I.SelectItem,{value:"PERSONAL",children:"üë§ Personal"}),(0,b.jsx)(I.SelectItem,{value:"SHOPPING",children:"üõí Shopping"}),(0,b.jsx)(I.SelectItem,{value:"HEALTH",children:"üè• Health"}),(0,b.jsx)(I.SelectItem,{value:"OTHER",children:"üìå Other"})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(s.Label,{children:"Due Date"}),(0,b.jsxs)(W.Popover,{children:[(0,b.jsx)(W.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(k.Button,{variant:"outline",className:(0,L.cn)("w-full justify-start text-left font-normal",!w&&"text-muted-foreground"),children:[(0,b.jsx)(X.default,{className:"mr-2 h-4 w-4"}),w?(0,z.format)(w,"PPP"):"Pick a date"]})}),(0,b.jsx)(W.PopoverContent,{className:"w-auto p-0",children:(0,b.jsx)(V,{mode:"single",selected:w,onSelect:x,initialFocus:!0})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(s.Label,{children:"Assign to (optional)"}),(0,b.jsxs)(I.Select,{onValueChange:a=>{y.includes(a)||A([...y,a])},children:[(0,b.jsx)(I.SelectTrigger,{children:(0,b.jsx)(I.SelectValue,{placeholder:"Select team members"})}),(0,b.jsx)(I.SelectContent,{children:J.map(a=>(0,b.jsxs)(I.SelectItem,{value:a.userId,children:[a.user.firstName," ",a.user.lastName," (",a.role,")"]},a.userId))})]}),y.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:y.map(a=>{let c=J.find(b=>b.userId===a);return(0,b.jsxs)("div",{className:"flex items-center gap-1 bg-secondary px-2 py-1 rounded-md text-sm",children:[(0,b.jsx)("span",{children:c?.user.firstName}),(0,b.jsx)("button",{type:"button",onClick:()=>A(y.filter(b=>b!==a)),className:"hover:text-destructive",children:(0,b.jsx)(Y.X,{className:"h-3 w-3"})})]},a)})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(s.Label,{children:"Tags"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(q.Input,{placeholder:"Add tag (e.g., urgent, backend)",value:D,onChange:a=>E(a.target.value),onKeyPress:a=>{"Enter"===a.key&&(a.preventDefault(),G())}}),(0,b.jsx)(k.Button,{type:"button",variant:"outline",onClick:G,children:"Add"})]}),B.length>0&&(0,b.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:B.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-1 bg-primary/10 px-2 py-1 rounded-md text-sm",children:[(0,b.jsx)("span",{children:a}),(0,b.jsx)("button",{type:"button",onClick:()=>{C(B.filter(b=>b!==a))},className:"hover:text-destructive",children:(0,b.jsx)(Y.X,{className:"h-3 w-3"})})]},a))})]})]})}),(0,b.jsx)("div",{className:"px-6 py-4 border-t bg-muted/30",children:(0,b.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,b.jsx)(k.Button,{type:"button",variant:"outline",onClick:()=>{n(),x(void 0),A([]),C([]),e(!1)},disabled:i,children:"Cancel"}),(0,b.jsx)(k.Button,{type:"submit",form:"create-task-form",disabled:i,children:i?"Creating...":"Create Task"})]})})]})})}var $=a.i(502794),_=a.i(687649),aa=a.i(558767),ab=a.i(810687),ac=a.i(723989),ad=a.i(751075);function ae({taskId:a}){let{toast:e}=(0,t.useToast)(),{data:f,loading:g,refetch:i}=(a=>{let b=(0,c.useMemo)(()=>{if(a)return{taskId:{equals:a},parentId:{equals:null}}},[a]),{data:e,loading:f,error:g,refetch:h}=(0,d.useFindMany)("taskComment",{where:b,orderBy:{createdAt:"asc"},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},replies:{orderBy:{createdAt:"asc"},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{replies:!0}}}},_count:{select:{replies:!0}}}},{skip:!a,fetchPolicy:"cache-and-network"});return{data:e||[],loading:f,error:g,refetch:h}})(a),[j,{loading:m}]=(()=>{let[a,{data:b,loading:c,error:e}]=(0,d.useCreateOne)("taskComment");return[async b=>({data:{createComment:await a({data:b.variables.input,include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{replies:!0}}}})}}),{loading:c,error:e}]})(),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(null),s=async b=>{if(b.preventDefault(),n.trim())try{await j({variables:{input:{content:n,taskId:a,parentId:p||void 0}}}),e({title:"Success",description:"Comment added",type:"success"}),o(""),q(null),i()}catch(a){e({title:"Error",description:"Failed to add comment",variant:"destructive",type:"error"})}};return g?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(l.ScrollArea,{className:"h-[400px] pr-4",children:0===f.length?(0,b.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,b.jsx)(h.MessageSquare,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,b.jsx)("p",{children:"No comments yet"}),(0,b.jsx)("p",{className:"text-sm",children:"Be the first to comment!"})]}):(0,b.jsx)("div",{className:"space-y-4",children:f.map(c=>(0,b.jsx)(af,{comment:c,taskId:a,onReply:a=>q(a),onUpdate:i},c.id))})}),p&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground bg-muted/50 p-2 rounded",children:[(0,b.jsx)(ab.Reply,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Replying to comment"}),(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:()=>q(null),className:"h-6 ml-auto",children:"Cancel"})]}),(0,b.jsxs)("form",{onSubmit:s,className:"space-y-2",children:[(0,b.jsx)(r.Textarea,{value:n,onChange:a=>o(a.target.value),placeholder:"Write a comment...",rows:3,className:"resize-none"}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)(k.Button,{type:"submit",disabled:m||!n.trim(),children:[(0,b.jsx)($.Send,{className:"h-4 w-4 mr-2"}),p?"Reply":"Comment"]})})]})]})}function af({comment:a,taskId:e,onReply:f,onUpdate:g,depth:h=0}){let{toast:i}=(0,t.useToast)(),[j,{loading:l}]=(()=>{let[a,{data:b,loading:c,error:e}]=(0,d.useUpdateOne)("taskComment");return[async b=>({data:{updateComment:await a({where:b.variables.id,data:b.variables.input,include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}}}})}}),{loading:c,error:e}]})(),[n,{loading:o}]=(()=>{let[a,{data:b,loading:c,error:e}]=(0,d.useDeleteOne)("taskComment");return[async b=>({data:{deleteComment:await a({where:b.variables.id,select:{id:!0}})}}),{loading:c,error:e}]})(),[p,q]=(0,c.useState)(!1),[s,u]=(0,c.useState)(a.content),v=async()=>{if(s.trim())try{await j({variables:{id:a.id,input:{content:s}}}),i({title:"Success",description:"Comment updated",type:"success"}),q(!1),g()}catch(a){i({title:"Error",description:"Failed to update comment",variant:"destructive",type:"error"})}},w=async()=>{if(confirm("Delete this comment?"))try{await n({variables:{id:a.id}}),i({title:"Success",description:"Comment deleted",type:"success"}),g()}catch(a){i({title:"Error",description:"Failed to delete comment",variant:"destructive",type:"error"})}};return(0,b.jsxs)("div",{className:`${h>0?"ml-8 mt-2":""}`,children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 group",children:[(0,b.jsxs)(m.Avatar,{className:"h-8 w-8 flex-shrink-0",children:[(0,b.jsx)(m.AvatarImage,{src:a.user?.avatar}),(0,b.jsxs)(m.AvatarFallback,{className:"text-xs",children:[a.user?.firstName?.[0],a.user?.lastName?.[0]]})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsxs)("span",{className:"font-medium text-sm",children:[a.user?.firstName," ",a.user?.lastName]}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:(0,z.format)(new Date(a.createdAt),"MMM dd, HH:mm")}),a.updatedAt!==a.createdAt&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"(edited)"})]}),p?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(r.Textarea,{value:s,onChange:a=>u(a.target.value),rows:2,className:"text-sm"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(k.Button,{size:"sm",onClick:v,disabled:l,children:"Save"}),(0,b.jsx)(k.Button,{size:"sm",variant:"outline",onClick:()=>{q(!1),u(a.content)},children:"Cancel"})]})]}):(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:a.content}),!p&&(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,b.jsxs)(k.Button,{variant:"ghost",size:"sm",onClick:()=>f(a.id),className:"h-6 text-xs opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,b.jsx)(ab.Reply,{className:"h-3 w-3 mr-1"}),"Reply"]}),(0,b.jsxs)(ad.DropdownMenu,{children:[(0,b.jsx)(ad.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsx)(ac.MoreVertical,{className:"h-3 w-3"})})}),(0,b.jsxs)(ad.DropdownMenuContent,{align:"end",children:[(0,b.jsxs)(ad.DropdownMenuItem,{onClick:()=>q(!0),children:[(0,b.jsx)(_.Edit,{className:"h-3 w-3 mr-2"}),"Edit"]}),(0,b.jsxs)(ad.DropdownMenuItem,{onClick:w,className:"text-destructive",children:[(0,b.jsx)(aa.Trash2,{className:"h-3 w-3 mr-2"}),"Delete"]})]})]})]})]})]}),a.replies&&a.replies.length>0&&(0,b.jsx)("div",{className:"mt-2 space-y-2",children:a.replies.map(a=>(0,b.jsx)(af,{comment:a,taskId:e,onReply:f,onUpdate:g,depth:h+1},a.id))})]})}let ag=a=>{let b=(0,c.useMemo)(()=>{if(a)return{parentId:{equals:a}}},[a]),{data:e,loading:f,error:g,refetch:h}=(0,d.useFindMany)("task",{where:b,orderBy:{createdAt:"asc"},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},subtasks:{orderBy:{order:"asc"},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}}}},_count:{select:{subtasks:!0}}}},{skip:!a,fetchPolicy:"cache-and-network"});return{data:e||[],loading:f,error:g,refetch:h}};var ah=a.i(976762),ai=a.i(890082),aj=a.i(753748),ak=a.i(669055);function al({taskId:a}){let{toast:f}=(0,t.useToast)(),{user:g}=(0,H.useAuth)(),{data:h,loading:i,refetch:j}=ag(a),l=(a=>{let{data:b,loading:d,error:e}=ag(a);return{...(0,c.useMemo)(()=>{let a=b.length,c=b.filter(a=>"COMPLETED"===a.status).length,d=a>0?Math.round(c/a*100):0;return{total:a,completed:c,percentage:d}},[b]),loading:d,error:e}})(a),[m,{loading:n}]=(()=>{let[a,{data:b,loading:c,error:e}]=(0,d.useCreateOne)("task");return[async b=>{let{userId:c,...d}=b.variables.input;if(!c)throw Error("userId is required to create a subtask");return{data:{createSubtask:await a({data:{...d,status:"PENDING",category:"OTHER",order:0,user:{connect:{id:c}}},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{subtasks:!0}}}})}}},{loading:c,error:e}]})(),[o,p]=(0,c.useState)(""),[r,s]=(0,c.useState)(new Set),u=async b=>{if(b.preventDefault(),o.trim()){if(!g?.id)return void f({title:"Error",description:"User not authenticated",variant:"destructive",type:"error"});try{await m({variables:{input:{title:o,parentId:a,userId:g.id}}}),f({title:"Success",description:"Subtask created",type:"success"}),p(""),j()}catch(a){f({title:"Error",description:"Failed to create subtask",variant:"destructive",type:"error"})}}};return i?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(0,b.jsxs)("div",{className:"space-y-4",children:[l&&h.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:"Progress"}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:[l.completed," / ",l.total," completed"]})]}),(0,b.jsx)(ah.Progress,{value:l.percentage,className:"h-2"}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground text-right",children:[l.percentage.toFixed(0),"% complete"]})]}),(0,b.jsx)("div",{className:"space-y-2",children:0===h.length?(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(aj.Circle,{className:"h-10 w-10 mx-auto mb-2 opacity-50"}),(0,b.jsx)("p",{children:"No subtasks yet"}),(0,b.jsx)("p",{className:"text-sm",children:"Break this task into smaller steps"})]}):h.map(a=>(0,b.jsx)(am,{subtask:a,onUpdate:j,isExpanded:r.has(a.id),onToggleExpanded:()=>{var b;return b=a.id,void s(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})}},a.id))}),(0,b.jsxs)("form",{onSubmit:u,className:"flex gap-2",children:[(0,b.jsx)(q.Input,{value:o,onChange:a=>p(a.target.value),placeholder:"Add a subtask...",className:"flex-1"}),(0,b.jsxs)(k.Button,{type:"submit",disabled:n||!o.trim(),children:[(0,b.jsx)(e.Plus,{className:"h-4 w-4 mr-2"}),"Add"]})]})]})}function am({subtask:a,onUpdate:c,depth:e=0,isExpanded:f=!1,onToggleExpanded:g}){let{toast:h}=(0,t.useToast)(),[i,{loading:j}]=(()=>{let[a,{data:b,loading:c,error:e}]=(0,d.useUpdateOne)("task");return[async b=>({data:{toggleSubtask:await a({where:b.variables.id,data:{status:b.variables.completed?"COMPLETED":"PENDING",completedAt:b.variables.completed?new Date().toISOString():null},select:{id:!0,status:!0,completedAt:!0}})}}),{loading:c,error:e}]})(),[l,{loading:m}]=(()=>{let[a,{data:b,loading:c,error:e}]=(0,d.useDeleteOne)("task");return[async b=>({data:{deleteSubtask:await a({where:b.variables.id,select:{id:!0}})}}),{loading:c,error:e}]})(),n=async()=>{try{let b="COMPLETED"!==a.status;await i({variables:{id:a.id,completed:b}}),c()}catch(a){h({title:"Error",description:"Failed to update subtask",variant:"destructive",type:"error"})}},o=async()=>{if(confirm("Delete this subtask?"))try{await l({variables:{id:a.id}}),h({title:"Success",description:"Subtask deleted",type:"success"}),c()}catch(a){h({title:"Error",description:"Failed to delete subtask",variant:"destructive",type:"error"})}},p="COMPLETED"===a.status,q=a.subtasks&&a.subtasks.length>0;return(0,b.jsxs)("div",{className:`${e>0?"ml-6 mt-1":""}`,children:[(0,b.jsxs)("div",{className:"group flex items-center gap-2 p-2 rounded-lg hover:bg-muted/50 transition-colors",children:[q&&(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:g,className:"h-6 w-6 p-0",children:f?(0,b.jsx)(ak.ChevronDown,{className:"h-3 w-3"}):(0,b.jsx)(K.ChevronRight,{className:"h-3 w-3"})}),(0,b.jsx)(F.Checkbox,{checked:p,onCheckedChange:n,disabled:j,className:"flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:(0,L.cn)("text-sm truncate",p&&"line-through text-muted-foreground"),children:a.title}),a.dueDate&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Due: ",(0,z.format)(new Date(a.dueDate),"MMM dd")]})]}),p?(0,b.jsx)(ai.CheckCircle2,{className:"h-4 w-4 text-green-600 flex-shrink-0"}):(0,b.jsx)(aj.Circle,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),q&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-0.5 rounded-full",children:a.subtasks.length}),(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",onClick:o,disabled:m,className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsx)(aa.Trash2,{className:"h-3 w-3 text-destructive"})})]}),q&&f&&(0,b.jsx)("div",{className:"mt-1 space-y-1",children:a.subtasks.map(a=>(0,b.jsx)(am,{subtask:a,onUpdate:c,depth:e+1},a.id))})]})}var an=a.i(509423);let ao=(a,b)=>{let e=(0,c.useMemo)(()=>{if(!a)return;let c={taskId:{equals:a}};return b?.action&&(c.action={equals:b.action}),b?.userId&&(c.userId={equals:b.userId}),(b?.fromDate||b?.toDate)&&(c.createdAt={},b.fromDate&&(c.createdAt.gte=b.fromDate),b.toDate&&(c.createdAt.lte=b.toDate)),c},[a,b]),{data:f,loading:g,error:h,refetch:i}=(0,d.useFindMany)("taskActivityLog",{where:e,orderBy:{createdAt:"desc"},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}}}},{skip:!a,fetchPolicy:"cache-and-network"});return{data:f||[],loading:g,error:h,refetch:i}},ap=a=>{switch(a){case"TASK_CREATED":return"‚ú®";case"TASK_UPDATED":case"COMMENT_EDITED":case"TITLE_CHANGED":return"‚úèÔ∏è";case"TASK_DELETED":case"COMMENT_DELETED":case"FILE_DELETED":return"üóëÔ∏è";case"TASK_STATUS_CHANGED":return"üìã";case"TASK_PRIORITY_CHANGED":return"üî•";case"TASK_ASSIGNED":return"üë§";case"TASK_UNASSIGNED":return"üëã";case"COMMENT_ADDED":return"üí¨";case"SUBTASK_ADDED":return"‚ûï";case"SUBTASK_COMPLETED":return"‚úÖ";case"SUBTASK_DELETED":return"‚ùå";case"FILE_UPLOADED":return"üìé";case"DUE_DATE_CHANGED":return"üìÖ";case"DESCRIPTION_CHANGED":return"üìù";default:return"üìå"}};var aq=a.i(57597);let ar=["TASK_CREATED","TASK_UPDATED","TASK_DELETED","TASK_STATUS_CHANGED","TASK_PRIORITY_CHANGED","TASK_ASSIGNED","TASK_UNASSIGNED","COMMENT_ADDED","COMMENT_EDITED","COMMENT_DELETED","SUBTASK_ADDED","SUBTASK_COMPLETED","SUBTASK_DELETED","FILE_UPLOADED","FILE_DELETED","DUE_DATE_CHANGED","DESCRIPTION_CHANGED","TITLE_CHANGED"];function as({taskId:a}){let[d,e]=(0,c.useState)("ALL"),[f,g]=(0,c.useState)(!1),{data:h,loading:i}=ao(a,"ALL"!==d?{action:d}:void 0),{data:j,loading:m}=ao(a,{fromDate:(0,c.useMemo)(()=>{let a=new Date;return a.setHours(a.getHours()-24),a.toISOString()},[])}),{stats:n}=(a=>{let{data:b,loading:d,error:e}=ao(a);return{stats:(0,c.useMemo)(()=>{let a={};return b.forEach(b=>{a[b.action]=(a[b.action]||0)+1}),a},[b]),loading:d,error:e}})(a),o=f?j:h;return(f?m:i)?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(x.Filter,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)(I.Select,{value:d,onValueChange:a=>e(a),children:[(0,b.jsx)(I.SelectTrigger,{className:"w-[200px]",children:(0,b.jsx)(I.SelectValue,{placeholder:"Filter by type"})}),(0,b.jsxs)(I.SelectContent,{children:[(0,b.jsx)(I.SelectItem,{value:"ALL",children:"All Activities"}),ar.map(a=>(0,b.jsxs)(I.SelectItem,{value:a,children:[ap(a)," ",a.replace(/_/g," ")]},a))]})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)(k.Button,{variant:f?"default":"outline",size:"sm",onClick:()=>g(!f),children:[(0,b.jsx)(C.Clock,{className:"h-4 w-4 mr-2"}),"Last 24h"]})})]}),n&&Object.keys(n).length>0&&(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-2 p-3 bg-muted/50 rounded-lg",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:Object.values(n).reduce((a,b)=>a+b,0)}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Total"})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:n.TASK_STATUS_CHANGED||0}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Status Changes"})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:n.COMMENT_ADDED||0}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Comments"})]})]}),(0,b.jsx)(l.ScrollArea,{className:"h-[400px] pr-4",children:0===o.length?(0,b.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,b.jsx)(aq.TrendingUp,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,b.jsx)("p",{children:"No activity yet"}),(0,b.jsx)("p",{className:"text-sm",children:f?"No activity in the last 24 hours":"Activity will appear here"})]}):(0,b.jsx)("div",{className:"space-y-4",children:o.map(a=>(0,b.jsx)(at,{activity:a},a.id))})})]})}function at({activity:a}){let c=ap(a.action),d=(a=>{switch(a){case"TASK_CREATED":case"SUBTASK_ADDED":case"SUBTASK_COMPLETED":return"text-green-600";case"TASK_DELETED":case"COMMENT_DELETED":case"SUBTASK_DELETED":case"FILE_DELETED":return"text-red-600";case"TASK_STATUS_CHANGED":return"text-blue-600";case"TASK_PRIORITY_CHANGED":return"text-orange-600";case"COMMENT_ADDED":return"text-purple-600";case"FILE_UPLOADED":return"text-indigo-600";default:return"text-gray-600"}})(a.action),e=a.oldValue?"string"==typeof a.oldValue?a.oldValue:JSON.stringify(a.oldValue):null,f=a.newValue?"string"==typeof a.newValue?a.newValue:JSON.stringify(a.newValue):null;return(0,b.jsxs)("div",{className:"flex items-start gap-3 group",children:[(0,b.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,b.jsx)("div",{className:(0,L.cn)("w-8 h-8 rounded-full flex items-center justify-center text-sm",d),children:c}),(0,b.jsx)("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 w-0.5 h-full bg-border"})]}),(0,b.jsx)("div",{className:"flex-1 min-w-0 pb-4",children:(0,b.jsxs)("div",{className:"flex items-start gap-2 mb-1",children:[(0,b.jsxs)(m.Avatar,{className:"h-6 w-6 flex-shrink-0",children:[(0,b.jsx)(m.AvatarImage,{src:a.user?.avatar}),(0,b.jsxs)(m.AvatarFallback,{className:"text-xs",children:[a.user?.firstName?.[0],a.user?.lastName?.[0]]})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsxs)("span",{className:"font-medium text-sm",children:[a.user?.firstName," ",a.user?.lastName]}),(0,b.jsx)(n.Badge,{variant:"outline",className:"text-xs",children:a.action.replace(/_/g," ")})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-0.5",children:a.description}),(e||f)&&(0,b.jsxs)("div",{className:"mt-2 p-2 bg-muted/50 rounded text-xs space-y-1",children:[e&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"From:"})," ",(0,b.jsx)("span",{className:"font-mono text-red-600",children:e})]}),f&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"To:"})," ",(0,b.jsx)("span",{className:"font-mono text-green-600",children:f})]})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[(0,an.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})," ","¬∑ ",(0,z.format)(new Date(a.createdAt),"MMM dd, HH:mm")]})]})]})})]})}let au=a.i(376946).Root;var av=a.i(785694),aw=a.i(951369),ax=a.i(973174);function ay({taskId:a,projectId:e,open:f,onOpenChange:g}){let{toast:j}=(0,t.useToast)(),{data:l,loading:o,error:u,refetch:v}=(a=>{let{data:b,loading:c,error:e,refetch:f}=(0,d.useFindUnique)("task",a||"",{include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{comments:!0,subtasks:!0}}}},{skip:!a});return{data:b?{task:b}:void 0,loading:c,error:e,refetch:f}})(a),[w,{loading:x}]=(()=>{let[a,{data:b,loading:c,error:e}]=(0,d.useUpdateOne)("task");return[async b=>({data:{updateTask:await a({where:b.variables.id,data:b.variables.input,include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{comments:!0,subtasks:!0}}}})}}),{loading:c,error:e}]})(),[y,{loading:F}]=(a=>{let[b,{data:c,loading:e,error:f}]=(0,d.useDeleteOne)("task");return[async a=>({data:{deleteTask:await b({where:a.variables.id,select:{id:!0}})}}),{loading:e,error:f}]})(0),[G,H]=(0,c.useState)(!1),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)(""),N=l?.task;if(c.default.useEffect(()=>{N&&(K(N.title),M(N.description||""))},[N]),!f||!a)return null;if(o)return(0,b.jsx)(p.Dialog,{open:f,onOpenChange:g,children:(0,b.jsxs)(p.DialogContent,{className:"max-w-4xl flex flex-col max-h-[90vh] p-0",children:[(0,b.jsx)(au,{children:(0,b.jsx)(p.DialogTitle,{children:"Loading task details"})}),(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})]})});if(u||!N)return(0,b.jsx)(p.Dialog,{open:f,onOpenChange:g,children:(0,b.jsxs)(p.DialogContent,{className:"max-w-4xl flex flex-col max-h-[90vh] p-0",children:[(0,b.jsx)(au,{children:(0,b.jsx)(p.DialogTitle,{children:"Error loading task"})}),(0,b.jsx)("div",{className:"text-center py-12",children:(0,b.jsx)("p",{className:"text-destructive",children:"Failed to load task details"})})]})});let O=async()=>{try{await w({variables:{id:a,input:{title:J,description:L}}}),j({title:"Success",description:"Task updated successfully",type:"success"}),H(!1),v()}catch(a){j({title:"Error",description:"Failed to update task",variant:"destructive",type:"error"})}},P=async()=>{if(confirm("Are you sure you want to delete this task?"))try{await y({variables:{id:a}}),j({title:"Success",description:"Task deleted successfully",type:"success"}),g(!1)}catch(a){j({title:"Error",description:"Failed to delete task",variant:"destructive",type:"error"})}},Q=async b=>{try{await w({variables:{id:a,input:{status:b}}}),j({title:"Success",description:"Status updated",type:"success"}),v()}catch(a){j({title:"Error",description:"Failed to update status",variant:"destructive",type:"error"})}},R=async b=>{try{await w({variables:{id:a,input:{priority:b}}}),j({title:"Success",description:"Priority updated",type:"success"}),v()}catch(a){j({title:"Error",description:"Failed to update priority",variant:"destructive",type:"error"})}},S=N.dueDate&&new Date(N.dueDate)<new Date&&"COMPLETED"!==N.status;return(0,b.jsx)(p.Dialog,{open:f,onOpenChange:g,children:(0,b.jsxs)(p.DialogContent,{className:"max-w-4xl flex flex-col max-h-[90vh] p-0",children:[(0,b.jsx)(p.DialogHeader,{className:"px-6 pt-6 pb-4 border-b",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsx)("div",{className:"flex-1",children:G?(0,b.jsx)(q.Input,{value:J,onChange:a=>K(a.target.value),className:"text-lg font-semibold",placeholder:"Task title"}):(0,b.jsx)(p.DialogTitle,{className:"text-xl",children:N.title})}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:G?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(k.Button,{size:"sm",onClick:O,disabled:x,children:[(0,b.jsx)(ax.Save,{className:"h-4 w-4 mr-2"}),"Save"]}),(0,b.jsxs)(k.Button,{size:"sm",variant:"outline",onClick:()=>H(!1),children:[(0,b.jsx)(Y.X,{className:"h-4 w-4 mr-2"}),"Cancel"]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(k.Button,{size:"sm",variant:"outline",onClick:()=>H(!0),children:[(0,b.jsx)(_.Edit,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,b.jsxs)(k.Button,{size:"sm",variant:"destructive",onClick:P,disabled:F,children:[(0,b.jsx)(aa.Trash2,{className:"h-4 w-4 mr-2"}),"Delete"]})]})})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(s.Label,{children:"Status"}),(0,b.jsxs)(I.Select,{value:N.status,onValueChange:Q,children:[(0,b.jsx)(I.SelectTrigger,{children:(0,b.jsx)(I.SelectValue,{})}),(0,b.jsxs)(I.SelectContent,{children:[(0,b.jsx)(I.SelectItem,{value:"PENDING",children:"üìã Pending"}),(0,b.jsx)(I.SelectItem,{value:"IN_PROGRESS",children:"‚ö° In Progress"}),(0,b.jsx)(I.SelectItem,{value:"COMPLETED",children:"‚úÖ Completed"}),(0,b.jsx)(I.SelectItem,{value:"CANCELLED",children:"‚ùå Cancelled"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(s.Label,{children:"Priority"}),(0,b.jsxs)(I.Select,{value:N.priority,onValueChange:R,children:[(0,b.jsx)(I.SelectTrigger,{children:(0,b.jsx)(I.SelectValue,{})}),(0,b.jsxs)(I.SelectContent,{children:[(0,b.jsx)(I.SelectItem,{value:"LOW",children:"üü¢ Low"}),(0,b.jsx)(I.SelectItem,{value:"MEDIUM",children:"üü° Medium"}),(0,b.jsx)(I.SelectItem,{value:"HIGH",children:"üü† High"}),(0,b.jsx)(I.SelectItem,{value:"URGENT",children:"üî¥ Urgent"})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(s.Label,{children:"Description"}),G?(0,b.jsx)(r.Textarea,{value:L,onChange:a=>M(a.target.value),rows:5,placeholder:"Task description..."}):(0,b.jsx)("div",{className:"p-3 bg-muted/50 rounded-md min-h-[100px]",children:N.description||(0,b.jsx)("span",{className:"text-muted-foreground italic",children:"No description"})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-4 bg-muted/30 rounded-lg",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(A.Calendar,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Due Date"}),(0,b.jsx)("div",{className:`text-sm font-medium ${S?"text-red-600":""}`,children:N.dueDate?(0,b.jsxs)(b.Fragment,{children:[(0,z.format)(new Date(N.dueDate),"PPP"),S&&(0,b.jsx)(B.AlertCircle,{className:"inline h-3 w-3 ml-1"})]}):"No due date"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(D.User,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Created By"}),(0,b.jsxs)("div",{className:"text-sm font-medium flex items-center gap-2",children:[(0,b.jsxs)(m.Avatar,{className:"h-5 w-5",children:[(0,b.jsx)(m.AvatarImage,{src:N.user?.avatar}),(0,b.jsxs)(m.AvatarFallback,{className:"text-xs",children:[N.user?.firstName?.[0],N.user?.lastName?.[0]]})]}),N.user?.firstName," ",N.user?.lastName]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(C.Clock,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Created"}),(0,b.jsx)("div",{className:"text-sm font-medium",children:(0,z.format)(new Date(N.createdAt),"PPp")})]})]}),N.completedAt&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(i.CheckSquare,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"Completed"}),(0,b.jsx)("div",{className:"text-sm font-medium",children:(0,z.format)(new Date(N.completedAt),"PPp")})]})]})]})]}),N.tags&&N.tags.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(s.Label,{children:"Tags"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:N.tags.map((a,c)=>(0,b.jsxs)(n.Badge,{variant:"secondary",children:[(0,b.jsx)(E.Tag,{className:"h-3 w-3 mr-1"}),a]},c))})]}),N.assignedTo&&N.assignedTo.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(s.Label,{children:"Assigned To"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,b.jsx)(D.User,{className:"h-4 w-4"}),N.assignedTo.length," member(s) assigned"]})]}),(0,b.jsx)(av.Separator,{}),(0,b.jsxs)(aw.Tabs,{defaultValue:"comments",className:"w-full",children:[(0,b.jsxs)(aw.TabsList,{className:"grid w-full grid-cols-3",children:[(0,b.jsxs)(aw.TabsTrigger,{value:"comments",children:[(0,b.jsx)(h.MessageSquare,{className:"h-4 w-4 mr-2"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Comments"}),(0,b.jsx)("span",{className:"sm:hidden",children:"üí¨"}),(0,b.jsxs)("span",{className:"ml-1",children:["(",N._count?.comments||0,")"]})]}),(0,b.jsxs)(aw.TabsTrigger,{value:"subtasks",children:[(0,b.jsx)(i.CheckSquare,{className:"h-4 w-4 mr-2"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Subtasks"}),(0,b.jsx)("span",{className:"sm:hidden",children:"‚úì"}),(0,b.jsxs)("span",{className:"ml-1",children:["(",N._count?.subtasks||0,")"]})]}),(0,b.jsxs)(aw.TabsTrigger,{value:"activity",children:[(0,b.jsx)(C.Clock,{className:"h-4 w-4 mr-2"}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Activity"}),(0,b.jsx)("span",{className:"sm:hidden",children:"‚è±"})]})]}),(0,b.jsx)(aw.TabsContent,{value:"comments",className:"space-y-4 pt-4",children:(0,b.jsx)(ae,{taskId:a})}),(0,b.jsx)(aw.TabsContent,{value:"subtasks",className:"space-y-4 pt-4",children:(0,b.jsx)(al,{taskId:a})}),(0,b.jsx)(aw.TabsContent,{value:"activity",className:"space-y-4 pt-4",children:(0,b.jsx)(as,{taskId:a})})]})]})}),(0,b.jsx)("div",{className:"px-6 py-4 border-t bg-muted/30",children:(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"text-xs text-muted-foreground text-center sm:text-left",children:["Last updated ",(0,z.format)(new Date(N.updatedAt),"PPp")]}),(0,b.jsx)(k.Button,{variant:"outline",onClick:()=>g(!1),children:"Close"})]})})]})})}function az({projectId:a}){let[f,g]=(0,c.useState)(""),[h,i]=(0,c.useState)(!1),[j,m]=(0,c.useState)(null),[o,p]=(0,c.useState)(null),{data:r,loading:s,error:t}=((a,b)=>{let e=(0,c.useMemo)(()=>{if(!a)return;let c={projectId:{equals:a}};return b?.status&&(c.status={equals:b.status}),b?.priority&&(c.priority={equals:b.priority}),b?.category&&(c.category={equals:b.category}),b?.search&&(c.OR=[{title:{contains:b.search,mode:"insensitive"}},{description:{contains:b.search,mode:"insensitive"}}]),(b?.dueDateFrom||b?.dueDateTo)&&(c.dueDate={},b.dueDateFrom&&(c.dueDate.gte=b.dueDateFrom),b.dueDateTo&&(c.dueDate.lte=b.dueDateTo)),b?.assignedTo&&b.assignedTo.length>0&&(c.assignedTo={hasSome:b.assignedTo}),b?.tags&&b.tags.length>0&&(c.tags={hasSome:b.tags}),c},[a,b]),{data:f,loading:g,error:h,refetch:i}=(0,d.useFindMany)("task",{where:e,orderBy:{createdAt:"desc"},include:{user:{select:{id:!0,firstName:!0,lastName:!0,email:!0,avatar:!0}},_count:{select:{comments:!0,subtasks:!0}}}},{skip:!a,fetchPolicy:"cache-and-network"});return{data:{projectTasks:f||[]},loading:g,error:h,refetch:i}})(a,{search:f||void 0,status:j||void 0});if(!a)return(0,b.jsx)("div",{className:"h-full flex items-center justify-center bg-background",children:(0,b.jsxs)("div",{className:"text-center max-w-md px-4",children:[(0,b.jsx)("div",{className:"text-6xl mb-4",children:"üìã"}),(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Project Selected"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select a project from the sidebar to view and manage tasks"})]})});let u=r?.projectTasks||[];return(0,b.jsxs)("div",{className:"h-full flex flex-col bg-background",children:[(0,b.jsxs)("div",{className:"p-4 border-b space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Task Feed"}),(0,b.jsxs)(k.Button,{size:"sm",onClick:()=>i(!0),children:[(0,b.jsx)(e.Plus,{className:"h-4 w-4 mr-2"}),"New Task"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(y.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(q.Input,{placeholder:"Search tasks...",value:f,onChange:a=>g(a.target.value),className:"pl-9"})]}),(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(x.Filter,{className:"h-4 w-4 mr-2"}),"Filter"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,b.jsx)(n.Badge,{variant:j?"outline":"default",className:"cursor-pointer",onClick:()=>m(null),children:"All Tasks"}),(0,b.jsx)(n.Badge,{variant:"IN_PROGRESS"===j?"default":"outline",className:"cursor-pointer",onClick:()=>m("IN_PROGRESS"),children:"In Progress"}),(0,b.jsx)(n.Badge,{variant:"PENDING"===j?"default":"outline",className:"cursor-pointer",onClick:()=>m("PENDING"),children:"Pending"}),(0,b.jsx)(n.Badge,{variant:"COMPLETED"===j?"default":"outline",className:"cursor-pointer",onClick:()=>m("COMPLETED"),children:"Completed"})]})]}),(0,b.jsx)(l.ScrollArea,{className:"flex-1",children:(0,b.jsxs)("div",{className:"p-4 space-y-3",children:[s&&(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-3",children:"Loading tasks..."})]}),t&&(0,b.jsx)("div",{className:"text-center py-12",children:(0,b.jsx)("p",{className:"text-sm text-destructive",children:"Failed to load tasks"})}),!s&&!t&&0===u.length&&(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("div",{className:"text-5xl mb-4",children:"‚úÖ"}),(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Tasks Yet"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Create your first task to get started"}),(0,b.jsxs)(k.Button,{onClick:()=>i(!0),children:[(0,b.jsx)(e.Plus,{className:"h-4 w-4 mr-2"}),"Create Task"]})]}),!s&&!t&&u.length>0&&(0,b.jsx)(b.Fragment,{children:u.map(a=>(0,b.jsx)(G,{task:a,onClick:()=>p(a.id)},a.id))})]})}),(0,b.jsx)(Z,{open:h,onOpenChange:i,projectId:a}),(0,b.jsx)(ay,{taskId:o,projectId:a,open:!!o,onOpenChange:a=>!a&&p(null)})]})}a.s(["default",()=>az],291364);var aA=a.i(196467),aB=a.i(327438),aB=aB,aC=a.i(921599),aD=a.i(775833),aD=aD;function aE({projectId:a,userToken:d}){let[e,f]=(0,c.useState)(null),[g,i]=(0,c.useState)([]),[j,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(!1),[r,s]=(0,c.useState)([]),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)(!1),y=(0,c.useRef)(null),{toast:z}=(0,t.useToast)(),A=(0,c.useRef)(void 0);(0,c.useEffect)(()=>{let b=d||null;if(!a)return;if(!b)return void console.error("[ChatPanel] Missing authentication token");let c="https://v3api.tazagroup.vn";console.log("[ChatPanel] Connecting to:",`${c}/project-chat`);let e=(0,aA.io)(`${c}/project-chat`,{auth:{token:b.startsWith("Bearer ")?b:`Bearer ${b}`},reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,reconnectionAttempts:5});return e.on("connect",()=>{x(!0),console.log("‚úÖ Connected to chat"),e.emit("join_project",{projectId:a}),e.emit("load_messages",{projectId:a,take:50,skip:0})}),e.on("disconnect",()=>{x(!1),console.log("‚ùå Disconnected from chat")}),e.on("new_message",a=>{i(b=>[...b,{...a,createdAt:new Date(a.createdAt)}])}),e.on("messages_loaded",a=>{i(a.map(a=>({...a,createdAt:new Date(a.createdAt)})))}),e.on("message_edited",a=>{i(b=>b.map(b=>b.id===a.messageId?{...b,content:a.content,isEdited:!0}:b))}),e.on("message_deleted",a=>{i(b=>b.filter(b=>b.id!==a.messageId))}),e.on("reaction_added",a=>{i(b=>b.map(b=>{if(b.id===a.messageId){let c=b.reactions||{};return c[a.emoji]=c[a.emoji]||[],c[a.emoji].includes(a.userId)||c[a.emoji].push(a.userId),{...b,reactions:c}}return b}))}),e.on("user_typing",a=>{v(b=>b.find(b=>b.userId===a.userId)?b:[...b,a])}),e.on("user_stopped_typing",a=>{v(b=>b.filter(b=>b.userId!==a.userId))}),e.on("online_users",a=>{s(a)}),e.on("user_joined",a=>{z({title:"User Joined",description:`${a.userName} joined the chat`,type:"info"})}),e.on("user_left",a=>{z({title:"User Left",description:`${a.userName} left the chat`,type:"info"})}),e.on("error",a=>{z({title:"Error",description:`Chat error: ${a.message}`,type:"error"})}),f(e),()=>{e.emit("leave_project",{projectId:a}),e.close()}},[a,d,z]),(0,c.useEffect)(()=>{y.current&&(y.current.scrollTop=y.current.scrollHeight)},[g]);let B=()=>{j.trim()&&e&&w&&(e.emit("send_message",{projectId:a,content:j,attachments:[]}),n(""),e.emit("typing_stop",{projectId:a}))},C=(a,b)=>{e&&w&&e.emit("message_reaction",{messageId:a,emoji:b})};return a?(0,b.jsxs)("div",{className:"h-full flex flex-col bg-background",children:[(0,b.jsx)("div",{className:"p-4 border-b bg-white sticky top-0",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(h.MessageSquare,{className:"h-4 w-4"}),(0,b.jsx)("h3",{className:"font-semibold",children:"Project Chat"}),w?(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 text-xs text-green-600",children:[(0,b.jsx)("span",{className:"h-2 w-2 rounded-full bg-green-600"}),"Connected"]}):(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 text-xs text-gray-500",children:[(0,b.jsx)(aD.default,{className:"h-3 w-3 animate-spin"}),"Connecting..."]})]}),(0,b.jsxs)("div",{className:"text-xs text-gray-500",children:[r.length," online"]})]})}),(0,b.jsx)(l.ScrollArea,{className:"flex-1 p-4",ref:y,children:(0,b.jsxs)("div",{className:"space-y-4",children:[0===g.length?(0,b.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No messages yet. Start the conversation!"})}):g.map(a=>(0,b.jsxs)("div",{className:"flex gap-3 group",children:[(0,b.jsxs)(m.Avatar,{className:"h-8 w-8 flex-shrink-0",children:[(0,b.jsx)(m.AvatarImage,{src:a.userAvatar}),(0,b.jsx)(m.AvatarFallback,{children:a.userName.charAt(0)})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-sm font-semibold",children:a.userName}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:a.createdAt.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})}),a.isEdited&&(0,b.jsx)("span",{className:"text-xs text-gray-400",children:"(edited)"})]}),(0,b.jsx)("p",{className:"text-sm text-foreground break-words",children:a.content}),a.reactions&&Object.keys(a.reactions).length>0&&(0,b.jsx)("div",{className:"flex gap-1 mt-1 flex-wrap",children:Object.entries(a.reactions).map(([c,d])=>(0,b.jsxs)("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-gray-100 rounded-full text-xs cursor-pointer hover:bg-gray-200",onClick:()=>C(a.id,c),children:[(0,b.jsx)("span",{children:c}),(0,b.jsx)("span",{className:"text-gray-600",children:d.length})]},c))}),(0,b.jsxs)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity flex gap-1 mt-1",children:[(0,b.jsx)(k.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>C(a.id,"üëç"),children:"üëç"}),(0,b.jsx)(k.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",onClick:()=>C(a.id,"‚ù§Ô∏è"),children:"‚ù§Ô∏è"}),(0,b.jsxs)(ad.DropdownMenu,{children:[(0,b.jsx)(ad.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(k.Button,{size:"sm",variant:"ghost",className:"h-6 w-6 p-0",children:(0,b.jsx)(ac.MoreVertical,{className:"h-3 w-3"})})}),(0,b.jsx)(ad.DropdownMenuContent,{align:"end",children:(0,b.jsx)(ad.DropdownMenuItem,{onClick:()=>{var b;return b=a.id,void(e&&w&&e.emit("delete_message",{messageId:b}))},children:"Delete"})})]})]})]})]},a.id)),u.length>0&&(0,b.jsxs)("div",{className:"flex gap-2 text-xs text-gray-500",children:[(0,b.jsxs)("span",{children:[u.map(a=>a.userName).join(", ")," is typing..."]}),(0,b.jsx)("span",{className:"animate-pulse",children:"‚óè‚óè‚óè"})]})]})}),(0,b.jsx)("div",{className:"p-4 border-t bg-white",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(k.Button,{size:"sm",variant:"ghost",className:"h-10 w-10 p-0",children:(0,b.jsx)(aC.Paperclip,{className:"h-4 w-4"})}),(0,b.jsx)(q.Input,{placeholder:"Type a message...",value:j,onChange:b=>{n(b.target.value),e&&w&&(e.emit("typing_start",{projectId:a}),A.current&&clearTimeout(A.current),A.current=setTimeout(()=>{e.emit("typing_stop",{projectId:a})},3e3))},onKeyPress:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),B())},disabled:!w,className:"flex-1"}),(0,b.jsx)(k.Button,{size:"sm",variant:"ghost",className:"h-10 w-10 p-0",onClick:()=>C(g[g.length-1]?.id||"","üòä"),children:(0,b.jsx)(aB.default,{className:"h-4 w-4"})}),(0,b.jsx)(k.Button,{size:"sm",onClick:B,disabled:!w||o,className:"h-10 w-10 p-0",children:o?(0,b.jsx)(aD.default,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)($.Send,{className:"h-4 w-4"})})]})})]}):(0,b.jsx)("div",{className:"h-full flex items-center justify-center bg-muted/30",children:(0,b.jsxs)("div",{className:"text-center max-w-xs px-4",children:[(0,b.jsx)(h.MessageSquare,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select a project to view chat"})]})})}a.s(["default",()=>aE],136569)}];

//# sourceMappingURL=frontend_src_components_project-management_ProjectSidebar_tsx_3d386dc5._.js.map