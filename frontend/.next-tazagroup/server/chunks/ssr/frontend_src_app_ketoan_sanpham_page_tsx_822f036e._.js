module.exports=[677125,a=>{"use strict";var b=a.i(321248),c=a.i(651332),d=a.i(189101),e=a.i(624461),f=a.i(8912),g=a.i(772213);let h=g.gql`
  mutation UpdateProductsFromDetails($dryRun: Boolean!, $limit: Int) {
    updateProductsFromDetails(dryRun: $dryRun, limit: $limit) {
      success
      message
      stats {
        totalDetails
        processed
        created
        updated
        skipped
        errors
      }
      output
    }
  }
`;g.gql`
  mutation NormalizeProducts($productIds: [String!], $threshold: Float) {
    normalizeProducts(productIds: $productIds, threshold: $threshold) {
      updated
      skipped
      errors
    }
  }
`,g.gql`
  query FindSimilarProducts($searchText: String!, $threshold: Float) {
    findSimilarProducts(searchText: $searchText, threshold: $threshold) {
      id
      ten
      ten2
      ma
      similarityScore
    }
  }
`,g.gql`
  query GetProductGroups($minGroupSize: Float) {
    getProductGroups(minGroupSize: $minGroupSize) {
      ten2
      productCount
      products {
        id
        ten
        ma
        dvt
        dgia
      }
    }
  }
`;var i=a.i(348284),j=a.i(890082),k=a.i(390874);let l=({stats:a})=>(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Tổng sản phẩm"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.total})]}),(0,b.jsx)(i.Database,{className:"h-8 w-8 text-blue-500"})]})}),(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Đã chuẩn hóa"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-green-600",children:a.normalized})]}),(0,b.jsx)(j.CheckCircle2,{className:"h-8 w-8 text-green-500"})]})}),(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Chưa chuẩn hóa"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:a.pending})]}),(0,b.jsx)(k.XCircle,{className:"h-8 w-8 text-orange-500"})]})})]});var m=a.i(629432),n=a.i(519732),o=a.i(8650),o=o;let p=({searchTerm:a,onSearchChange:c,filterStatus:d,onFilterChange:e,uniqueFilter:f,onUniqueFilterChange:g,stats:h,filteredCount:j,loading:k,onRefresh:l,onNormalize:p,onUpdate:q})=>(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm p-4 mb-6",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[(0,b.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,b.jsx)(m.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Tìm kiếm theo tên, mã, DVT...",value:a,onChange:a=>c(a.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{onClick:l,disabled:k,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50",children:[(0,b.jsx)(n.RefreshCw,{className:`h-4 w-4 ${k?"animate-spin":""}`}),"Làm mới"]}),(0,b.jsxs)("button",{onClick:q,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[(0,b.jsx)(o.default,{className:"h-4 w-4"}),"Cập nhật SP"]}),(0,b.jsxs)("button",{onClick:p,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[(0,b.jsx)(i.Database,{className:"h-4 w-4"}),"Chuẩn hóa"]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Trạng thái:"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{onClick:()=>e("all"),className:`px-3 py-1 text-sm rounded-lg transition-colors ${"all"===d?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["Tất cả (",h.total,")"]}),(0,b.jsxs)("button",{onClick:()=>e("normalized"),className:`px-3 py-1 text-sm rounded-lg transition-colors ${"normalized"===d?"bg-green-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["Đã chuẩn hóa (",h.normalized,")"]}),(0,b.jsxs)("button",{onClick:()=>e("pending"),className:`px-3 py-1 text-sm rounded-lg transition-colors ${"pending"===d?"bg-orange-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["Chưa xử lý (",h.pending,")"]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Hiển thị unique:"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("button",{onClick:()=>g("none"),className:`px-3 py-1 text-sm rounded-lg transition-colors ${"none"===f?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["Tất cả ","none"===f&&`(${j})`]}),(0,b.jsxs)("button",{onClick:()=>g("ma"),className:`px-3 py-1 text-sm rounded-lg transition-colors ${"ma"===f?"bg-purple-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["Theo mã sản phẩm ","ma"===f&&`(${j})`]}),(0,b.jsxs)("button",{onClick:()=>g("ten2"),className:`px-3 py-1 text-sm rounded-lg transition-colors ${"ten2"===f?"bg-indigo-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["Theo tên chuẩn hóa ","ten2"===f&&`(${j})`]})]})]})]})});var q=a.i(733554),r=a.i(596739),s=a.i(703540),t=a.i(451825);let u=({products:a,loading:c,sortField:d,sortDirection:e,onSort:f,emptyMessage:g="Không có dữ liệu"})=>{let h=a=>d!==a?(0,b.jsx)(r.ArrowUpDown,{className:"h-4 w-4 text-gray-400"}):"asc"===e?(0,b.jsx)(s.ArrowUp,{className:"h-4 w-4 text-blue-500"}):(0,b.jsx)(t.ArrowDown,{className:"h-4 w-4 text-blue-500"});return(0,b.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full",children:[(0,b.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>f("ma"),children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:["Mã SP",h("ma")]})}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>f("ten"),children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:["Tên sản phẩm",h("ten")]})}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Tên chuẩn hóa"}),(0,b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"ĐVT"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-600",onClick:()=>f("dgia"),children:(0,b.jsxs)("div",{className:"flex items-center justify-end gap-2",children:["Đơn giá",h("dgia")]})}),(0,b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Trạng thái"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:c?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:6,className:"px-4 py-8 text-center",children:(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,b.jsx)(q.Loader2,{className:"h-5 w-5 animate-spin text-blue-500"}),(0,b.jsx)("span",{className:"text-gray-500",children:"Đang tải..."})]})})}):0===a.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-500",children:g})}):a.map(a=>{var c;return(0,b.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,b.jsx)("td",{className:"px-4 py-3 text-sm font-medium text-gray-900 dark:text-white",children:a.ma||"-"}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700 dark:text-gray-300",children:a.ten||"-"}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm",children:a.ten2?(0,b.jsx)("span",{className:"text-green-700 dark:text-green-400 font-medium",children:a.ten2}):(0,b.jsx)("span",{className:"text-gray-400 italic",children:"Chưa chuẩn hóa"})}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-gray-700 dark:text-gray-300",children:a.dvt||"-"}),(0,b.jsx)("td",{className:"px-4 py-3 text-sm text-right text-gray-900 dark:text-white font-medium",children:null===(c=a.dgia)?"-":new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(Number(c))}),(0,b.jsx)("td",{className:"px-4 py-3 text-center",children:a.ten2?(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs rounded-full",children:[(0,b.jsx)(j.CheckCircle2,{className:"h-3 w-3"}),"Đã chuẩn hóa"]}):(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 text-xs rounded-full",children:[(0,b.jsx)(k.XCircle,{className:"h-3 w-3"}),"Chưa xử lý"]})})]},a.id)})})]})})})},v=({currentPage:a,totalItems:c,itemsPerPage:d,onPageChange:e})=>{let f=Math.ceil(c/d),g=Math.min(a*d,c);return c<=d?null:(0,b.jsx)("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Hiển thị ",(a-1)*d+1," - ",g," trong tổng số ",c," sản phẩm"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{onClick:()=>e(Math.max(1,a-1)),disabled:1===a,className:"px-4 py-2 text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Trang trước"}),(0,b.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Trang ",a," / ",f]}),(0,b.jsx)("button",{onClick:()=>e(a+1),disabled:a>=f,className:"px-4 py-2 text-sm text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Trang sau"})]})]})})};var w=a.i(321279);let x=({isOpen:a,onClose:d,onNormalize:e,loading:f})=>{let[g,h]=(0,c.useState)("preview"),[i,j]=(0,c.useState)(10);if(!a)return null;let k=async()=>{await e("preview"===g,i)};return(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Chuẩn hóa tên sản phẩm"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Chế độ"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"radio",checked:"preview"===g,onChange:()=>h("preview"),className:"text-blue-600"}),(0,b.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Xem trước (Dry run)"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"radio",checked:"update"===g,onChange:()=>h("update"),className:"text-blue-600"}),(0,b.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Cập nhật thực tế"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Số lượng sản phẩm"}),(0,b.jsxs)("select",{value:i,onChange:a=>j(Number(a.target.value)),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white",children:[(0,b.jsx)("option",{value:10,children:"10 sản phẩm"}),(0,b.jsx)("option",{value:100,children:"100 sản phẩm"}),(0,b.jsx)("option",{value:1e3,children:"1000 sản phẩm"}),(0,b.jsx)("option",{value:0,children:"Tất cả"})]})]}),(0,b.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:(0,b.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:[(0,b.jsx)("strong",{children:"Fuzzy Matching với pg_trgm:"})," Hệ thống sẽ tự động nhóm các sản phẩm có tên tương tự nhau bằng thuật toán fuzzy matching."]})})]}),(0,b.jsxs)("div",{className:"flex gap-2 mt-6",children:[(0,b.jsx)("button",{onClick:d,disabled:f,className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700",children:"Hủy"}),(0,b.jsx)("button",{onClick:k,disabled:f,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center gap-2",children:f?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.Loader2,{className:"h-4 w-4 animate-spin"}),"Đang xử lý..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Play,{className:"h-4 w-4"}),"preview"===g?"Xem trước":"Chạy ngay"]})})]})]})})};var y=a.i(363615),o=o,z=a.i(897608);let A=({isOpen:a,onClose:d,onUpdate:e,loading:f})=>{let[g,h]=(0,c.useState)("preview"),[i,j]=(0,c.useState)(100),k=async()=>{await e("preview"===g,i)};return a?(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(o.default,{className:"h-6 w-6 text-green-600"}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Cập Nhật Sản Phẩm"})]}),(0,b.jsx)("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:(0,b.jsx)(y.X,{className:"h-6 w-6"})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[(0,b.jsx)("h3",{className:"font-medium text-blue-900 dark:text-blue-200 mb-2",children:"Chức năng"}),(0,b.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-300",children:["Tự động đồng bộ sản phẩm từ ",(0,b.jsx)("strong",{children:"ext_detailhoadon"})," sang"," ",(0,b.jsx)("strong",{children:"ext_sanphamhoadon"}),"."]}),(0,b.jsxs)("ul",{className:"mt-2 text-sm text-blue-800 dark:text-blue-300 list-disc list-inside space-y-1",children:[(0,b.jsx)("li",{children:"Tạo sản phẩm mới nếu chưa tồn tại"}),(0,b.jsx)("li",{children:"Cập nhật thông tin nếu đã có"}),(0,b.jsx)("li",{children:"Tự động sinh mã sản phẩm từ tên"}),(0,b.jsx)("li",{children:"Tự động chuẩn hóa tên sản phẩm (ten2) bằng fuzzy matching"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Chế độ thực thi"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)("button",{onClick:()=>h("preview"),className:`p-4 border-2 rounded-lg transition-all ${"preview"===g?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-blue-300"}`,children:(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:"Xem trước"}),(0,b.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Chỉ hiển thị thay đổi, không lưu vào database"})]})}),(0,b.jsx)("button",{onClick:()=>h("update"),className:`p-4 border-2 rounded-lg transition-all ${"update"===g?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-green-300"}`,children:(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:"Cập nhật"}),(0,b.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Thực hiện và lưu thay đổi vào database"})]})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Giới hạn số lượng (để test)"}),(0,b.jsx)("input",{type:"number",value:i,onChange:a=>j(Math.max(1,parseInt(a.target.value)||1)),min:"1",max:"10000",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Bỏ trống hoặc nhập số lớn để xử lý tất cả"})]}),"update"===g&&(0,b.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(z.AlertTriangle,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium text-yellow-900 dark:text-yellow-200",children:"Cảnh báo"}),(0,b.jsx)("p",{className:"text-sm text-yellow-800 dark:text-yellow-300 mt-1",children:"Chế độ cập nhật sẽ thay đổi dữ liệu trong database. Hãy đảm bảo bạn đã kiểm tra ở chế độ xem trước trước khi thực hiện."})]})]})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-3 p-6 border-t border-gray-200 dark:border-gray-700",children:[(0,b.jsx)("button",{onClick:d,disabled:f,className:"px-4 py-2 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50",children:"Hủy"}),(0,b.jsx)("button",{onClick:k,disabled:f,className:`px-6 py-2 rounded-lg text-white disabled:opacity-50 flex items-center gap-2 ${"preview"===g?"bg-blue-600 hover:bg-blue-700":"bg-green-600 hover:bg-green-700"}`,children:f?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"Đang xử lý..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(o.default,{className:"h-4 w-4"}),"preview"===g?"Xem trước":"Cập nhật ngay"]})})]})]})}):null};function B(){let[a,g]=(0,c.useState)(""),[i,j]=(0,c.useState)(1),[k]=(0,c.useState)(50),[m,n]=(0,c.useState)("createdAt"),[o,q]=(0,c.useState)("desc"),[r,s]=(0,c.useState)("all"),[t,w]=(0,c.useState)("none"),[y,z]=(0,c.useState)(!1),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(!1),{data:H,loading:I,refetch:J}=(0,e.useDynamicQuery)("GET_ALL","ext_sanphamhoadon",{fetchPolicy:"network-only"}),[K]=(0,f.useMutation)(h),{filteredProducts:L,stats:M}=(({products:a,searchTerm:b,filterStatus:d,uniqueFilter:e,sortField:f,sortDirection:g})=>(0,c.useMemo)(()=>{if(!Array.isArray(a))return console.warn("Products data is not an array:",a),{filteredProducts:[],stats:{total:0,normalized:0,pending:0}};let c=[...a];if(b){let a=b.toLowerCase().trim();c=c.filter(b=>b.ten?.toLowerCase().includes(a)||b.ten2?.toLowerCase().includes(a)||b.ma?.toLowerCase().includes(a)||b.dvt?.toLowerCase().includes(a))}if("normalized"===d?c=c.filter(a=>a.ten2):"pending"===d&&(c=c.filter(a=>!a.ten2)),"ma"===e){let a=new Set;c=c.filter(b=>!b.ma||!a.has(b.ma)&&(a.add(b.ma),!0))}else if("ten2"===e){let a=new Set;c=c.filter(b=>!b.ten2||!a.has(b.ten2)&&(a.add(b.ten2),!0))}return c.sort((a,b)=>{let c=a[f],d=b[f];if(null===c)return 1;if(null===d)return -1;"dgia"===f?(c=Number(c)||0,d=Number(d)||0):"createdAt"===f?(c=new Date(c).getTime(),d=new Date(d).getTime()):(c=String(c).toLowerCase(),d=String(d).toLowerCase());let e=c<d?-1:+(c>d);return"asc"===g?e:-e}),{filteredProducts:c,stats:{total:a.length,normalized:a.filter(a=>a.ten2).length,pending:a.filter(a=>!a.ten2).length}}},[a,b,d,e,f,g]))({products:H?.getext_sanphamhoadons||[],searchTerm:a,filterStatus:r,uniqueFilter:t,sortField:m,sortDirection:o}),{paginatedProducts:N}=(({products:a,page:b,limit:d,setPage:e,dependencies:f=[]})=>((0,c.useEffect)(()=>{e(1)},f),{paginatedProducts:(0,c.useMemo)(()=>{let c=(b-1)*d;return a.slice(c,c+d)},[a,b,d]),totalPages:Math.ceil(a.length/d)}))({products:L,page:i,limit:k,setPage:j,dependencies:[a,r,t,m,o]}),O=async()=>{try{await J(),d.toast.success("Đã tải lại dữ liệu")}catch(a){console.error("Error loading products:",a),d.toast.error("Lỗi khi tải dữ liệu")}},P=async(a,b)=>{z(!0);try{let c=await fetch("/api/ketoan/normalize-products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dryRun:a,limit:b})}),e=await c.json();e.success?(d.toast.success(e.message),a||await O(),C(!1)):d.toast.error(e.message||"Lỗi khi chuẩn hóa dữ liệu")}catch(a){console.error("Normalization error:",a),d.toast.error("Không thể kết nối với server")}finally{z(!1)}},Q=async(a,b)=>{E(!0);try{let{data:c}=await K({variables:{dryRun:a,limit:b}}),e=c?.updateProductsFromDetails;if(e?.success){if(d.toast.success(e.message),e.stats){let{created:a,updated:b,skipped:c,errors:d}=e.stats;console.log("Update stats:",{created:a,updated:b,skipped:c,errors:d})}a||await O(),G(!1)}else d.toast.error(e?.message||"Lỗi khi cập nhật sản phẩm")}catch(a){console.error("Update error:",a),d.toast.error(a.message||"Không thể kết nối với server")}finally{E(!1)}};return(0,b.jsxs)("div",{className:"container mx-auto p-6",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Quản Lý Sản Phẩm"}),(0,b.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Danh sách sản phẩm từ hóa đơn với tính năng chuẩn hóa tên sản phẩm"})]}),(0,b.jsx)(p,{searchTerm:a,onSearchChange:g,filterStatus:r,onFilterChange:s,uniqueFilter:t,onUniqueFilterChange:w,stats:M,filteredCount:L.length,loading:I,onRefresh:O,onNormalize:()=>C(!0),onUpdate:()=>G(!0)}),(0,b.jsx)(l,{stats:M}),(0,b.jsx)(u,{products:N,loading:I,sortField:m,sortDirection:o,onSort:a=>{m===a?q("asc"===o?"desc":"asc"):(n(a),q("asc"))},emptyMessage:a||"all"!==r?"Không tìm thấy sản phẩm phù hợp":"Không có dữ liệu"}),(0,b.jsx)(v,{currentPage:i,totalItems:L.length,itemsPerPage:k,onPageChange:j}),(0,b.jsx)(x,{isOpen:B,onClose:()=>C(!1),onNormalize:P,loading:y}),(0,b.jsx)(A,{isOpen:F,onClose:()=>G(!1),onUpdate:Q,loading:D})]})}a.s(["default",()=>B],677125)}];

//# sourceMappingURL=frontend_src_app_ketoan_sanpham_page_tsx_822f036e._.js.map