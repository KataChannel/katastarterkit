// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRoleType {
  ADMIN
  USER
  GUEST
}

enum AuthProvider {
  LOCAL
  GOOGLE
  FACEBOOK
  PHONE
}

enum TokenType {
  EMAIL_VERIFICATION
  PASSWORD_RESET
  PHONE_VERIFICATION
  TWO_FACTOR
}

enum PostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum TaskCategory {
  PERSONAL
  WORK
  SHOPPING
  HEALTH
  OTHER
}

enum TaskPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum MediaType {
  IMAGE
  VIDEO
  DOCUMENT
}

enum SharePermission {
  VIEW
  EDIT
  ADMIN
}

model User {
  id         String       @id @default(uuid())
  email      String?      @unique
  username   String       @unique
  password   String?
  phone      String?      @unique
  firstName  String?
  lastName   String?
  avatar     String?
  roleType   UserRoleType @default(USER)
  isActive   Boolean      @default(true)
  isVerified Boolean      @default(false)

  // Security settings
  isTwoFactorEnabled  Boolean   @default(false)
  failedLoginAttempts Int       @default(0)
  lockedUntil         DateTime?
  lastLoginAt         DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  authMethods        AuthMethod[]
  verificationTokens VerificationToken[]
  sessions           UserSession[]
  auditLogs          AuditLog[]

  // RBAC Relations
  userRoles        UserRoleAssignment[]
  userPermissions  UserPermission[]
  resourceAccesses ResourceAccess[]

  // RBAC Creation relations
  rolesCreated       Role[]       @relation("RoleCreator")
  permissionsCreated Permission[] @relation("PermissionCreator")

  // Content relations
  posts         Post[]         @relation("PostAuthor")
  comments      Comment[]      @relation("CommentAuthor")
  likes         Like[]         @relation("UserLikes")
  notifications Notification[] @relation("UserNotifications")
  tasks         Task[]         @relation("UserTasks")
  taskComments  TaskComment[]  @relation("TaskCommentAuthor")
  taskMedia     TaskMedia[]    @relation("TaskMediaUploader")

  // Tag relations
  tagsCreated Tag[] @relation("TagCreator")

  // Task sharing relations
  tasksSharedBy   TaskShare[] @relation("TaskSharedBy")
  tasksSharedWith TaskShare[] @relation("TaskSharedWith")

  // AI Training relations
  chatbotModels     ChatbotModel[]
  trainingData      TrainingData[]
  chatConversations ChatConversation[]
  chatMessages      ChatMessage[]      @relation("ChatMessageSender")

  // Security relations
  mfaSettings    UserMfaSettings?
  devices        UserDevice[]
  securityEvents SecurityEvent[]

  // Menu relations
  menusCreated Menu[] @relation("MenuCreator")
  menusUpdated Menu[] @relation("MenuUpdater")

  // File management relations
  files   File[]       @relation("UserFiles")
  folders FileFolder[] @relation("UserFolders")

  // Affiliate relations
  affiliateProfile AffUser?

  // HR Relations
  employeeProfile      EmployeeProfile?
  employmentHistory    EmploymentHistory[]
  documents            EmployeeDocument[]
  onboardingChecklist  OnboardingChecklist?
  offboardingProcesses OffboardingProcess[]

  // Performance indexes for GIAI ĐOẠN 1 optimization
  @@index([isActive])
  @@index([roleType])
  @@index([createdAt])
  @@index([lastLoginAt])
  @@map("users")
}

model AuthMethod {
  id         String       @id @default(uuid())
  userId     String
  provider   AuthProvider
  providerId String? // External provider ID (Google ID, Facebook ID, etc.)
  isVerified Boolean      @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, provider])
  @@map("auth_methods")
}

model VerificationToken {
  id        String    @id @default(uuid())
  userId    String
  token     String    @unique
  type      TokenType
  expiresAt DateTime
  isUsed    Boolean   @default(false)

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("verification_tokens")
}

model UserSession {
  id           String   @id @default(uuid())
  userId       String
  sessionId    String   @unique
  refreshToken String?  @unique
  deviceId     String? // Link to user device
  ipAddress    String?
  userAgent    String?
  location     String? // Geographic location
  isActive     Boolean  @default(true)
  expiresAt    DateTime
  lastActivity DateTime @default(now())

  // MFA
  mfaVerified Boolean @default(false)
  mfaMethod   String? // Method used for MFA verification

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  device UserDevice? @relation(fields: [deviceId], references: [deviceId], onDelete: SetNull)

  @@index([deviceId])
  @@index([lastActivity])
  @@map("user_sessions")
}

model AuditLog {
  id        String  @id @default(uuid())
  userId    String?
  sessionId String?

  // Event Details
  action       String // Action performed (login, logout, create, update, delete, etc.)
  resourceType String // Type of resource affected (user, task, project, etc.)
  resourceId   String? // ID of the affected resource

  // Request Details
  ipAddress String?
  userAgent String?
  method    String? // HTTP method
  endpoint  String? // API endpoint

  // Event Data
  oldValues Json? // Previous values (for updates)
  newValues Json? // New values (for creates/updates)
  details   Json? // Additional event details

  // Enhanced Tracking
  entityName         String? // Name/title of the affected entity
  parentResourceType String? // Parent resource type for nested resources
  parentResourceId   String? // Parent resource ID

  // Operation Context
  operationType String? // CRUD, AUTH, PERMISSION, etc.
  severity      String   @default("info") // debug, info, warn, error, critical
  tags          String[] // Searchable tags for categorization

  // Batch Operation Support
  batchId    String? // For grouping related operations
  batchSize  Int? // Number of items in batch
  batchIndex Int? // Position in batch

  // Outcome
  success      Boolean @default(true)
  errorMessage String? // Error message if action failed
  errorCode    String? // Error code for categorization

  // Performance Metrics
  responseTime Int? // Response time in milliseconds
  requestSize  Int? // Request payload size in bytes
  responseSize Int? // Response payload size in bytes
  dbQueryTime  Int? // Database query time in milliseconds
  dbQueryCount Int? // Number of database queries executed
  memoryUsage  Float? // Memory usage in MB
  cpuUsage     Float? // CPU usage percentage
  statusCode   Int? // HTTP status code

  // Performance Context
  performanceData Json? // Additional performance metrics and traces

  // Compliance & Security
  requiresReview  Boolean @default(false) // Flag for manual review
  sensitiveData   Boolean @default(false) // Contains sensitive information
  retentionPeriod Int? // Days to retain this log entry

  // Metadata
  correlationId String? // For tracking related events
  sessionInfo   Json? // Session information at time of event
  clientInfo    Json? // Client application information

  // Timestamps
  timestamp DateTime @default(now())
  createdAt DateTime @default(now())

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([action])
  @@index([resourceType])
  @@index([timestamp])
  @@index([correlationId])
  @@index([endpoint])
  @@index([responseTime])
  @@index([statusCode])
  @@index([userId, timestamp])
  @@index([operationType])
  @@index([severity])
  @@index([batchId])
  @@index([parentResourceType, parentResourceId])
  @@index([requiresReview])
  @@index([sensitiveData])
  @@map("audit_logs")
}

model Post {
  id            String     @id @default(uuid())
  title         String
  content       String
  excerpt       String?
  slug          String     @unique
  featuredImage String?
  status        PostStatus @default(DRAFT)
  publishedAt   DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  authorId String
  author   User   @relation("PostAuthor", fields: [authorId], references: [id], onDelete: Cascade)

  // Relations
  comments Comment[]
  likes    Like[]
  tags     PostTag[] @relation("PostTags")

  @@map("posts")
}

model Comment {
  id      String @id @default(uuid())
  content String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  postId String
  post   Post   @relation(fields: [postId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation("CommentAuthor", fields: [userId], references: [id], onDelete: Cascade)

  parentId String?
  parent   Comment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies  Comment[] @relation("CommentReplies")

  @@map("comments")
}

model Tag {
  id    String  @id @default(uuid())
  name  String  @unique
  slug  String  @unique
  color String?

  createdAt DateTime @default(now())

  // Relations
  posts PostTag[] @relation("TagPosts")

  // User who created this tag
  createdBy String
  creator   User   @relation("TagCreator", fields: [createdBy], references: [id], onDelete: Cascade)

  @@index([createdBy])
  @@map("tags")
}

model Like {
  id     String @id @default(uuid())
  postId String
  userId String

  createdAt DateTime @default(now())

  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User @relation("UserLikes", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@map("likes")
}

model PostTag {
  postId String
  tagId  String

  post Post @relation("PostTags", fields: [postId], references: [id], onDelete: Cascade)
  tag  Tag  @relation("TagPosts", fields: [tagId], references: [id], onDelete: Cascade)

  @@id([postId, tagId])
  @@map("post_tags")
}

model Notification {
  id      String  @id @default(uuid())
  userId  String
  title   String
  message String
  type    String
  isRead  Boolean @default(false)
  data    Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model Task {
  id          String       @id @default(uuid())
  title       String
  description String?
  category    TaskCategory @default(OTHER)
  priority    TaskPriority @default(MEDIUM)
  status      TaskStatus   @default(PENDING)
  dueDate     DateTime?
  completedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId String
  user   User   @relation("UserTasks", fields: [userId], references: [id], onDelete: Cascade)

  // Hierarchical relations
  parentId String?
  parent   Task?   @relation("TaskSubtasks", fields: [parentId], references: [id])
  subtasks Task[]  @relation("TaskSubtasks")

  // Relations
  comments TaskComment[]
  media    TaskMedia[]
  shares   TaskShare[]

  // Performance indexes for GIAI ĐOẠN 1 optimization
  @@index([userId])
  @@index([parentId])
  @@index([status])
  @@index([priority])
  @@index([dueDate])
  @@index([createdAt])
  @@index([userId, status])
  @@index([userId, createdAt])
  @@index([userId, dueDate])
  @@map("tasks")
}

model TaskComment {
  id      String @id @default(uuid())
  content String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  taskId String
  task   Task   @relation(fields: [taskId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation("TaskCommentAuthor", fields: [userId], references: [id], onDelete: Cascade)

  parentId String?
  parent   TaskComment?  @relation("TaskCommentReplies", fields: [parentId], references: [id])
  replies  TaskComment[] @relation("TaskCommentReplies")

  // Performance indexes for GIAI ĐOẠN 1 optimization
  @@index([taskId])
  @@index([userId])
  @@index([parentId])
  @@index([createdAt])
  @@index([taskId, createdAt])
  @@map("task_comments")
}

model TaskMedia {
  id       String    @id @default(uuid())
  type     MediaType
  url      String
  filename String
  size     Int
  mimeType String
  caption  String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  taskId String
  task   Task   @relation(fields: [taskId], references: [id], onDelete: Cascade)

  uploadedBy String
  uploader   User   @relation("TaskMediaUploader", fields: [uploadedBy], references: [id])

  // Performance indexes for GIAI ĐOẠN 1 optimization
  @@index([taskId])
  @@index([uploadedBy])
  @@index([createdAt])
  @@index([type])
  @@map("task_media")
}

model TaskShare {
  id         String          @id @default(uuid())
  permission SharePermission @default(VIEW)
  shareToken String          @unique
  expiresAt  DateTime?
  isActive   Boolean         @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  taskId String
  task   Task   @relation(fields: [taskId], references: [id], onDelete: Cascade)

  sharedBy     String
  sharedByUser User   @relation("TaskSharedBy", fields: [sharedBy], references: [id])

  sharedWith     String?
  sharedWithUser User?   @relation("TaskSharedWith", fields: [sharedWith], references: [id])

  @@index([shareToken])
  @@map("task_shares")
}

// AI Training and Chatbot Models
enum TrainingDataType {
  DOCUMENT
  TEXT
  FAQ
  CONVERSATION
  KNOWLEDGE_BASE
}

enum TrainingStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
}

enum ChatbotStatus {
  ACTIVE
  INACTIVE
  TRAINING
}

model ChatbotModel {
  id           String        @id @default(uuid())
  name         String
  description  String?
  systemPrompt String        @default("You are a helpful AI assistant.")
  status       ChatbotStatus @default(INACTIVE)

  // Model configuration
  temperature      Float @default(0.7)
  maxTokens        Int   @default(1000)
  topP             Float @default(1.0)
  frequencyPenalty Float @default(0.0)
  presencePenalty  Float @default(0.0)

  // Training metrics
  totalTrainingTokens Int       @default(0)
  lastTrainedAt       DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  trainingData  TrainingData[]
  conversations ChatConversation[]

  @@map("chatbot_models")
}

model TrainingData {
  id      String           @id @default(uuid())
  title   String
  content String           @db.Text
  type    TrainingDataType
  status  TrainingStatus   @default(PENDING)

  // File information if uploaded
  fileName String?
  fileSize Int?
  filePath String?

  // Processing information
  processedAt  DateTime?
  errorMessage String?
  tokenCount   Int?

  // Embeddings for vector search
  embeddings Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  chatbotId String
  chatbot   ChatbotModel @relation(fields: [chatbotId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([chatbotId, status])
  @@map("training_data")
}

model ChatConversation {
  id       String  @id @default(uuid())
  title    String?
  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  chatbotId String
  chatbot   ChatbotModel @relation(fields: [chatbotId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  messages ChatMessage[]

  @@index([userId, chatbotId])
  @@map("chat_conversations")
}

model ChatMessage {
  id      String @id @default(uuid())
  content String @db.Text
  role    String // 'user' or 'assistant'

  // Response metadata
  tokenCount   Int?
  responseTime Int? // milliseconds
  relevantData Json? // references to training data used

  createdAt DateTime @default(now())

  // Relations
  conversationId String
  conversation   ChatConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  // User who sent this message (for user messages)
  userId String?
  user   User?   @relation("ChatMessageSender", fields: [userId], references: [id], onDelete: SetNull)

  @@index([conversationId, createdAt])
  @@index([userId])
  @@map("chat_messages")
}

model Hoadon {
  id            String          @id @default(uuid())
  nbmst         String
  khmshdon      Int?
  khhdon        String?
  shdon         Int?
  cqt           String?
  cttkhac       Json?
  dvtte         String?
  hdon          String?
  hsgcma        String?
  hsgoc         String?
  hthdon        Int?
  htttoan       Int?
  idtbao        String?
  khdon         String?
  khhdgoc       String?
  khmshdgoc     String?
  lhdgoc        Int?
  mhdon         String?
  mtdiep        String?
  mtdtchieu     String?
  nbdchi        String?
  nbhdktngay    DateTime?
  nbhdktso      String?
  nbhdso        String?
  nblddnbo      String?
  nbptvchuyen   String?
  nbstkhoan     String?
  nbten         String?
  nbtnhang      String?
  nbtnvchuyen   String?
  ncma          DateTime?
  ncnhat        DateTime?
  ngcnhat       String?
  nky           DateTime?
  nmdchi        String?
  nmmst         String?
  nmstkhoan     String?
  nmten         String?
  nmtnhang      String?
  nmtnmua       String?
  ntao          DateTime?
  ntnhan        DateTime?
  pban          String?
  ptgui         Int?
  shdgoc        Int?
  tchat         Int?
  tdlap         DateTime?
  tgia          Int?
  tgtcthue      Int?
  tgtthue       Int?
  tgtttbchu     String?
  tgtttbso      Int?
  thdon         String?
  thlap         Int?
  thttlphi      Json?
  tlhdon        String?
  ttcktmai      Int?
  tthai         Int?
  tttbao        Int?
  ttxly         Int?
  tvandnkntt    String?
  mhso          String?
  ladhddt       Int?
  mkhang        String?
  nbsdthoai     String?
  nbdctdtu      String?
  nbfax         String?
  nbwebsite     String?
  nbcks         String?
  nmsdthoai     String?
  nmdctdtu      String?
  nmcmnd        String?
  nmcks         String?
  bhphap        Int?
  hddunlap      String?
  gchdgoc       String?
  tbhgtngay     DateTime?
  bhpldo        String?
  bhpcbo        String?
  bhpngay       DateTime?
  tdlhdgoc      String?
  tgtphi        Int?
  unhiem        String?
  mstdvnunlhdon String?
  tdvnunlhdon   String?
  nbmdvqhnsach  String?
  nbsqdinh      String?
  nbncqdinh     String?
  nbcqcqdinh    String?
  nbhtban       String?
  nmmdvqhnsach  String?
  nmddvchden    String?
  nmtgvchdtu    String?
  nmtgvchdden   String?
  nbtnban       String?
  dcdvnunlhdon  String?
  dksbke        String?
  dknlbke       String?
  thtttoan      String?
  msttcgp       String?
  gchu          String?
  kqcht         String?
  hdntgia       String?
  tgtkcthue     String?
  tgtkhac       Int?
  nmshchieu     String?
  nmnchchieu    String?
  nmnhhhchieu   String?
  nmqtich       String?
  ktkhthue      String?
  hdhhdvu       String?
  qrcode        String?
  ttmstten      String?
  ladhddtten    String?
  hdxkhau       String?
  hdxkptquan    String?
  hdgktkhthue   String?
  hdonLquans    Json?
  tthdclquan    Boolean?
  pdndungs      Json?
  hdtbssrses    Json?
  hdTrung       String?
  isHDTrung     Boolean?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  HoadonChitiet HoadonChitiet[]
}

model HoadonChitiet {
  id        String   @id @default(uuid())
  codeId    String?
  title     String?
  title2    String?
  idhdon    String
  idhoadon  String
  hoadon    Hoadon   @relation(fields: [idhoadon], references: [id], onDelete: Cascade)
  dgia      Int?
  dvtinh    String?
  ltsuat    String?
  sluong    Int?
  stbchu    String?
  stckhau   Int?
  stt       Int?
  tchat     Int?
  ten       String?
  thtcthue  Int?
  thtien    Int?
  tlckhau   Int?
  tsuat     Float?
  tthue     Int?
  sxep      Int?
  dvtte     String?
  tgia      Int?
  order     Int?     @default(1)
  isproduct Boolean? @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())

  @@index([idhdon])
}

// Page Builder Models
enum PageStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum BlockType {
  // Content Blocks
  TEXT
  IMAGE
  HERO
  GALLERY
  VIDEO
  BUTTON
  DIVIDER
  SPACER
  COLUMN
  ROW
  CARD
  CAROUSEL
  TESTIMONIAL
  FAQ
  CONTACT_FORM
  TEAM
  STATS
  CONTACT_INFO
  
  // Container/Layout Blocks (for nested children)
  CONTAINER
  SECTION
  GRID
  FLEX_ROW
  FLEX_COLUMN
  
  // Dynamic Blocks
  DYNAMIC
  
  // E-commerce Blocks (Data-driven)
  PRODUCT_LIST
  PRODUCT_DETAIL
}

model Page {
  id             String     @id @default(uuid())
  title          String
  slug           String     @unique
  description    String?
  content        Json? // Stored as JSON for flexibility
  status         PageStatus @default(DRAFT)
  seoTitle       String?
  seoDescription String?
  seoKeywords    Json? // Stored as JSON array of keywords
  ogImage        String?
  layoutSettings Json? // Layout configuration: hasHeader, hasFooter, headerMenuId, footerMenuId, headerStyle, footerStyle

  // Relationships
  blocks PageBlock[]

  // Timestamps and user tracking
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  publishedAt DateTime?
  createdBy   String
  updatedBy   String?

  // Indexing
  @@index([slug])
  @@index([status])
  @@index([createdAt])
}

model PageBlock {
  id        String    @id @default(uuid())
  type      BlockType
  content   Json // Block-specific content and configuration
  style     Json? // CSS styles and layout properties
  order     Int       @default(0)
  isVisible Boolean   @default(true)

  // Page relationship
  pageId String
  page   Page   @relation(fields: [pageId], references: [id], onDelete: Cascade)

  // Nested blocks support (self-relation)
  parentId String?
  parent   PageBlock?  @relation("BlockChildren", fields: [parentId], references: [id], onDelete: Cascade)
  children PageBlock[] @relation("BlockChildren")
  
  // Nesting depth (0 = top level, 1 = first level child, etc.)
  depth    Int         @default(0)
  
  // Dynamic configuration
  config   Json? // Dynamic block configuration (templates, data sources, etc.)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Indexing for performance
  @@index([pageId, order])
  @@index([type])
  @@index([parentId])
}

// File Management Models
enum FileType {
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  ARCHIVE
  OTHER
}

enum FileVisibility {
  PUBLIC
  PRIVATE
  SHARED
}

model FileFolder {
  id          String       @id @default(uuid())
  name        String
  description String?
  parentId    String?
  parent      FileFolder?  @relation("FolderHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children    FileFolder[] @relation("FolderHierarchy")
  path        String // Full path for quick access (e.g., "/root/subfolder1/subfolder2")

  // Ownership
  userId String
  user   User   @relation("UserFolders", fields: [userId], references: [id], onDelete: Cascade)

  // Files in this folder
  files File[]

  // Metadata
  color    String? // Hex color for UI
  icon     String? // Icon name/emoji
  isSystem Boolean @default(false) // System folders can't be deleted

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([parentId])
  @@index([path])
}

model File {
  id String @id @default(uuid())

  // File information
  filename     String // Generated unique filename
  originalName String // Original uploaded filename
  mimeType     String
  size         Int // Size in bytes
  fileType     FileType

  // Storage information
  url    String // Public URL to access file
  bucket String // MinIO bucket name
  path   String // Full path in MinIO (e.g., "images/2024/01/file.jpg")
  etag   String? // MinIO ETag for integrity

  // Organization
  folderId String?
  folder   FileFolder? @relation(fields: [folderId], references: [id], onDelete: SetNull)

  // Ownership and permissions
  userId     String
  user       User           @relation("UserFiles", fields: [userId], references: [id], onDelete: Cascade)
  visibility FileVisibility @default(PRIVATE)

  // Metadata
  title       String?
  description String?
  alt         String? // Alt text for images
  tags        String[] // Array of tags for searching
  metadata    Json? // Additional metadata (dimensions, duration, etc.)

  // Image-specific
  width        Int?
  height       Int?
  thumbnailUrl String? // URL to thumbnail version

  // Usage tracking
  downloadCount Int @default(0)
  viewCount     Int @default(0)

  // Sharing
  shares FileShare[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([folderId])
  @@index([fileType])
  @@index([mimeType])
  @@index([createdAt])
  @@index([path])
}

model FileShare {
  id String @id @default(uuid())

  fileId String
  file   File   @relation(fields: [fileId], references: [id], onDelete: Cascade)

  sharedBy   String
  sharedWith String? // Null means public link

  token     String    @unique // Unique token for share link
  expiresAt DateTime?
  password  String? // Optional password protection

  // Permissions
  canDownload Boolean @default(true)
  canView     Boolean @default(true)

  // Analytics
  accessCount Int       @default(0)
  lastAccess  DateTime?

  createdAt DateTime @default(now())

  @@index([fileId])
  @@index([token])
  @@index([sharedBy])
}

// MFA and Security Models
model UserMfaSettings {
  id     String @id @default(uuid())
  userId String @unique

  // TOTP Settings
  totpEnabled Boolean @default(false)
  totpSecret  String? // Encrypted TOTP secret

  // SMS Settings
  smsEnabled     Boolean @default(false)
  smsPhoneNumber String? // Encrypted phone number

  // Email Settings
  emailEnabled Boolean @default(false)

  // Hardware Token Settings
  hardwareTokenEnabled Boolean @default(false)

  // Backup Codes
  backupCodes          String? // Encrypted backup codes JSON
  backupCodesGenerated Boolean @default(false)
  backupCodesUsed      Int     @default(0)

  // Emergency Settings
  emergencyContactEnabled Boolean @default(false)
  emergencyContact        String? // Encrypted emergency contact

  // Preferences
  preferredMethod String @default("totp") // totp, sms, email, hardware

  // Timestamps
  enabledAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model UserDevice {
  id         String  @id @default(uuid())
  userId     String
  deviceId   String  @unique // Generated device identifier
  deviceName String // User-friendly device name
  deviceType String // mobile, desktop, tablet, unknown
  browser    String? // Browser information
  os         String? // Operating system
  ipAddress  String // Last known IP address
  location   String? // Geographic location (city, country)
  isTrusted  Boolean @default(false)

  // Security
  isActive Boolean  @default(true)
  lastUsed DateTime @default(now())

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user     User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  sessions UserSession[]

  @@index([userId])
  @@index([deviceId])
  @@index([lastUsed])
}

model SecurityEvent {
  id        String  @id @default(uuid())
  userId    String?
  sessionId String?

  // Event Classification
  eventType String // login_attempt, mfa_failure, suspicious_activity, etc.
  severity  String // low, medium, high, critical
  category  String // authentication, authorization, data_access, etc.

  // Event Details
  description String
  details     Json? // Detailed event information

  // Source Information
  ipAddress String
  userAgent String?
  location  String? // Geographic location

  // Risk Assessment
  riskScore      Float? // Calculated risk score (0-1)
  isBlocked      Boolean @default(false)
  requiresAction Boolean @default(false)

  // Resolution
  isResolved Boolean   @default(false)
  resolvedBy String? // User ID who resolved the event
  resolvedAt DateTime?
  resolution String? // Resolution details

  // Metadata
  correlationId String? // For tracking related events
  parentEventId String? // For linked events

  // Timestamps
  detectedAt DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relationships
  user        User?           @relation(fields: [userId], references: [id], onDelete: SetNull)
  parentEvent SecurityEvent?  @relation("SecurityEventHierarchy", fields: [parentEventId], references: [id], onDelete: SetNull)
  childEvents SecurityEvent[] @relation("SecurityEventHierarchy")

  @@index([userId])
  @@index([eventType])
  @@index([severity])
  @@index([detectedAt])
  @@index([isResolved])
  @@index([correlationId])
  @@index([parentEventId])
}

// RBAC (Role-Based Access Control) Models
model Role {
  id          String  @id @default(uuid())
  name        String  @unique
  displayName String // User-friendly role name
  description String?

  // Hierarchy
  parentId String?
  parent   Role?   @relation("RoleHierarchy", fields: [parentId], references: [id], onDelete: SetNull)
  children Role[]  @relation("RoleHierarchy")

  // Role Properties
  isSystemRole Boolean @default(false) // System roles cannot be deleted
  isActive     Boolean @default(true)
  priority     Int     @default(0) // Higher priority roles override lower ones

  // Metadata
  metadata Json? // Additional role configuration

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // User who created this role
  createdBy String?
  creator   User?   @relation("RoleCreator", fields: [createdBy], references: [id], onDelete: SetNull)

  // Relationships
  permissions RolePermission[]
  userRoles   UserRoleAssignment[]

  @@index([name])
  @@index([createdBy])
  @@index([parentId])
  @@index([isActive])
  @@index([priority])
}

model Permission {
  id          String  @id @default(uuid())
  name        String  @unique
  displayName String // User-friendly permission name
  description String?

  // Permission Details
  resource String // Resource type (user, task, project, etc.)
  action   String // Action (create, read, update, delete, etc.)
  scope    String? // Scope limitation (own, team, organization, global)

  // Permission Properties
  isSystemPerm Boolean @default(false) // System permissions cannot be deleted
  isActive     Boolean @default(true)
  category     String  @default("general") // Permission category for organization

  // Conditions (JSON-based conditions for dynamic permissions)
  conditions Json? // Dynamic permission conditions

  // Metadata
  metadata Json? // Additional permission configuration

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // User who created this permission
  createdBy String?
  creator   User?   @relation("PermissionCreator", fields: [createdBy], references: [id], onDelete: SetNull)

  // Relationships
  rolePermissions RolePermission[]
  userPermissions UserPermission[]

  @@unique([resource, action, scope])
  @@index([resource])
  @@index([action])
  @@index([category])
  @@index([isActive])
  @@index([createdBy])
}

model RolePermission {
  id           String @id @default(uuid())
  roleId       String
  permissionId String

  // Permission Configuration
  effect     String @default("allow") // allow, deny
  conditions Json? // Additional conditions for this role-permission pair

  // Metadata
  grantedBy String? // User ID who granted this permission
  grantedAt DateTime  @default(now())
  expiresAt DateTime? // Optional expiration

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  role       Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
  @@index([effect])
  @@index([expiresAt])
}

model UserRoleAssignment {
  id     String @id @default(uuid())
  userId String
  roleId String

  // Role Assignment Properties
  effect String  @default("allow") // allow, deny
  scope  String? // Scope limitation for this user-role assignment

  // Assignment Details
  assignedBy String? // User ID who assigned this role
  assignedAt DateTime  @default(now())
  expiresAt  DateTime? // Optional expiration

  // Conditions
  conditions Json? // Dynamic conditions for role assignment

  // Metadata
  metadata Json? // Additional assignment metadata

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  role Role @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
  @@index([userId])
  @@index([roleId])
  @@index([effect])
  @@index([expiresAt])
}

model UserPermission {
  id           String @id @default(uuid())
  userId       String
  permissionId String

  // Direct Permission Assignment
  effect String  @default("allow") // allow, deny
  scope  String? // Scope limitation

  // Assignment Details
  assignedBy String? // User ID who granted this permission
  assignedAt DateTime  @default(now())
  expiresAt  DateTime? // Optional expiration
  reason     String? // Reason for direct permission assignment

  // Conditions
  conditions Json? // Dynamic conditions

  // Metadata
  metadata Json? // Additional metadata

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([userId, permissionId])
  @@index([userId])
  @@index([permissionId])
  @@index([effect])
  @@index([expiresAt])
}

model ResourceAccess {
  id           String @id @default(uuid())
  userId       String
  resourceType String // Type of resource (task, project, etc.)
  resourceId   String // ID of the specific resource

  // Access Details
  accessType  String // Type of access (owner, member, viewer, etc.)
  permissions Json // Specific permissions for this resource

  // Access Properties
  inheritedFrom String? // ID of parent resource if access is inherited
  isInherited   Boolean @default(false)
  isActive      Boolean @default(true)

  // Assignment Details
  grantedBy String? // User ID who granted access
  grantedAt DateTime  @default(now())
  expiresAt DateTime? // Optional expiration

  // Conditions
  conditions Json? // Dynamic access conditions

  // Metadata
  metadata Json? // Additional metadata

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, resourceType, resourceId])
  @@index([userId])
  @@index([resourceType])
  @@index([resourceId])
  @@index([accessType])
  @@index([isActive])
  @@index([expiresAt])
}

// External Invoice System Models

model ext_listhoadon {
  id        String  @id @default(uuid())
  idServer  String? @unique // Basic Invoice Info
  brandname String? // Tên nhãn hàng
  nbmst     String? // Mã số thuế người bán
  khmshdon  String? // Ký hiệu mẫu số hóa đơn
  khhdon    String? // Ký hiệu hóa đơn
  shdon     String? // Số hóa đơn
  cqt       String? // Cơ quan thuế
  hdon      String? // Hóa đơn
  hthdon    String? // Hình thức hóa đơn
  htttoan   String? // Hình thức thanh toán
  idtbao    String? // ID thông báo
  khdon     String? // Khách hàng hóa đơn
  khhdgoc   String? // Ký hiệu hóa đơn gốc
  khmshdgoc String? // Ký hiệu mẫu số hóa đơn gốc
  lhdgoc    String? // Loại hóa đơn gốc
  mhdon     String? // Mã hóa đơn
  mtdiep    String? // Mã thông điệp
  mtdtchieu String? // Mã thông điệp tham chiếu

  // Seller Information
  nbdchi      String? // Địa chỉ người bán
  chma        String? // Chữ ký mã
  chten       String? // Chữ ký tên
  nbhdktngay  DateTime? // Ngày ký hợp đồng người bán
  nbhdktso    String? // Số ký hợp đồng người bán
  nbhdso      String? // Số hợp đồng người bán
  nblddnbo    String? // Người bán lãnh đạo đại diện bộ
  nbptvchuyen String? // Người bán phương thức vận chuyển
  nbstkhoan   String? // Số tài khoản người bán
  nbten       String? // Tên người bán
  nbtnhang    String? // Tên nhãn hàng người bán
  nbtnvchuyen String? // Tên nhà vận chuyển người bán

  // Other Codes
  ncma    String? // Mã người cung cấp
  ncnhat  DateTime? // Ngày cập nhật người cung cấp
  ngcnhat DateTime? // Ngày cập nhật
  nky     String? // Người ký

  // Buyer Information
  nmdchi    String? // Địa chỉ người mua
  nmmst     String? // Mã số thuế người mua
  nmstkhoan String? // Số tài khoản người mua
  nmten     String? // Tên người mua
  nmtnhang  String? // Tên nhãn hàng người mua
  nmtnmua   String? // Tên người mua thực tế
  nmttkhac  String? // Thông tin khác người mua

  // Process Information
  ntao   DateTime? // Ngày tạo
  ntnhan DateTime? // Ngày nhận
  pban   String? // Phiên bản
  ptgui  String? // Phương thức gửi
  shdgoc String? // Số hóa đơn gốc
  tchat  String? // Tính chất
  tdlap  DateTime? // Thời điểm lập
  tgia   Decimal? // Tiền gia

  // Amounts
  tgtcthue  Decimal? // Tổng giá trị chưa thuế
  tgtthue   Decimal? // Tổng giá trị thuế
  tgtttbchu String? // Tổng giá trị thanh toán bằng chữ
  tgtttbso  Decimal? // Tổng giá trị thanh toán bằng số

  // Status and Processing
  thdon      String? // Trạng thái hóa đơn
  thlap      String? // Thời điểm lập
  thttlphi   Decimal? // Thành tiền lệ phí
  tlhdon     String? // Loại hóa đơn
  ttcktmai   String? // Trạng thái chấp nhận mã
  tthai      String? // Trạng thái
  tttbao     String? // Trạng thái thông báo
  ttxly      String? // Trạng thái xử lý
  tvandnkntt String? // Thông tin vận đơn kiện nhận thông tin

  // Additional Fields
  mhso      String? // Mã hiệu số
  ladhddt   Boolean? // Là hóa đơn điện tử
  mkhang    String? // Mã khách hàng
  nbsdthoai String? // Số điện thoại người bán
  nbdctdtu  String? // Địa chỉ thư điện tử người bán
  nbfax     String? // Fax người bán
  nbwebsite String? // Website người bán
  nmsdthoai String? // Số điện thoại người mua
  nmdctdtu  String? // Địa chỉ thư điện tử người mua
  nmcmnd    String? // CMND người mua
  nmcks     String? // Chữ ký số người mua

  // Legal and Compliance
  bhphap        String? // Bảo hộ pháp lý
  hddunlap      String? // Hóa đơn dự án lập
  gchdgoc       String? // Ghi chú hóa đơn gốc
  tbhgtngay     DateTime? // Thông báo hạn giao thời gian
  bhpldo        String? // Bảo hộ pháp lý do
  bhpcbo        String? // Bảo hộ pháp lý cơ bộ
  bhpngay       DateTime? // Bảo hộ pháp lý ngày
  tdlhdgoc      DateTime? // Thời điểm lập hóa đơn gốc
  tgtphi        Decimal? // Tổng giá trị phí
  unhiem        String? // Ủy nhiệm
  mstdvnunlhdon String? // Mã số thuế đơn vị ủy nhiệm lập hóa đơn
  tdvnunlhdon   String? // Tên đơn vị ủy nhiệm lập hóa đơn

  // Regulatory Information
  nbmdvqhnsach String? // Người bán mã đơn vị quản hành sách
  nbsqdinh     String? // Người bán số quy định
  nbncqdinh    String? // Người bán ngày có quy định
  nbcqcqdinh   String? // Người bán cơ quan có quy định
  nbhtban      String? // Người bán hình thức bán
  nmmdvqhnsach String? // Người mua mã đơn vị quản hành sách
  nmddvchden   String? // Người mua địa điểm vận chuyển đến
  nmtgvchdtu   DateTime? // Người mua thời gian vận chuyển đầu
  nmtgvchdden  DateTime? // Người mua thời gian vận chuyển đến
  nbtnban      String? // Người bán tên nhân bán
  dcdvnunlhdon String? // Địa chỉ đơn vị ủy nhiệm lập hóa đơn

  // Processing Dates
  dksbke    DateTime? // Đăng ký sổ bán kê
  dknlbke   DateTime? // Đăng ký nhật lý bán kê
  thtttoan  String? // Trạng thái thanh toán
  msttcgp   String? // Mã số thuế TCGp
  gchu      String? // Ghi chú
  kqcht     String? // Kết quả chuyển hóa
  hdntgia   Decimal? // Hóa đơn nội tệ giá
  tgtkcthue Decimal? // Tổng giá trị không chính thuế
  tgtkhac   Decimal? // Tổng giá trị khác

  // Reference Information
  nmshchieu   String? // Người mua số hóa chiếu
  nmnchchieu  String? // Người mua ngân chứng chiếu
  nmnhhhchieu String? // Người mua nhà hàng hóa chiếu
  nmqtich     String? // Người mua quốc tịch
  ktkhthue    Decimal? // Kết toán khấu trừ thuế
  nmstttoan   String? // Người mua số tài khoản thanh toán
  nmttttoan   String? // Người mua thông tin thanh toán
  hdhhdvu     String? // Hóa đơn hàng hóa dịch vụ
  qrcode      String? // QR Code
  ttmstten    String? // Thông tin mã số tên
  ladhddtten  String? // Là hóa đơn điện tử tên

  // Export/Import
  hdxkhau     String? // Hóa đơn xuất khẩu
  hdxkptquan  String? // Hóa đơn xuất khẩu phương tiện quân
  hdgktkhthue Decimal? // Hóa đơn giá kê khai thuế
  hdonLquans  String? // Hóa đơn liên quan
  tthdclquan  String? // Thông tin hóa đơn chính liên quan
  pdndungs    String? // Phần dùng đúng số
  hdtbssrses  String? // Hóa đơn thông báo số sáng rộng ses

  // Duplicate Handling
  hdTrung    String? // Hóa đơn trùng
  isHDTrung  Boolean? // Có phải hóa đơn trùng
  hdcttchinh String? // Hóa đơn chính thức chính

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  details ext_detailhoadon[]

  @@unique([nbmst, khmshdon, shdon, khhdon])
  // Indexes for performance
  @@index([nbmst])
  @@index([khmshdon, shdon])
  @@index([tdlap])
  @@index([nmmst])
  @@index([tthai])
  @@index([createdAt])
}

model ext_detailhoadon {
  id String @id @default(uuid())

  // Reference to parent invoice
  idServer     String?  @unique // Basic Invoice Info
  idhdonServer String // Foreign key to ext_listhoadon.id
  // Item Information
  dgia         Decimal? // Đơn giá
  dvtinh       String? // Đơn vị tính
  ltsuat       Decimal? // Lũy tiến suất
  sluong       Decimal? // Số lượng
  stbchu       String? // Số thứ bằng chữ
  stckhau      Decimal? // Số tiền chiết khấu
  stt          Int? // Số thứ tự
  tchat        String? // Tính chất
  ten          String? // Tên hàng hóa/dịch vụ
  thtcthue     Decimal? // Thành tiền chưa thuế
  thtien       Decimal? // Thành tiền
  tlckhau      Decimal? // Tỷ lệ chiết khấu
  tsuat        Decimal? // Thuế suất
  tthue        Decimal? // Tiền thuế
  sxep         Int? // Sắp xếp
  dvtte        String? // Đơn vị tiền tệ
  tgia         Decimal? // Tiền gia
  tthhdtrung   String? // Thông tin hàng hóa trùng

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  invoice ext_listhoadon @relation(fields: [idhdonServer], references: [idServer], onDelete: Cascade)

  // Indexes
  @@index([idhdonServer])
  @@index([stt])
  @@index([createdAt])
  ext_sanphamhoadon ext_sanphamhoadon[]
}

model ext_sanphamhoadon {
  id String @id @default(uuid())
  iddetailhoadon String? // Foreign key to ext_detailhoadon.id
  ten String? // Tên sản phẩm
  ten2 String? // Tên sản phẩm 2
  ma  String? // Mã sản phẩm
  dvt String? // Đơn vị tính
  dgia Decimal? // Đơn giá
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  // Relationships
  detailhoadon ext_detailhoadon? @relation(fields: [iddetailhoadon], references: [id], onDelete: Cascade)
  // Indexes
  @@index([iddetailhoadon])
  @@index([ma])
  @@index([createdAt])
}

// =====================================================
// Menu Management System
// =====================================================

enum MenuType {
  SIDEBAR // Menu in sidebar navigation
  HEADER // Menu in header/top navigation
  FOOTER // Menu in footer
  MOBILE // Mobile-specific menu
  CUSTOM // Custom menu type
}

enum MenuTarget {
  SELF // Open in same tab
  BLANK // Open in new tab
  MODAL // Open in modal
}

model Menu {
  id String @id @default(uuid())

  // Basic Info
  title       String // Menu display title
  slug        String   @unique // URL-friendly identifier
  description String? // Menu description
  type        MenuType @default(SIDEBAR) // Menu type

  // Hierarchy
  parentId String? // Parent menu ID for nested menus
  parent   Menu?   @relation("MenuHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children Menu[]  @relation("MenuHierarchy")
  order    Int     @default(0) // Display order
  level    Int     @default(0) // Depth level in hierarchy
  path     String? // Full path from root (e.g., "/parent/child")

  // Navigation
  url         String? // Menu link URL
  route       String? // Internal route path
  externalUrl String? // External URL
  target      MenuTarget @default(SELF) // Link target

  // Display
  icon       String? // Icon name/class (lucide-react icon name)
  iconType   String? @default("lucide") // Icon library type
  badge      String? // Badge text
  badgeColor String? // Badge color
  image      String? // Image URL for menu item

  // Permissions & Access
  requiredPermissions String[] // Required permissions to view (JSON array)
  requiredRoles       String[] // Required roles to view
  isPublic            Boolean  @default(false) // Accessible without auth

  // State
  isActive    Boolean @default(true) // Active/inactive
  isVisible   Boolean @default(true) // Visible/hidden
  isProtected Boolean @default(false) // Protected from deletion

  // Metadata
  metadata   Json? // Additional metadata (JSON)
  cssClass   String? // Custom CSS class
  customData Json? // Custom data storage

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String? // User ID who created
  updatedBy String? // User ID who last updated

  // Relations
  creator User? @relation("MenuCreator", fields: [createdBy], references: [id], onDelete: SetNull)
  updater User? @relation("MenuUpdater", fields: [updatedBy], references: [id], onDelete: SetNull)

  // Indexes
  @@index([parentId])
  @@index([type])
  @@index([order])
  @@index([isActive])
  @@index([isVisible])
  @@index([createdAt])
  @@index([slug])
  @@map("menus")
}

// ===== AFFILIATE SYSTEM MODELS =====

enum AffUserRole {
  AFFILIATE
  MERCHANT
  ADMIN
}

enum AffCampaignStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum AffConversionStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
}

enum AffPaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

enum AffPaymentMethod {
  BANK_TRANSFER
  PAYPAL
  MOMO
  ZALOPAY
  OTHER
}

model AffUser {
  id     String      @id @default(uuid())
  userId String // Reference to main User table
  role   AffUserRole

  // Profile info
  companyName  String?
  businessType String?
  website      String?
  description  String?

  // Payment info
  paymentMethod AffPaymentMethod?
  bankAccount   String?
  paypalEmail   String?
  taxId         String?

  // Settings
  isActive     Boolean   @default(true)
  joinedAt     DateTime  @default(now())
  lastActiveAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  // For Merchants
  campaignsCreated AffCampaign[] @relation("CampaignCreator")

  // For Affiliates
  campaignJoins   AffCampaignAffiliate[]
  links           AffLink[]
  conversions     AffConversion[]
  paymentRequests AffPaymentRequest[]

  @@unique([userId])
  @@index([role])
  @@index([isActive])
  @@index([joinedAt])
  @@map("aff_users")
}

model AffCampaign {
  id          String  @id @default(uuid())
  name        String
  description String?

  // Product info
  productName  String
  productUrl   String
  productImage String?

  // Commission settings
  commissionRate Decimal  @db.Decimal(5, 2) // Percentage (0.00 to 100.00)
  commissionType String   @default("percentage") // percentage, fixed
  fixedAmount    Decimal? @db.Decimal(10, 2)

  // Campaign settings
  status          AffCampaignStatus @default(DRAFT)
  startDate       DateTime?
  endDate         DateTime?
  maxAffiliates   Int?
  requireApproval Boolean           @default(true)

  // Tracking
  totalClicks      Int     @default(0)
  totalConversions Int     @default(0)
  totalRevenue     Decimal @default(0) @db.Decimal(15, 2)
  totalCommission  Decimal @default(0) @db.Decimal(15, 2)

  // Creator info
  creatorId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  creator     AffUser                @relation("CampaignCreator", fields: [creatorId], references: [id], onDelete: Cascade)
  affiliates  AffCampaignAffiliate[]
  links       AffLink[]
  conversions AffConversion[]

  @@index([status])
  @@index([creatorId])
  @@index([startDate])
  @@index([endDate])
  @@index([createdAt])
  @@map("aff_campaigns")
}

model AffCampaignAffiliate {
  id          String @id @default(uuid())
  campaignId  String
  affiliateId String

  // Join status
  status     String    @default("pending") // pending, approved, rejected
  appliedAt  DateTime  @default(now())
  approvedAt DateTime?
  rejectedAt DateTime?
  reason     String? // For rejection or notes

  // Performance tracking
  totalClicks      Int     @default(0)
  totalConversions Int     @default(0)
  totalEarnings    Decimal @default(0) @db.Decimal(10, 2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  campaign  AffCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  affiliate AffUser     @relation(fields: [affiliateId], references: [id], onDelete: Cascade)

  @@unique([campaignId, affiliateId])
  @@index([status])
  @@index([appliedAt])
  @@map("aff_campaign_affiliates")
}

model AffLink {
  id          String @id @default(uuid())
  campaignId  String
  affiliateId String

  // Link details
  trackingCode String  @unique // Unique tracking identifier
  originalUrl  String // The merchant's product URL
  shortUrl     String? // Optional shortened URL

  // UTM and tracking parameters
  utmSource   String?
  utmMedium   String?
  utmCampaign String?
  utmContent  String?

  // Performance
  totalClicks      Int     @default(0)
  totalConversions Int     @default(0)
  totalEarnings    Decimal @default(0) @db.Decimal(10, 2)

  // Settings
  isActive  Boolean   @default(true)
  expiresAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  campaign    AffCampaign     @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  affiliate   AffUser         @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  clicks      AffClick[]
  conversions AffConversion[]

  @@index([trackingCode])
  @@index([campaignId])
  @@index([affiliateId])
  @@index([isActive])
  @@index([createdAt])
  @@map("aff_links")
}

model AffClick {
  id     String @id @default(uuid())
  linkId String

  // Tracking info
  ipAddress String?
  userAgent String?
  referer   String?
  country   String?
  city      String?
  device    String?
  browser   String?

  // Session tracking
  sessionId String?
  visitorId String? // For unique visitor tracking

  clickedAt DateTime @default(now())

  // Relations
  link AffLink @relation(fields: [linkId], references: [id], onDelete: Cascade)

  @@index([linkId])
  @@index([clickedAt])
  @@index([ipAddress])
  @@index([visitorId])
  @@map("aff_clicks")
}

model AffConversion {
  id          String @id @default(uuid())
  linkId      String
  campaignId  String
  affiliateId String

  // Conversion details
  orderId       String? // Merchant's order ID
  customerEmail String?
  saleAmount    Decimal @db.Decimal(15, 2)
  commission    Decimal @db.Decimal(10, 2)

  // Tracking
  clickId        String? // Link to the click that generated this conversion
  conversionType String  @default("sale") // sale, lead, signup, etc.

  // Status and validation
  status   AffConversionStatus @default(PENDING)
  currency String              @default("VND")

  // Timestamps
  convertedAt DateTime  @default(now())
  approvedAt  DateTime?
  rejectedAt  DateTime?
  paidAt      DateTime?

  // Notes and validation
  notes       String?
  validatedBy String? // Admin who validated

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  link      AffLink     @relation(fields: [linkId], references: [id], onDelete: Cascade)
  campaign  AffCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  affiliate AffUser     @relation(fields: [affiliateId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([convertedAt])
  @@index([affiliateId])
  @@index([campaignId])
  @@index([orderId])
  @@map("aff_conversions")
}

model AffPaymentRequest {
  id          String @id @default(uuid())
  affiliateId String

  // Payment details
  amount   Decimal          @db.Decimal(10, 2)
  currency String           @default("VND")
  status   AffPaymentStatus @default(PENDING)

  // Payment method details
  paymentMethod  AffPaymentMethod
  accountDetails String? // JSON string with payment account details

  // Processing info
  requestedAt DateTime  @default(now())
  processedAt DateTime?
  completedAt DateTime?
  failedAt    DateTime?

  // Reference and notes
  transactionId String? // Payment processor transaction ID
  notes         String?
  adminNotes    String?
  processedBy   String? // Admin who processed

  // Period info (what period this payment covers)
  periodStart DateTime
  periodEnd   DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  affiliate AffUser @relation(fields: [affiliateId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([affiliateId])
  @@index([requestedAt])
  @@index([periodStart, periodEnd])
  @@map("aff_payment_requests")
}

// ============================================
// HR MANAGEMENT MODELS - Onboarding/Offboarding
// ============================================

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum MaritalStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
}

enum EmploymentEventType {
  ONBOARDING
  PROMOTION
  TRANSFER
  SALARY_CHANGE
  POSITION_CHANGE
  DEPARTMENT_CHANGE
  OFFBOARDING
}

enum ContractType {
  PROBATION
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
  FREELANCE
}

enum TerminationType {
  RESIGNATION
  TERMINATION
  RETIREMENT
  CONTRACT_END
  MUTUAL_AGREEMENT
}

enum DocumentType {
  CV
  CONTRACT
  ID_CARD
  PASSPORT
  DEGREE
  CERTIFICATE
  PHOTO
  BANK_INFO
  HEALTH_CERTIFICATE
  OTHER
}

enum OnboardingStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum OffboardingStatus {
  INITIATED
  IN_PROGRESS
  PENDING_APPROVAL
  APPROVED
  COMPLETED
  CANCELLED
}

enum ClearanceStatus {
  PENDING
  PARTIAL
  COMPLETE
}

model EmployeeProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Employee Code
  employeeCode String @unique

  // Personal Information
  fullName            String
  displayName         String?
  citizenId           String?   @unique // CCCD/CMND
  citizenIdIssueDate  DateTime?
  citizenIdIssuePlace String?
  passportNumber      String?   @unique
  passportIssueDate   DateTime?
  passportExpiryDate  DateTime?

  dateOfBirth   DateTime?
  placeOfBirth  String?
  gender        Gender?
  maritalStatus MaritalStatus?
  nationality   String?        @default("Vietnam")

  // Contact Information
  personalEmail    String?
  personalPhone    String?
  permanentAddress String?
  currentAddress   String?
  city             String?
  district         String?
  ward             String?
  postalCode       String?

  // Emergency Contact
  emergencyContactName         String?
  emergencyContactRelationship String?
  emergencyContactPhone        String?
  emergencyContactAddress      String?

  // Education & Professional
  education      Json? // [{degree, school, major, year, gpa}]
  certifications Json? // [{name, issuer, date, expiryDate, fileId}]
  skills         String[]
  languages      Json? // [{language, proficiency}]

  // Banking Information
  bankName          String?
  bankAccountNumber String?
  bankAccountName   String?
  bankBranch        String?

  // Tax & Insurance
  taxCode               String? @unique
  socialInsuranceNumber String? @unique
  healthInsuranceNumber String? @unique

  // Employment Information
  department    String?
  position      String?
  level         String?
  team          String?
  directManager String? // User ID

  startDate        DateTime?
  probationEndDate DateTime?
  contractType     ContractType?
  workLocation     String?

  // Salary (encrypted or reference to separate salary table)
  salaryGrade String?

  // Status
  isActive Boolean @default(true)

  // Metadata
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?

  // Relations
  employmentHistory    EmploymentHistory[]
  documents            EmployeeDocument[]
  onboardingChecklist  OnboardingChecklist?
  offboardingProcesses OffboardingProcess[]

  @@index([employeeCode])
  @@index([citizenId])
  @@index([department])
  @@index([position])
  @@index([isActive])
  @@index([startDate])
  @@map("employee_profiles")
}

model EmploymentHistory {
  id                String          @id @default(cuid())
  employeeProfileId String
  employeeProfile   EmployeeProfile @relation(fields: [employeeProfileId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  eventType     EmploymentEventType
  eventDate     DateTime
  effectiveDate DateTime

  // Event Details
  previousValue Json? // Store previous state
  newValue      Json? // Store new state

  // Position & Department
  fromPosition   String?
  toPosition     String?
  fromDepartment String?
  toDepartment   String?
  fromLevel      String?
  toLevel        String?

  // Contract
  contractType      ContractType?
  contractNumber    String?
  contractStartDate DateTime?
  contractEndDate   DateTime?

  // Salary Change (if applicable)
  salaryChangePercentage Float?
  newSalaryGrade         String?

  // Offboarding Specific
  terminationType   TerminationType?
  terminationReason String?
  lastWorkingDay    DateTime?
  noticePeriodDays  Int?

  // Documents & Approvals
  documentIds    String[] // References to EmployeeDocument or File IDs
  approvalStatus String?
  approvedBy     String? // User ID
  approvedAt     DateTime?

  // Notes
  notes         String?
  internalNotes String? // Only visible to HR/Admin

  // Metadata
  processedBy String? // User ID who created/processed this record
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([employeeProfileId])
  @@index([eventType])
  @@index([eventDate])
  @@index([effectiveDate])
  @@map("employment_history")
}

model EmployeeDocument {
  id                String          @id @default(cuid())
  employeeProfileId String
  employeeProfile   EmployeeProfile @relation(fields: [employeeProfileId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  documentType DocumentType
  title        String
  description  String?

  // File Reference (from FileManager)
  fileId       String
  fileName     String
  fileUrl      String
  fileSize     Int?
  fileMimeType String?

  // Document Metadata
  documentNumber   String? // Contract number, certificate number, etc.
  issueDate        DateTime?
  expiryDate       DateTime?
  issuingAuthority String?

  // Verification & Validation
  isVerified        Boolean   @default(false)
  verifiedBy        String? // User ID
  verifiedAt        DateTime?
  verificationNotes String?

  // Access Control
  isConfidential Boolean  @default(false)
  accessibleBy   String[] // User IDs who can access

  // Metadata
  uploadedBy String
  uploadedAt DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([employeeProfileId])
  @@index([documentType])
  @@index([isVerified])
  @@index([expiryDate])
  @@map("employee_documents")
}

model OnboardingChecklist {
  id                String          @id @default(cuid())
  employeeProfileId String          @unique
  employeeProfile   EmployeeProfile @relation(fields: [employeeProfileId], references: [id], onDelete: Cascade)

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Checklist Configuration
  checklistTemplate String? // Reference to template used

  // Checklist Items (JSON for flexibility)
  tasks Json // [{id, category, title, description, required, completed, completedAt, completedBy, order}]

  // Categories might include:
  // - Documentation (ID, contracts, certificates)
  // - IT Setup (email, accounts, equipment)
  // - Training (orientation, safety, systems)
  // - Administrative (bank setup, insurance, parking)
  // - Introduction (team meeting, buddy assignment)

  // Progress Tracking
  totalTasks         Int   @default(0)
  completedTasks     Int   @default(0)
  progressPercentage Float @default(0)

  // Status & Timeline
  status               OnboardingStatus @default(PENDING)
  startDate            DateTime
  targetDate           DateTime?
  actualCompletionDate DateTime?

  // Assignments
  assignedTo String? // HR manager/coordinator User ID
  buddyId    String? // Assigned buddy/mentor User ID

  // Notifications
  remindersSent  Int       @default(0)
  lastReminderAt DateTime?

  // Feedback
  employeeFeedback String?
  managerFeedback  String?
  hrNotes          String?

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?

  @@index([status])
  @@index([startDate])
  @@index([targetDate])
  @@index([assignedTo])
  @@map("onboarding_checklists")
}

model OffboardingProcess {
  id                String          @id @default(cuid())
  employeeProfileId String
  employeeProfile   EmployeeProfile @relation(fields: [employeeProfileId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Exit Information
  lastWorkingDay    DateTime
  effectiveDate     DateTime?
  exitReason        String
  exitType          TerminationType
  resignationLetter String? // File ID or text

  // Notice Period
  noticePeriodDays Int?
  noticeGivenDate  DateTime?
  noticeRequired   Boolean   @default(true)

  // Checklist Items
  assetReturnChecklist  Json? // [{asset, assetId, category, returned, returnedDate, returnedTo, condition, notes}]
  knowledgeTransferPlan Json? // [{task, area, assignedTo, status, completedDate, notes}]
  accessRevocationList  Json? // [{system, access, revoked, revokedDate, revokedBy}]

  // Exit Interview
  exitInterviewScheduled Boolean   @default(false)
  exitInterviewDate      DateTime?
  exitInterviewBy        String? // HR manager User ID
  exitInterviewNotes     String?
  exitInterviewForm      Json? // Structured responses

  // Final Settlement
  finalSalaryAmount Float?
  unusedLeaveDays   Int?
  leavePayoutAmount Float?
  bonusAmount       Float?
  deductions        Json? // [{type, amount, reason}]
  totalSettlement   Float?
  paymentDate       DateTime?
  paymentStatus     String?

  // Clearance
  clearanceStatus ClearanceStatus @default(PENDING)
  clearanceSteps  Json? // [{department, clearedBy, clearedAt, notes}]

  // References & Documents
  referenceLetterRequested Boolean  @default(false)
  referenceLetterProvided  Boolean  @default(false)
  experienceCertificate    String? // File ID
  finalDocuments           String[] // File IDs

  // Rehire Eligibility
  eligibleForRehire Boolean?
  rehireNotes       String?

  // Process Status
  status OffboardingStatus @default(INITIATED)

  // Approvals
  approvalWorkflow Json? // [{step, approver, status, date, comments}]
  finalApprovedBy  String?
  finalApprovedAt  DateTime?

  // Assignment
  initiatedBy  String // User ID who initiated
  processOwner String? // HR manager handling the process

  // Completion
  completedAt DateTime?
  completedBy String?

  // Notes & Comments
  hrNotes          String?
  managerComments  String?
  employeeComments String?

  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([employeeProfileId])
  @@index([status])
  @@index([exitType])
  @@index([lastWorkingDay])
  @@index([clearanceStatus])
  @@map("offboarding_processes")
}

// ============================================================================
// PRODUCT & CATEGORY SYSTEM
// ============================================================================

enum ProductStatus {
  DRAFT
  ACTIVE
  INACTIVE
  OUT_OF_STOCK
  DISCONTINUED
}

enum ProductUnit {
  KG        // Kilogram
  G         // Gram
  BUNDLE    // Bó
  PIECE     // Củ/Quả
  BAG       // Túi
  BOX       // Hộp
}

// Category Model - Danh mục sản phẩm
model Category {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  description String?
  image       String?
  icon        String?
  
  // Hierarchy - hỗ trợ danh mục con
  parentId    String?
  parent      Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children    Category[] @relation("CategoryHierarchy")
  
  // SEO
  metaTitle       String?
  metaDescription String?
  metaKeywords    String?
  
  // Display
  displayOrder Int      @default(0)
  isActive     Boolean  @default(true)
  isFeatured   Boolean  @default(false)
  
  // Relations
  products Product[]
  
  // Metadata
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?
  
  @@index([slug])
  @@index([parentId])
  @@index([isActive])
  @@index([isFeatured])
  @@index([displayOrder])
  @@map("categories")
}

// Product Model - Sản phẩm
model Product {
  id          String        @id @default(uuid())
  name        String
  slug        String        @unique
  description String?
  shortDesc   String?       // Mô tả ngắn
  
  // Pricing
  price          Float
  originalPrice  Float?      // Giá gốc (để hiển thị giảm giá)
  costPrice      Float?      // Giá vốn
  
  // Inventory
  sku            String?     @unique
  barcode        String?     @unique
  stock          Int         @default(0)
  minStock       Int         @default(0)  // Ngưỡng tồn kho tối thiểu
  maxStock       Int?                     // Tồn kho tối đa
  
  // Product details
  unit           ProductUnit @default(KG)
  weight         Float?                   // Trọng lượng (gram)
  origin         String?                  // Xuất xứ (VD: Đà Lạt, Lâm Đồng)
  status         ProductStatus @default(ACTIVE)
  
  // Category
  categoryId  String
  category    Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  
  // Images
  images      ProductImage[]
  thumbnail   String?                    // Ảnh đại diện
  
  // Variants (sizes, colors, etc.)
  variants    ProductVariant[]
  
  // Attributes - JSON field for flexible attributes
  // VD: {"organic": true, "pesticide_free": true, "harvest_date": "2025-01-08"}
  attributes  Json?
  
  // SEO
  metaTitle       String?
  metaDescription String?
  metaKeywords    String?
  
  // Display & Features
  isFeatured      Boolean @default(false)
  isNewArrival    Boolean @default(false)
  isBestSeller    Boolean @default(false)
  isOnSale        Boolean @default(false)
  displayOrder    Int     @default(0)
  
  // Statistics
  viewCount       Int     @default(0)
  soldCount       Int     @default(0)
  
  // Dates
  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  createdBy   String?
  updatedBy   String?
  
  @@index([slug])
  @@index([categoryId])
  @@index([status])
  @@index([isFeatured])
  @@index([isNewArrival])
  @@index([isBestSeller])
  @@index([isOnSale])
  @@index([price])
  @@index([publishedAt])
  @@map("products")
}

// Product Images
model ProductImage {
  id        String   @id @default(uuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  url       String
  alt       String?
  title     String?
  isPrimary Boolean  @default(false)
  order     Int      @default(0)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([productId])
  @@index([isPrimary])
  @@map("product_images")
}

// Product Variants - Biến thể sản phẩm (VD: size, màu)
model ProductVariant {
  id        String  @id @default(uuid())
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  name      String  // VD: "1kg", "500g", "Túi 2kg"
  sku       String? @unique
  barcode   String? @unique
  
  price     Float
  stock     Int     @default(0)
  
  // Variant details
  attributes Json?  // VD: {"size": "1kg", "color": "green"}
  
  isActive  Boolean  @default(true)
  order     Int      @default(0)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([productId])
  @@index([isActive])
  @@map("product_variants")
}

// ============================================================================
// CALL CENTER INTEGRATION
// ============================================================================

enum CallDirection {
  INBOUND
  OUTBOUND
  LOCAL
}

enum CallStatus {
  ANSWER
  CANCELED
  BUSY
  NO_ANSWER
  FAILED
  UNKNOWN
}

enum CallCenterSyncMode {
  MANUAL
  SCHEDULED
}

model CallCenterRecord {
  id          String   @id @default(uuid())
  
  // External API fields
  externalUuid            String  @unique // uuid from external API
  direction               CallDirection
  callerIdNumber          String?
  outboundCallerIdNumber  String?
  destinationNumber       String?
  
  // Time fields (stored as epoch timestamps)
  startEpoch    String?
  endEpoch      String?
  answerEpoch   String?
  
  // Duration fields (in seconds)
  duration      String?  // Total call duration
  billsec       String?  // Billable seconds
  
  // Call disposition
  sipHangupDisposition String?
  callStatus           CallStatus
  
  // Recording
  recordPath    String?
  
  // Metadata
  domain        String?  // PBX domain
  rawData       Json?    // Full raw response for debugging
  
  // Sync tracking
  syncedAt      DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([externalUuid])
  @@index([direction])
  @@index([callStatus])
  @@index([callerIdNumber])
  @@index([destinationNumber])
  @@index([startEpoch])
  @@index([syncedAt])
  @@map("call_center_records")
}

model CallCenterConfig {
  id            String   @id @default(uuid())
  
  // API Configuration
  apiUrl        String   // Base API URL
  domain        String   // PBX domain
  apiKey        String?  // Optional API key for authentication
  
  // Sync Configuration
  syncMode      CallCenterSyncMode @default(MANUAL)
  cronExpression String? // For scheduled sync (e.g., "0 */5 * * * *")
  isActive      Boolean  @default(true)
  
  // Sync Range
  defaultDaysBack Int @default(30) // How many days back to sync
  
  // Pagination
  batchSize     Int @default(200) // Records per API request
  
  // Last sync info
  lastSyncAt    DateTime?
  lastSyncStatus String?  // "success", "error", "partial"
  lastSyncError  String?
  totalRecordsSynced Int @default(0)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@map("call_center_config")
}

model CallCenterSyncLog {
  id              String   @id @default(uuid())
  
  configId        String?  // Reference to config used
  
  // Sync details
  syncType        CallCenterSyncMode
  status          String   // "running", "success", "error"
  
  // Sync parameters
  fromDate        DateTime
  toDate          DateTime
  offset          Int      @default(0)
  
  // Results
  recordsFetched  Int      @default(0)
  recordsCreated  Int      @default(0)
  recordsUpdated  Int      @default(0)
  recordsSkipped  Int      @default(0)
  
  // Error tracking
  errorMessage    String?
  errorDetails    Json?
  
  // Timing
  startedAt       DateTime @default(now())
  completedAt     DateTime?
  duration        Int?     // Duration in milliseconds
  
  @@index([configId])
  @@index([status])
  @@index([startedAt])
  @@map("call_center_sync_logs")
}
