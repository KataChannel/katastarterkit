# ============================================================================
# PostgreSQL Performance Tuning for 2-Core, 4GB RAM Server
# ============================================================================
# Copy to: /var/lib/postgresql/data/postgresql.conf (inside container)
# Or mount as volume in docker-compose.yml

# ===== Memory Settings (for 256MB container limit) =====
shared_buffers = 64MB              # 25% of container memory
effective_cache_size = 192MB        # 75% of container memory
work_mem = 4MB                      # Per sort/hash operation
maintenance_work_mem = 16MB         # For VACUUM, CREATE INDEX

# ===== Connection Settings =====
max_connections = 50                # Reduced for limited memory
shared_preload_libraries = ''       # Disable unnecessary extensions

# ===== Query Planning =====
random_page_cost = 1.1              # For SSD storage
effective_io_concurrency = 200      # For SSD storage

# ===== Logging (minimal for disk space) =====
log_min_duration_statement = 1000   # Log slow queries (>1s)
log_line_prefix = '%t [%p]: '       # Simple log format
log_timezone = 'UTC'

# ===== WAL (Write-Ahead Logging) - Optimized for small disk =====
wal_buffers = 2MB
min_wal_size = 80MB
max_wal_size = 256MB
checkpoint_completion_target = 0.9

# ===== Background Workers =====
max_worker_processes = 2            # Match CPU cores
max_parallel_workers_per_gather = 1
max_parallel_workers = 2

# ===== Autovacuum =====
autovacuum = on
autovacuum_max_workers = 1          # Reduce worker count
autovacuum_naptime = 60s

# ===== Statistics =====
track_activities = on
track_counts = on
track_io_timing = off               # Disable for performance
