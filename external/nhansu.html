<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống quản lý nhân sự</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 0 0% 3.6%;
            --card: 0 0% 100%;
            --card-foreground: 0 0% 3.6%;
            --primary: 0 0% 9%;
            --primary-foreground: 0 0% 100%;
            --secondary: 0 0% 96.1%;
            --secondary-foreground: 0 0% 9%;
            --muted: 0 0% 89.8%;
            --muted-foreground: 0 0% 45.1%;
            --accent: 0 84.2% 60.2%;
            --accent-foreground: 0 0% 100%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 0 0% 100%;
            --border: 0 0% 89.8%;
            --input: 0 0% 89.8%;
            --ring: 0 0% 3.6%;
        }

        * {
            @apply border-border;
        }

        body {
            @apply bg-background text-foreground;
        }

        .card {
            @apply rounded-lg border bg-card text-card-foreground shadow-sm;
        }

        .button {
            @apply inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50;
        }

        .button-primary {
            @apply bg-primary text-primary-foreground hover:bg-primary/90;
        }

        .button-secondary {
            @apply border border-input bg-background hover:bg-accent hover:text-accent-foreground;
        }

        .button-destructive {
            @apply bg-destructive text-destructive-foreground hover:bg-destructive/90;
        }

        .button-ghost {
            @apply hover:bg-accent hover:text-accent-foreground;
        }

        .button-sm {
            @apply h-8 rounded-md px-3 text-xs;
        }

        .input {
            @apply flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50;
        }

        .textarea {
            @apply flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none;
        }

        .editable-cell {
            @apply transition-colors focus:bg-accent/20 focus:outline-none;
        }

        .table-row:hover {
            @apply bg-muted/50;
        }
    </style>
</head>
<body class="bg-background">
    <!-- Header -->
    <header class="border-b bg-card shadow-sm">
        <div class="container mx-auto px-6 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="rounded-lg bg-accent/10 p-2">
                        <i class="fas fa-users text-accent"></i>
                    </div>
                    <h1 class="text-3xl font-bold tracking-tight">Quản lý nhân sự</h1>
                </div>
                <div class="flex gap-2">
                    <button onclick="exportData()" class="button button-secondary button-sm">
                        <i class="fas fa-download mr-2"></i>Xuất dữ liệu
                    </button>
                    <button onclick="importData()" class="button button-primary button-sm">
                        <i class="fas fa-upload mr-2"></i>Nhập dữ liệu
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-6 max-w-7xl">
        <!-- Data Input Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Input Area -->
            <div class="card p-6">
                <div class="mb-4 flex items-center gap-3">
                    <i class="fas fa-paste text-accent"></i>
                    <h2 class="text-lg font-semibold">Nhập dữ liệu</h2>
                </div>
                <textarea 
                    id="dataInput" 
                    class="textarea mb-4"
                    placeholder="Dán dữ liệu từ Excel/CSV hoặc nhập thủ công..."></textarea>
                <div class="flex gap-3">
                    <button onclick="processData()" class="button button-primary flex-1 button-sm">
                        <i class="fas fa-cogs mr-2"></i>Xử lý dữ liệu
                    </button>
                    <button onclick="clearData()" class="button button-destructive button-sm">
                        <i class="fas fa-trash mr-2"></i>Xóa
                    </button>
                </div>
            </div>

            <!-- Column Configuration -->
            <div class="card p-6">
                <div class="mb-4 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-columns text-accent"></i>
                        <h2 class="text-lg font-semibold">Cấu hình cột</h2>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="addColumn()" class="button button-secondary button-sm button-ghost" title="Thêm cột">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button onclick="resetColumns()" class="button button-secondary button-sm button-ghost" title="Đặt lại">
                            <i class="fas fa-undo"></i>
                        </button>
                    </div>
                </div>
                <div id="columnContainer" class="space-y-2 max-h-60 overflow-y-auto">
                    <!-- Dynamic columns will be added here -->
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div id="tableContainer" class="card hidden overflow-hidden">
            <div class="border-b bg-muted/50 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-table text-accent"></i>
                        <h3 class="text-lg font-semibold">Dữ liệu nhân sự</h3>
                    </div>
                    <div class="flex items-center gap-4">
                        <span id="statsText" class="text-sm text-muted-foreground"></span>
                        <button onclick="addRow()" class="button button-secondary button-sm button-ghost">
                            <i class="fas fa-plus mr-1"></i>Thêm dòng
                        </button>
                    </div>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="border-b bg-muted/50">
                        <tr id="tableHeader"></tr>
                    </thead>
                    <tbody id="tableBody" class="divide-y"></tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Hidden file input -->
    <input type="file" id="fileInput" accept=".csv,.txt" style="display: none;" onchange="handleFileImport(event)">

    <script>
        let columns = [];
        let tableData = [];
        
        document.addEventListener('DOMContentLoaded', function() {
            loadFromStorage();
            renderColumnInputs();
        });

        function loadFromStorage() {
            const savedColumns = localStorage.getItem('hrColumns');
            const savedData = localStorage.getItem('hrData');
            
            columns = savedColumns ? JSON.parse(savedColumns) : ['Họ tên', 'Chức vụ', 'Phòng ban', 'Email', 'Điện thoại'];
            tableData = savedData ? JSON.parse(savedData) : [];
            
            if (tableData.length > 0) renderTable();
        }

        function saveToStorage() {
            localStorage.setItem('hrColumns', JSON.stringify(columns));
            localStorage.setItem('hrData', JSON.stringify(tableData));
        }

        function renderColumnInputs() {
            const container = document.getElementById('columnContainer');
            container.innerHTML = '';
            
            columns.forEach((column, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center gap-2';
                div.innerHTML = `
                    <input type="text" 
                           value="${column}" 
                           onchange="updateColumn(${index}, this.value)"
                           class="input flex-1">
                    <button onclick="removeColumn(${index})" class="button button-destructive button-sm button-ghost" title="Xóa">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(div);
            });
        }

        function addColumn() {
            columns.push(`Cột ${columns.length + 1}`);
            renderColumnInputs();
            saveToStorage();
        }

        function removeColumn(index) {
            if (columns.length <= 1) {
                alert('Phải có ít nhất 1 cột!');
                return;
            }
            columns.splice(index, 1);
            tableData = tableData.map(row => {
                row.splice(index, 1);
                return row;
            });
            renderColumnInputs();
            if (tableData.length > 0) renderTable();
            saveToStorage();
        }

        function updateColumn(index, value) {
            columns[index] = value;
            if (tableData.length > 0) renderTable();
            saveToStorage();
        }

        function resetColumns() {
            columns = ['Họ tên', 'Chức vụ', 'Phòng ban', 'Email', 'Điện thoại'];
            renderColumnInputs();
            saveToStorage();
        }

        function processData() {
            const dataInput = document.getElementById('dataInput').value.trim();
            if (!dataInput) {
                alert('Vui lòng nhập dữ liệu!');
                return;
            }

            const rows = dataInput.split('\n').filter(row => row.trim());
            tableData = rows.map(row => {
                const cells = row.split('\t').length > 1 ? row.split('\t') : row.split(',');
                while (cells.length < columns.length) cells.push('');
                return cells.slice(0, columns.length);
            });

            renderTable();
            saveToStorage();
        }

        function renderTable() {
            const tableContainer = document.getElementById('tableContainer');
            const tableHeader = document.getElementById('tableHeader');
            const tableBody = document.getElementById('tableBody');
            
            tableHeader.innerHTML = '';
            columns.forEach(col => {
                const th = document.createElement('th');
                th.className = 'px-6 py-3 text-left text-sm font-semibold';
                th.textContent = col;
                tableHeader.appendChild(th);
            });
            
            const actionTh = document.createElement('th');
            actionTh.className = 'px-6 py-3 text-center text-sm font-semibold w-24';
            actionTh.textContent = 'Thao tác';
            tableHeader.appendChild(actionTh);

            tableBody.innerHTML = '';
            tableData.forEach((row, rowIndex) => {
                const tr = document.createElement('tr');
                tr.className = 'table-row border-b';
                
                columns.forEach((col, colIndex) => {
                    const td = document.createElement('td');
                    td.className = 'px-6 py-4 text-sm editable-cell cursor-text';
                    td.contentEditable = true;
                    td.textContent = row[colIndex] || '';
                    td.addEventListener('blur', () => updateCellData(rowIndex, colIndex, td.textContent));
                    tr.appendChild(td);
                });
                
                const actionTd = document.createElement('td');
                actionTd.className = 'px-6 py-4 text-center';
                actionTd.innerHTML = `
                    <button onclick="deleteRow(${rowIndex})" class="button button-ghost text-destructive hover:bg-destructive/10 button-sm">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                tr.appendChild(actionTd);
                tableBody.appendChild(tr);
            });

            tableContainer.classList.remove('hidden');
            updateStats();
        }

        function updateCellData(rowIndex, colIndex, value) {
            if (tableData[rowIndex]) {
                tableData[rowIndex][colIndex] = value;
                saveToStorage();
            }
        }

        function addRow() {
            tableData.push(new Array(columns.length).fill(''));
            renderTable();
            saveToStorage();
        }

        function deleteRow(index) {
            if (confirm('Bạn có chắc muốn xóa dòng này?')) {
                tableData.splice(index, 1);
                renderTable();
                saveToStorage();
            }
        }

        function updateStats() {
            document.getElementById('statsText').textContent = `${tableData.length} dòng • ${columns.length} cột`;
        }

        function clearData() {
            if (confirm('Bạn có chắc muốn xóa toàn bộ dữ liệu?')) {
                document.getElementById('dataInput').value = '';
                tableData = [];
                document.getElementById('tableContainer').classList.add('hidden');
                localStorage.removeItem('hrData');
            }
        }

        function exportData() {
            if (tableData.length === 0) {
                alert('Không có dữ liệu để xuất!');
                return;
            }
            
            let csvContent = columns.join(',') + '\n';
            tableData.forEach(row => {
                csvContent += row.map(cell => `"${cell}"`).join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `nhansu_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById('dataInput').value = e.target.result;
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>
