version: '3.8'

# ================================================================
# RAUSACH DOMAIN - PRODUCTION DEPLOYMENT
# ================================================================
# Frontend: http://116.118.49.243:12000
# Backend: http://116.118.49.243:12001
# Database: 116.118.49.243:12003
# ================================================================

services:
  # Backend with Bun
  rausach-backend:
    build:
      context: .
      dockerfile: ./backend/Dockerfile.production
    container_name: rausach-backend
    restart: unless-stopped
    env_file:
      - .env.prod.rausach
    environment:
      NODE_ENV: production
      PORT: 4000
      DATABASE_URL: postgresql://postgres:postgres@116.118.49.243:12003/rausachcore
      REDIS_HOST: 116.118.49.243
      REDIS_PORT: 12004
      MINIO_ENDPOINT: 116.118.49.243
      MINIO_PORT: 12007
      MINIO_USE_SSL: "false"
      MINIO_BUCKET_NAME: rausach-uploads
    ports:
      - "12001:4000"
    networks:
      - rausach-network

  # Frontend with Next.js
  rausach-frontend:
    build:
      context: .
      dockerfile: ./frontend/Dockerfile.production
      args:
        NEXT_PUBLIC_API_URL: http://116.118.49.243:12001
        NEXT_PUBLIC_GRAPHQL_URL: http://116.118.49.243:12001/graphql
        NEXT_PUBLIC_UPLOAD_URL: http://116.118.49.243:12001
        NEXT_PUBLIC_WEBSITE_URL: http://116.118.49.243:12000
        NEXT_PUBLIC_WEBSITE_NAME: Rausach
    container_name: rausach-frontend
    restart: unless-stopped
    env_file:
      - .env.prod.rausach
    environment:
      NODE_ENV: production
      NEXT_PUBLIC_GRAPHQL_ENDPOINT: http://116.118.49.243:12001/graphql
      NEXT_PUBLIC_APP_URL: http://116.118.49.243:12000
      NEXTAUTH_URL: http://116.118.49.243:12000
      NEXT_OTEL_ENABLED: "false"
      NEXT_TELEMETRY_DISABLED: "1"
    ports:
      - "12000:3000"
    depends_on:
      - rausach-backend
    networks:
      - rausach-network

networks:
  rausach-network:
    driver: bridge
    name: rausach-network
